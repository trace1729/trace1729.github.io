{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#_1","title":"\u6211\u662f\u8c01?","text":""},{"location":"%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/","title":"\u5199\u4f5c\u6307\u5357","text":""},{"location":"%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/#admonition","title":"Admonition","text":"<p>\u53ef\u4ee5\u4f7f\u7528</p> <p><code>!!! [note | warning | abstract | info | tip | success |faliure| danger | bug | example | quote]</code></p> <p>\u6765\u751f\u6210\u77e9\u5f62\u6846(\u6ce8\u610f\u6b63\u6587\u90e8\u5206\u9700\u8981\u7f29\u8fdb\u4e00\u4e2atab\uff0c \u4e0d\u80fd\u7528\u7a7a\u683c)</p> <pre><code>```\n!!! note\n    This is note\n\n!!! warning\n    This is warning\n\n!!! warning \"\u53ef\u6307\u5b9a\u663e\u793a\u7684\u5b57\u7b26\u4e32\"\n    This is warning\n\n???+ tips\n    \u53ef\u6298\u53e0\uff0c\u4f46\u662f\u9ed8\u8ba4\u5c55\u5f00\n\n??? tips\n    \u53ef\u6298\u53e0\n\n!!! info inline \"lhs\"\n    \u5728\u5de6\u8fb9\n\n!!! info inline end \"rhs\"\n    \u5728\u53f3\u8fb9\n```\n</code></pre> <p>\u6bd4\u5982\u4e0a\u8ff0\u4ee3\u7801\u4f1a\u6709\u4ee5\u4e0b\u6548\u679c</p> <p>Note</p> <p>This is note</p> <p>Warning</p> <p>This is warning</p> <p>\u53ef\u6307\u5b9a\u663e\u793a\u7684\u5b57\u7b26\u4e32</p> <p>This is warning</p> Tips <p>\u53ef\u6298\u53e0\uff0c\u4f46\u662f\u9ed8\u8ba4\u5c55\u5f00</p> Tips <p>\u53ef\u6298\u53e0</p> <p>lhs</p> <p>\u5728\u5de6\u8fb9!</p> <p>Success</p> <p>\u5c1d\u8bd5\u586b\u8865</p> <p>rhs</p> <p>\u5728\u53f3\u8fb9!</p> <p>Tip</p> <p>\u5c1d\u8bd5\u586b\u8865</p>"},{"location":"%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/#content-tabs","title":"\u9009\u9879\u5361 (content tabs)","text":"<p>\u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5c06\u4e0d\u540c\u7684\u5185\u5bb9\u653e\u5728\u4e0d\u540c\u7684\u9009\u9879\u5361\u4e0b\u3002\u6bd4\u5982\u63cf\u8ff0\u4e0d\u540c\u7f16\u7a0b\u8bed\u8a00\u4e0b\u5bf9\u4e00\u4e2a api \u7684\u8bbf\u95ee</p> <pre><code>=== \"c\"\n\n    \\`\\`\\`c\n    #include &lt;stdio.h&gt;\n    int main() {return 0;}\n    \\`\\`\\`\n\n=== \"cpp\"\n\n    \\`\\`\\`cpp\n    #include &lt;iostream&gt;\n    int main() {return 0;}\n    \\`\\`\\`\n</code></pre> ccpp <pre><code>#include &lt;stdio.h&gt;\nint main() {return 0;}\n</code></pre> <pre><code>#include &lt;iostream&gt;\nint main() {return 0;}\n</code></pre>"},{"location":"%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/#_2","title":"\u9ad8\u4eae\u5757","text":"<ul> <li> <p>\u53ef\u4ee5\u4f7f\u7528 <code>&lt;span class=\"box box-\u989c\u8272\"&gt;\u6587\u672c&lt;/span&gt;</code> \u6765\u7ed9\u6587\u5b57\u52a0\u80cc\u666f, \u6bd4\u5982green\uff0cred\uff0cyellow...</p> <ul> <li>\u7eff\u8272</li> <li>\u7ea2\u706f</li> <li>\u9ec4\u8272</li> <li>\u84dd\u8272</li> <li>\u7070\u8272</li> </ul> </li> </ul>"},{"location":"%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/#_3","title":"\u5b57\u4f53\u5927\u5c0f\u8c03\u6574","text":"<ul> <li> <p>\u53ef\u4ee5\u4f7f\u7528 \\(\\LaTeX\\) \u8bed\u6cd5\u6765\u6539\u53d8\u5b57\u4f53\u5927\u5c0f</p> <ul> <li><code>$\\small \u4f60\u662f\u8c01$</code> \\(\\small \u4f60\u662f\u8c01\\)</li> <li><code>$\\large \u4f60\u662f\u8c01$</code> \\(\\large \u4f60\u662f\u8c01\\)</li> <li><code>$\\Large \u4f60\u662f\u8c01$</code> \\(\\Large \u4f60\u662f\u8c01\\)</li> <li><code>$\\LARGE \u4f60\u662f\u8c01$</code> \\(\\LARGE \u4f60\u662f\u8c01\\)</li> <li><code>$\\huge \u4f60\u662f\u8c01$</code> \\(\\huge \u4f60\u662f\u8c01\\)</li> </ul> </li> </ul>"},{"location":"archive/cs61c-intro-risc/","title":"CS61C 1","text":""},{"location":"archive/cs61c-intro-risc/#isa","title":"ISA \u7684\u6982\u5ff5","text":""},{"location":"archive/cs61c-intro-risc/#risc-cisc","title":"RISC \u548c CISC","text":"<p>\u4e0a\u4e16\u7eaa\u6709\u4e24\u79cd\u6d41\u884c\u7684\u8ba1\u7b97\u673a\u7ec4\u7ec7\u7ed3\u6784</p> <ul> <li>CISC Complex Instruction Set Computer</li> </ul> <p>The main idea behind this is to make hardware simpler by using an instruction set composed of a few basic steps for loading, evaluating, and storing operations just like a load command will load data, a store command will store the data</p> <ul> <li>RISC reduced Instruction Set Computer</li> </ul> <p>The main idea is that a single instruction will do all loading, evaluating, and storing operations just like a multiplication command will do stuff like loading data, evaluating, and storing it, hence it\u2019s complex.</p> <p>\u57fa\u4e8e\u8fd9\u4e24\u7c7b\u7ec4\u7ec7\u7ed3\u6784\uff0c\u786c\u4ef6\u5de5\u7a0b\u5e08\u5f00\u53d1\u4e86\u591a\u79cd\u4e0d\u540c\u7684\u6307\u4ee4\u96c6(ISA)</p>"},{"location":"archive/cs61c-intro-risc/#isa-example","title":"ISA example","text":"<ul> <li> <p>\u57fa\u4e8e CISC \u5f00\u53d1</p> </li> <li> <p>Intel x86</p> </li> <li> <p>\u57fa\u4e8e RISC \u5f00\u53d1</p> </li> <li> <p>ARM</p> </li> <li> <p>RISC I - V </p> <p>1981\u5e74 \u7531 berkelay </p> </li> <li> <p>MIPS</p> </li> </ul>"},{"location":"archive/cs61c-intro-risc/#risc","title":"RISC","text":"<ul> <li>risc\u8bbe\u8ba1\u601d\u60f3\u662f\u5f53\u524d\u82af\u7247\u8bbe\u8ba1\u7684\u4e3b\u5bfc</li> <li>\u76ee\u524d intel x86 \u7684\u5e95\u5c42\u4e5f\u4f7f\u7528\u4e86 risc \u7684\u601d\u60f3\uff0c\u5373\u5c06\u4e00\u6761\u590d\u6742\u7684\u6307\u4ee4\u62c6\u5206\u6210\u591a\u6761\u7b80\u5355\u6307\u4ee4\u6267\u884c</li> </ul>"},{"location":"archive/cs61c-intro-risc/#risc-v","title":"RISC V","text":""},{"location":"archive/cs61c-intro-risc/#registers","title":"registers","text":"<ul> <li>RISC V \u753132\u4e2a\u5bc4\u5b58\u5668 \\(x_0\\) - \\(x_{31}\\)\u7ec4\u6210</li> <li> <p>\u53ef\u4ee5\u4f7f\u7528 \u6570\u5b57 \u6216\u8005 \u5bc4\u5b58\u5668\u540d \u6765\u5f15\u7528\u5bc4\u5b58\u5668</p> <ul> <li>\u4fdd\u5b58\u53d8\u91cf\u540d   \\(s_0\\) - \\(s_1\\) &lt;=&gt; \\(x_8\\) - \\(x_9\\),</li> </ul> <p>\\(s_2\\) - \\(s_{11}\\) &lt;=&gt; \\(x_{18}\\) - \\(x_{27}\\)  - \u4fdd\u5b58\u4e34\u65f6\u53d8\u91cf  \\(s_0\\) - \\(s_2\\) &lt;=&gt; \\(x_5\\) - \\(x_7\\),</p> <p>\\(s_3\\) - \\(s_{6}\\) &lt;=&gt; \\(x_{28}\\) - \\(x_{31}\\) * \\(x_0\\) \u662f 0\u5bc4\u5b58\u5668, \u5176\u503c\u6c38\u8fdc\u662f \\(0\\) * \u5b58\u50a8\u5728\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u503c \u6ca1\u6709 \u7c7b\u578b\u4e4b\u5206\uff0c\u6570\u503c\u7684\u7c7b\u578b\u53d6\u51b3\u4e8e\u5bf9\u6570\u503c\u8fdb\u884c\u7684\u64cd\u4f5c</p> </li> </ul>"},{"location":"archive/cs61c-intro-risc/#_1","title":"\u6307\u4ee4","text":"<p>Instruction Syntax is rigid: op dst, src1, src2</p> <ul> <li>1 operator, 3 operands</li> <li>op = operation name (\u201coperator\u201d)</li> <li>dst = register getting result (\u201cdestination\u201d)</li> <li>src1 = first register for operation (\u201csource 1\u201d)</li> <li>src2 = second register for operation (\u201csource 2\u201d)</li> </ul>"},{"location":"archive/cs61c-intro-risc/#_2","title":"\u7b97\u6570\u6307\u4ee4","text":"<p>c: <code>a = (b + c) - (d + e)</code></p> <p>risc:  <pre><code>add s0 t1 t2 # b+c\nadd s1 t3 t4 # d+e\nsub s2 s0 s1 # (b+c) - (d+e)\n</code></pre></p>"},{"location":"archive/cs61c-intro-risc/#_3","title":"\u7acb\u5373\u6570","text":"<p>c: <code>a = c + 5</code></p> <p>risc: <code>addi s0 s1 5</code></p>"},{"location":"archive/cs61c-intro-risc/#_4","title":"\u6570\u636e\u4f20\u8f93\u6307\u4ee4","text":"<p>Instruction syntax for data transfer:</p> <ul> <li>memop reg, off(bAddr)</li> <li>memop = operation name (\u201coperator\u201d)</li> <li>reg = register for operation source or destination</li> <li>bAddr = register with pointer to memory (\u201cbase   address\u201d)</li> <li>off = address offset (immediate) in bytes (\u201coffset\u201d)</li> </ul> <p>c: <code>a[10] = a[3] + b</code></p> <p>risc: <pre><code>  lw t0, 12(s3)     \n  add t0 s1 t0\n  sw t0, 40(s3) # \u5c06t0 \u5b58\u5165 s3\n</code></pre> \u5927\u7aef\u5c0f\u7aef</p> <ul> <li>\u5927\u7aef <p>Most-significant byte at least address of word</p> </li> <li>\u5c0f\u7aef <p>Least-significant byte at least address of word</p> </li> </ul> <p>risc v \u4f7f\u7528\u7684\u662f \u5c0f\u7aef\u6cd5</p> <p>\u5b57\u8282\u64cd\u4f5c </p> <p>For example, let s0 = 0x00000180:</p> <p><pre><code>lb s1,1(s0)\nlb s2,0(s0)\nsb s2,2(s0)\n48\n# s1=0x00000001\n# s2=0xFFFFFF80\n# *(s0)=0x00800180\n</code></pre> \u6ce8\u610f\u7ec6\u8282</p> <ul> <li>\u5c0f\u6807\u4ece0\u5f00\u59cb</li> <li>\u7531\u4e8e\u6570\u636e\u4ee5\u5c0f\u7aef\u65b9\u5f0f\u5b58\u50a8\uff0c\u5f15\u7528\u6570\u636e\u662f\u4ece\u5730\u4f4d\u5411\u9ad8\u4f4d\u8ba1\u7b97\u5b50\u8282\u6570</li> <li>\u4e00\u4e2a\u5b50\u82828\u4f4d =&gt; \u4e24\u4f4d16\u8fdb\u5236</li> <li>\u6ce8\u610f\u7b26\u53f7\u6269\u5c55  </li> </ul>"},{"location":"archive/cs61c-intro-risc/#_5","title":"\u6761\u4ef6\u5224\u65ad","text":"<ul> <li>Branch if equal</li> <li>beq reg1, reg2, label</li> <li>if v(reg1) == v(reg2)</li> <li>go to label </li> <li>Branch if not equal</li> <li>bne reg1, reg2, label</li> <li>if v(reg1) != v(reg2)</li> <li>go to label </li> <li>Branch if less than</li> <li>blt </li> <li>Branch if greater than or equal </li> <li>bgt</li> <li>jump</li> <li>j label</li> <li>unconditional jump to label</li> </ul> <p>   In cpp     <pre><code>if (i ==j) a = b\nelse a = -b\n</code></pre> </p> <p>     In risc 5     <pre><code># i -&gt; s0, j -&gt; s1\n# a -&gt; s2, b -&gt; s3\nbeq s0, s1, then\n\nelse:  # if true\n  sub s2 x0 s3\n  j end\n\nthen: # if false\n  add s2 x3 x0\n  j end\n\nend:\n</code></pre> </p>"},{"location":"archive/cs61c-intro-risc/#_6","title":"\u79fb\u4f4d\u64cd\u4f5c","text":"<ul> <li>\u903b\u8f91\u53f3\u79fb \u5728\u5de6\u8fb9\u88650</li> <li>\u903b\u8f91\u5de6\u79fb \u5728\u53f3\u8fb9\u88650</li> <li>\u7b97\u6570\u53f3\u79fb \u5728\u5de6\u8fb9\u88651</li> </ul>"},{"location":"archive/cs61c-intro-risc/#some-tips","title":"some tips","text":"<p>   `op` \u6307\u4ee4 \u4e0e `op+i` \u6307\u4ee4\u7684\u533a\u522b\u5728\u4e0e \u540e\u8005\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u7acb\u5373\u6570\u800c\u975e\u5bc4\u5b58\u5668</p> <p>   \u6ce8\u610f\u6ca1\u6709`subi`\u6307\u4ee4</p>"},{"location":"archive/math-equation-test/","title":"math_equation_test","text":"\\[ \\frac{1}{n \\left( n+k \\right)}= \\frac{1}{k}\\left( \\frac{1}{n}-\\frac{1}{n+k}\\right)  \\] \\[ \\begin{array}{c}    \\text{\u82e5}\\left \\{a_{n}\\right \\}\u3001\\left \\{b_{n}\\right \\}\\text{\u4e3a\u7b49\u5dee\u6570\u5217}, \\\\    \\text{\u5219}\\left \\{a_{n}+ b_{n}\\right \\}\\text{\u4e3a\u7b49\u5dee\u6570\u5217}  \\end{array} \\] \\[ \\begin{pmatrix}     a_{11} &amp; a_{12} &amp; a_{13} \\\\     a_{21} &amp; a_{22} &amp; a_{23} \\\\     a_{31} &amp; a_{32} &amp; a_{33}   \\end{pmatrix}  \\]"},{"location":"archive/%E8%80%83%E7%A0%94/","title":"\u8003\u7814","text":"<p>\u590d\u8bd5\u5b66\u751f\u540d\u5355 </p> <p>\u4e13\u4e1a\u76ee\u5f55\u67e5\u8be2 </p> \u4e13\u4e1a\u4ee3\u7801 \u4e13\u4e1a\u540d\u79f0 \u9884\u8ba1\u62db\u6536\u4eba\u6570 \u8fdb\u5165\u590d\u8bd5\u4eba\u6570 \u6700\u4f4e\u5206 \u6700\u9ad8\u5206 081200 \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u6280\u672f 28 36 298 379 085404 \u8ba1\u7b97\u673a\u6280\u672f 100 114 341 404 085405 \u8f6f\u4ef6\u5de5\u7a0b 40 50 321 383 085412 \u7f51\u7edc\u4e0e\u4fe1\u606f\u5b89\u5168 14 22 331 398"},{"location":"notes/PA2%20summery/","title":"\u603b\u7ed3","text":"<ol> <li>PA2.1</li> <li>PA2.2 \u6709\u5173 string \u7684\u5904\u7406</li> <li>PA2.3</li> <li>\u5f85\u529e\u4e8b\u9879</li> </ol>"},{"location":"notes/PA2%20summery/#pa21","title":"PA2.1","text":"<p>NEMU \u8bd1\u7801\u89e3\u6790</p> <pre><code>decode_exec \n    |\n    |  (define INSTPAT_MATCH, INSTPAT_START)\n    |            |____ decode_operand (:func)  \n    |____ (a sequence of) INSTPAT (:macro)\n            | (4 \u4e2a\u53c2\u6570\uff1a\u5339\u914d\u6a21\u5f0f\uff0c\u6307\u4ee4\u540d\u79f0\uff0c\u8d44\u6599\u7c7b\u578b\uff0c\u8d44\u6599\u52a8\u4f5c)\n            |_____ pattern_decode (:func)\n            |            (\u786e\u5b9a key mask shift)\n            |_____ If match, execute INSTPAT_MATCH\n            |_____ then goto __instpat_end (\u8fd9\u662f\u4e00\u4e2atag)\n                            |__ \u8fd9\u4e2a\u662f\u5728 INSTPAT_START \n                                \u5b9a\u4e49\u7684\u4e00\u4e2a\u4e1c\u4e1c\n</code></pre> <p>objdump \u751f\u6210\u7684\u53cd\u6c47\u7f16\u662f\u53ef\u8bfb\u6027\u6700\u597d\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u6240\u4ee5\u4f1a\u5305\u542b\u4e00\u4e9b\u4f2a\u6307\u4ee4\uff0c\u8fd9\u4e9b\u4f2a\u6307\u4ee4\u5176\u5b9e\u5c31\u662f base instruction \u4e2d\u7684\u4e00\u79cd\uff0c(alias) \u672c\u8eab \u4f2a\u6307\u4ee4\u662f\u6ca1\u6709\u81ea\u5df1\u7684byte representation \u7684\u3002</p> <p>\u9ad8\u4f4d\u4f4e\u4f4d\u7684\u533a\u522b   \u5728\u4f7f\u7528 python \u683c\u5f0f\u5316\u6307\u4ee4\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u65f6\uff0c\u6ce8\u610f \u6307\u4ee4\u7684\u6700\u9ad8\u4f4d\uff0c\u5b58\u5728python\u7684\u5b57\u7b26\u4e32\u91cc\uff0c\u5bf9\u5e94\u7684\u662f\u6700\u4f4e\u4f4d\u3002 \u6bd4\u5982\u5bf9\u4e8e0x12\u8fd9\u4e2a16\u8fdb\u5236\u6570\u6765\u8bf4, 0001 \u662f\u5b9e\u9645\u4e0a\u7684\u9ad8\u56db\u4f4d\u3002\u800c\u5f53\u6211\u4eec\u5c06\u5176\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u50a8\u5b58\u5728 python \u4e2d\u65f6, s = bin(0x12) (s == '0x00010010')\u3002\u4fdd\u5b58 0001 \u5bf9\u5e94\u7684\u4e0b\u6807\u662f \u4f4e\u56db\u4f4d\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u5bb9\u6613\u6df7\u6dc6\u3002</p> <p>hexdump \u9ed8\u8ba4\u4f7f\u7528 big-endian \u6253\u5370 bin \u6587\u4ef6\u5185\u5bb9 xdd     \u9ed8\u8ba4\u4f7f\u7528 little-endian</p> <p>\u5047\u8bbe\u4e00\u4e2a\u6587\u4ef6\u5305\u542b <code>`\\x14\\x20`</code>, \u90a3\u4e48\u4f7f\u7528\u4e24\u79cd\u4e0d\u540c\u7684\u4e8c\u8fdb\u5236\u5c55\u793a\u5de5\u5177\u7684\u7ed3\u679c\u5982\u4e0b</p> <pre><code>hexdump:\n    2014\nxdd:\n    1420\n</code></pre> <p>\u6211\u4eec\u63a5\u4e0b\u6765\u8ba8\u8bba\u4e00\u4e0b\uff0cC\u8bed\u8a00\u65e0\u7b26\u53f7\u6570\u7684\u4e00\u4e9b\u7279\u6027</p> <pre><code>    unsigned x = -2147446780;\n    // printf(\"%0x\\n\", x); // actually, is the starting address of the stack.\n    int y = -4; \n    x = y; \n    unsigned t = 123;\n    unsigned s = t + x;\n    // \u65e0\u7b26\u53f7\u6570\u7684\u6ea2\u51fa\u662f defined behavior, \u81ea\u52a8\u5f52 0\n    // \u6240\u4ee5\u7ed3\u679c \u5c0f\u4e8e 123\n    // \u53e6\u4e00\u79cd\u7406\u89e3\u65b9\u5f0f\uff1a\u5728 \u65e0\u7b26\u53f7\u6570 \u7684\u8fd0\u7b97\u89c4\u5219\u4e0b\uff0c4 \u5bf9\u5e94\u7684\u52a0\u6cd5\u9006\u5143\u662f 2^n - 4\n    // t + x = 119 + (4 + 2^n - 4) = 119 + 0\n    printf(\"t(%u) + x(%u) = s(%u)\\n\", t, x, s);\n    s = t * x;\n    printf(\"%d\\n\", s);\n    // s = t / x; \u5982\u679c\u4e0d\u5f3a\u5236\u7c7b\u578b\u8f6c\u5316, then x is promoted to unsignd \n    s = (int)t / (int)x; \n    printf(\"%d\\n\", s);\n</code></pre> <p>\u6d4b\u8bd5\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u7684\u65f6\u5019\u662f\u5426\u4f1a\u8fdb\u884c sign-extending</p> <pre><code>// nemu \u4e4b\u6240\u4ee5\u4f7f\u7528 bit field \u5c31\u662f\u4e3a\u4e86\u80fd\u6307\u5b9a\u4f4d\u6570\u4e3a\u7b26\u53f7\u4f4d (\u6bd4\u598220\uff0c\u800c\u975e32\u621664)\uff0c\u8fd9\u6837\n// \u5728\u8d4b\u503c\u7ed9\u65e0\u7b26\u53f7\u6570 \u8fdb\u884c type promotion \u65f6, \u80fd\u6309\u7167\u6307\u5b9a\u4f4d\u7684\u503c\u8fdb\u884c sign extension\n// (i.e. \u5c06\u7b2c 20 \u4f4dsign extend \u5230 32 \u4f4d)  \nunsigned tmp = ({struct { int n: 8; } __x = {.n = -128}; (unsigned)__x.n;});\nprintf(\"%u\\n\", tmp);\n</code></pre> <p>\u6211\u4eec\u8bd5\u7740\u6253\u5370\u51fa4294967168\u7684\u4e8c\u8fdb\u5236\u8868\u793a\uff0c\u6765\u770b\u662f\u4e0d\u662f\u771f\u7684\u8fdb\u884c\u7684\u7b26\u53f7\u4f4d\u6269\u5c55</p> <pre><code>    print(bin(128))\n    print(bin(4294967168))\n    print(bin(1 &lt;&lt; 12))\n</code></pre> <p></p>"},{"location":"notes/PA2%20summery/#pa22-string","title":"PA2.2 \u6709\u5173 string \u7684\u5904\u7406","text":"<pre><code>strcat -----    memcpy---\n            |            |\n        |            |\nstrcpy --&gt; stpcpy --&gt; mempcpy\n                       |\n                   |\nstrncpy --&gt; stpncpy----- memset\n</code></pre> <p>\u603b\u7ed3 xxxcpy \u90fd\u4f1a\u8c03\u7528\u76f8\u5e94\u5730 xxpcpy\u3002 xxpcpy \u4e0e xxxcpy \u7684\u4e0d\u540c\u4e4b\u5904\u662f\uff1a</p> <ul> <li>xxpcpy \u8fd4\u56de\u7684\u4f4d\u7f6e\u662f dst + n</li> <li>xxxcpy \u8fd4\u56de\u7684\u4f4d\u7f6e\u662f dst</li> </ul> t(123) + x(4294967292) = s(119) -492 -30 <p></p>"},{"location":"notes/PA2%20summery/#pa23","title":"PA2.3","text":"<ul> <li> <p>\u5728\u751f\u6210elf\u6587\u4ef6\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4ec0\u4e48\u624d\u7b97\u662f\u7b26\u53f7\uff1f     \u53ef\u4ee5\u53c2\u8003 csapp \u7b2c\u4e03\u7ae0\u94fe\u63a5 P711          \u7b26\u53f7\u5305\u62ec \u5168\u5c40\u53d8\u91cf\u548c\u51fd\u6570 <li> <p>\u5728Linux\u4e0b\u7f16\u5199\u4e00\u4e2aHello World\u7a0b\u5e8f, \u7f16\u8bd1\u540e\u901a\u8fc7\u4e0a\u8ff0\u65b9\u6cd5\u627e\u5230ELF\u6587\u4ef6\u7684\u5b57\u7b26\u4e32\u8868, \u4f60\u53d1\u73b0\"Hello World!\"\u5b57\u7b26\u4e32\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u7684\u4ec0\u4e48\u4f4d\u7f6e? \u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837?     \u5728 .rodata \u533a\u57df (read only data)</p> </li> <li> <p>\u4e0d\u5339\u914d\u7684\u51fd\u6570\u8c03\u7528\u548c\u8fd4\u56de     \u7f16\u8bd1\u5668\u5bf9\u5c3e\u9012\u5f52\u8fdb\u884c\u4e86\u4f18\u5316</p> </li> <li> <p>\u4f7f\u7528strip \u53bb\u6389 <code>foo</code> \u7684\u7b26\u53f7\u8868\uff0c\u80fd\u6b63\u5e38\u8fd0\u884c\u3002     \u4f46\u662f\u53bb\u6389 <code>foo.o</code> \u7684\u7b26\u53f7\u8868\uff0c\u94fe\u63a5\u5931\u8d25\u3002     \u53ef\u80fd\u7684\u539f\u56e0\uff1a\u94fe\u63a5\u7684\u8fc7\u7a0b\u9700\u8981\u53c2\u8003\u7b26\u53f7\u8868\u751f\u6210\u76ee\u6807\u4ee3\u7801\uff0c\u800c\u8fd0\u884c\u7a0b\u5e8f\u4e0d\u9700\u8981\u4e86\u89e3\u8fd9\u4e9b\u4fe1\u606f\u3002</p> </li> <li> <p>\u5982\u679c string \u6d4b\u8bd5\u5931\u8d25\uff0cmake \u4e3a\u4ec0\u4e48\u4f1a\u8fd4\u56de -1     \u6839\u636e man make, \u5982\u679c\u6709 makefile\u6784\u5efa\u5931\u8d25\u7684\u8bdd\uff0c\u4f1a\u8fd4\u56de-1.</p> </li> <li> <p>\u89e3\u91ca\u53ef\u6267\u884c\u6587\u4ef6\u7684\u751f\u6210\u8fc7\u7a0b</p> <ol> <li>\u9996\u5148\u7531\u7f16\u8bd1\u5668\u5c06 AM \u7684\u5b9e\u73b0\u6253\u5305\u6210\u4e00\u4e2a\u5f52\u6863\u6587\u4ef6</li> <li>\u5176\u6b21\u5c06 \u76ee\u6807\u6e90\u6587\u4ef6 \u7f16\u8bd1\u6210 \u76ee\u6807\u6587\u4ef6</li> <li>\u6700\u540e\u5c06 klib \u4e5f\u6253\u5305\u6210\u5f52\u6863\u6587\u4ef6</li> <li>\u94fe\u63a5\u5668\u6839\u636e linker.ld \u751f\u6210 \u53ef\u6267\u884c\u6587\u4ef6</li> </ol> </li> <li> <p>\u4e3a\u4ec0\u4e48\u5b9a\u4e49\u5b8f<code>__NATIVE__USE__KLIB</code>\u4e4b\u540e\u5c31\u53ef\u4ee5\u628anative\u4e0a\u7684\u8fd9\u4e9b\u5e93\u51fd\u6570\u94fe\u63a5\u5230 klib ? \u8fd9\u5177\u4f53\u662f\u5982\u4f55\u53d1\u751f\u7684?</p> <ul> <li>gcc \u4f1a\u4f18\u5148\u94fe\u63a5\u5148\u51fa\u73b0\u7684\u51fd\u6570\u5b9e\u73b0\uff0c\u5f00\u542f <code>__NATIVE_USE_KLIB__</code>, \u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\u5e93\u51fd\u6570\u4f1a\u5148\u4e8eglibc\u5728\u94fe\u63a5\u8fc7\u7a0b\u4e2d\u51fa\u73b0</li> </ul> </li> <li> <p>\u6e38\u620f\u662f\u5982\u4f55\u8fd0\u884c\u7684     \u4ecenemu\u7684\u89c6\u89d2\uff0c\u7528\u6237\u6309\u4e0b\u6309\u952e\uff0csdl \u5e93\u68c0\u6d4b\u5230\u7528\u6237\u8f93\u5165\uff0c\u5c06\u6570\u636e\u653e\u5728 nemu \u6307\u5b9a\u7684\u6570\u636e\u5bc4\u5b58\u5668\u4e2d\u3002     \u4ece\u5e94\u7528\u7684\u89c6\u89d2\uff0c\u5185\u5c42\u7684 while \u5faa\u73af\u901a\u8fc7 AM \u63d0\u4f9b\u7684 <code>ioe_read</code> \u8bfb\u53d6\u5230\u4e86 \u7528\u6237\u6309\u4e0b\u7684\u952e\u7801 (<code>io_read</code> - <code>ioe_read</code> - <code>__am_device_function</code>)     \u8bfb\u53d6\u5230\u952e\u7801\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u7528\u6237\u8f93\u5165\u7684\u952e\u7801\u548c\u5c4f\u5e55\u4e0a\u5c55\u793a\u7684\u5b57\u6bcd\u76f8\u6bd4\u8f83</p> <ul> <li>\u5982\u679c\u4e00\u81f4\uff0c\u8bbe\u7f6e\u5b57\u6bcd\u7684\u5185\u5bb9\u4e3a NULL</li> <li>\u5728\u4e0b\u4e00\u4e2a\u5faa\u73af\u8c03\u7528 <code>game_update</code> \u66f4\u65b0\u754c\u9762(\u6570\u7ec4)\u3002</li> <li>\u5e94\u7528\u8c03\u7528 <code>io_write</code> \u5c06\u6570\u636e\u5199\u5165\u5230 nemu \u7684\u6307\u5b9a\u5730\u5740\u3002</li> <li>nemu \u5c06\u6570\u636e\u63d0\u4f9b\u7ed9 SDL2 \u5e93\uff0cSDL2 \u5e93\u8d1f\u8d23\u6e32\u67d3\u754c\u9762\u3002</li> </ul> </li> <li> <p>\u5982\u679c\u5728\u5185\u5c42 nemu \u8fd0\u884c\uff0c\u54ea\u53c8\u662f\u5982\u4f55\u8fd0\u884c\u7684     \u6d41\u7a0b\u662f\u4e00\u6837\u7684\u53ea\u4e0d\u8fc7\u591a\u52a0\u4e86\u4e24\u4e2a\u6b65\u9aa4 \u5e94\u7528\u7a0b\u5e8f -&gt; \u5185\u5c42 nemu \u7684 <code>io_read</code> -&gt; \u5185\u5c42 nemu \u7684 <code>ioe_read</code>     -&gt; \u5916\u5c42\u7684 <code>io(e)_read</code> -&gt; \u2026</p> </li> <li> <p>\u7f16\u8bd1\u4e0e\u94fe\u63a5</p> <ul> <li>\u5728nemu/include/common.h\u4e2d\u6dfb\u52a0\u4e00\u884cvolatile static int dummy;     \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u8bf7\u95ee\u91cd\u65b0\u7f16\u8bd1\u540e\u7684NEMU\u542b\u6709\u591a\u5c11\u4e2adummy\u53d8\u91cf\u7684\u5b9e\u4f53? \u4f60\u662f\u5982\u4f55\u5f97\u5230\u8fd9\u4e2a\u7ed3\u679c\u7684?<ul> <li>36\u4e2a riscv-linux-gnu-readelf -a xxx.elf |grep dummy</li> </ul> </li> <li>\u6dfb\u52a0\u4e0a\u9898\u4e2d\u7684\u4ee3\u7801\u540e, \u518d\u5728nemu/include/debug.h\u4e2d\u6dfb\u52a0\u4e00\u884cvolatile static int dummy;     \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u8bf7\u95ee\u6b64\u65f6\u7684NEMU\u542b\u6709\u591a\u5c11\u4e2adummy\u53d8\u91cf\u7684\u5b9e\u4f53? \u4e0e\u4e0a\u9898\u4e2ddummy\u53d8\u91cf\u5b9e\u4f53\u6570\u76ee\u8fdb\u884c\u6bd4\u8f83, \u5e76\u89e3\u91ca\u672c\u9898\u7684\u7ed3\u679c.<ul> <li>\u4f9d\u7136\u662f 36 \u4e2a\uff0c\u5bf9\u4e8e\u672a\u8d4b\u503c\u7684\u9759\u6001\u53d8\u91cf\uff0c\u7f16\u8bd1\u5668\u4f1a\u968f\u673a\u6311\u9009\u4e00\u4e2a\u4f7f\u7528\u3002</li> </ul> </li> <li>\u4fee\u6539\u6dfb\u52a0\u7684\u4ee3\u7801, \u4e3a\u4e24\u5904dummy\u53d8\u91cf\u8fdb\u884c\u521d\u59cb\u5316:volatile static int dummy = 0;     \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u4f60\u53d1\u73b0\u4e86\u4ec0\u4e48\u95ee\u9898? \u4e3a\u4ec0\u4e48\u4e4b\u524d\u6ca1\u6709\u51fa\u73b0\u8fd9\u6837\u7684\u95ee\u9898? (\u56de\u7b54\u5b8c\u672c\u9898\u540e\u53ef\u4ee5\u5220\u9664\u6dfb\u52a0\u7684\u4ee3\u7801.)<ul> <li>redefinition of dummy\uff0c\u5bf9\u4e8e\u672a\u8d4b\u503c\u7684\u9759\u6001\u53d8\u91cf\uff0c\u662f\u5f31\u7b26\u53f7\u94fe\u63a5\uff0c\u591a\u4e2a\u76f8\u540c\u7684\u5f31\u7b26\u53f7\u94fe\u63a5\u53ef\u4ee5\u5171\u5b58     \u800c\u5f3a\u7b26\u53f7\u94fe\u63a5\u4e0d\u884c</li> </ul> </li> </ul> </li> <li> <p>Makefile \u7684\u5de5\u4f5c\u65b9\u5f0f</p> </li> <p></p> <p></p>"},{"location":"notes/PA2%20summery/#xv6","title":"\u5173\u4e8e XV6","text":"<ul> <li> \u719f\u6089\u4e00\u4e0b\u9879\u76ee\uff0c\u4e3b\u8981\u662f xv6 \u76f8\u5173\u7684\uff0c\u5dee\u4e0d\u591a\u5fd8\u5149\u4e86\u3002</li> <li> <p>\u5199\u65f6\u590d\u5236\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u5728\u4f7f\u7528 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u5b50\u7236\u8fdb\u7a0b\u5171\u4eab\u7a7a\u95f4\uff0c\u5e76\u8bbe\u7f6e\u6743\u9650\u4e3a\u53ea\u8bfb\u3002</li> <li>\u5728\u5bf9\u53ea\u8bfb\u5185\u5bb9\u8fdb\u884c\u5199\u5165\u65f6\uff0c\u4f1a\u5f15\u53d1\u4e2d\u65ad\u5904\u7406\uff0c\u5728\u5904\u7406\u6a21\u5757\u4e2d\uff0c\u6211\u4eec\u518d\u4e3a  \u5b50\u8fdb\u7a0b\u7684\u6570\u636e\u5355\u72ec\u5206\u914d\u7a7a\u95f4\uff0c\u5199\u5165\u6570\u636e\u3002</li> </ul> </li> <li> <p>\u5982\u4f55\u6539\u8fdb\u7684\u5185\u5b58\u5206\u914d\u5668</p> <ul> <li>\u539f\u6765\u662f\u6240\u6709\u8fdb\u7a0b\u5171\u540c\u4f7f\u7528\u4e00\u4e2a\u5185\u5b58\u5206\u914d\u94fe\u8868\uff0c\u4e00\u628a\u5927\u9501\u4fdd\u5e73\u5b89\u3002</li> <li>\u73b0\u5728\u7ed9\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u5185\u5b58\u5206\u914d\u94fe\u8868\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 race condition\u3002</li> </ul> </li> <li> <p>\u7f51\u5361\u9a71\u52a8\u83b7\u53d6/\u53d1\u9001\u6570\u636e\u7684\u6d41\u7a0b</p> <ul> <li>\u53d1\u9001 \uff1a\u64cd\u4f5c\u7cfb\u7edf\u60f3\u8981\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c06\u6570\u636e\u653e\u5165\u73af\u5f62\u7f13\u51b2\u533a\u6570\u7ec4 tx_ring \u5185\uff0c\u7136\u540e\u9012\u589e E1000_TDT\uff0c\u7f51\u5361\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u53d1\u51fa\u3002</li> <li>\u8bfb\u53d6 \uff1a\u5f53\u7f51\u5361\u6536\u5230\u6570\u636e\u7684\u65f6\u5019\uff0c\u7f51\u5361\u9996\u5148\u4f7f\u7528 direct memory access\uff0c\u5c06\u6570\u636e\u653e\u5165 rx_ring \u73af\u5f62\u7f13\u51b2\u533a\u6570\u7ec4\u4e2d\uff0c          \u7136\u540e\u5411 CPU \u53d1\u8d77\u4e00\u4e2a\u786c\u4ef6\u4e2d\u65ad\uff0cCPU \u5728\u6536\u5230\u4e2d\u65ad\u540e\uff0c\u76f4\u63a5\u8bfb\u53d6 rx_ring \u4e2d\u7684\u6570\u636e\u5373\u53ef</li> </ul> </li> <li> <p>mmap \u7cfb\u7edf\u8c03\u7528\u4e3b\u8981\u662f\u5e72\u4ec0\u4e48\u7684</p> <ul> <li>\u521d\u59cb\u5316 \uff1a \u7528\u6237\u8c03\u7528 mmap \u7684\u65f6\u5019\uff0c\u627e\u5230\u4e00\u6bb5\u8fde\u7eed\u7684\u865a\u62df\u5730\u5740\uff0c\u5e76\u5c06\u6587\u4ef6\u5185\u5bb9\u6620\u5c04\u5230\u8fd9\u5757\u533a\u57df\u3002</li> <li>\u8bb0\u5f55  \uff1a  \u5c06\u6620\u5c04\u5173\u7cfb\u8bb0\u5f55\u5230 vma \u7ed3\u6784\u4f53\u4e2d</li> <li>\u4f7f\u7528  \uff1a \u65e5\u540e\u51fa\u73b0\u7f3a\u9875\u5f02\u5e38\uff0c\u9996\u5148\u770b\u6570\u636e\u662f\u5426\u80fd\u5728 vma \u4e2d\u547d\u4e2d\uff0c\u80fd\u627e\u5230\u7684\u8bdd\u5c31\u4e0d\u9700\u8981\u8bbf\u95ee\u6587\u4ef6\u4e86\u3002</li> </ul> </li> </ul>"},{"location":"notes/PA2%20summery/#_2","title":"\u81ea\u6211\u4ecb\u7ecd","text":"<p>\u8001\u5e08\u597d\uff0c\u6211\u662f\u9f9a\u5f00\u5bb8\uff0c\u5c31\u8bfb\u4e8e\u5357\u660c\u5927\u5b66\u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u6280\u672f\u4e13\u4e1a\u3002    </p> <p>\u6211\u5728\u672c\u79d1\u671f\u95f4\u505a\u4e86\u4e0d\u5c11\u8ba1\u7b97\u673a\u7cfb\u7edf\u76f8\u5173\u7684\u516c\u5f00\u8bfe\u3002\u6bd4\u5982\u4f2f\u514b\u5229\u7684CS61C\uff0c\u548c MIT \u7684 6.s081\u3002</p> <p>CS61C \u7684\u5185\u5bb9\u4e3b\u8981\u662f\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\uff0c\u4ece\u9ad8\u7ea7\u8bed\u8a00\u5165\u624b\uff0c\u81ea\u9876\u5411\u4e0b\u9010\u6b65\u4ecb\u7ecd\u8ba1\u7b97\u673a\u7684\u786c\u4ef6\u7ec6\u8282\u3002\u8fd9\u4e2a\u8bfe\u7a0b\u6709\u4e00\u4e2a\u9879\u76ee\u662f \u7528 logisim \u753b\u4e00\u4e2a \u4e8c\u7ea7\u6d41\u6c34\u7684 RV32IM \u5904\u7406\u5668\u3002\u5982\u4eca\u770b\u6765\u96be\u5ea6\u786e\u5b9e\u4e0d\u5927\uff0c\u4f46\u662f\u4e5f\u7b97\u6211\u7684\u5904\u7406\u5668\u8bbe\u8ba1\u542f\u8499\u7684\u4f5c\u54c1\u3002</p> <p>6.s081 \u7684\u5185\u5bb9\u662f\u5728\u6559\u5b66\u578b\u7684\u64cd\u4f5c\u7cfb\u7edfxv6\u4e0a\uff0c\u6dfb\u52a0\u4e00\u4e9b\u529f\u80fd \u6bd4\u5982\u8bf4\u65b0\u7684\u7cfb\u7edf\u8c03\u7528\u6216\u8005\u4e2d\u65ad\uff0c\u6216\u8005\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u6539\u8fdb \u6bd4\u5982 \u5b9e\u73b0\u5199\u65f6\u590d\u5236\uff0c\u51cf\u5c11\u521b\u5efa\u8fdb\u7a0b\u65f6\u7684\u5f00\u9500\u3002\u505a\u8fd9\u4e2a\u8bfe\u7a0b\u4e3b\u8981\u662f\u770b\u4e00\u4e0b\u5728\u64cd\u4f5c\u7cfb\u7edf\u6559\u6750\u4e2d\u62bd\u8c61\u7684\u6982\u5ff5\u662f\u5982\u4f55\u843d\u5b9e\u5230\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\u4e2d\u7684\u3002</p> <p>\u5728\u5927\u56db\u4e0a\u6211\u5f00\u59cb\u505a\u4e00\u751f\u4e00\u82af\uff0c\u5230\u73b0\u5728\u7684\u8bdd\u505a\u5b8c\u4e86\u5355\u5468\u671f\u7684 npc\uff0c\u6b63\u5728\u5199 PA3.1\u3002(\u628a\u8fd9\u4e2a RT-Thread \u63a5\u5165\u540e\u5c31\u51c6\u5907\u5199\u6d41\u6c34\u7ebf\u4e86)</p> <p>\u5728\u8fd9\u4e2a\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u611f\u89c9\u6700\u6311\u6218\u6027\u7684\u90e8\u5206\u8fd8\u662f\u5199 npc\u3002\u672c\u6765\u6211\u89c9\u7684\u6709 logisim \u7684\u7ecf\u9a8c\u518d\u7528 HDL \u5199\u4e00\u4e2a\u5e94\u8be5\u4f1a\u7b80\u5355\u70b9\u5427\u3002\u4f46\u662f\u771f\u6b63\u5f00\u59cb\u7528 verilog \u5199\u7684\u65f6\u5019\u72b6\u51b5\u767e\u51fa\u3002\u8fd9\u91cc\u4e3b\u8981\u662f\u4e24\u65b9\u9762\u539f\u56e0\uff0c\u9996\u5148\u662f verilog \u9648\u65e7\u7684\u8bed\u6cd5\u7279\u6027\u3002\u4ee4\u6211\u8bb0\u5fc6\u72b9\u65b0\u7684\uff0c\u662f\u4e00\u4e2a\u4fe1\u53f7\u7684\u8f93\u5165\u8f93\u51fa\u7c7b\u578b\u5199\u53cd\u4e86\uff0c\u8fd9\u4e2a bug \u6211\u627e\u4e86\u4e09\u5929\uff0c\u592a\u75db\u82e6\u4e86\u3002\u73b0\u5728\u60f3\u60f3\uff0c\u5f53\u65f6\u8fd8\u662f\u5bf9 verilator \u7684\u4eff\u771f\u673a\u5236\u4e0d\u719f\uff0c\u7136 \u540e\u6ca1\u6709\u79f0\u624b\u7684 verilog lsp \u5de5\u5177\u5bfc\u81f4\u6bcf\u6b21\u5199\u5b8c\u7f16\u8bd1\u90fd\u6709\u4e00\u5806 syntax error\u3002(\u66f4\u4e0d\u7528\u8bf4 verilator \u7684\u63d0\u793a\u4e0d\u7b97\u53cb\u597d)\u3002\u53cd\u6b63\u7528 verilog \u5199\u5b8c\u6700\u7b80\u5355\u7684\u5904\u7406\u5668\u4e4b\u540e\u6211\u5c31\u8f6c\u5b66 chisel\u3002chisel \u4e00\u5f00\u59cb\u5b66\u7684\u4e5f\u633a\u75db\u82e6\u7684\uff0c\u4f46\u662f\u5b83\u6bd5\u7adf\u6709\u5b8c\u5584\u7684\u7f16\u8f91\u5668\u548clsp\uff0c\u5728\u9547\u75db\u671f\u8fc7\u540e\u5c31\u7231\u4e0a chisel \u4e86\u3002</p> <p>\u5176\u6b21\u662f\u5bf9 HDL \u9002\u5e94\uff0c\u4e4b\u524d\u7684\u9ad8\u7ea7\u8bed\u8a00\u51e0\u4e4e\u90fd\u662f\u7ebf\u6027\u6267\u884c\u7684\uff0c\u4f46\u662f HDL \u4e3b\u8981\u63cf\u8ff0\u7684\u662f\u7535\u8def\u4e4b\u95f4\u7684\u903b\u8f91\u5173\u7cfb\uff0c\u5bf9\u4e8e\u7ec4\u5408\u903b\u8f91\u6765\u8bf4\uff0c\u5f88\u591a\u503c\u7684\u66f4\u65b0 \u90fd\u662f\u540c\u65f6\u53d1\u751f\u7684\u3002\u4ece\u7535\u8def\u56fe\u5230hdl\u8fde\u7ebf\u7684\u8f6c\u5316\u5bf9\u6211\u6765\u8bf4\u8fd8\u662f\u9700\u8981\u4e00\u5b9a\u7684\u65f6\u95f4\u3002</p>"},{"location":"notes/PA2%20summery/#todo","title":"TODO \u5f85\u529e\u4e8b\u9879","text":"<ul> <li> \u6355\u6349\u6b7b\u5faa\u73af</li> <li> \u5b9e\u73b0\u58f0\u5361</li> <li> \u4f18\u5316 litenes</li> </ul>"},{"location":"notes/ee219/","title":"EE219 project","text":""},{"location":"notes/ee219/#_1","title":"\u9879\u76ee\u7684\u76ee\u7684\u662f\u4ec0\u4e48","text":"<p>\u6838\u5fc3\u76ee\u6807\u662f\u8bbe\u8ba1\u81ea\u5b9a\u4e49\u6307\u4ee4\uff0c\u5b9e\u73b0\u4e0a\u5c42 AI \u5e94\u7528\u4e0e\u786c\u4ef6\u4e4b\u95f4\u7684\u9ad8\u6548\u4ea4\u4e92\u3002</p>"},{"location":"notes/ee219/#_2","title":"\u8f6f\u4ef6\u90e8\u5206","text":"<ol> <li> <p>\u57fa\u7840\u5b9e\u73b0    \u5373\u4fbf\u5b8c\u5168\u4e0d\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u5b8c\u6210\u63a8\u7406\u4efb\u52a1\uff0c\u4f8b\u5982\u8fd0\u884c\u7ecf\u5178\u7684 LeNet \u6a21\u578b\u3002\u7136\u800c\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u65f6\u95f4\u5468\u671f\uff0c\u6027\u80fd\u8f83\u4f4e\u3002</p> </li> <li> <p>\u4f18\u5316\u5b9e\u73b0    \u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4\u80fd\u591f\u663e\u8457\u52a0\u901f\u8fd0\u7b97\uff0c\u4f8b\u5982\u6307\u5bfc\u786c\u4ef6\u6a21\u5757\u52a0\u901f\u77e9\u9635\u8ba1\u7b97\u7684\u6838\u5fc3\u4efb\u52a1\u3002</p> </li> </ol> <p>\u5177\u4f53\u6b65\u9aa4\u5305\u62ec\uff1a</p> <ul> <li>\u8bbe\u8ba1\u81ea\u5b9a\u4e49\u6307\u4ee4\u96c6\uff0c\u7528\u4ee5\u652f\u6301\u77e9\u9635\u8fd0\u7b97\u3001\u5377\u79ef\u7b49\u5173\u952e\u529f\u80fd\u3002</li> <li>\u5c06\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u6307\u4ee4\u901a\u8fc7\u5185\u8054\u6c47\u7f16\u5c01\u88c5\u6210\u51fd\u6570\u63a5\u53e3\u3002</li> <li>\u5229\u7528\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5c06\u539f\u751f\u7684 C \u8bed\u8a00\u5b9e\u73b0\u6539\u5199\u4e3a\u652f\u6301\u81ea\u5b9a\u4e49\u6307\u4ee4\u7684\u7248\u672c\uff0c\u4ece\u800c\u5145\u5206\u5229\u7528\u786c\u4ef6\u52a0\u901f\u80fd\u529b\u3002</li> </ul>"},{"location":"notes/ee219/#_3","title":"\u786c\u4ef6\u90e8\u5206","text":"<p>\u4e3a\u4e86\u652f\u6301\u81ea\u5b9a\u4e49\u6307\u4ee4\uff0c\u6211\u4eec\u9700\u8981\u5728\u786c\u4ef6\u4e2d\u5b8c\u6210\u4ee5\u4e0b\u6a21\u5757\u7684\u5b9e\u73b0\uff1a</p> <ul> <li>\u5377\u79ef\u5c42\uff1a\u5904\u7406\u8f93\u5165\u7279\u5f81\u56fe\u548c\u5377\u79ef\u6838\u7684\u77e9\u9635\u8fd0\u7b97\u3002</li> <li>ReLU \u5c42\uff1a\u6fc0\u6d3b\u51fd\u6570\u6a21\u5757\uff0c\u7528\u4e8e\u975e\u7ebf\u6027\u53d8\u6362\u3002</li> <li>\u5168\u8fde\u63a5\u5c42\uff1a\u5b9e\u73b0\u7f51\u7edc\u7684\u5206\u7c7b\u6216\u56de\u5f52\u4efb\u52a1\u3002</li> </ul> <p>\u8fd9\u4e9b\u6a21\u5757\u5171\u540c\u7ec4\u6210\u4e86\u652f\u6301\u81ea\u5b9a\u4e49\u6307\u4ee4\u7684\u786c\u4ef6\u8ba1\u7b97\u6846\u67b6\u3002</p>"},{"location":"notes/ee219/#_4","title":"\u6784\u5efa\u6d41\u7a0b","text":"<p>\u5f53\u6211\u4eec\u8fd0\u884c <code>make run CFILE=xxx</code> \u547d\u4ee4\u65f6\uff0c\u5b9e\u9645\u53d1\u751f\u4e86\u4ee5\u4e0b\u51e0\u6b65\u64cd\u4f5c\uff1a</p> <ol> <li> <p>\u6784\u5efa\u5904\u7406\u5668\uff08build\uff09    \u4f7f\u7528 Verilator \u5c06 Verilog \u63cf\u8ff0\u7684\u5904\u7406\u5668\u8f6c\u5316\u4e3a C++ \u4eff\u771f\u6a21\u578b\uff0c\u540c\u65f6\u94fe\u63a5 C++ \u6fc0\u52b1\u6587\u4ef6\u4ee5\u751f\u6210\u53ef\u6267\u884c\u4eff\u771f\u7a0b\u5e8f\u3002</p> </li> <li> <p>\u751f\u6210\u53c2\u8003\u7ed3\u679c\uff08model\uff09    \u4f7f\u7528 Python \u811a\u672c\u8fd0\u884c\u8f6f\u4ef6\u6a21\u578b\uff0c\u751f\u6210\u7528\u4e8e\u5bf9\u6bd4\u7684\u9ec4\u91d1\u6807\u51c6\u7ed3\u679c\u3002</p> </li> <li> <p>\u7f16\u8bd1 C \u7a0b\u5e8f\uff08compile\uff09    \u501f\u52a9 AM \u6846\u67b6\uff0c\u5c06 C \u6e90\u4ee3\u7801\u7f16\u8bd1\u4e3a\u6c47\u7f16\u6307\u4ee4\uff0c\u5e76\u63d0\u53d6\u51fa\u6307\u4ee4\u4e8c\u8fdb\u5236\u6587\u4ef6\u4ee5\u4f9b\u786c\u4ef6\u4eff\u771f\u4f7f\u7528\u3002</p> </li> </ol> <p>\u6700\u540e\uff0c\u4eff\u771f\u7a0b\u5e8f\u4f1a\u52a0\u8f7d\u6307\u5b9a\u7684\u53c2\u6570\u8fd0\u884c\uff0c\u5e76\u9a8c\u8bc1\u4eff\u771f\u7ed3\u679c\u662f\u5426\u7b26\u5408\u9884\u671f\u3002</p>"},{"location":"notes/ee219/#_5","title":"\u65b9\u6cd5\u8bba","text":"<p><code>model.h</code> \u6587\u4ef6\u4e2d\u6ca1\u6709\u4efb\u4f55\u6ce8\u91ca\uff0c\u8fd9\u7ed9\u8c03\u8bd5\u5e26\u6765\u4e86\u6781\u5927\u7684\u56f0\u6270\u2014\u2014\u4e00\u4e0d\u7559\u795e\u5c31\u53ef\u80fd\u641e\u4e0d\u6e05\u695a\u6743\u91cd\u53c2\u6570\u5230\u5e95\u5b58\u50a8\u5728\u54ea\u91cc\u3002</p>"},{"location":"notes/ee219/#_6","title":"\u539f\u59cb\u8f6f\u4ef6\u5b9e\u73b0","text":"<p>\u5728 <code>model.py</code> \u4e2d\uff0c\u6211\u4eec\u4f9d\u6b21\u5b8c\u6210\u4e86\u4ee5\u4e0b\u4efb\u52a1\uff1a</p> <ol> <li> <p>\u52a0\u8f7d\u9884\u8bad\u7ec3\u53c2\u6570    \u5305\u62ec\u6bcf\u4e00\u5c42\u7684\u6743\u91cd\u53c2\u6570\uff08<code>weights</code>\uff09\u3001\u8f93\u5165\u91cf\u5316\u6bd4\u4f8b\uff08<code>input_scale</code>\uff09\u4ee5\u53ca\u8f93\u51fa\u91cf\u5316\u6bd4\u4f8b\uff08<code>output_scale</code>\uff09\u3002</p> </li> <li> <p>\u8fd0\u884c\u63a8\u7406\u5e76\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c    \u4f7f\u7528\u52a0\u8f7d\u7684\u6a21\u578b\u5bf9 CIFAR \u6570\u636e\u96c6\u4e2d\u7684\u4e00\u5f20\u56fe\u7247\u8fdb\u884c\u63a8\u7406\uff0c\u540c\u65f6\u5728\u63a8\u7406\u8fc7\u7a0b\u4e2d\u5c06\u6bcf\u4e00\u5c42\u7684\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\u4fdd\u5b58\u4e3a <code>.npy</code> \u6587\u4ef6\uff08\u5982 <code>xxx.npy</code>\uff09\uff0c\u4fbf\u4e8e\u540e\u7eed\u5206\u6790\u3002</p> </li> <li> <p>\u5bfc\u51fa\u91cf\u5316\u6743\u91cd\u548c\u7f29\u653e\u56e0\u5b50    \u904d\u5386\u6bcf\u4e00\u5c42\u7684\u53c2\u6570\uff0c\u5c06\u6743\u91cd\u91cf\u5316\u5230 8-bit\uff0c\u5e76\u5c06\u7f29\u653e\u56e0\u5b50\u8c03\u6574\u4e3a 2 \u7684\u5e42\uff0c\u6700\u7ec8\u5c06\u8fd9\u4e9b\u6570\u636e\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff08<code>xxx.bin</code>\uff09\uff0c\u4f9b\u786c\u4ef6\u52a0\u8f7d\u4f7f\u7528\u3002</p> </li> </ol>"},{"location":"notes/ee219/#_7","title":"\u786c\u4ef6\u4eff\u771f\u6d4b\u8bd5","text":"<p>\u4e3a\u4e86\u5728 C \u7a0b\u5e8f\u4e2d\u5b9e\u73b0\u4e0e <code>model.py</code> \u7b49\u4ef7\u7684\u529f\u80fd\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u4e00\u4e9b\u5173\u952e\u95ee\u9898\u3002</p>"},{"location":"notes/ee219/#c","title":"\u95ee\u9898\uff1a\u5982\u4f55\u5728 C \u7a0b\u5e8f\u4e2d\u83b7\u53d6\u6743\u91cd\u53c2\u6570\uff1f","text":"<p>\u7531\u4e8e AM \u6846\u67b6\u4e0d\u652f\u6301\u76f4\u63a5\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6743\u91cd\u53c2\u6570\uff0c\u8fd9\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u89e3\u51b3\uff1a</p> <ul> <li>AM \u6846\u67b6\u7684\u5185\u5b58\u8bbf\u95ee\u4f9d\u8d56\u4e8e DPI-C \u63a5\u53e3\u5b9e\u73b0\u3002\u8fd9\u610f\u5473\u7740\u6743\u91cd\u53c2\u6570\u9700\u8981\u9884\u5148\u52a0\u8f7d\u5230\u4e00\u4e2a\u6a21\u62df\u6846\u67b6\u63d0\u4f9b\u7684 C \u6570\u7ec4\u4e2d\u3002</li> <li><code>xxx.bin</code> \u6587\u4ef6\u4e2d\u7684\u6570\u636e\u5df2\u52a0\u8f7d\u5230\u8fd9\u4e2a C \u6570\u7ec4\u4e2d\uff0c\u6570\u636e\u7684\u57fa\u5730\u5740\u7531\u5b8f <code>ADDR_DATA</code> \u5b9a\u4e49\u3002</li> <li>\u6587\u4ef6 <code>model.h</code> \u63d0\u4f9b\u4e86\u6bcf\u4e00\u5c42\u53c2\u6570\u8d77\u59cb\u5730\u5740\u7684\u5b8f\u5b9a\u4e49\uff0c\u901a\u8fc7\u8fd9\u4e9b\u5b8f\u53ef\u4ee5\u51c6\u786e\u5b9a\u4f4d\u5404\u5c42\u7684\u6743\u91cd\u548c\u504f\u7f6e\u6570\u636e\u3002</li> </ul>"},{"location":"notes/ee219/#_8","title":"\u52a0\u901f\uff01","text":"<p>\u901a\u8fc7\u5b9a\u4e49\u81ea\u5b9a\u4e49\u6307\u4ee4\u5e76\u7ed3\u5408\u786c\u4ef6\u652f\u6301\uff0c\u6211\u4eec\u53ef\u4ee5\u9ad8\u6548\u5b8c\u6210\u63a8\u7406\u4efb\u52a1\uff0c\u4ece\u800c\u663e\u8457\u63d0\u5347\u6a21\u578b\u7684\u8fd0\u884c\u901f\u5ea6\u3002</p> <pre><code>Now I need to write C code to achieve the following job:\nThe program will build a neutral framework as this:\n\n        self.conv1  = nn.Conv2d(3, 12, 5, bias=False)\n        self.pool   = nn.MaxPool2d(2, 2)\n        self.conv2  = nn.Conv2d(12, 32, 3, bias=False)\n        self.fc1    = nn.Linear(32 * 6 * 6, 256, bias=False)\n        self.fc2    = nn.Linear(256, 64, bias=False)\n        self.fc3    = nn.Linear(64, 10, bias=True)\n\nYou can read weigh of all layer by accessing the memory, the offset of the start index of each index is listed in model.h which will be presented as follows\n\n#define ADDR_DATA           0x80800000\n#define ADDR_SAVE           0x80f00000\n\n#define INPUT_INT8_CONV1    3*32*32\n#define WEIGHT_INT8_CONV1   12*3*5*5\n#define SCALE_INT8_CONV1    1\n#define WEIGHT_INT8_CONV2   32*12*3*3\n#define SCALE_INT8_CONV2    1\n#define WEIGHT_INT8_FC1     32*6*6*256\n#define SCALE_INT8_FC1      1\n#define WEIGHT_INT8_FC2     256*64\n#define SCALE_INT8_FC2      1\n#define WEIGHT_INT8_FC3     64*10\n#define BIAS_INT16_FC3      10*2\n#define SCALE_INT8_FC3      1\n\n#define OUTPUT_INT8_CONV1   12*28*28\n#define OUTPUT_INT8_POOL1   12*14*14\n#define OUTPUT_INT8_CONV2   32*12*12\n#define OUTPUT_INT8_POOL2   32*6*6\n#define OUTPUT_INT8_FC1     256\n#define OUTPUT_INT8_FC2     64\n#define OUTPUT_INT8_FC3     10\n\n#define ADDR_INPUT          ADDR_DATA\n#define ADDR_WCONV1         ADDR_INPUT  + INPUT_INT8_CONV1\n#define ADDR_SCONV1         ADDR_WCONV1 + WEIGHT_INT8_CONV1\n#define ADDR_WCONV2         ADDR_SCONV1 + SCALE_INT8_CONV1\n#define ADDR_SCONV2         ADDR_WCONV2 + WEIGHT_INT8_CONV2\n#define ADDR_WFC1           ADDR_SCONV2 + SCALE_INT8_CONV2\n#define ADDR_SFC1           ADDR_WFC1   + WEIGHT_INT8_FC1\n#define ADDR_WFC2           ADDR_SFC1   + SCALE_INT8_FC1\n#define ADDR_SFC2           ADDR_WFC2   + WEIGHT_INT8_FC2\n#define ADDR_WFC3           ADDR_SFC2   + SCALE_INT8_FC2\n#define ADDR_BFC3           ADDR_WFC3   + WEIGHT_INT8_FC3\n#define ADDR_SFC3           ADDR_BFC3   + BIAS_INT16_FC3\n\n\n#define ADDR_OUTCONV1       ADDR_SAVE   \n#define ADDR_OUTPOOL1       ADDR_OUTCONV1 + OUTPUT_INT8_CONV1\n#define ADDR_OUTCONV2       ADDR_OUTPOOL1 + OUTPUT_INT8_POOL1\n#define ADDR_OUTPOOL2       ADDR_OUTCONV2 + OUTPUT_INT8_CONV2\n#define ADDR_OUTFC1         ADDR_OUTPOOL2 + OUTPUT_INT8_POOL2\n#define ADDR_OUTFC2         ADDR_OUTFC1   + OUTPUT_INT8_FC1\n#define ADDR_OUTFC3         ADDR_OUTFC2   + OUTPUT_INT8_FC2\n\n#endif \n\nThe program can get the input data from ADDR_INPUT, and perform inference process which includes the layers aforementioned whose weight can be accessed using macro in mode.h as listed above.\n\nFinally, the C code will be run on a bare machine, which only provides limited runtime library, which listed as follows:\n// string.h\nvoid  *memset    (void *s, int c, size_t n);\nvoid  *memcpy    (void *dst, const void *src, size_t n);\nvoid  *memmove   (void *dst, const void *src, size_t n);\nint    memcmp    (const void *s1, const void *s2, size_t n);\nsize_t strlen    (const char *s);\nchar  *strcat    (char *dst, const char *src);\nchar  *strcpy    (char *dst, const char *src);\nchar  *strncpy   (char *dst, const char *src, size_t n);\nint    strcmp    (const char *s1, const char *s2);\nint    strncmp   (const char *s1, const char *s2, size_t n);\n\n// stdlib.h\nvoid   srand     (unsigned int seed);\nint    rand      (void);\nvoid  *malloc    (size_t size);\nvoid   free      (void *ptr);\nint    abs       (int x);\nint    atoi      (const char *nptr);\n\n// stdio.h\nint    printf_s    (const char *format, ...);\nint    sprintf_s   (char *str, const char *format, ...);\nint    snprintf_s  (char *str, size_t size, const char *format, ...);\nint    vsprintf_s (char *str, const char *format, va_list ap);\nint    vsnprintf_s (char *str, size_t size, const char *format, va_list ap);\n\n// printf.h\nvoid _putchar(char character);\n#define printf printf_\nint printf_(const char* format, ...);\n#define sprintf sprintf_\nint sprintf_(char* buffer, const char* format, ...);\n#define snprintf  snprintf_\n#define vsnprintf vsnprintf_\nint  snprintf_(char* buffer, size_t count, const char* format, ...);\nint vsnprintf_(char* buffer, size_t count, const char* format, va_list va);\n#define vprintf vprintf_\nint vprintf_(const char* format, va_list va);\nint fctprintf(void (*out)(char character, void* arg), void* arg, const char* format, ...);\n\n\nHelp me write c code that perform the above task, and rember add some printf statement for better debugging. If you are confused about anything, please remind me to give you more infomation.\nand remember to convert constant to uintptr_t first to avoid type mismatch.\n</code></pre> <pre><code>#include \"trap.h\"\n#include \"model.h\"\n\n/*--------------------------------------------------------------------------------------*\n * Helper functions for memory access. \n * Always cast the #define addresses to (uintptr_t) first to avoid type mismatch.\n *--------------------------------------------------------------------------------------*/\n\n/**\n * Simple naive conv2d for int8 input/weights, int8 output\n *   in_w, in_h: width &amp; height of the input feature map\n *   kernel_size: e.g. 3 or 5\n *   in_ch, out_ch: input &amp; output channels\n *   stride: typically 1\n *   p_in, p_w, p_out: pointers to input, weight, output memory\n */\nstatic void conv2d_naive_int8(\n    const int8_t *p_in,        /* input tensor */\n    const int8_t *p_w,         /* weight tensor */\n    int8_t       *p_out,       /* output tensor */\n    int          in_w,\n    int          in_h,\n    int          in_ch,\n    int          out_ch,\n    int          kernel_size,\n    int          stride\n)\n{\n    int out_w = (in_w - kernel_size) / stride + 1;\n    int out_h = (in_h - kernel_size) / stride + 1;\n\n    // For each output channel\n    for(int oc = 0; oc &lt; out_ch; oc++)\n    {\n        // For each output y/x\n        for(int oy = 0; oy &lt; out_h; oy++)\n        {\n            for(int ox = 0; ox &lt; out_w; ox++)\n            {\n                // Compute convolution\n                int32_t acc = 0;  // 32-bit accumulator\n                // Weighted sum\n                for(int ic = 0; ic &lt; in_ch; ic++)\n                {\n                    for(int ky = 0; ky &lt; kernel_size; ky++)\n                    {\n                        for(int kx = 0; kx &lt; kernel_size; kx++)\n                        {\n                            int in_x = ox * stride + kx;\n                            int in_y = oy * stride + ky;\n\n                            int8_t val_in = p_in[ic * (in_w*in_h) + (in_y * in_w) + in_x];\n                            int8_t val_w  = p_w[oc * (in_ch * kernel_size * kernel_size)\n                                             + ic * (kernel_size * kernel_size)\n                                             + ky * kernel_size + kx];\n                            acc += (int32_t)val_in * (int32_t)val_w;\n                        }\n                    }\n                }\n                // Naive scale or shift if needed. For now, just clamp to int8:\n                // In a real scenario, you'd do: acc = (acc * scale) &gt;&gt; shift, or something similar.\n                if(acc &gt; 127)  acc = 127;\n                if(acc &lt; -128) acc = -128;\n\n                p_out[oc * (out_w*out_h) + oy * out_w + ox] = (int8_t)acc;\n            }\n        }\n    }\n}\n\n/**\n * Simple MaxPool2D with kernel=2, stride=2, no overlap, int8\n *   in_ch: # input channels\n *   in_w, in_h: input width &amp; height\n *   out_w, out_h: output width &amp; height\n */\nstatic void maxpool2d_2x2_stride2_int8(\n    const int8_t *p_in,\n    int8_t       *p_out,\n    int          in_ch,\n    int          in_w,\n    int          in_h\n)\n{\n    // With 2x2, stride=2, output dims are in_w/2, in_h/2 (assuming in_w, in_h are even)\n    int out_w = in_w / 2;\n    int out_h = in_h / 2;\n\n    for(int c = 0; c &lt; in_ch; c++)\n    {\n        for(int oy = 0; oy &lt; out_h; oy++)\n        {\n            for(int ox = 0; ox &lt; out_w; ox++)\n            {\n                int8_t max_val = -128;\n                for(int ky = 0; ky &lt; 2; ky++)\n                {\n                    for(int kx = 0; kx &lt; 2; kx++)\n                    {\n                        int in_x = ox*2 + kx;\n                        int in_y = oy*2 + ky;\n                        int8_t val = p_in[c*(in_w*in_h) + in_y*in_w + in_x];\n                        if(val &gt; max_val)\n                            max_val = val;\n                    }\n                }\n                p_out[c*(out_w*out_h) + oy*out_w + ox] = max_val;\n            }\n        }\n    }\n}\n\n/**\n * Fully-connected (linear) layer with int8 input, int8 weight, optional int16 bias, int8 output.\n *   in_features, out_features: e.g., for FC1: in_features=32*6*6=1152, out_features=256\n *   p_in, p_w, p_b, p_out: pointers to input, weight, bias, output memory\n *   has_bias: 1 if bias is present, 0 if no bias\n */\nstatic void fc_naive_int8(\n    const int8_t *p_in,\n    const int8_t *p_w,\n    const int16_t *p_b,\n    int8_t       *p_out,\n    int          in_features,\n    int          out_features,\n    int          has_bias\n)\n{\n    for(int o = 0; o &lt; out_features; o++)\n    {\n        int32_t acc = 0;\n        // Dot product\n        for(int i = 0; i &lt; in_features; i++)\n        {\n            int32_t val_in = (int32_t)p_in[i];\n            int32_t val_w  = (int32_t)p_w[o*in_features + i];\n            acc += val_in * val_w;\n        }\n        // Add bias if present (note that BIAS_INT16_FC3 says it's 16-bit, so cast properly)\n        if(has_bias)\n        {\n            acc += (int32_t)p_b[o];\n        }\n        // Naively clamp to int8\n        if(acc &gt; 127)  acc = 127;\n        if(acc &lt; -128) acc = -128;\n\n        p_out[o] = (int8_t)acc;\n    }\n}\n\n/*--------------------------------------------------------------------------------------*\n * The main inference function\n *--------------------------------------------------------------------------------------*/\nint main(void)\n{\n    // 1) Convert addresses to pointers\n    int8_t  *p_input   = (int8_t  *)(uintptr_t)(ADDR_INPUT);\n\n    int8_t  *p_wconv1  = (int8_t  *)(uintptr_t)(ADDR_WCONV1);\n    int8_t  *p_wconv2  = (int8_t  *)(uintptr_t)(ADDR_WCONV2);\n\n    int8_t  *p_wfc1    = (int8_t  *)(uintptr_t)(ADDR_WFC1);\n    int8_t  *p_wfc2    = (int8_t  *)(uintptr_t)(ADDR_WFC2);\n    int8_t  *p_wfc3    = (int8_t  *)(uintptr_t)(ADDR_WFC3);\n    int16_t *p_bfc3    = (int16_t *)(uintptr_t)(ADDR_BFC3);\n\n\n    int8_t  *p_outconv1= (int8_t  *)(uintptr_t)(ADDR_OUTCONV1);\n    int8_t  *p_outpool1= (int8_t  *)(uintptr_t)(ADDR_OUTPOOL1);\n    int8_t  *p_outconv2= (int8_t  *)(uintptr_t)(ADDR_OUTCONV2);\n    int8_t  *p_outpool2= (int8_t  *)(uintptr_t)(ADDR_OUTPOOL2);\n    int8_t  *p_outfc1  = (int8_t  *)(uintptr_t)(ADDR_OUTFC1);\n    int8_t  *p_outfc2  = (int8_t  *)(uintptr_t)(ADDR_OUTFC2);\n    int8_t  *p_outfc3  = (int8_t  *)(uintptr_t)(ADDR_OUTFC3);\n\n    // Debug prints\n    printf(\"DEBUG: p_input   = 0x%08x\\n\", (unsigned)(uintptr_t)p_input);\n    printf(\"DEBUG: p_wconv1  = 0x%08x\\n\", (unsigned)(uintptr_t)p_wconv1);\n    printf(\"DEBUG: p_outconv1= 0x%08x\\n\", (unsigned)(uintptr_t)p_outconv1);\n    // ... add more as needed\n\n    //----------------------------------------------------------------------------------\n    // 2) Conv1: in=(3,32,32), out=(12,28,28), kernel=5, stride=1\n    //----------------------------------------------------------------------------------\n    printf(\"Running Conv1...\\n\");\n    conv2d_naive_int8(\n        /* p_in   */ p_input,\n        /* p_w    */ p_wconv1,\n        /* p_out  */ p_outconv1,\n        /* in_w   */ 32,\n        /* in_h   */ 32,\n        /* in_ch  */ 3,\n        /* out_ch */ 12,\n        /* ksize  */ 5,\n        /* stride */ 1\n    );\n\n    //----------------------------------------------------------------------------------\n    // 3) Pool1: MaxPool2D(2,2) =&gt; in=(12,28,28), out=(12,14,14)\n    //----------------------------------------------------------------------------------\n    printf(\"Running Pool1...\\n\");\n    maxpool2d_2x2_stride2_int8(\n        /* p_in   */ p_outconv1,\n        /* p_out  */ p_outpool1,\n        /* in_ch  */ 12,\n        /* in_w   */ 28,\n        /* in_h   */ 28\n    );\n\n    //----------------------------------------------------------------------------------\n    // 4) Conv2: in=(12,14,14), out=(32,12,12), kernel=3, stride=1\n    //----------------------------------------------------------------------------------\n    printf(\"Running Conv2...\\n\");\n    conv2d_naive_int8(\n        p_outpool1,\n        p_wconv2,\n        p_outconv2,\n        14,\n        14,\n        12,\n        32,\n        3,\n        1\n    );\n\n    //----------------------------------------------------------------------------------\n    // 5) Pool2: in=(32,12,12), out=(32,6,6)\n    //----------------------------------------------------------------------------------\n    printf(\"Running Pool2...\\n\");\n    maxpool2d_2x2_stride2_int8(\n        p_outconv2,\n        p_outpool2,\n        32,\n        12,\n        12\n    );\n\n    //----------------------------------------------------------------------------------\n    // 6) FC1: in=32*6*6=1152, out=256, no bias\n    //----------------------------------------------------------------------------------\n    printf(\"Running FC1...\\n\");\n    fc_naive_int8(\n        /* p_in        */ p_outpool2,\n        /* p_w         */ p_wfc1,\n        /* p_b         */ NULL,  // no bias for FC1\n        /* p_out       */ p_outfc1,\n        /* in_features */ 32*6*6,\n        /* out_features*/ 256,\n        /* has_bias    */ 0\n    );\n\n    //----------------------------------------------------------------------------------\n    // 7) FC2: in=256, out=64, no bias\n    //----------------------------------------------------------------------------------\n    printf(\"Running FC2...\\n\");\n    fc_naive_int8(\n        /* p_in        */ p_outfc1,\n        /* p_w         */ p_wfc2,\n        /* p_b         */ NULL,  // no bias for FC2\n        /* p_out       */ p_outfc2,\n        /* in_features */ 256,\n        /* out_features*/ 64,\n        /* has_bias    */ 0\n    );\n\n    //----------------------------------------------------------------------------------\n    // 8) FC3: in=64, out=10, with int16 bias\n    //----------------------------------------------------------------------------------\n    printf(\"Running FC3...\\n\");\n    fc_naive_int8(\n        /* p_in        */ p_outfc2,\n        /* p_w         */ p_wfc3,\n        /* p_b         */ p_bfc3,\n        /* p_out       */ p_outfc3,\n        /* in_features */ 64,\n        /* out_features*/ 10,\n        /* has_bias    */ 1\n    );\n\n    //----------------------------------------------------------------------------------\n    // Done: p_outfc3 now has the logits for the 10 classes. \n    // Print them out for debugging (optional).\n    //----------------------------------------------------------------------------------\n    printf(\"Inference done. Printing final FC3 output:\\n\");\n    for(int i = 0; i &lt; 10; i++)\n    {\n        printf(\"Logit[%d] = %d\\n\", i, (int)p_outfc3[i]);\n    }\n\n    // You might want to return an integer code or loop forever in a bare-metal system.\n    return 0;\n}\n</code></pre>"},{"location":"notes/org-mode/","title":"Table of Contents","text":"<ol> <li>\u6807\u9898<ol> <li>\u4ee3\u7801\u5b9e\u4f8b</li> <li>\u5927\u7eb2\u76f8\u5173\u7684\u5feb\u6377\u952e<ol> <li>\u6298\u53e0</li> <li>\u5927\u7eb2\u95f4\u79fb\u52a8</li> <li>\u57fa\u4e8e\u5927\u7eb2\u7684\u7f16\u8f91</li> <li>\u5173\u4e8e\u5927\u7eb2\u663e\u793a</li> </ol> </li> <li>\u8f7b\u91cf\u7ea7\u6807\u8bb0\u8bed\u8a00<ol> <li>\u6bb5\u843d</li> <li>\u5b57\u4f53</li> <li>\u5217\u8868</li> </ol> </li> </ol> </li> <li>Organize Party <code>[100%]</code><ol> <li>Call people <code>[2/2]</code><ol> <li>Peter</li> <li>Sarah</li> </ol> </li> <li>Buy products</li> <li>\u8868\u683c<ol> <li>\u8868\u683c\u8bed\u6cd5</li> <li>\u8868\u683c\u5feb\u6377\u952e</li> <li>\u5206\u9694\u7ebf</li> <li>\u94fe\u63a5</li> <li>\u6807\u8bb0</li> <li>\u4ee3\u7801\u5757</li> <li>\u811a\u6ce8</li> <li>anchor</li> <li>todo</li> <li>\u5bfc\u51fa</li> <li>math</li> </ol> </li> </ol> </li> </ol>"},{"location":"notes/org-mode/#_1","title":"\u6807\u9898","text":"<p>\u6587\u7ae0\u4e2d\u7684\u6807\u9898\u53ef\u4ee5\u901a\u8fc7 <code>#+TITLE</code> \u6765\u8bbe\u7f6e\uff1b\u6b63\u6587\u4e2d\u7684\u6807\u9898\u53ef\u4ee5\u901a\u8fc7 <code>*</code> \u6765\u8bbe\u7f6e\uff0c \u4e00\u4e2a * \u4ee3\u8868\u4e00\u7ea7\u3002</p> <p></p>"},{"location":"notes/org-mode/#_2","title":"\u4ee3\u7801\u5b9e\u4f8b","text":"<pre><code>* \u8fd9\u662f\u4e00\u4e2a\u4e00\u7ea7\u6807\u9898\n** \u8fd9\u662f\u4e00\u4e2a\u4e8c\u7ea7\u6807\u9898\n*** \u8fd9\u662f\u4e00\u4e2a\u4e09\u7ea7\u6807\u9898\n</code></pre>"},{"location":"notes/org-mode/#_3","title":"\u5927\u7eb2\u76f8\u5173\u7684\u5feb\u6377\u952e","text":""},{"location":"notes/org-mode/#_4","title":"\u6298\u53e0","text":"\u5feb\u6377\u952e \u8bf4\u660e S-Tab \u5faa\u73af \u6574\u4e2a\u6587\u6863\u7684 \u7684\u5927\u7eb2\u72b6\u6001 TAB \u5faa\u73af\u5207\u6362 \u5149\u6807\u6240\u5728 \u5927\u7eb2\u7684\u72b6\u6001"},{"location":"notes/org-mode/#_5","title":"\u5927\u7eb2\u95f4\u79fb\u52a8","text":"\u5feb\u6377\u952e \u8bf4\u660e C-c C-n/p \u4e0b/\u4e0a\u4e00\u7ea7\u6807\u9898 C-c C-f/b \u4e0b/\u4e0a\u4e00\u7ea7\u6807\u9898 (\u4ec5\u9650\u540c\u7ea7\u6807\u9898) C-c C-u \u8df3\u8f6c\u5230\u4e0a\u4e00\u7ea7\u6807\u9898"},{"location":"notes/org-mode/#_6","title":"\u57fa\u4e8e\u5927\u7eb2\u7684\u7f16\u8f91","text":"\u5feb\u6377\u952e \u8bf4\u660e M-Return \u63d2\u5165\u4e00\u4e2a\u540c\u7ea7\u6807\u9898 M-S-Return \u63d2\u5165\u4e00\u4e2a\u540c\u7ea7TODO\u6807\u9898 M-Left/Right \u5c06\u5f53\u524d\u6807\u9898\u5347\u7ea7/\u964d\u7ea7 M-S-Left/Right \u5c06\u5f53\u524d\u6807\u9898(\u548c\u5b50\u6807\u9898\u4e00\u8d77)\u5347\u7ea7/\u964d\u7ea7 M-S-UP/DOWN \u5c06\u6807\u9898\u4e0a/\u4e0b\u79fb\u52a8 C-c C-t / S-L/R todo done \u5207\u6362 S-U/D \u4efb\u52a1\u4f18\u5148\u7ea7 \u5207\u6362 C-c / \u53ea\u4fdd\u7559\u5927\u7eb2"},{"location":"notes/org-mode/#_7","title":"\u5173\u4e8e\u5927\u7eb2\u663e\u793a","text":"<ul> <li>\u5f53\u524d\u6587\u6863\u663e\u793a\u7f29\u8fdb <code>M-x: org-indent-mode</code></li> <li>\u9ed8\u8ba4\u663e\u793a\u7f29\u8fdb <code>#+STARTUP: indent</code></li> </ul>"},{"location":"notes/org-mode/#_8","title":"\u8f7b\u91cf\u7ea7\u6807\u8bb0\u8bed\u8a00","text":""},{"location":"notes/org-mode/#_9","title":"\u6bb5\u843d","text":"<p>org Mode \u4e2d\uff0c\u9700\u8981\u56de\u8f66\u4e24\u884c\u5f00\u59cb\u65b0\u7684\u6bb5\u843d\u3002 \u8fd9\u662f\u4e00\u6bb5\u6587\u5b57 \u8fd9\u8fd8\u662f\u7b2c\u4e00\u4e2a\u6bb5\u6587\u5b57</p> <p>\u8fd9\u662f\u7b2c\u4e8c\u6bb5\u6587\u5b57\u3002</p> <p></p>"},{"location":"notes/org-mode/#_10","title":"\u5b57\u4f53","text":"<ul> <li>bold *bold*</li> <li>italic italic</li> <li>underline underline</li> <li>H<sub>2</sub> O;  e=mc<sup>2</sup></li> <li><code>git</code></li> </ul>"},{"location":"notes/org-mode/#_11","title":"\u5217\u8868","text":"<ol> <li> <p>ordered list</p> <ol> <li>first item<ol> <li>sub task 1</li> <li>sub task 2</li> </ol> </li> <li>second item</li> </ol> </li> <li> <p>unordered list</p> <p>\u53ef\u4f7f\u7528 <code>-, +, *</code> \u5f00\u5934</p> <ul> <li>List<ul> <li>sublist<ul> <li>subsub list</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>\u6dfb\u52a0\u5217\u8868\u5b8c\u6210\u8fdb\u5ea6</p> </li> </ol> <p></p>"},{"location":"notes/org-mode/#organize-party-100","title":"Organize Party <code>[100%]</code>","text":""},{"location":"notes/org-mode/#call-people-22","title":"Call people <code>[2/2]</code>","text":""},{"location":"notes/org-mode/#done-peter","title":"DONE Peter","text":""},{"location":"notes/org-mode/#done-sarah","title":"DONE Sarah","text":""},{"location":"notes/org-mode/#done-buy-products","title":"DONE Buy products","text":"<ol> <li> <p>\u6dfb\u52a0\u65f6\u95f4\u6233</p> <p>C-c C-s/d schedule/deadline</p> <p>C-c &gt; \u65e5\u5386</p> </li> <li> <p>\u4efb\u52a1\u4e00</p> </li> <li> <p>\u6709\u5173\u5217\u8868\u7684\u5feb\u6377\u952e</p> <p> <p> \u5feb\u6377\u952e \u8bf4\u660e <p> M-Return \u63d2\u5165\u4e00\u4e2a\u540c\u7ea7\u9879 </p> <p> M-S-Return \u63d2\u5165\u4e00\u4e2a\u5e26\u6709\u590d\u9009\u6846\u7684\u9879 </p> <p> M-Left/Right \u5347\u7ea7/\u964d\u7ea7 </p> <p> M-S-Left/Right \u5c06\u5f53\u524d\u9879(\u548c\u9879\u4e00\u8d77)\u5347\u7ea7/\u964d\u7ea7 </p> <p> M-S-UP/DOWN \u4e0a/\u4e0b\u79fb\u52a8 </p> <p> C-c C-c \u6539\u53d8\u590d\u9009\u6846\u72b6\u6001 </p> <p> C-c - \u5faa\u73af\u5207\u6362\u5217\u8868\u6807\u8bb0 </p> <p></p>"},{"location":"notes/org-mode/#_12","title":"\u8868\u683c","text":""},{"location":"notes/org-mode/#_13","title":"\u8868\u683c\u8bed\u6cd5","text":"<pre><code>| Name     | Height | Weight | Age |\n|----------+--------+--------+-----|\n| Abcdefgh |    178 |    123 |  18 |\n</code></pre>"},{"location":"notes/org-mode/#_14","title":"\u8868\u683c\u5feb\u6377\u952e","text":"Table 1: \u8868\u683c\u6807\u9898 \u5feb\u6377\u952e \u8bf4\u660e C-c \u7ad6\u7ebf \u521b\u5efa\u8868\u683c C-c C-c \u8c03\u6574\u8868\u683c Tab/S-Tab \u79fb\u52a8 M-Left/Right \u79fb\u52a8\u5217 M-Up/Down \u79fb\u52a8\u884c M-S-L/R \u5220\u9664/\u63d2\u5165\u5217 M-S-U/D \u5220\u9664/\u63d2\u5165\u884c C-c - \u6dfb\u52a0\u6c34\u5e73\u5206\u5272\u7ebf C-c ^ \u6392\u5e8f \u4e00\u7ea7\u90e8\u95e8 \u4e8c\u7ea7\u90e8\u95e8 \u4eba\u6570 A A.1 5 A.2 6 B B.1 7 B.2 3"},{"location":"notes/org-mode/#_15","title":"\u5206\u9694\u7ebf","text":"<p>_</p> <p>\u2014</p> <p></p>"},{"location":"notes/org-mode/#_16","title":"\u94fe\u63a5","text":"<ol> <li> <p>\u94fe\u63a5\u8bed\u6cd5</p> <ul> <li><code>C-c C-i</code> \u63d2\u5165\u94fe\u63a5</li> <li><code>C-c C-o</code> \u70b9\u51fb\u94fe\u63a5</li> </ul> <p>The Missing Semester of your CS education NCU local version</p> <p>docx \u6587\u4ef6</p> <p>\u89c6\u9891</p> </li> </ol> <p></p>"},{"location":"notes/org-mode/#_17","title":"\u6807\u8bb0","text":"<p>\u5728\u6807\u9898\u540e <code>:tag1:tag2:tag3...</code></p> <p></p>"},{"location":"notes/org-mode/#_18","title":"\u4ee3\u7801\u5757","text":"<ul> <li><code>C-c C-,</code> \u751f\u6210\u6a21\u677f</li> <li><code>C-c '</code>  \u5728\u5c0f\u7a97\u7f16\u8f91\u4ee3\u7801\u5757</li> </ul> <p><pre><code>    module tb;\n        reg clk;\n        initial begin\n            clk = 1'b0;\n        end\n        always #5 clk = ~clk;\n    endmodule\n</code></pre> <pre><code>    #include &lt;stdio.h&gt;\n    int main ()\n      {printf(\"hello emacs\\n\"); return 0;}\n</code></pre></p> Sede Max cites H-index Chile 257.72 21.39 Leeds 165.77 19.68 Sao Paolo 71.00 11.50 Stockholm 134.19 14.33 Morelia 257.56 17.67 <p><pre><code>    cities = [d[0] for d in data];\n    for _ in cities:\n        print(_)\n</code></pre> <pre><code>    import matplotlib\n    import matplotlib.pyplot as plt\n    matplotlib.use('Agg')\n    fig=plt.figure(figsize=(3,2))\n    plt.plot([1,3,2])\n    fig.tight_layout()\n    plt.savefig('myfig.png')\n    return './myfig.png' # return this to org-mode\n</code></pre></p> <pre><code>    #include \"Foo.cpp\"\n    #include &lt;utility&gt;\n    // \u6a21\u677f\u53c2\u6570\u7684\u63a8\u5bfc\u8fd8\u4e0d\u662f\u5f88\u719f\n\n    template &lt;typename T&gt;\n    class Container {\n        int capacity = 512;\n        int size = 0;\n        T* data;\n    public:\n        // using \u53ef\u4ee5\u652f\u6301\u6cdb\u578b\u5417\n        class containerIterator;\n        using iterator=containerIterator;\n        // \u65e0\u53c2\u6784\u9020\u5668\n        explicit Container ()\n            : size(0), data(static_cast&lt;T*&gt;(malloc(capacity * sizeof(T)))) {}\n\n        // \u6709\u53c2\u6784\u9020\u5668\n        explicit Container (int capacity)\n</code></pre> <p></p>"},{"location":"notes/org-mode/#_19","title":"\u811a\u6ce8","text":"<p>Latex is the best engine<sup>1</sup>, It is a great tool.</p> <p></p>"},{"location":"notes/org-mode/#anchor","title":"anchor","text":"<p>go to p1</p> <p><code>C-c %/&amp;</code> \u8bb0\u5fc6/\u56de\u6eaf\u4f4d\u7f6e</p> <p></p>"},{"location":"notes/org-mode/#todo","title":"todo","text":"<ul> <li> execute code in org, using babel?</li> <li> export and preview org</li> <li> Latex support</li> </ul>"},{"location":"notes/org-mode/#_20","title":"\u5bfc\u51fa","text":"<ul> <li><code>C-c C-e</code> \u5bfc\u51fa,\u53ef\u4ee5\u770b menu bar \u91cc\u7684\u5feb\u6377\u952e</li> <li><code>M-x:org-md-export-as-markdown</code> \u5bfc\u51fa markdown file</li> </ul>"},{"location":"notes/org-mode/#math","title":"math","text":"<ul> <li><code>C-c C-x C-l</code> \u9884\u89c8latex</li> <li><code>C-c C-x C-v</code> \u9884\u89c8\u56fe\u7247</li> </ul> \\[\\begin{equation} x = \\sqrt{2} \\end{equation}\\]"},{"location":"notes/org-mode/#footnotes","title":"Footnotes","text":"<p><sup>1</sup> http://www.latexlive.com</p>"},{"location":"notes/verilog_lab/","title":"\u6570\u5b57\u7535\u8def\u5b9e\u9a8c","text":""},{"location":"notes/verilog_lab/#verilator-gtkwave","title":"verilator + gtkwave","text":"<ul> <li> <p>\u5982\u4f55\u5728 \u4ee3\u7801\u91cc \u91cc\u8bbe\u7f6e top.v \u751f\u6210\u7684\u53cc\u63a7\u5f00\u5173, \u5982\u4f55\u52a0\u8f7d \u5143\u5668\u4ef6\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48 git \u63d0\u4ea4\u4e0d\u4f1a\u81ea\u52a8\u540c\u6b65\u5230 tracer \u5206\u652f</p> <p>\u7531\u4e8e\u4f7f\u7528zsh\u8fd0\u884c\u7684makefile\uff0czsh\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u6ca1\u6709 $(NEMU) \u73af\u5883\u53d8\u91cf\u7684\u5b9a\u4e49, \u6240\u4ee5\u8c03\u7528 git-commit \u51fd\u6570\u5931\u6548</p> </li> <li> <p>\u8fd0\u884c NVBoard \u540e\u4e00\u6bb5\u65f6\u95f4\uff0c\u7a0b\u5e8f\u65e0\u54cd\u5e94\u662f\u6b63\u5e38\u73b0\u8c61\u5417</p> </li> <li> <p>\u9700\u8981\u7814\u7a76 nvboard \u4e2d\u7684 Makefile, \u518d\u5c1d\u8bd5\u5c06\u6211\u4eec\u7684\u53cc\u63a7\u5f00\u5173\u63a5\u5165\u5230 NVboard     \u5b9e\u4f8b\u5de5\u7a0b\u6709\u51e0\u5927\u6a21\u5757</p> <ul> <li>15-8: \u6d41\u6c34\u706f</li> <li>0-7 : \u5f00\u5173\u63a7\u5236\u4eae\u706d</li> <li>\u6570\u7801\u7ba1</li> <li>VGA \u663e\u793a\u5c4f</li> </ul> <p>constr/top.nxdc \u8fd9\u4e2a\u6587\u4ef6\u662f\u5f15\u811a\u7684\u63cf\u8ff0\u6587\u4ef6\uff0c\u4e4b\u540e\u57fa\u4e8e\u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\uff0c\u751f\u6210\u5bf9\u5e94\u7684 cpp \u4ee3\u7801</p> <p>Makefile \u4f7f\u7528 <code>verilator</code> \u548c cpp \u6e90\u6587\u4ef6\u3001verilog \u6e90\u6587\u4ef6\u3001\u751f\u6210\u7684 auto_bind.cpp \u4ee5\u53ca nvboard \u7684\u9759\u6001\u94fe\u63a5\u5e93\u6587\u4ef6 \u751f\u6210 \u53ef\u6267\u884c\u6587\u4ef6</p> <p>cpp \u6587\u4ef6\u4e3b\u8981\u662f\u52a0\u8f7d auto_bind.cpp \u91cc\u7684\u51fd\u6570</p> </li> <li> <p>\u7ed1\u5b9a\u5f15\u811a\u6210\u529f\uff0c\u4f46\u662fled\u706f\u7684\u8f93\u51fa\u4e0d\u53d7\u5f00\u5173\u7684\u63a7\u5236</p> <p>\u6ca1\u6709\u4f7f\u7528 clk pin \u540c\u6b65\u65f6\u949f</p> </li> </ul>"},{"location":"notes/verilog_lab/#lab01","title":"Lab01 \u9009\u62e9\u5668","text":""},{"location":"notes/verilog_lab/#ddca-ch02","title":"DDCA ch02","text":"<p>\u7ec4\u5408\u903b\u8f91\u7535\u8def\u4e0e\u65f6\u5e8f\u903b\u8f91\u7535\u8def</p> <ul> <li>\u7ec4\u5408\u903b\u8f91\u7535\u8def\u7684\u8f93\u51fa\u4ec5\u53d6\u51b3\u4e8e\u8f93\u5165</li> <li>\u65f6\u5e8f\u903b\u8f91\u7535\u8def\u7684\u8f93\u51fa\u4e0d\u4ec5\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u8f93\u5165\uff0c\u8fd8\u53d6\u51b3\u4e8e\u8fc7\u53bb\u7684\u8f93\u5165\u72b6\u6001\u3002(\u6216\u8005\u8bf4\u8f93\u5165\u5e8f\u5217)</li> </ul> <p>\u7ec4\u5408\u903b\u8f91\u7535\u8def\u6ee1\u8db3\u4ec0\u4e48\u6837\u7684\u6761\u4ef6\uff1f</p> <ol> <li>\u7ec4\u6210\u7535\u8def\u7684\u6bcf\u4e00\u4e2a\u7535\u8def\u672c\u8eab\u662f\u7ec4\u5408\u7684</li> <li>\u6bcf\u4e00\u4e2a\u8282\u70b9\u8981\u4e48\u662f\u8f93\u5165\uff0c\u8981\u4e48\u662f\u8f93\u51fa</li> <li>\u6ca1\u6709\u73af\u8def</li> </ol> <p>\u5361\u8bfa\u56fe</p> <ul> <li>Grey code: 00 01 11 10</li> </ul> <p>\u5de6\u53f3\u76f8\u63a5</p> <ul> <li>\u7528\u6700\u5c11\u7684\u5706\u5305\u542b\u6240\u6709\u7684 1</li> <li>\u5706\u5185\u7684\u9879\u5fc5\u987b\u662f 1</li> <li>\u5706\u5185\u5305\u542b\u7684\u9879\u7684\u4e2a\u6570\u5fc5\u987b\u662f \\(2^n\\)</li> <li>\u6bcf\u4e00\u4e2a\u5706\u8d8a\u5927\u8d8a\u597d (\u53ef\u91cd\u53e0 \u56e0\u4e3a \u540c\u4e00\u6027)</li> </ul> <p>\u5217\u771f\u503c\u8868</p>"},{"location":"notes/verilog_lab/#_2","title":"\u9009\u62e9\u5668\u5b9e\u73b0","text":"<ul> <li><code>NR_KEY</code>: \u952e\u503c\u5bf9\u7684\u6570\u91cf</li> <li><code>KEY_LEN</code>: \u9009\u62e9\u4fe1\u53f7(key)\u7684\u5bbd\u5ea6</li> <li><code>DATA_LEN</code>: (value) \u503c\u7684\u5bbd\u5ea6</li> </ul>"},{"location":"notes/verilog_lab/#lab02","title":"Lab02 \u8bd1\u7801\u5668\u548c\u7f16\u7801\u5668","text":"<p>\u8bd1\u7801\u5668: \u5c06\u8f93\u5165\u4fe1\u606f\u8f6c\u5316\u4e3a\u7279\u5b9a\u8f93\u51fa\u4fe1\u606f</p> <p>e.g. \u6839\u636e\u8f93\u5165\uff0c\u8f93\u51fa 8 \u4e2a \u4e8c\u6781\u7ba1\u7684\u7535\u8def\u72b6\u6001</p> <p>\u7f16\u7801\u5668: \u7ed9\u591a\u4e2a\u8f93\u5165\u4fe1\u53f7\u7f16\u53f7 (\u591a\u4e2a\u8f93\u5165\uff0c\u54ea\u4e00\u4e2a\u8f93\u5165\u6709\u4fe1\u53f7\uff0c\u5c31\u663e\u793a\u8fd9\u4e2a\u8f93\u5165\u7684\u7f16\u7801)</p> <p>verilog, casez \u7684 entry \u53ef\u4ee5\u4f7f\u7528 z \u8868\u793a 0/1 \u90fd\u884c</p>"},{"location":"notes/verilog_lab/#lab3-alu","title":"Lab3 ALU","text":"<p>\u9009\u62e9\u5668\uff0c\u8f93\u5165\uff0c\u8f93\u51fa\uff0c\u5404\u79cd\u6807\u5fd7\u4f4d</p> <p>\u533a\u5206\u8fdb\u4f4d\u548c\u6ea2\u51fa</p> <ul> <li>\u8fdb\u4f4d \u6b63\u6570+\u6b63\u6570 \u8fd8\u662f\u6b63\u6570</li> <li>\u6ea2\u51fa \u6b63\u6570\u52a0\u6b63\u6570 \u53d8\u6210\u8d1f\u6570\uff1b\u8d1f\u6570\u52a0\u8d1f\u6570 \u53d8\u6210 \u6b63\u6570</li> </ul> <p>\u4e00\u4e2a\u8fd0\u7b97\u4e2d\uff0c\u53ef\u80fd\u4f1a\u89e6\u53d1\u8fdb\u4f4d\u548c\u501f\u4f4d</p>"},{"location":"notes/verilog_lab/#lab6","title":"Lab6 \u7ebf\u6027\u79fb\u4f4d\u5bc4\u5b58\u5668","text":""},{"location":"notes/verilog_lab/#lab7","title":"Lab7 \u77e9\u9635\u952e\u76d8\u68c0\u6d4b","text":""},{"location":"notes/verilog_lab/#what-have-you-learnt","title":"What Have You Learnt ?","text":"<ul> <li> <p>\u5982\u4f55\u6bd4\u8f83\u4e24\u4e2a\u6709\u7b26\u53f7\u6570\u7684\u5927\u5c0f\u5173\u7cfb\u3002</p> <p>\\(\\text{less} = \\text{OF} \\oplus \\text{results[} n - 1\\text{]}\\)</p> </li> <li> <p>\u8bbe\u8ba1 Soc \u8fc7\u7a0b\u4e2d\uff0c\u6240\u4f7f\u7528\u5230\u7684\u8f6f\u4ef6\u548c\u6280\u672f\u662f\u4ec0\u4e48\u3002</p> </li> <li>\u4ec0\u4e48\u662f\u786c\u4ef6\u7f16\u7a0b\uff0c\u4ec0\u4e48\u662f\u8f6f\u4ef6\u7f16\u7a0b\u3002<ul> <li>\u786c\u4ef6\u7f16\u7a0b\uff1a\u901a\u8fc7 \u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00(HDL)\u6765\u5b9a\u4e49\u786c\u4ef6\u7ed3\u6784\u3002(\u6bd4\u5982\u4f7f\u7528 vivado \u7f16\u5199 verilog)</li> <li>\u8f6f\u4ef6\u7f16\u7a0b\uff1a\u901a\u8fc7 \u9ad8\u7ea7\u8bed\u8a00\u751f\u6210 .hex \u6587\u4ef6\uff0c\u52a0\u8f7d\u5230\u786c\u4ef6\u7684 ROM \u4e2d\uff0c\u64cd\u63a7\u786c\u4ef6\u5b8c\u6210\u4efb\u52a1 (\u6bd4\u5982\u4f7f\u7528 keil \u5199 c \u8bed\u8a00) Modelsim \u4eff\u771f\u8f6f\u4ef6\u3002\u53ef\u5c06\u7f16\u5199\u7684 hex \u6587\u4ef6\u5185\u5bb9\u52a0\u8f7d\u5230 HDL \u6240\u63cf\u8ff0\u7684\u786c\u4ef6\u4e2d\u53bb\u3002</li> </ul> </li> <li> <p>\u719f\u6089 verilog \u8bed\u6cd5, \u66f4\u6df1\u523b\u7684\u7406\u89e3\u4e86 \u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00\u7684\u542b\u610f</p> </li> <li> <p>\u76ee\u524d\u7f16\u5199\u7684 alu \u6548\u7387\u592a\u4f4e\uff0c\u8003\u8651\u4e4b\u540e\u8fdb\u884c\u4f18\u5316</p> </li> </ul>"},{"location":"notes/15445%20Database/p0/","title":"P0","text":""},{"location":"notes/15445%20Database/p0/#_1","title":"\u914d\u7f6e\u73af\u5883","text":""},{"location":"notes/15445%20Database/p0/#_2","title":"\u5bbf\u4e3b\u673a\u73af\u5883","text":"<pre><code>OS: Manjaro Linux x86_64\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Host: HLYL-WXX9 M1010\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588            \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Kernel: 6.1.44-1-MANJARO\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Uptime: 2 hours, 22 mins\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Packages: 1934 (pacman)\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Shell: zsh 5.9\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Resolution: 1920x1080\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   DE: GNOME 44.3\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   WM: Mutter\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   WM Theme: Adwaita\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Theme: adw-gtk3-dark [GTK2/3]\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   Icons: Papirus-Maia [GTK2/3]\n                               Terminal: alacritty\n                               Terminal Font: 'JetBrainsMonoNerdFont'\n                               CPU: AMD Ryzen 5 4600H with Radeon Graphics (12) @ 3.000GHz\n                               GPU: AMD ATI 03:00.0 Renoir\n                               Memory: 3822MiB / 15360MiB\n</code></pre>"},{"location":"notes/15445%20Database/p0/#docker","title":"\u4f7f\u7528 docker \u642d\u5efa\u73af\u5883","text":"<p>\u5b9e\u9a8c\u53ea\u7ed9\u51fa\u4e86 <code>Ubuntu</code> \u7684\u73af\u5883\u914d\u7f6e\u6559\u7a0b\uff0c\u4e0e <code>manjaro</code> \u4e0d\u517c\u5bb9\uff0c\u9042\u4f7f\u7528 <code>docker</code> \u642d\u5efa\u3002</p> <ul> <li>\u62c9\u53d6\u4ed3\u5e93  <code>git clone https://github.com/cmu-db/bustub.git</code> </li> </ul> <p>\u53c2\u8003\u4ed3\u5e93\u4e2d\u7684 <code>README</code> \u914d\u7f6e docker.</p> <p>\u4ee5\u4e0b\u5185\u5bb9 \u6765\u81ea \u4ed3\u5e93\u4e2d\u7684 README.md</p> <p>First, make sure that you have docker installed: <pre><code>$ sudo apt update\n$ sudo apt install docker\n</code></pre> or  <pre><code>$ sudo pacman -Syu\n$ sudo pacman -S docker\n</code></pre> From the repository directory, run these commands to create a Docker image and container:</p> <p>\u5728\u4ed3\u5e93\u6587\u4ef6\u5939\u4e0b\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u955c\u50cf\u548c\u5bb9\u5668</p> <pre><code>$ docker build . -t bustub # \u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u5bfb\u627e Dockerfile, \u521b\u5efa\u540d\u4e3a bustub \u7684\u955c\u50cf\n$ docker create -t -i --name bustub -v $(pwd):/bustub bustub bash # \u6839\u636e\u955c\u50cf bustub, \u521b\u5efa\u4e00\u4e2a bustub \u7684\u5bb9\u5668\uff0c\u5e76\u628a\u5f53\u524d\u6587\u4ef6\u5939\u6620\u5c04\u5230 \u5bb9\u5668\u7684 /bustub \u76ee\u5f55, \u521b\u5efa\u955c\u50cf\u540e\u6267\u884c bash \u547d\u4ee4 \n</code></pre> <p>This will create a Docker image and container. To run it, type:</p> <pre><code>$ docker start -a -i bustub\n</code></pre> <p>to open a shell within the box. You can find Bustub's code mounted at <code>/bustub</code> and run the commands mentioned above like normal.</p> <p>ps \u5bb9\u5668\u662f\u955c\u50cf\u7684\u5b9e\u4f8b\uff0c \u4e00\u4e2a\u955c\u50cf\u53ef\u4ee5\u6709\u591a\u4e2a\u5b9e\u4f8b </p>"},{"location":"notes/15445%20Database/p0/#_3","title":"\u6784\u5efa\u9879\u76ee","text":"<p>\u8fdb\u5165 docker \u540e\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u6784\u5efa\u6574\u4e2a\u9879\u76ee</p> <pre><code>$ cd /bustub\n$ mkdir build\n$ cd build\n$ cmake ..\n$ make # or  make -j`nproc` \u7528\u591a\u7ebf\u7a0b\u8fdb\u884c\u6784\u5efa\uff0c\u901f\u5ea6\u66f4\u5feb \n</code></pre> <p>\u4e3a\u4e86\u80fd\u591f\u8ba9\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u52a0\u5165\u8c03\u8bd5\u4fe1\u606f\uff0c\u6211\u4eec\u9700\u8981\u5c06 cmake \u7684 \u6784\u5efa\u6a21\u5f0f\u8bbe\u7f6e\u4e3a Debug</p> <pre><code>$ cmake -DCMAKE_BUILD_TYPE=Debug ..\n$ make -j`nproc`\n</code></pre>"},{"location":"notes/15445%20Database/p0/#_4","title":"\u9879\u76ee\u6587\u4ef6\u7ed3\u6784","text":"<p>\u63a8\u8350\u4f7f\u7528 vscode + remote \u63d2\u4ef6 \u6216\u8005 \u4f7f\u7528 CLion</p> <p>\u6559\u7a0b </p> <ul> <li><code>build</code> \u6587\u4ef6\u5939\u50a8\u5b58\u7f16\u8bd1\u540e\u7684\u7ed3\u679c</li> <li><code>src</code> \u6587\u4ef6\u5939\u6700\u4e3a\u91cd\u8981\uff0c\u50a8\u5b58\u9879\u76ee\u6838\u5fc3\u4ee3\u7801<ul> <li><code>src/include</code> \u5b58\u653e\u81ea\u5b9a\u4e49\u5934\u6587\u4ef6</li> <li><code>src/primer</code> \u5b58\u653e\u7684\u662f project0 cpp \u6587\u4ef6 </li> </ul> </li> <li><code>test</code> \u6587\u4ef6\u5939\u5b58\u653e\u6d4b\u8bd5\u6587\u4ef6<ul> <li><code>test/primer</code> \u5b58\u653e\u7684\u662f project0 \u7684\u6d4b\u8bd5\u6587\u4ef6</li> </ul> </li> </ul>"},{"location":"notes/15445%20Database/p0/#vscode","title":"Vscode \u63d2\u4ef6","text":"<p>\u6765\u81ea project0 \u6587\u6863</p> <p>If you are using VSCode, we recommend you to install CMake Tools, C/C++ Extension Pack and clangd.</p> <p>CMake Tools \u63d2\u4ef6\u9700\u8981\u4e00\u4e9b\u914d\u7f6e\uff0c\u8bf7\u53c2\u8003 \u6559\u7a0b  \u5982\u679c\u4f7f\u7528 Docker\uff0cdebug \u529f\u80fd\u597d\u50cf\u6ca1\u6cd5\u4f7f\u7528\uff0c\u9700\u8981\u53e6\u5916\u914d\u7f6e</p> <p>debug </p> <p>\u521b\u5efa .vscode/launch.json</p> <pre><code>{\n    // Use IntelliSense to learn about possible attributes.\n    // Hover to view descriptions of existing attributes.\n    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n\n        {\n            \"name\": \"(gdb) Launch\",\n            \"type\": \"cppdbg\",\n            \"request\": \"launch\",\n            \"program\": \"${workspaceFolder}/build/test/trie_test\",\n            \"args\": [],\n            \"stopAtEntry\": false,\n            \"cwd\": \"${fileDirname}\",\n            \"environment\": [],\n            \"externalConsole\": false,\n            \"MIMode\": \"gdb\",\n            \"setupCommands\": [\n                {\n                    \"description\": \"Enable pretty-printing for gdb\",\n                    \"text\": \"-enable-pretty-printing\",\n                    \"ignoreFailures\": true\n                },\n                {\n                    \"description\": \"Set Disassembly Flavor to Intel\",\n                    \"text\": \"-gdb-set disassembly-flavor intel\",\n                    \"ignoreFailures\": true\n                }\n            ]\n        }\n\n    ]\n}\n</code></pre> <p>\u6ce8\u610f\uff0cdebug \u9700\u8981\u5c06cmake\u7684\u6a21\u5f0f\u8bbe\u7f6e\u4e3a <code>Debug</code>,  \u4e14\u8bb0\u5f97\u66ff\u6362\u4e0a\u8ff0\u914d\u7f6e\u4e2d <code>program</code> \u7684\u53ef\u6267\u884c\u6587\u4ef6\u5730\u5740 </p> <p>\u5f53\u7136\uff0c \u4f7f\u7528 gdb \u4e5f\u662f\u6781\u597d\u7684\u3002</p> <p>gdb \u542f\u52a8\u65f6\uff0c\u4f1a\u81ea\u52a8\u8bfb\u53d6 .gdbinit \u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u5c06 gdb \u547d\u4ee4\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u6bcf\u4e00\u6b21\u8c03\u8bd5\u90fd\u91cd\u590d\u8f93\u5165\u3002</p> <p>\u6bd4\u5982</p> <p></p>"},{"location":"notes/15445%20Database/p0/#_5","title":"\u4ee3\u7801\u89c4\u8303","text":"<pre><code>make format # \u4f1a\u81ea\u52a8\u66f4\u6b63\nmake check-lint # \u6d4b\u8bd5\u4ee3\u7801\u89c4\u8303\nmake check-clang-tidy-p0 \n</code></pre>"},{"location":"notes/15445%20Database/p0/#spec","title":"spec","text":""},{"location":"notes/15445%20Database/p0/#task1","title":"task1","text":"<p>\u9996\u5148</p> <p>\u5728\u8fd9\u4e2a\u9879\u76ee\u4e2d\uff0c\u4f60\u5c06\u5b9e\u73b0\u4e00\u4e2a \u6709\u7740 copy-on-write \u7279\u6027\u7684\u5b57\u5178\u6811 trie\u3002trie \u53ef\u4ee5\u9ad8\u6548\u7684\u6839\u636e key \u6765\u67e5\u8be2 value. \u4e3a\u4e86\u65b9\u4fbf\u9610\u8ff0\uff0c\u6211\u4eec\u5047\u8bbe trie \u7684 \u952e \u662f\u4e0d\u5b9a\u957f\u7684, \u867d\u7136\u5b9e\u9645\u4e0a \u952e\u53ef\u4ee5\u662f\u4efb\u610f\u4e00\u79cd\u7c7b\u578b\u3002</p> <p>\u9996\u5148\u6839\u636eREADME \u770b \u5982\u4f55\u6784\u5efa\u73af\u5883\uff0c\u4e4b\u540e\u719f\u6089\u9879\u76ee\u7ed3\u6784\uff0c\u770b\u61c2 makefile. \u518d\u5c1d\u8bd5\u8fdb\u884c\u5199\u4ee3\u7801\u548c\u8c03\u8bd5\u3002 \u9996\u5148\uff0c\u770b\u4e00\u4e0b\u6d4b\u8bd5\u4ee3\u7801\u662f\u5982\u4f55\u521d\u59cb\u5316 Trie \u8fd9\u4e2a \u6570\u636e\u7ed3\u6784\u7684\uff0c\u6574\u7406\u51fa\u51fd\u6570\u8c03\u7528\u5173\u7cfb\u3002</p>"},{"location":"notes/15445%20Database/p0/#_6","title":"\u521d\u59cb\u5316","text":"<p><code>trie_test.cpp</code> \u4e2d\u7b2c\u4e00\u4e2a\u6d4b\u8bd5\u8bed\u53e5\u662f <code>auto trie = Trie()</code> , \u8bf4\u660e\u8c03\u7528\u4e86 Trie \u7684\u9ed8\u8ba4\u6784\u9020\u5668\u3002 \u6211\u4eec\u6765\u770b\u770b <code>Trie</code> \u9ed8\u8ba4\u6784\u9020\u5668\u7684\u5b9e\u73b0</p> <p><code>Trie() = default</code> </p> <p>\u9ed8\u8ba4\u6784\u9020\u5668\u4f7f\u7528\u4e86\u7f16\u8bd1\u5668\u4e3a\u5176\u751f\u6210\u7684\u9ed8\u8ba4\u6784\u9020\u5668\uff0c\u8fd9\u4e2a \u9ed8\u8ba4\u6784\u9020\u5668 \u4f1a\u5c1d\u8bd5\u8c03\u7528\u6240\u6709\u6210\u5458\u51fd\u6570\u7684\u9ed8\u8ba4\u6784\u9020\u5668\u8fdb\u884c\u521d\u59cb\u5316\u3002 <code>Trie</code> \u7684\u6210\u5458\u51fd\u6570\u53ea\u6709\u4e00\u4e2a\uff0c <code>std::shared_ptr&lt;const TrieNode&gt; root_{nullptr};</code> \u3002<code>root</code> \u6307\u5b9a\u4e86\u4f7f\u7528 nullptr \u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4 root_ \u6307\u5411 nullptr\u3002</p> <p>\u6839\u636e <code>shared_ptr</code> \u7684\u7279\u6027\uff0c\u5b83\u4f1a\u4f7f\u7528\u63a5\u53d7\u7684\u53c2\u6570\u4f5c\u4e3a \u6307\u5b9a\u7c7b\u578b (TrieNode) \u7684\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570 <code>TrieNode()</code> \u521b\u9020\u4e00\u4e2a\u5bf9\u8c61, \u7136\u540e\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u8fdb\u884c\u4e00\u4e9b\u5305\u88c5\u3002 </p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u6765\u770b\u770b <code>TrieNode</code> \u7684\u6784\u9020\u51fd\u6570 <code>TrieNode() = default</code> , \u8fd9\u540c\u6837\u662f\u7f16\u8bd1\u5668\u4e3a\u5176\u751f\u6210\u7684\u9ed8\u8ba4\u6784\u9020\u5668\uff0cTrieNode \u6709\u4e24\u4e2a\u6210\u5458 <code>map</code> \u548c <code>is_value_node_</code>\u3002map \u88ab\u521d\u59cb\u5316\u4e3a\u7a7a\uff0cis_value_node_ \u88ab\u521d\u59cb\u5316\u4e3a false</p>"},{"location":"notes/15445%20Database/p0/#get-put","title":"Get &amp;&amp; Put","text":"<p>\u5b8c\u6210\u8fd9\u4e9b\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u5199 Trie \u4e86\u3002 \u9996\u5148\u8981\u660e\u786e trie \u7684 \u7ed3\u6784</p> <p>Q: \u9006\u5929\u7684\u96be\u9898\uff0cmap \u503c\u7684\u7c7b\u578b\u662f const TrieNode, \u90fd\u662f\u5e38\u91cf\u4e86\u6211\u8fd8\u600e\u4e48\u521b\u5efa\u65b0\u8282\u70b9\u554a\u3002</p> <p>A: \u8003\u8651\u4f7f\u7528 Clone \u51fd\u6570\uff0c\u521b\u5efa\u65b0\u8282\u70b9\u3002</p> <p>Q: Trie \u7684\u6784\u9020\u5668\u53ea\u80fd\u63a5\u53d7 <code>shared_ptr&lt;TrieNode&gt;</code> \u4f5c\u4e3a\u6784\u9020\u53c2\u6570\uff0c\u4f46\u662f\u7ec8\u7aef\u8282\u70b9\u7684\u7c7b\u578b\u662f <code>shared_ptr&lt;TrieNodeWithValue&gt;</code>\u3002\u597d\u50cf\u6ca1\u6709\u529e\u6cd5\u505a \u5411\u4e0a\u8f6c\u578b\u3002</p> <p>A: \u662f\u53ef\u4ee5\u5411\u4e0a\u8f6c\u578b\u7684\uff0c\u76f4\u63a5\u4f20\u9012 <code>shared_ptr&lt;TrieNodeWithValue&gt;</code> \u4f5c\u4e3a Trie \u7684\u6784\u9020\u53c2\u6570\u5373\u53ef\uff0c\u4e0d\u9700\u8981 \u624b\u52a8\u8f6c\u6362\u3002</p> <p>Q: Clone \u65b9\u6cd5\u5c06\u6210\u5458\u53d8\u91cf\u518d\u6b21\u5305\u88c5\u6210 unique_ptr, \u8fd9\u4e0d\u4f1a\u9020\u6210 double free \u5417\u3002</p> <p>A: \u8fd9\u662f\u6ca1\u6709\u5173\u7cfb\u7684\uff0c\u6210\u5458\u53d8\u91cf\u7c7b\u578b\u662f map\u3002cpp \u5185\u90e8\u4f1a\u5c06\u6570\u636e\u590d\u5236\u4e00\u4efd\uff0c\u7136\u540e\u8ba9 unique_ptr \u6307\u5411 \u590d\u5236\u540e\u7684\u6570\u636e</p> <p>Q: \u76ee\u524d\u597d\u50cf\u53ea\u80fd\u63d2\u5165\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u540e\u7eed\u66f4\u6539\u5931\u8e2a\u4e86\u3002</p> <p>A: \u7531\u4e8e\u662f const \u7c7b\u578b\uff0c \u6240\u4ee5\u518d\u600e\u4e48\u6837\u4e5f\u662f\u6539\u4e0d\u4e86\u8282\u70b9\u7684\u5185\u5bb9\u7684</p> <p>\u53c2\u8003 \u77e5\u4e4e , \u91cd\u5199Put \u9700\u8981\u5b9e\u73b0\u5199\u65f6\u590d\u5236\u7684\u5b57\u5178\u6811\uff0c\u6240\u4ee5\u4e0d\u662f\u6309\u7167abc\u7684\u987a\u5e8f\uff0c\u800c\u662fcba\u5411\u4e0a\u9012\u5f52</p> <p>\u672c\u9898\u7684\u6838\u5fc3\u5c31\u662f\u5982\u4f55\u5728 \u4e0d\u66f4\u6539\u539f\u59cb trie \u7ed3\u6784\u7684\u524d\u63d0\u4e0b\uff0c\u901a\u8fc7\u9012\u5f52\u7684\u65b9\u5f0f\uff0c\u6784\u5efa\u4e00\u4e2a\u65b0\u7684trie (\u540c\u65f6\u8fd8\u8981\u590d\u7528\u539f\u59cbtrie\u7684\u8282\u70b9)</p>"},{"location":"notes/15445%20Database/p0/#task2","title":"task2","text":"<p>\u5b9e\u73b0\u4e00\u4e2a concurrent trie</p> <p>\u5f53\u4f60\u6709\u4e86\u4e00\u4e2a\u53ef\u4ee5\u5355\u7ebf\u7a0b\u53ef\u7528\u7684\u5199\u65f6\u590d\u5236 trie, \u518d\u5c1d\u8bd5\u5b9e\u73b0\u4e00\u4e2a \u591a\u7ebf\u7a0b\u4e0b\u53ef\u7528\u7684 trie\u3002\u5728\u8fd9\u4e2a\u4efb\u52a1\u4e2d\uff0c\u4f60\u9700\u8981\u4fee\u6539 <code>trie.h</code> \u548c <code>trie.cpp</code> \u6587\u4ef6\u3002\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u4e5f\u652f\u6301\u4e09\u79cd\u64cd\u4f5c</p> <ul> <li><code>get</code> </li> <li><code>put</code> </li> <li><code>delete</code> </li> </ul> <p>\u5bf9\u4e8e\u539f\u59cb\u7684 Trie, \u6bcf\u5f53\u6211\u4eec\u60f3\u8981\u4fee\u6539 trie \u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5c31\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 \u6839\u8282\u70b9\u6765\u8bbf\u95ee\u4fee\u6539\u540e\u7684\u5185\u5bb9\u3002\u4f46\u662f\u5bf9\u4e8e concurrent trie \u7684 <code>put</code> \u548c <code>get</code> \u65b9\u6cd5\u6765\u8bf4\uff0c\u4ed6\u4eec\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u8fd9\u5c31\u9700\u8981\u4f60\u4f7f\u7528 \u5e76\u53d1\u7279\u6027 \u6765\u540c\u6b65\u8bfb\u5199\u64cd\u4f5c\uff0c\u4ee5\u907f\u514d \u5728\u4fee\u6539\u8fc7\u7a0b\u4e2d\u9020\u6210\u6570\u636e\u4e22\u5931\u3002</p> <p>\u4f60\u7684 concurrent trie \u5e94\u8be5\u80fd\u652f\u6301\u591a\u4e2a\u8bfb\u8005 \u548c \u4e00\u4e2a\u5199\u8005\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u5199\u8005\u5728\u4fee\u6539 trie \u7684\u65f6\u5019\uff0c\u8bfb\u8005\u53ef\u4ee5\u901a\u8fc7\u8001\u6839\u8282\u70b9\u6765\u8bbf\u95ee\u6570\u636e\u3002\u5f53\u6709\u8bfb\u8005\u6b63\u5728\u8bfb\u53d6\u6570\u636e\u65f6\uff0c \u5199\u8005\u4e0d\u9700\u8981\u7b49\u5f85\u8bfb\u8005\u8bfb\u53d6\u5b8c\u6210\u3002</p> <p>\u540c\u65f6\uff0c\u5982\u679c\u4f60\u83b7\u53d6\u4e86 trie \u4e2d\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u7684\u503c \u7684\u5f15\u7528\uff0c\u90a3\u4e48\u4e0d\u8bba\u4e4b\u540e\u5bf9trie \u505a\u4e86\u4ec0\u4e48\u64cd\u4f5c\uff0c\u6211\u4eec\u90fd\u5e94\u8be5\u80fd\u591f\u901a\u8fc7\u5f15\u7528\u83b7\u53d6\u5230\u8fd9\u4e2a\u503c\u3002<code>get</code> \u65b9\u6cd5\u53ea\u8fd4\u56de\u4e00\u4e2a\u6307\u9488\uff0c\u5982\u679c\u8fd9\u4e2a trieNode \u88ab\u5220\u9664\u540e\uff0c\u8fd9\u4e2a\u6307\u9488\u5c31\u4f1a\u53d8\u4e3a \u60ac\u5782\u6307\u9488\uff0c \u4e3a\u6b64\uff0c\u6211\u4eec\u5c06\u8fd4\u56de\u503c\u7528 <code>ValueGuard</code> \u7c7b\u5305\u88c5\uff0c<code>valueGuard</code> \u4e0d\u4ec5\u4fdd\u5b58\u4e86 \u6307\u9488\u548c\u5bf9\u5e94\u7684\u503c\uff0c\u8fd8\u4fdd\u5b58\u4e86\u8fd9\u4e2a TrieNode \u6240\u5bf9\u5e94\u7684\u6839\u8282\u70b9\u3002</p> <p>\u4e3a\u4e86\u505a\u5230\u8fd9\u70b9\uff0c\u6211\u4eec\u5df2\u7ecf\u4e3a\u4f60\u5728 <code>TrieStore::Get</code> \u65b9\u6cd5\u4e2d\u5199\u597d\u4e86 \u4f2a\u4ee3\u7801\uff0c\u8bf7\u4e25\u683c \u6309\u7167 \u8bf4\u660e\u8fdb\u884c \u7f16\u5199\u3002</p>"},{"location":"notes/6.s081%20OS/interview/","title":"The starting process of xv6","text":""},{"location":"notes/6.s081%20OS/interview/#compile-time","title":"Compile time","text":"<ul> <li>Using gcc to compile all the kernel source file into a elf. </li> <li>Using gcc to build userspace which contains all user program to <code>fs.img</code>, kernel can access this filesystem by using virtualized disk.</li> <li>Because the xv6 runs on qemu, qemu will read the meta data of compiled kernel, and put data segment in 0x8000000, and help virtualize the hardware resources the xv6 needs.</li> </ul>"},{"location":"notes/6.s081%20OS/interview/#run-time","title":"Run time","text":"<ul> <li>The first assembly code for kernel starts from <code>entry.S</code> (set by the <code>kernel.ld</code>), <code>entry.S</code> will set the stack_pointer, and call <code>start.S</code>.</li> <li><code>start.S</code> will set relevent flags and set epc to <code>main</code>, then call <code>mret</code> to downgrade privliged mode to supervised mode.</li> <li>Then start <code>main.c</code></li> <li>init hardware resource, set up paging.</li> <li>start first user program <code>initCode</code>, which using system call <code>exec</code> to call user-program <code>init</code>.</li> <li><code>init</code> print welcome message in the console, and wait for user input.</li> </ul>"},{"location":"notes/6.s081%20OS/interview/#_1","title":"\u7cfb\u7edf\u8c03\u7528","text":""},{"location":"notes/6.s081%20OS/interview/#_2","title":"\u5b8f\u89c2\u4e0a","text":"<ol> <li>\u5728 user-space \u8bbe\u7f6e\u597d\u5bf9\u5e94\u7684\u51fd\u6570\u58f0\u660e\uff0c\u8bbe\u7f6e\u597d\u7cfb\u7edf\u8c03\u7528\u53f7</li> <li>\u5728 kernel-space \u5b9e\u73b0\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528</li> </ol>"},{"location":"notes/6.s081%20OS/interview/#_3","title":"\u5fae\u89c2\u4e0a","text":"<p>The ecall instruction traps into the kernel and executes uservec, usertrap, and then syscall, as we saw above. (ecall -&gt; uservec -&gt; usertrap -&gt; syscall)</p> <p>syscall (kernel/syscall.c:133) retrieves the system call number from the saved a7 in the trapframe and uses it to index into syscalls. For the first system call, a7 contains SYS_exec (kernel/syscall.h:8), resulting in a call to the system call implementation function sys_exec.</p> <p>syscall trace print the specified system call when executing sysinfo add system calls to collect memory usage and processor count, user program can access this by using provided added system call.</p>"},{"location":"notes/6.s081%20OS/interview/#_4","title":"\u5185\u5b58\u5206\u914d\u5668","text":"<p>xv6 \u539f\u59cb\u7684\u8bbe\u8ba1\u662f\u6240\u6709\u8fdb\u7a0b\u5171\u4eab\u4e00\u4e2a\u5185\u5b58\u5206\u914d\u94fe\u8868\uff0c\u7528\u4e00\u628a\u5927\u9501\u6765\u4fdd\u8bc1\u539f\u5b50\u6027</p> <p>\u6539\u8fdb\u540e\u7684\u8bbe\u8ba1\u662f \u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u94fe\u8868\uff0c\u5f53\u81ea\u5df1\u7684\u7a7a\u95f2\u5185\u5b58\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u53bb\u5176\u4ed6cpu\u54ea\u91cc\u83b7\u53d6\u5185\u5b58\u3002</p>"},{"location":"notes/6.s081%20OS/interview/#cow","title":"COW","text":"<p>\u5728\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u6211\u4eec\u8bbe\u7f6e\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u6620\u5c04\u4e3a\u7236\u8fdb\u7a0b\u865a\u62df\u9875\u9762\u5bf9\u5e94\u7684\u7269\u7406\u9875\u9762\uff0c\u5e76\u5c06\u4e8c\u8005\u7684\u9875\u8868\u9879\u90fd\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u5199\u3002</p> <p>\u8fd9\u6837\uff0cfork \u65f6\u5c31\u4e0d\u4f1a\u7acb\u523b\u590d\u5236\u5185\u5b58\uff0c\u53ea\u4f1a\u521b\u5efa\u4e00\u4e2a\u6620\u5c04\u4e86\u3002\u8fd9\u65f6\u5019\u5982\u679c\u5c1d\u8bd5\u4fee\u6539\u61d2\u590d\u5236\u7684\u9875\uff0c\u4f1a\u51fa\u73b0 page fault \u88ab usertrap() \u6355\u83b7\u3002</p> <p>\u5176\u6b21\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5bf9 \u5206\u914d\u7684\u9875\u9762\u505a\u597d \u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e00\u4e2a\u5206\u914d\u7684\u9875\u9762\u8bbe\u7f6e\u4e00\u4e2a \u8ba1\u6570\u5668\uff0c\u5f53\u8fd9\u4e2a\u8ba1\u6570\u5668\u5f520\u65f6\uff0c\u4e5f\u5c31\u662f\u4e0d\u518d\u6709\u5176\u4ed6\u8fdb\u7a0b \u5360\u6709\u8fd9\u4e2a\u9875\u9762\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c06\u5206\u914d\u7684\u9875\u9762\u56de\u6536.</p>"},{"location":"notes/6.s081%20OS/lab1/","title":"Lab1","text":""},{"location":"notes/6.s081%20OS/lab1/#primes","title":"primes","text":"<ul> <li>How to stop program<ul> <li>-1 \u4f5c\u4e3a\u7ec8\u7ed3\u7b26</li> <li>\u6ce8\u610f\u5728\u7236\u8fdb\u7a0b \u6700\u540e \u52a0\u4e0a wait(0);</li> </ul> </li> <li>when you are confused about the output, pint out the pid would be convenient</li> </ul>"},{"location":"notes/6.s081%20OS/lab1/#find","title":"find","text":"<p>\u5148\u770bls\u7684\u5b9e\u73b0\u7ec6\u8282\uff1a     - \u9996\u5148\u6839\u636e\u53c2\u6570\u4e2a\u6570\u5224\u65ad\u8f93\u5165\u662f\u5426\u5408\u6cd5         - \u82e5\u8f93\u5165\u7684\u53c2\u6570\u4e2a\u6570\u4e3a0 \u76f4\u63a5\u9000\u51fa         - \u5426\u5219\uff0c\u5206\u522b\u5bf9\u6bcf\u4e00\u4e2a\u53c2\u6570 \u6267\u884c ls \u51fd\u6570</p> <p>ls \u51fd\u6570\u7684\u5b9e\u73b0\u7ec6\u8282 some struct and function api - struct dirent </p> <pre><code>| name | type    | description       |\n|------|---------|-------------------|\n| inum | ushort  | number of files ? |\n| name | char [] | file names array  |\n</code></pre> <ul> <li> <p>struct stat</p> name type description dev int file system disk divice ino uint file poniters ponits to the array type short type of a file nlink short number of links to the file size size size of a file </li> <li> <p>system call close</p> arugments description const char* pathname the name of the file int flag specify the way to open a file flag des O_RDONLY, O_WRONLY, or O_RDWR. \u53ea\u8bfb\uff0c\u53ea\u5199\uff0c\u8bfb\u5199 return Value des int fd file descripnator </li> <li> <p>fstat (file state)</p> arugments description int fd file descripnator struct stat* the info retrived from file fd points to was saved here return Value des status code 0 success, -1 failed </li> <li> <p>details about the ls</p> <ul> <li>first we open the file according to the file name (string) , and we get fd</li> <li>using fd, we call <code>fstat</code> ,to retrieve the metadata from it,</li> <li>according to the file, we have the following operation<ul> <li>if it is a <code>T_FILE</code> we print it </li> <li>if it is a <code>T_DIR</code> we </li> </ul> </li> </ul> </li> <li>persudo code for \"find\"</li> </ul> <pre><code>takes two argument, \n    1. target directory\n    2. find target\nopen target directory, iterate through the catalogue\n    if it is a file, we compare it to file target\n    if it is a direc, we do it recursively\n</code></pre>"},{"location":"notes/6.s081%20OS/lab1/#problem","title":"problem","text":"<ul> <li>how to iterate through a direc in unix</li> <li>what is <code>.</code>, <code>..</code> be represented for</li> <li>cannot open file, maybe file name wrongs<ul> <li>do not close the file descripnator, so new file cannot be open</li> </ul> </li> </ul>"},{"location":"notes/6.s081%20OS/lab1/#xargs","title":"xargs","text":""},{"location":"notes/6.s081%20OS/lab1/#problem_1","title":"problem","text":"<ul> <li>how can we know we are excecuting xargs command</li> <li>how can I get the arguments from the pipe <ul> <li>we do not need to know, just read from standard input. the os provide us with abstraction using pipe.</li> </ul> </li> <li>how can pass char**  arg as the second  argument for exec, as we need to increase the number of arugments,     instead of copy value, we just assign poniters</li> </ul>"},{"location":"notes/6.s081%20OS/lab1/#how-to-implement","title":"How to implement","text":"<ul> <li>is the second paramter == '-n'<ul> <li>yes,  then we store the specified maximum arguments </li> <li>no, we read all the input, replace \\n -&gt; ' ' </li> </ul> </li> </ul>"},{"location":"notes/6.s081%20OS/lab10/","title":"Lab10","text":""},{"location":"notes/6.s081%20OS/lab10/#mmap","title":"mmap","text":"<p>mmap \u5c06 \u6587\u4ef6\u5185\u5bb9 \u6620\u5c04\u5230\u865a\u62df\u5185\u5b58\u3002\u8fd9\u6837\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u901a\u8fc7\u865a\u62df\u5730\u5740\u6765\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\u3002</p> <p>\u9700\u8981\u67e5\u770b\u7684\u5185\u5bb9     - lecture 15 17 19 VMA     - lazy page allowcation     - \u5783\u573e\u56de\u6536\u673a\u5236</p> <p>lecture 10</p> <p>\u7ed3\u675f lab \u540e(\u9664\u4e86 lock)     - paper     - lecture</p> <p>\u4ec0\u4e48\u53eb fill in the page lazily, \u54ea\u91cc\u7684 page</p> <p>process \u5c06 \u6253\u5f00\u7684\u6587\u4ef6\u4fdd\u5b58\u5728 p-&gt;ofile \u6570\u7ec4\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 file descriptor \u6765\u8bbf\u95ee\u3002</p> <p>\u90a3\u4e48\u5728\u4e4b\u524d\uff0cuvmcopy \u662f\u901a\u8fc7\u67e5\u627e \u8d77\u59cb\u5730\u5740\u5bf9\u5e94\u7684 \u9875\u8868\u9879 \u6765\u505a\u5730\u5740\u6620\u5c04\u7684\u3002 mmap \u7684\u91cd\u70b9\u662f\u8981\u627e\u5230\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u5b58\u653e\u6587\u4ef6\u6620\u5c04\u533a\u57df\u3002</p> <p>naive thought:      \u5728\u8c03\u7528 mmap \u65f6\uff0c\u4f7f\u7528\u5faa\u73af\u4fbf\u5229\u6574\u4e2a\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u627e\u5230\u8fde\u7eed n \u4e2a page\uff1b     \u4e3a\u8fd9\u8fde\u7eed\u7684 n \u4e2apage \u8bbe\u7f6e\u6807\u5fd7\u4f4d\u3002\u5e76\u8bb0\u5f55\u5728\u6570\u7ec4 vma \u4e2d\u3002     \u968f\u4fbf\u627e\u4e00\u6bb5\u7a7a\u95f2\u5185\u5b58\u597d\u50cf\u4e0d\u663e\u793a\uff0c\u4f1a\u51fa\u73b0\u5404\u79cd\u6743\u9650\u9519\u8bef\u3002</p> <p>\u5730\u5740\u7a7a\u95f4 addr     user space         text data bss heap {mmap area} stack        kernerl space</p> <ul> <li> <p>\u9996\u5148\uff0c\u53ea\u662f\u4e3a mmap \u5728\u7528\u6237\u7a7a\u95f4 \u627e\u5230\u4e00\u4e2a\u8fde\u7eed\u7684\u7a7a\u95f4\uff0c\u7136\u540e\u6ce8\u518c\u4e00\u4e0b vma\u3002\u8fd9\u4e2a\u65f6\u5019\u4e0d\u5bf9\u865a\u62df\u5185\u5b58\u505a\u4efb\u4f55\u64cd\u4f5c \u7f3a\u9875\u4e2d\u65ad\u7684\u65f6\u5019\uff0c\u518d\u505a\u9875\u9762\u6620\u5c04\u3002</p> </li> <li> <p>\u4e0d\u77e5\u9053\u4ece\u865a\u62df\u5185\u5b58\u7684\u90a3\u4e00\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u67e5\u627e\u9875\u9762\u6620\u5c04\uff0c\u53bb\u770b\u4e0b exec \u7684\u4ee3\u7801\u8bd5\u8bd5\u3002</p> </li> </ul> <p>\u53d1\u73b0\u53ef\u4ee5\u4ece p-&gt;sz + 2 * PGSIZE (\u7528\u6237\u6808) \u5f00\u59cb\u3002(\u5176\u5b9e\u4ece0\u5f00\u59cb\u626b\u63cf\u4e5f\u884c)</p> <ul> <li>\u7a0b\u5e8f\u5361\u6b7b\u4e86</li> <li> <p>\u9006\u5929, \u662f\u56e0\u4e3a\u5728 trap \u4e2d \u5224\u65ad\u662f\u5426\u53d1\u751f\u4e86\u7f3a\u9875\uff0c\u4f46\u662f\u6ca1\u6709\u5bf9\u7f3a\u9875\u505a\u4efb\u4f55\u5904\u7406\u3002\u3002\u3002</p> </li> <li> <p>\u5728\u5bf9 vma \u8fdb\u884c\u4e2d\u65ad\u5904\u7406\u4e4b\u540e\uff0c\u76f8\u540c\u7684va \u518d\u6b21\u89e6\u53d1\u4e86\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fd9\u5bfc\u81f4 mappages \u51fa\u73b0 panic\u3002\u6211\u731c\u6d4b\u5927\u6982\u662f\u56e0\u4e3a\u6211\u5bf9 \u6743\u9650\u4f4d\u6ca1\u6709\u5904\u7406\u597d</p> </li> </ul> <p>\u786e\u5b9e\uff0cprot \u9700\u8981\u53f3\u79fb\u4e00\u4f4d\uff0c\u624d\u80fd\u548c pte \u6807\u5fd7\u4f4d\u76f8\u5bf9\u5e94</p> <ul> <li> <p>\u4fee\u6b63\u540e\uff0c\u51fa\u73b0 panic freewalk, \u4f30\u8ba1\u662f \u8fdb\u7a0b\u7ed3\u675f\u65f6\uff0c\u6ca1\u6709\u91ca\u653e\u6389 vma \u6240\u6307\u5411\u7684 \u865a\u62df\u5185\u5b58\uff1b     \u5148\u67e5\u770b\u4e00\u4e0b\u5199\u5165\u7684\u6570\u636e\u5bf9\u4e0d\u5bf9\u3002</p> </li> <li> <p>\u5e76\u4e0d\u662f\uff0c\u56e0\u4e3a mmaptouch \u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u8bbe\u7f6e p-&gt;killed = 1\uff0c\u6240\u4ee5\u624d\u4f1a\u89e6\u53d1 freewalk \u7b2c\u4e8c\u4e2a\u9875\u9762\u53ea\u8bfb\u5230 2048 \u5b57\u8282\u7684\u6570\u636e, \u5c06\u591a\u4f59\u7684\u6570\u636e\u521d\u59cb\u5316\u4e3a0\u5c31\u597d\u4e86\u3002</p> </li> </ul> <p>\u8ba9\u6211\u597d\u5947\u7684\u662f\uff0c write(fd, buf, BSIZE) \u662f\u600e\u4e48\u505a\u5230\u6bcf\u6b21\u5199\u5165\u4e00\u4e2a\u5b57\u7b26\u7684\uff1f \u4ed6\u7684\u5199\u5165\u5927\u5c0f\u4e0d\u662f BSIZE \u5417\uff1f</p> <ul> <li>\u5728\u5185\u6838\u6001\u53ea\u80fd\u8fde\u7eed\u68c0\u9a8c\u4e00\u4e2a\u9875\u7684\u5185\u5bb9\u3002 (\u4e0d\u540c\u7684\u9875\u9700\u8981\u67e5\u9875\u8868\u83b7\u5f97\u6620\u5c04)</li> </ul>"},{"location":"notes/6.s081%20OS/lab2/","title":"Lab2","text":""},{"location":"notes/6.s081%20OS/lab2/#lab-2-kernal-development","title":"lab 2 kernal development","text":""},{"location":"notes/6.s081%20OS/lab2/#_1","title":"\u7b14\u8bb0","text":""},{"location":"notes/6.s081%20OS/lab2/#kernal-user-mode","title":"kernal / user mode","text":"<p>How would user actually override the bits that identify context if the instruction to change that bit  is itself a privilege instruction? It seems user can never change to kernel mode.</p> <ul> <li>use <code>ecall</code> to invoke kernel mode</li> </ul> <p>The loader loads the XV_6 kernel into memory at physical address 0x80000000. The reason it places the kernel at 0x80000000 rather than 0x0 is because the address range 0x0:0x80000000 contains I/O devices</p>"},{"location":"notes/6.s081%20OS/lab2/#xv_6","title":"xv_6","text":"<p>The startup process for xv_6 system</p> <p> \u4e3a\u4e86\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u83b7\u53d6\u7528\u6237\u4f20\u9012\u7684\u53c2\u6570\u3002\u7531\u4e8e\u6700\u521d\u662f\u5728\u7528\u6237\u6a21\u5f0f\u4e0b\u8c03\u7528\u7684\u8c03\u7528\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570 \uff0c\u6240\u4ee5\u53c2\u6570\u662f\u50a8\u5b58\u5728\u901a\u7528\u5bc4\u5b58\u5668\u4e2d\u3002<code>kernal trap code</code> \u4f1a\u4fdd\u5b58\u901a\u7528\u5bc4\u5b58\u5668\u7684\u503c\uff0c<code>kernal code</code> \u5c31\u53ef\u4ee5\u5229\u7528 trapframe \u6765\u83b7\u53d6\u53c2\u6570\u3002xv6 \u4e3a\u6b64\u5c01\u88c5\u4e86<code>argint</code>, <code>argaddr</code>, <code>argfd</code>\u4e09\u4e2a\u51fd\u6570\u3002</p> <ul> <li>\u4f7f\u7528\u5b83\u4eec\u53ef\u4ee5\u5206\u522b\u4ee5 \u6574\u5f62\uff0c\u6307\u9488\uff0c\u6587\u4ef6\u63cf\u8ff0\u7b26\u6765\u83b7\u53d6\u7528\u6237\u4f20\u9012\u53c2\u6570</li> <li>\u5b83\u4eec\u90fd\u501f\u52a9 <code>argraw</code> \u6765\u4ece\u6b63\u786e\u7684\u5bc4\u5b58\u5668\u83b7\u53d6\u53c2\u6570</li> </ul>"},{"location":"notes/6.s081%20OS/lab2/#_2","title":"\u5b9e\u9a8c","text":""},{"location":"notes/6.s081%20OS/lab2/#trace-system-call","title":"trace system call","text":""},{"location":"notes/6.s081%20OS/lab2/#_3","title":"\u7cfb\u7edf\u8c03\u7528\u7684\u6267\u884c\u8fc7\u7a0b","text":"<ol> <li><code>user.h</code> add function stub to pass compiling </li> <li><code>usys.pl</code> generate corresponding assembly code </li> <li><code>syscall.c</code> call corresponding function in <code>sysproc.c</code> </li> <li>add code in <code>sycall.h</code> <code>1 &lt;&lt; xxx</code> </li> <li>add function <code>sys_trace</code> in <code>sysproc.c</code> </li> <li>add <code>extern uint64 sys_trace(void)</code> function signature</li> <li>modify array <code>syscalls</code> </li> </ol>"},{"location":"notes/6.s081%20OS/lab2/#sysinfo-system-call","title":"sysinfo system call","text":"<ul> <li>need record</li> <li><code>freemem</code> free memory, <code>kalloc.c</code> </li> <li> <p><code>nproc</code> number of process, <code>proc.c</code> </p> </li> <li> <p>copy <code>struct info</code> back to user space</p> </li> <li><code>sys_fstate</code> in <code>sysfile.c</code> </li> <li> <p><code>filestat</code> in <code>file.c</code> </p> </li> <li> <p>quesion</p> </li> <li> <p>why we need copy <code>struct info</code> to user space </p> </li> <li> <p>because after the system call, we need read struct info in user space</p> </li> <li> <p>why testmem test failed?</p> </li> <li> <p>seems like the freemem is always 0</p> <p><code>p = p-&gt;next</code> instead of <code>p++</code> </p> </li> </ul>"},{"location":"notes/6.s081%20OS/lab3/","title":"Lab3","text":""},{"location":"notes/6.s081%20OS/lab3/#page-table","title":"Page Table","text":"\u51fd\u6570 \u4f5c\u7528 copyin copy data to user space copyout copy data from user space mappages install PTE for new mappings walk find PA for VA"},{"location":"notes/6.s081%20OS/lab3/#xv6-book","title":"XV6 Book","text":"<ul> <li>\u4ece3.5 \u5f00\u59cb\uff0c \u90fd\u6ca1\u8bfb\u61c2, \u540e\u7eed\u8865\u4e0a:  &lt;13-04-23, David Chen&gt; -</li> </ul> <p>implement pageing in practice </p> <p>in <code>main.c</code> , it calls <code>kvminit</code>, and <code>kvminit</code>  calls <code>kvmmake</code>. <code>kvmmake</code> returns a pointer (kernel_pagetable).</p> <p>kvmmake first init allocate a PAGE for root pagetable, and then call <code>mappages</code> to allocate memory for hardware (At this point, paging is not started, so virtual address is directed mapped to physical address) </p> <p><code>kvmmap</code> calls <code>mappages</code> , <code>mappages</code> first align the start address and end address, and start allocate PA for VA at page intervals</p> <ul> <li><code>mappages</code> function makes me confusing</li> <li>what is macro <code>PAGEROUNDDOWN</code> means<ul> <li>I guess this macro is used to align the size of a and size.</li> </ul> </li> </ul>"},{"location":"notes/6.s081%20OS/lab3/#lab","title":"lab","text":""},{"location":"notes/6.s081%20OS/lab3/#speed-up-system-calls","title":"Speed up system calls","text":"<p>\u67d0\u4e9b\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u4e00\u4e2a\u53ea\u8bfb\u533a\u57df\u6765\u5728\u7528\u6237\u4e0e\u5185\u6838\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u4ee5\u52a0\u901f\u7cfb\u7edf\u8c03\u7528\u7684\u6267\u884c\u901f\u5ea6\u3002\u8fd9\u6837\u7684\u7b56\u7565\u80fd\u591f\u51cf\u5c11\u7cfb\u7edf\u5728\u5730\u5740\u8f6c\u6362\u4e0a\u82b1\u8d39\u7684\u65f6\u95f4\u3002\u4e3a\u4e86\u5e2e\u52a9\u4f60\u66f4\u597d\u7684\u7406\u89e3\u5982\u4f55\u5411 <code>page table</code> \u4e2d\u63d2\u5165\u6620\u5c04\uff0c\u4f60\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1\u5c31\u662f\u4e3a <code>getpid</code> \u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u5b9e\u73b0\u8fd9\u6837\u7684\u4f18\u5316\u3002</p> <p>Solution </p> <p>The life cycle of a xv6 process is as follows.</p> <p>We can call <code>allocproc</code> to create a new process. <code>allocproc</code> first use <code>kalloc</code> to allocate physical space for <code>p-&gt;trapframe</code>  and <code>p-&gt;usyscall</code> .</p> <pre><code>  if((p-&gt;usyscall = (struct usyscall *)kalloc()) == 0){\n    freeproc(p);\n    release(&amp;p-&gt;lock);\n    return 0;\n  }\n\n  p-&gt;usyscall-&gt;pid = p-&gt;pid;\n</code></pre> <p>Then <code>allocproc</code> call <code>proc_pagetabl</code> to initialize the pagetable for the process.</p> <p><code>proc_pagetable</code> use <code>uvmmap</code> to map virtual memory to corresponding physical memory.</p> <pre><code>  // map a page for speed up syscall\n  if(mappages(pagetable, USYSCALL, PGSIZE,\n              (uint64)(p-&gt;usyscall), PTE_R) &lt; 0){\n    uvmunmap(pagetable, USYSCALL, 1, 0);\n    uvmfree(pagetable, 0);\n    return 0;\n  }\n\n  return pagetable;\n}\n</code></pre> <p>We can call <code>freeproc</code> to free an running process. <code>freeproc</code> first use <code>kfree</code> to free process memory, Then call <code>proc_freepagetabl</code> to initialize free pagetable for the process.</p> <pre><code>  if(p-&gt;usyscall)\n    kfree((void*)p-&gt;usyscall);\n  p-&gt;usyscall = 0;\n</code></pre> <p><code>proc_pagetable</code> use <code>uvmummap</code> to  cancel mapping for virtual memory to corresponding physical memory.</p> <p>And then call <code>uvmfree</code> to free pagetable.</p> <pre><code>void\nproc_freepagetable(pagetable_t pagetable, uint64 sz)\n{\n  uvmunmap(pagetable, TRAMPOLINE, 1, 0);\n  uvmunmap(pagetable, TRAPFRAME, 1, 0);\n  uvmunmap(pagetable, USYSCALL, 1, 0);\n  uvmfree(pagetable, sz);\n}\n</code></pre>"},{"location":"notes/6.s081%20OS/lab3/#detecting-which-page-have-been-accessed","title":"Detecting which page have been accessed","text":"<p>and according to the PA, find corresponding VA for kernel. But How to do this. Or we insert a new mapping for this copyin and copyout confused me. I guess they work as follows. copyin use process pagetable to find PA of the argument</p> <p>\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u53ea\u9700\u901a\u8fc7 walkaddr \u627e\u5230 \u7528\u6237\u865a\u62df\u5730\u5740\u5bf9\u5e94\u7684 \u7269\u7406\u5730\u5740\uff0c\u518d\u5bf9\u7269\u7406\u5730\u5740\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\u3002 </p> <p>How to write content to corresponding addr</p> <ol> <li>First we need to define <code>PTE_A</code> in <code>riscv.h</code> </li> <li>add stub for <code>walk</code> in <code>def.h</code> </li> <li>implement <code>sys_pgaccess</code> in <code>sysproc.c</code> <ul> <li>\u904d\u5386\u5c31\u597d </li> </ul> </li> </ol> <p> \u6ce8\u610f\u6211\u4eec\u4e0d\u9700\u8981\u624b\u52a8\u8bbe\u7f6e PTE_A \u4f4d\uff0c\u786c\u4ef6\u5e2e\u6211\u4eec\u505a\u597d\u4e86  <pre><code>int sys_pgaccess()\n{\n    // lab pgtbl: your code here.\n\n  uint64 va0;\n  int num;\n  uint64 usr_cnt;\n\n  // \u4ece trapframe \u83b7\u53d6\u53c2\u6570\n  if(argaddr(0, &amp;va0) &gt; 0) {\n    return -1;\n  }\n\n  if(argint(1, &amp;num) &gt; 0) {\n    return -1;\n  }\n\n  if(argaddr(2, &amp;usr_cnt) &gt; 0) {\n    return -1;\n  } \n\n  uint64 k_cnt = 0;\n\n  // \u5411\u4e0b\u53d6\u6574\uff0c\u4fdd\u8bc1\u5730\u5740\u5bf9\u9f50\n\n  va0 = PGROUNDDOWN(va0);\n  struct proc* p = myproc();\n\n  // \u4ece va0 -&gt; va0 + num * pagesize \u904d\u5386 \u9875\u8868\n  // \u67e5\u770b\u5176 PTE_A \u662f\u5426\u4e3a 1\n  // \u4e3a 1 \u7684\u8bdd\uff0c\u7f6e\u7ed3\u679c\u7b2c 1 &lt;&lt; num \u4f4d \u4e3a 1\uff0c\n  // \u518d\u5c06 access \u4f4d \u7f6e 0\n  for (int i = 0; i &lt; num; i++) {\n    pte_t* pte = walk(p-&gt;pagetable, va0, 0);\n    if (*pte &amp; PTE_A) {\n      k_cnt |= (1 &lt;&lt; i);\n      *pte = *pte &amp; (~PTE_A);\n    }\n    va0 += PGSIZE;\n  }\n\n  copyout(p-&gt;pagetable, usr_cnt, (char* )&amp;k_cnt, sizeof(uint64) / sizeof(char));\n\n  return 0;\n}\n</code></pre></p> <p>&lt;++&gt;</p> <p>```json</p>"},{"location":"notes/6.s081%20OS/lab4/","title":"Lab4","text":""},{"location":"notes/6.s081%20OS/lab4/#trap","title":"Trap","text":"<p>Q: Which registers contain arguments to functions? For example, which register holds 13 in main's call to printf?</p> <ul> <li>regisetr a2</li> </ul> <p>Q: Where is the call to function f in the assembly code for main? Where is the call to g? (Hint: the compiler may inline functions.)</p> <ul> <li>\u7f16\u8bd1\u5668\u4f18\u5316\u4e86\u5bf9\u4e0e f \u548c g \u7684\u51fd\u6570\u8c03\u7528</li> </ul> <p>26: 45b1                    li  a1,12</p> <p>Q: At what address is the function printf located?</p> <p>0x616</p> <p>Q: What value is in the register ra just after the jalr to printf in main?</p> <p>0x616</p> <p>Q: Run the following code.</p> <pre><code>unsigned int i = 0x00646c72;\nprintf(\"H%x Wo%s\", 57616, &amp;i);\n</code></pre> <p>What is the output? Here's an ASCII table that maps bytes to characters. The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set i to in order to yield the same output? Would you need to change 57616 to a different value?</p> <p>HE110 World; 0x726c64; 57616 \u4e0d\u9700\u8981\u6539\u53d8</p> <p></p> <p>Q: In the following code, what is going to be printed after 'y='? (note: the answer is not a specific value.) Why does this happen?</p> <pre><code>printf(\"x=%d y=%d\", 3);\n</code></pre> <p>A: read data that locates outside the stackframe</p> <p>Q: riscv \u4e0d\u662f\u5b9a\u957f\u7f16\u5740\uff0c\u4e00\u6761\u6307\u4ee464\u4f4d\u5417\uff0c\u600e\u4e48\u8fd9\u91cc\u6307\u4ee4\u7684\u4f4d\u7f6e\u4e4b\u95f4\u76f8\u5dee2</p> <p>64\u4f4d\u6307\u7684\u662f \u53ef\u5bfb\u5740\u8303\u56f4\u662f 2^64, \u548c\u6307\u4ee4\u957f\u5ea6\u6ca1\u6709\u5173\u7cfb\u3002 xv6 \u91c7\u7528\u7684\u6307\u4ee4\u96c6\u4e2d\u7684\u6307\u4ee4\u662f\u975e\u5b9a\u957f\u7684\u3002(16 bit / 32 bit)</p> <p>Q: auipc \u6307\u4ee4\u662f\u5e72\u5565\u7684</p> <p>auipc rd imm =&gt; rd = PC + imm &lt;&lt; 12 </p> <p>imm \u5269\u4e0b\u768412\u4f4d\u5728 jalr \u91cc</p> <p>auipc\u6307\u4ee4\u5c06\u7acb\u5373\u6570\u5de6\u79fb12\u4f4d\u52a0\u5230PC\u4e0a\u3002\u8fd9\u6837\uff0c\u53ef\u4ee5\u5c06auipc\u4e2d\u768420\u4f4d\u7acb\u5373\u6570\u4e0ejalr\u4e2d\u768412\u4f4d\u7acb\u5373\u6570\u7ec4\u5408\uff0c\u5c06\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u5230\u4efb\u4f5532\u4f4dpc\u76f8\u5bf9\u5730\u5740\u3002\u800cauipc\u52a0\u4e0a\u666e\u901a\u52a0\u8f7d\u6216\u5b58\u50a8\u6307\u4ee4\u4e2d\u768412\u4f4d\u7acb\u5373\u6570\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u4f7f\u5f97\u7a0b\u5e8f\u8bbf\u95ee\u4efb\u4f5532\u4f4dPC\u76f8\u5bf9\u5730\u5740\u7684\u6570\u636e</p> <p>Q: \u5982\u679c\u50a8\u5b58\u4e0d\u4e0b\uff0c\u8ba1\u7b97\u5730\u5740\u7684\u65f6\u5019\u4e0d\u4f1a\u6ea2\u51fa\u5417\uff1f</p> <p>\u8fd0\u7b97\u7684\u65f6\u5019\u5728ALU\u4e2d\u8fdb\u884c\u7684\uff0c\u4e0e\u673a\u5668\u5b57\u957f\u6709\u5173\uff0c \u548c\u6307\u4ee4\u5b57\u957f\u65e0\u5173\u3002</p> <p>\u673a\u5668\u5b57\u957f \u50a8\u5b58\u5b57\u957f \u6307\u4ee4\u5b57\u957f \u5bfb\u5740\u7a7a\u95f4</p> <p>Q: \u5730\u5740\u4e0d\u592a\u5bf9\u7684\u4e0a\u54e6\u3002  \u5bf9\u7684\u4e0a 30: ra = PC(0x30) + 0 = 0x30 34: pc = ra + 1510 = 1510 + 3 * 16 = 1558 = 0x616</p>"},{"location":"notes/6.s081%20OS/lab4/#backtrace","title":"backtrace","text":"<p>Q: \u8fd9\u4e2a stackframe \u7684\u5730\u5740\u4e3a\u5565\u8fd9\u4e48\u5c0f A: \u6253\u5370\u51fa\u6765\u7684\u662f\u7269\u7406\u5730\u5740</p> <p>Q: \u6808\u662f\u5b58\u5728\u865a\u62df\u5185\u5b58\u7684\u90a3\u4e00\u4e2a\u4f4d\u7f6e\uff1f A: </p> <p>\u5b8c\u6210\u672c\u5b9e\u9a8c\u7684\u5173\u952e\u70b9\uff0c\u5728\u4e8e\u7406\u89e3\u6808\u5e27 (stack frame) \u8fd9\u4e2a\u6a21\u578b</p> <p></p> <p>\u8fd8\u6709\u6307\u9488\u7684\u5999\u7528 </p> <p>r_fp \u8fd9\u4e2a\u51fd\u6570 \u8fd4\u56de\u7684\u662f\u5f53\u524d\u51fd\u6570\u7684 fp \u5730\u5740\u3002\u7531\u4e8e <code>xv</code>  \u662f 64 \u7684\u673a\u5668\uff0c\u6211\u4eec\u7528 <code>uint64</code> \u6765\u4fdd\u5b58\u5f53\u524d\u51fd\u6570\u7684 <code>fp</code> \u3002</p> <p>\u53c8\u56e0\u4e3a ra \u50a8\u5b58\u5728 \u6808\u9876\uff0c\u4e14 <code>xv6</code> \u662f <code>little endian</code> \u5b58\u50a8\uff0c\u6240\u4ee5\u6211\u4eec\u77e5\u9053\u50a8\u5b58 <code>ra</code> \u4f4e\u5b57\u8282\u7684\u6570\u636e\u5b58\u653e\u5728 \u4f4e\u5730\u5740\uff0c\u4e5f\u5c31\u662f <code>fp - 8</code> \u8fd9\u4e2a\u4f4d\u7f6e\u3002</p> <p>\u62ff\u5230 \u8fd9\u4e2a\u5730\u5740\u540e\uff0c\u6211\u4eec\u8981\u600e\u4e48\u83b7\u53d6\u8fd9\u4e2a\u5730\u5740\u6240\u4fdd\u5b58\u7684\u503c\u5462\uff1f \u53ef\u4ee5\u5c06\u8fd9\u4e2a\u5730\u5740\u8f6c\u6362\u4e3a\u6307\u9488\u7684\u7c7b\u578b\uff0c\u7136\u540e\u901a\u8fc7 <code>*fp</code> \u7684\u65b9\u5f0f\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u503c\u3002</p> <p>\u5176\u5b9e\u770b\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\uff0c\u6307\u9488\u4e0d\u8fc7\u662f C \u8bed\u8a00\u63d0\u4f9b\u7ed9\u6211\u4eec\u7684\u4e00\u4e2a\u8bed\u6cd5\u7cd6\u3002 <code>*p</code> \u7684\u672c\u8d28\u76f8\u5f53\u4e8e</p> <pre><code>void copy(void* a, void* b, int len) \n{\n    char* a1 = (char *)a;\n    char* b1 = (char *)b;\n\n    while (len-- &gt; 0) {*a1++ = *b1++;}\n}\n</code></pre> <pre><code>void\nbacktrace(void)\n{\n  uint64 fp = r_fp();\n  uint64 up = PGROUNDUP(fp);\n  uint64 down = PGROUNDDOWN(fp);\n\n  while (fp &lt;= up &amp;&amp; fp &gt;= down) {\n    uint64* ra = (uint64* )(fp - 8);\n    uint64* pre_fp = (uint64* )(fp - 16);\n    printf(\"%p\\n\", *ra);\n    fp = *pre_fp;\n  }\n}\n</code></pre> <p>\u505a\u5b8c\u8fd9\u4e2a\u5b9e\u9a8c\u6211\u4e5f\u7ec8\u4e8e\u7406\u89e3\u4e86</p> <p>The allocator sometimes treats addresses as integers in order to perform arithmetic on them (e.g., traversing all pages in freerange), and sometimes uses addresses as pointers to read and write memory (e.g., manipulating the run structure stored in each page);  this dual use of addresses is the main reason that the allocator code is full of C type casts.  The other reason is that freeing and allocation inherently change the type of the memory</p>"},{"location":"notes/6.s081%20OS/lab4/#alarm","title":"Alarm","text":"<p>\u9898\u610f: \u5728\u67d0\u4e00\u4e2a\u7a0b\u5e8f\u8c03\u7528\u4e86 <code>sigalarm</code> \u540e\uff0c \u6bcf\u95f4\u9694 <code>n</code> \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u5c31\u4f1a\u8fdb\u5165\u8fdb\u5165\u4e2d\u65ad\uff0c\u8c03\u7528 <code>handler</code> \u51fd\u6570\u3002 \u60f3\u8981\u53d6\u6d88\u5468\u671f\u6027\u4e2d\u65ad\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u8c03\u7528 <code>sigalarm(0, 0)</code> </p> <p>test0 \u96be\u70b9\uff1a 1. \u600e\u6837\u83b7\u53d6\u65f6\u95f4 2. \u6ca1\u6709\u627e\u5230 kernel \u83b7\u53d6 timer interrupt \u7684\u4ee3\u7801</p> <p>\u597d\u50cf\u4e0d\u9700\u8981\u624b\u52a8\u83b7\u53d6\u65f6\u95f4, \u786c\u4ef6\u5e2e\u6211\u4eec\u505a\u5230\u4e86</p> <p>Every tick, the hardware clock forces an interrupt' \u76f4\u63a5\u7528 ticks \u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf</p> <p>\u53ef\u4ee5\u5728\u8fd9\u4e2a\u6761\u4ef6\u4e0b\uff0c\u5904\u7406 tick</p> <p>if(which_dev == 2) ...</p> <p>test1 \u96be\u70b9: 1. \u50a8\u5b58\u4ec0\u4e48\u5bc4\u5b58\u5668\u624d\u80fd\u6b63\u5e38\u56de\u590d\u72b6\u6001</p> <p><code>int* p = 1;</code></p> <pre><code>fill in the content of p to 1.\n</code></pre> <p><code>*p = 1</code></p> <pre><code>find the address of p.\nget its value (another addrss),\naccording to the address \nfind the value\n</code></pre>"},{"location":"notes/6.s081%20OS/lab5%28cow%29/","title":"Lab5(cow)","text":""},{"location":"notes/6.s081%20OS/lab5%28cow%29/#cow","title":"cow","text":"<p>\u5f88\u7efc\u5408\u7684\u4e00\u4e2a\u9879\u76ee\uff0c\u505a\u5b8c\u4e4b\u540e\u590d\u4e60\u4e86 os api(fork, pipe), \u7cfb\u7edf\u8c03\u7528\uff0c\u9875\u8868\uff0c\u4e2d\u65ad, \u8fdb\u7a0b\u58f0\u660e\u5468\u671f\u3002</p> <ul> <li> <p>\u4fee\u6539 uvmmap \u51fd\u6570\u5c06\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u5730\u5740\u6620\u5c04\u5230\u5b50\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740</p> </li> <li> <p>Modify uvmcopy() to map the parent's physical pages into the child, instead     of allocating new pages. Clear PTE_W in the PTEs of both child and parent.</p> </li> </ul> <p>structure of pagetabl entry</p> <p></p> <p>scause \u503c\u6240\u4ee3\u8868\u7684\u542b\u610f</p> <p></p> <ul> <li>\u51fa\u73b0\u7f3a\u9875\u9519\u8bef\u624d\u4e3a\u5b50\u8fdb\u7a0b\u5206\u914d\u81ea\u5df1\u7684\u5185\u5bb9\u7a7a\u95f4.</li> <li> <p>\u600e\u4e48\u627e\u5230\u5f15\u53d1\u7f3a\u9875\u9519\u8bef\u7684\u5730\u5740\u5462\uff1f</p> </li> <li> <p>Modify usertrap() to recognize page faults. When a page-fault occurs on a     COW page, allocate a new page with kalloc(), copy the old page to the newpage, and install the new page in the PTE with PTE_W set.</p> </li> <li> <p>\u4ec0\u4e48\u65f6\u5019 drop \u4e00\u4e2apage \u5f53\u5b50\u8fdb\u7a0b\u8fd0\u884c\u7ed3\u675f\u7684\u65f6\u5019\u5417</p> </li> </ul> <p>need some ways to record page reference count</p> <ol> <li>Ensure that each physical page is freed when the last PTE reference to it     goes away -- but not before. A good way to do this is to keep, for each     physical page, a \"reference count\" of the number of user page tables that     refer to that page. Set a page's reference count to one when kalloc()     allocates it. Increment a page's reference count when fork causes a child     to share the page, and decrement a page's count each time any process drops     the page from its page table. kfree() should only place a page back on the     free list if its reference count is zero. It's OK to to keep these counts     in a fixed-size array of integers. You'll have to work out a scheme for how     to index the array and how to choose its size. For example, you could index     the array with the page's physical address divided by 4096, and give the     array a number of elements equal to highest physical address of any page     placed on the free list by kinit() in kalloc.c.</li> <li>Modify copyout() to use the same scheme as page faults when it encounters a     COW page.</li> </ol> <p>Some hints:</p> <ul> <li>use RSW to distinguish cow pages table</li> </ul> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cpte \u7684 \u7b2c\u4e5d\u4f4d \u4e5f\u5c31\u662f rsw \u4f4d\u662f 0 \u624d\u5bf9\u3002  \u4e0d\u5bf9\uff0c1 &lt;&lt; 9\uff0c \u5b9e\u9645\u4e0a\u5012\u6570\u7b2c10\u4f4d\u662f1</p> <p>\u662f\u4e0d\u662f\u6211\u7684\u7236\u8fdb\u7a0b\u6ca1\u6709\u6807\u793a\u4e3a cow\uff0c\u6240\u4ee5\u5bfc\u81f4\u51fa\u9519     \u8fd8\u771f\u662f\uff0c\u4e0d\u8fc7 \u8fd9\u6837\u6539\u5c31\u8fc7\u4e0d\u4e86\u7b2c\u4e09\u4e2a threetest, \u5185\u5b58\u8fd8\u662f\u6cc4\u6f0f\u4e86</p> <p>\u6211\u8fd9\u91cc\u53ea\u8003\u8651\u4e86\u4e00\u4e2a\u8fdb\u7a0b\u7ed3\u675f\u65f6\uff0c\u5bf9\u8fdb\u7a0b\u6240\u5360\u6709\u7684\u7269\u7406\u7a7a\u95f4\u7684\u8ba1\u6570\u5668\u51cf\u4e00\uff0c\u8fd8\u6709\u4ec0\u4e48\u5176\u4ed6\u60c5\u51b5\u4f1a\u5bfc\u81f4\u8ba1\u6570\u5668\u51cf\u4e00\u5417       \u5176\u5b9e\u5e76\u6ca1\u6709\u3002</p> <pre><code>\u5728 uvmhardcopy \u91cc\uff0c\u8fd9\u91cc\u5bf9\u7236\u8fdb\u7a0b\u5730\u5740\u7684\u5f15\u7528\u51cf1\uff0c\u6211\u4ee5\u4e3a\u8fd9\u4e2a\u65f6\u5019\u7236\u8fdb\u7a0b\u5730\u5740\u7684\u5f15\u7528\u4e00\u5b9a\u662f\u5927\u4e8e 0\u7684\uff0c\u5176\u5b9e\u4e0d\u4e00\u5b9a\u3002\u53ef\u80fd\u4f1a\u6709\u5b64\u513f\u8fdb\u7a0b\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u6709\u5b50\u8fdb\u7a0b\uff0c\u6ca1\u6709\u7236\u8fdb\u7a0b\u3002\uff08\u6216\u8005\u8bf4\u5b50\u8fdb\u7a0b\u88ab\u6839\u8fdb\u7a0b\u6258\u7ba1\uff09\u8fd9\u4e2a\u65f6\u5019\uff0c\u7236\u8fdb\u7a0b\u5360\u7528\u7684\u8fd9\u5757\u5185\u5b58\u5c31\u91ca\u653e\u4e0d\u4e86\u4e86\u3002\u8981\u5224\u65ad\u4e00\u4e0b\uff0c\u5982\u679c\u8fd9\u5757\n\u5730\u5740\u7684\u5f15\u7528\u5df2\u7ecf\u662f0\u7684\u8bdd\uff0c\u5c31\u8981\u91ca\u653e\u7a7a\u95f4\u3002\n</code></pre> <p>\u8bf4\u5b9e\u8bdd\uff0c\u8fd9\u6b21\u627ebug\u4e5f\u662f\u9760\u8fd0\u6c14\uff0c\u8fd8\u662f\u7f3a\u5c11\u70b9\u65b9\u6cd5\u8bba\u3002</p> <p>\u5fc3\u8def\u5386\u7a0b</p> <p>\u7b2c\u4e09\u4e2a threetest failed -&gt; \uff08\u770b\u4e86\u6d4b\u8bd5\u51fd\u6570\u7684\u76ee\u7684\uff09\u53ef\u80fd\u662f\u6709\u5185\u5b58\u6ca1\u91ca\u653e -&gt; \u5199\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u770b\u4e00\u4e0b\u6267\u884c\u5b8c\u4e00\u4e2a\u51fd\u6570\u540e\uff0c\u7269\u7406\u5185\u5b58\u7684\u5269\u4f59\u5927\u5c0f -&gt; \u679c\u7136\u8d8a\u6765\u8d8a\u5c0f\u4e86 -&gt; \u5c1d\u8bd5\u4fee\u6539\u4e00\u4e0b\u8ba1\u7b97\u9875\u9762\u5f15\u7528\u7684\u7b97\u6cd5 -&gt; \u6210\u4e86 -&gt; \u5206\u6790\u95ee\u9898\u539f\u56e0</p> <p>\u2022 The lazy page allocation lab has likely made you familiar with much of the     xv6 kernel code that's relevant for copy-on-write. However, you should not     base this lab on your lazy allocation solution; instead, please start with     a fresh copy of xv6 as directed above.   \u2022 It may be useful to have a way to record, for each PTE, whether it is a COW     mapping. You can use the RSW (reserved for software) bits in the RISC-V PTE     for this.   \u2022 usertests explores scenarios that cowtest does not test, so don't forget to     check that all tests pass for both.   \u2022 Some helpful macros and definitions for page table flags are at the end of     kernel/riscv.h.   \u2022 If a COW page fault occurs and there's no free memory, the process should     be killed.</p> <p>\u8fc7\u4e86 cowtest, \u4f46\u662f usertest \u6ca1\u6709\u8fc7\u3002 usertest: countfree     \u5f00\u4e24\u4e2a\u8fdb\u7a0b\u3002\u5b50\u8fdb\u7a0b\u4f7f\u7528sbrk\u5206\u914d\u7a7a\u95f4\uff0c\u6bcf\u5206\u914d\u4e00\u9875\u7a7a\u95f4\u5c31\u50cf stdin \u5199\u5165\u4e00\u4e2ax\uff0c\u7236\u8fdb\u7a0b\u4ece stdout \u8bfb\u53d6\u5b57\u7b26\uff0c\u6bcf     \u8bfb\u5230\u4e00\u4e2a\u5b57\u7b26\u5c31\u8bf4\u660e\u6210\u529f\u5206\u914d\u4e86\u4e00\u9875\u3002</p> <p>\u5728\u8fdb\u884c MAXva test \u65f6\uff0c\u4f1a\u51fa\u73b0 \u9875\u9762\u7a7a\u95f4\u6ca1\u6709\u56de\u6536\u7684\u60c5\u51b5 \u603b\u662f\u6709\u4e00\u9875 \u7684 mem leak \u6682\u65f6\u653e\u5f03\u4e86 \u4e4b\u540e\u6709\u65f6\u95f4\u518d\u91cd\u5199\u4e00\u904d \u901a\u8fc7\u4fee\u6539\u6d4b\u8bd5\u4ee3\u7801\uff0c\u9a97\u5230\u4e86 usertests \u7684\u5206\u6570\uff0c\u5f88\u65e0\u803b\u54c8\u54c8\u54c8 \u5148\u770b\u540e\u9762\u4e86</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/","title":"Lab6(scheduling)","text":""},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#lab-6-multithreading","title":"lab 6 multithreading","text":""},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#xv6-chapter-7-scheduling","title":"XV6 Chapter 7 Scheduling","text":"<p>7.6 - 7.7 \u6ca1\u6709\u770b</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#6","title":"\u8fdb\u7a0b\u8c03\u5ea6\u7684 6 \u4e2a\u95ee\u9898","text":""},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#71","title":"7.1","text":"<ol> <li>\u5982\u4f55\u5728\u8fdb\u7a0b\u95f4\u8fdb\u884c\u5207\u6362</li> <li>\u5982\u4f55\u5b9e\u73b0\u5bf9\u4e8e\u7528\u6237\u900f\u660e\u7684\u4e0a\u4e0b\u6587\u5207\u6362<ul> <li><code>yield</code> , <code>swtch</code> , <code>scheduler</code> </li> </ul> </li> <li>\u9700\u8981\u52a0\u9501\u6765\u9632\u6b62 race condition<ul> <li><code>p-&gt;lock</code> , <code>sleep</code> , <code>wake up</code> </li> </ul> </li> <li>\u8fdb\u7a0b\u7ed3\u675f\u65f6\u9700\u8981\u91ca\u653e\u6389\u6240\u6709\u8d44\u6e90\uff0c\u4ec5\u4f9d\u9760\u8fdb\u7a0b\u81ea\u5df1\u4e0d\u80fd\u5b8c\u5168\u91ca\u653e\u3002<ul> <li><code>wait</code> and <code>exit</code> </li> </ul> </li> <li>\u591a\u6838\u673a\u5668\u5fc5\u987b\u77e5\u9053\u4ed6\u6b63\u52a0\u6267\u884c\u7684\u662f\u54ea\u4e00\u4e2a\u8fdb\u7a0b</li> <li>sleep and wake up</li> </ol> <p><code>swtch</code> only save and restore 32 regs </p> <p>\u4e3a\u4ec0\u4e48 process \u6709 context, cpu \u4e5f\u6709 context, \u4ed6\u4eec\u662f\u7528\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\u5417 </p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#72-code-context-switching","title":"7.2 code context switching","text":"<p>\u590d\u4e60\u4e00\u4e0b\u5728 chapter 4 \u4e2d\uff0c\u4e2d\u65ad\u7684\u8c03\u7528\u8fc7\u7a0b</p> <ol> <li><code>usertrap</code> calls <code>yield</code> </li> <li><code>yield</code> calls <code>sched</code> </li> <li><code>sched</code> calls <code>swtch</code> to save current context in p-&gt;context, and switch to the scheduler context previously saved in cpu-&gt;scheduler</li> </ol> <p>Q: \u4e3a\u4ec0\u4e48\u8981\u5207\u6362\u5230 <code>scheduler context</code> , <code>scheduler context</code> \u53c8\u662f\u4ec0\u4e48\u610f\u601d\uff1f A: \u6bcf\u4e00\u4e2a cpu \u90fd\u6709\u4e00\u4e2a kernel thread \u8fd0\u884c <code>scheduler</code> \u51fd\u6570\u3002\u60f3\u8981\u5207\u6362\u6267\u884c\u7684\u8fdb\u7a0b\uff0c\u5c31\u8981\u5148\u5207\u6362\u5230\u8fd9\u4e2a\u8fd0\u884c\u7740 <code>scheduler</code> \u51fd\u6570 \u7684 kernel thread. \u518d\u901a\u8fc7  <code>scheduler</code> \u51fd\u6570\u6765\u8fdb\u884c\u8fdb\u7a0b\u5207\u6362\u3002(\u5bf9\u5e944\u6b21\u8f6c\u6362\u7684\u7b2c\u4e8c\u6b21)</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#73-scheduler","title":"7.3 scheduler","text":"<p>Q: \u4e3a\u4ec0\u4e48\u5728<code>swtch</code> \u6267\u884c\u671f\u95f4\uff0c\u8981\u4fdd\u6301 <code>p-&gt;lock</code> A: \u56e0\u4e3a\u8981\u7ef4\u6301\u4e00\u4e2a\u4e0d\u53d8\u91cf\uff0c\u4e5f\u5373 before schedulering, process must excute <code>yield</code> , <code>sched</code> , <code>scheduler</code> continuosly. \u4e0d\u52a0\u9501\u7684\u8bdd\uff0c\u53ef\u80fd\u5728cpu1 \u4e2d \u8fdb\u7a0bp \u521a\u5c06\u81ea\u5df1\u7684\u72b6\u6001\u8bbe\u7f6e\u6210 runable \uff0c\u4e0e\u6b64\u540c\u65f6 cpu2 \u770b\u5230 \u8fdb\u7a0bp\u7684\u72b6\u6001\u662f runable\uff0c\u5c31\u60f3\u8981\u5f00\u59cb\u6267\u884c\u8fd9\u4e2a\u8fdb\u7a0b\u3002\u8fd9\u6837\u4f1a\u5bfc\u81f4\u4e24\u4e2acpu \u8fd0\u884c\u5728\u540c\u4e00\u4e2a kernel stack \u4e2d </p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#75-sleep-and-wake-up","title":"7.5 sleep and wake up","text":"<p>\u4e3a\u4ec0\u4e48\u4e0d\u5728 sched \u4e4b\u524d release p-lock</p> <p>In the given code, we don't release the <code>p-&gt;lock</code> before calling <code>sched</code> because releasing the lock before calling <code>sched</code> would allow other threads to modify the state of the process (<code>p-&gt;state</code>) or wake it up (<code>wakeup</code>), which could lead to race conditions or incorrect behavior.</p> <p>\u4e0d\u592a\u5bf9\u52b2\uff0c\u4e4b\u540e\u95ee\u95ee\u522b\u4eba</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#78-wait-exit-and-kill","title":"7.8 wait exit and kill","text":"<p>wait </p> <ol> <li>free any child whose stauts is ZOMBIE</li> </ol> <p>exit </p> <ol> <li>put caller into zombie state.</li> <li>wake up parent</li> </ol> <p>kill </p> <p>does very little, just mark the state of process to be <code>KILLED``</code>. when the process enter or exit the kernel, the trap handler will see the flag and free this process.</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#lab-thread","title":"Lab thread","text":""},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#user-level-thread-package","title":"user level thread package","text":"<ol> <li>\u521b\u5efa\u7684\u65f6\u5019. \u521d\u59cb\u5316 context, \u8bbe\u7f6e ra \u548c sp \u4e24\u4e2a\u6307\u9488.</li> <li>\u8c03\u5ea6\u7684\u65f6\u5019, \u4fdd\u5b58 ra, sp \u548c callee saved \u5bc4\u5b58\u5668</li> </ol> <p>lab \u5f88\u7b80\u7b54,\u4f46\u662f\u6211\u5f88\u7591\u60d1</p> <p>Q: \u6211\u53ea\u662f\u8bbe\u7f6e\u4e86\u7ebf\u7a0b\u7ed3\u6784\u4f53\u4e2dcontext\u7684ra\u503c,\u64cd\u4f5c\u7cfb\u7edf\u662f\u600e\u4e48\u77e5\u9053\u8981\u52a0\u8f7d\u8fd9\u4e2ara\u5230pc\u7684.\u5982\u679c\u662f\u8fdb\u7a0b\u7684\u8bdd,\u7f16\u8bd1\u5668\u4f1a\u5e2e\u52a9\u81ea\u52a8\u751f\u6210\u76f8\u5173\u7684\u6c47\u7f16\u4ee3\u7801(\u6bd4\u5982\u5c06ra\u5bc4\u5b58\u5668\u7684\u503c\u653e\u8fdbpc\u91cc), \u4f46\u662f\u8fd9\u4e2a thread \u662f\u600e\u4e48\u505a\u5230\u7684?? A: \u50bb\u4e86, thread_Switch \u5c31\u6709 <code>ld ra, xxx</code>. \u628a\u4fdd\u5b58\u7684 ra \u503c\u52a0\u8f7d\u5230 ra \u5bc4\u5b58\u53bb\u4e86\u3002\u6700\u540e\u6267\u884cret, \u5c31\u628a ra \u7684\u503c\u7ed9pc\u4e86\u3002</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#_1","title":"\u4f7f\u7528\u7ebf\u7a0b","text":"<p>\u5728\u8fd9\u4e2a\u4efb\u52a1\u4e2d\uff0c\u4f60\u5c06\u63a2\u7d22\u5982\u4f55\u4f7f\u7528\u7ebf\u7a0b\u548c\u9501\u6765\u4fdd\u8bc1\u54c8\u5e0c\u8868\u5728\u591a\u7ebf\u7a0b\u4e0b\u6b63\u5e38\u5de5\u4f5c\u3002\u4f60\u5e94\u8be5\u5728\u771f\u6b63\u7684Linux\u6216\u8005Macos \u4e0b \u5b8c\u6210\u8fd9\u4e2a\u5b9e\u9a8c (not xv6)</p> <p>\u8fd9\u4e2a\u5b9e\u9a8c\u4f7f\u7528\u4e86 <code>pthread</code> \u7ebf\u7a0b\u5e93\uff0c\u4f60\u53ef\u4ee5\u9605\u8bfb\u6587\u6863\u4ee5\u4e86\u89e3\u5e93\u7684\u4f7f\u7528\u3002</p> <p>\u6587\u4ef6 <code>ph.c</code> \u5b9e\u73b0\u4e86\u4e00\u4e2a\u5728\u5355\u7ebf\u7a0b\u4e0b\u6b63\u5e38\u5de5\u4f5c\uff0c\u4f46\u5728\u591a\u7ebf\u7a0b\u4e0b\u4f1a\u51fa\u9519\u7684\u54c8\u5e0c\u8868\u3002</p> <p>\u4f60\u9700\u8981\u505a\u7684\uff0c\u5c31\u662f\u4f7f\u7528\u4e00\u628a\u4e92\u65a5\u9501\uff0c\u6765\u4f7f\u5f97\u54c8\u5e0c\u8868\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u5728\u8c03\u7528 insert \u51fd\u6570\u524d\u540e\u52a0\u4e0a\u4e00\u628a \u4e92\u65a5\u9501\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>pthread_mutex_lock(&amp;lock);\ninsert(key, value, &amp;table[i], table[i]);\npthread_mutex_unlock(&amp;lock);\n</code></pre> <p>\u6ce8\u610f\u4e0d\u80fd\u5728 insert \u51fd\u6570\u5185\u52a0\u9501\uff0c\u56e0\u4e3a\u5728\u5411 insert \u51fd\u6570\u4f20\u9012\u503c\u7684\u65f6\u5019(\u94fe\u8868\u5934)\uff0c \u53ef\u80fd\u4f1a\u53d1\u751f race condition.</p>"},{"location":"notes/6.s081%20OS/lab6%28scheduling%29/#barrier","title":"barrier","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u7c7b\u4f3c sleep \u548c wakeup \u7684\u673a\u5236</p> <p>\u6bd4\u8f83\u7b80\u5355, \u5f53\u6709\u7ebf\u7a0b\u8fdb\u5165 <code>barrier</code> \u7684\u65f6\u5019,\u9012\u589e <code>barrier.nthread</code> , \u5982\u679c <code>barrier.nthread</code> \u662f <code>nthread</code> \u7684\u6574\u6570\u500d,\u8bf4\u660e\u5728\u5f53\u524d\u8f6e\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u5230\u8fbe\u4e86 <code>barrier</code> , \u8fd9\u4e2a\u65f6\u5019\u5c31\u8c03\u7528 <code>broadcast</code> . \u4e0d\u7136\u5c31 <code>wait</code> . \u6ce8\u610f\u5728\u4e24\u4e2a\u51fa\u53e3\u90fd\u9700\u8981\u66f4\u65b0 round</p> <pre><code>static void \nbarrier()\n{\n  // YOUR CODE HERE\n  //\n  // Block until all threads have called barrier() and\n  // then increment bstate.round.\n\n  pthread_mutex_lock(&amp;bstate.barrier_mutex);\n  bstate.nthread++;\n  if (bstate.nthread != 0 &amp;&amp; bstate.nthread % nthread == 0) {\n    pthread_mutex_unlock(&amp;bstate.barrier_mutex);\n    pthread_cond_broadcast(&amp;bstate.barrier_cond);\n    bstate.round = bstate.nthread / nthread;\n    return;\n  }\n  pthread_cond_wait(&amp;bstate.barrier_cond, &amp;bstate.barrier_mutex);\n  bstate.round = bstate.nthread / nthread;\n  pthread_mutex_unlock(&amp;bstate.barrier_mutex);\n}\n</code></pre>"},{"location":"notes/6.s081%20OS/lab7/","title":"Lab7","text":""},{"location":"notes/6.s081%20OS/lab7/#chapter-5-device-interrupt","title":"Chapter 5 device interrupt","text":"<p>a top half     process kernel stack, system call (\u6a21\u5f0f\u5207\u6362\uff0c\u6570\u636e\u62f7\u8d1d) a bottom half     hander \u5982\u4f55\u63a5\u53d7\u6570\u636e</p> <p><code>consoleinit</code> configures two interrupt . One is receive interrupt, another is (receiving) complete interrupt.</p> <p>How to Read  (software)</p> <p><code>read</code> system call make their way through <code>consoleread</code> , <code>consoleread</code> waits for input to arrive, and store input in cons.buf.</p> <p>How UART handle input (hardware)</p> <p>user type -&gt; hardware asks for a interrupt. -&gt; trap handler( <code>trap.c</code> ) check if it is device interrupt  -&gt; devintr according to <code>scause</code> (and Plic),  calls <code>uartintr</code> . </p> <p><code>uartintr</code> read any chars to <code>consoleintr</code>. if user have typed entire line.<code>consoleintr</code> wakeup <code>consoleread</code>.</p> <p>once <code>consoleread</code> read a whole line from cons.buf, it copy contents to user space and give control back to user.</p> <p>How to write </p> <p>timerintrrupt </p> <p>only in machine mode, in <code>start.c</code> </p>"},{"location":"notes/6.s081%20OS/lab7/#_1","title":"\u5b9e\u9a8c","text":"<p>\u4e3aE1000\u7f51\u5361\u52a0\u4e00\u4e2a\u9a71\u52a8 </p> <ul> <li>\u6846\u67b6\u4ee3\u7801\u89e3\u6790\u3002\u9996\u5148\u662f <code>kernel/net.c</code> \u5b58\u653e\u662f\u4e00\u4e9b\u6709\u5173 <code>mbuf</code> \u7684 \u5e93\u51fd\u6570\uff0c\u9488\u5bf9 <code>mbufq</code> \u7684\u4e00\u4e9b\u64cd\u4f5c\u3002\u5b9e\u9a8c\u91cc\u7528\u4e0d\u5230\u3002</li> <li><code>kernel/net.h</code> \u5b58\u653e\u7684\u662f<code>mbuf</code> \u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u548c\u4e00\u4e9b\u5b8f\u51fd\u6570\u3002</li> <li><code>kernel/def_net.h</code> \u5b58\u653e\u7684\u662f\u4e00\u4e9bE1000\u5bc4\u5b58\u5668\u7684\u5b8f</li> <li><code>kernel/e1000.c</code> \u5b58\u653e\u662f\u6709\u5173 e1000 \u7f51\u5361 \u521d\u59cb\u5316\uff0c\u5b58\u50a8\uff0c\u8f6c\u53d1\u7684\u51fd\u6570\u3002</li> </ul> <p>\u5b9e\u73b0 <code>e1000_tranmit</code> \u51fd\u6570</p> <p>free the last mbuf that was transmitted from that descriptor</p> <p>Q:\u4e0d\u592a\u6e05\u695a\u8fd9\u4e2a last mbuf  \u5230\u5e95\u5b58\u653e\u5728\u54ea\u91cc</p> <p>A:\u653e\u5728 tx_buf array</p> <p>stash away a pointer to the mbuf for later freeing.</p> <p>Q: \u8fd9\u4e2a stash away \u662f\u8981\u628a\u8fd9\u4e2abuf\u6307\u9488\u5b58\u653e\u5728\u54ea\u91cc\u5462\uff1f</p> <p>A: \u5b58\u653e\u5728 tx_buf array</p>"},{"location":"notes/6.s081%20OS/lab8/","title":"Lab8","text":""},{"location":"notes/6.s081%20OS/lab8/#chapter-6-lock","title":"chapter 6 Lock","text":""},{"location":"notes/6.s081%20OS/lab8/#61-race-condition","title":"6.1 Race condition","text":"<p>Locks protect Data Item, but kill performance</p> <p><code>race condition</code> : A memory location is accessed concurrently, and at least one access is a write.</p> <p>The Lock make the critial section atomatic. The Lock protects some invariants. For example, In <code>kalloc.c</code>, the invariants are </p> <ol> <li><code>list</code> points to the first element in the linked list.</li> <li><code>next</code> points to the next element in the list.</li> </ol> <p>In function <code>push</code> , first invariant is violated during excution, thus we need lock to save the day.</p> <p>Because the lock kills the performance, we need to know how to prevent using locks and when to insert locks.</p>"},{"location":"notes/6.s081%20OS/lab8/#62-code-naive","title":"6.2 Code (naive)","text":"<p>XV6 has two type of locks <code>spinlock</code> and <code>sleeplock</code>.</p> <p>spinlock </p> <p><code>acquire</code></p> <pre><code>void\nacquire(struct spinlock *lk)\n{\n  push_off(); // disable interrupts to avoid deadlock.\n  // \u5728\u540c\u4e00\u4e2acpu\u4e0b\uff0c\u83b7\u53d6\u4e24\u6b21\u9501\uff0c\u76f4\u63a5 panic\n  if(holding(lk))\n    panic(\"acquire\");\n\n  // \u4e0d\u505c\u7684\u67e5\u770b\u662f\u4e0d\u662f\u4e0a\u9501\u4e86\uff0c\u5982\u679c\u6ca1\u6709\u4e0a\u9501\uff0c\u5c31\u83b7\u53d6\u9501\u3002\n  while(__sync_lock_test_and_set(&amp;lk-&gt;locked, 1) != 0) {\n    __sync_fetch_and_add(&amp;(lk-&gt;nts), 1);\n}\n</code></pre> <p><code>release</code> </p> <p>resemble to <code>acquire</code>, <code>release</code> clear the <code>lk-&gt;cpu</code> and then, use atomic operation to clear the lock.</p>"},{"location":"notes/6.s081%20OS/lab8/#63-using-lock","title":"6.3 Using Lock","text":"<p>Some principles</p> <ol> <li>Any time a variable can be written by a cpu, and read by another.</li> <li>A invariant involves multiple operation.</li> </ol>"},{"location":"notes/6.s081%20OS/lab8/#64-deadlock-and-lock-ordering","title":"6.4 DeadLock and lock ordering","text":"<p>Example:  Suppose there Locks A and B. Process 1 acquire lock A then B Process 2 acquure lock B then A.</p> <p>This setting may leads to deadlock. Considering the following situation. When Process 1 acquire A and waits for lock B to be release, However Process 2 acquure B and waits A to be released</p> <p></p> <p>To avoid deadlock, all code path must acquire locks in the same order.</p> <p>Avoiding deadlock is often a major factor in kernel implementation. It is difficult to get things right.</p> <ol> <li>we might know the lock we need in advance.</li> </ol>"},{"location":"notes/6.s081%20OS/lab8/#re-entrant-locks","title":"Re-entrant Locks","text":"<p>In the same cpu, If a process wants to acquire a lock again, that is, acquiring a lock that has been prevously acqured. (recursive acquiring a lock)</p> <p>XV6 didnot take this approach, but both strategy can be made to work.</p>"},{"location":"notes/6.s081%20OS/lab8/#locks-and-interrupt-handlers","title":"Locks and interrupt handlers","text":"<p>disaster - never hold the lock during interrupt, disable interrupt when holding the lock</p> <ul> <li>restore the interrupt when not poessing any lock.</li> </ul>"},{"location":"notes/6.s081%20OS/lab8/#insturction-and-memory-reorder","title":"Insturction and memory reorder","text":"<p>using sync_synchronize() to create a memory barrier to tell compiler do not reorder instruction between critical section. (between <code>acquire</code> and <code>release</code> )</p>"},{"location":"notes/6.s081%20OS/lab8/#sleep-locks","title":"sleep locks","text":"<p>\u5728\u7b49\u5f85 <code>spin_lock</code> \u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u80fd\u505a\u522b\u7684\u4e8b\u60c5\uff0c\u6bd4\u8f83\u6d6a\u8d39\u8d44\u6e90\u3002 <code>sleep lock</code> \u53ef\u4ee5\u8ba9\u4f60\u5728\u6301\u6709\u9501\u7684\u65f6\u5019\uff0c\u8c03\u7528 yield, \u5c06cpu\u8d44\u6e90\u8ba9\u7ed9\u5176\u4ed6\u8fdb\u7a0b\u3002</p> <p>sleep_lock \u6709\u4e24\u628a\u9501\uff0c\u4e00\u628a\u81ea\u65cb\u9501\uff0c\u4e00\u628a\u666e\u901a\u7684\u9501\u3002</p> <p>\u5f53\u4e00\u4e2a\u8fdb\u7a0b \u8981 \u83b7\u53d6\u4e00\u4e2a\u7761\u7720\u9501\u7684\u65f6\u5019\u3002 1. \u9996\u5148\u67e5\u770b\u666e\u901a\u7684\u9501\u6709\u6ca1\u6709\u4e0a\u9501\uff0c\u5982\u679c\u6709, \u8c03\u7528sleep.     - sleep \u9996\u5148\u7ed9\u8fdb\u7a0b\u4e0a\u9501     - \u518d\u91ca\u653e\u81ea\u65cb\u9501     - \u6807\u8bb0\u8fdb\u7a0b\u7684\u72b6\u6001\u4e3a SLEEPING \u540e     - \u8c03\u7528 yield \u628a\u8d44\u6e90\u8ba9\u7ed9\u5176\u4ed6\u8fdb\u7a0b     - \u4e4b\u540e\uff0c\u6062\u590d\u6267\u884c\u7684\u65f6\u5019\uff0c\u91cd\u65b0\u83b7\u53d6\u81ea\u65cb\u9501\u3002     - \u8bbe\u7f6e\u666e\u901a\u9501\u4e3a\u4e0a\u9501\u72b6\u6001     - \u91ca\u653e\u81ea\u65cb\u9501</p>"},{"location":"notes/6.s081%20OS/lab8/#69-real-world","title":"6.9 Real world","text":"<ul> <li>Pthread</li> <li>Lock-free design</li> </ul>"},{"location":"notes/6.s081%20OS/lab8/#_1","title":"\u5b9e\u9a8c","text":""},{"location":"notes/6.s081%20OS/lab8/#memory-allocator","title":"memory allocator","text":"<p>\u6309\u7167\u6587\u6863\u91cc\u8bf4\u7684,\u5c1d\u8bd5\u4e3a XV6 \u7684 \u5185\u5b58\u5206\u914d\u5668\u8fdb\u884c\u4f18\u5316.\u4f7f\u5f97\u6bcf\u4e00\u4e2a cpu \u6709\u7740\u81ea\u5df1\u7684\u7a7a\u95f2\u94fe\u8868. \u81ea\u5df1\u7684\u7a7a\u95f2\u94fe\u8868\u4e0d\u591f\u518d\u4ece\u5176\u4ed6cpu\u90a3\u5077\u4e00\u70b9. </p> <p>\u521d\u770b\u8bf4\u660e, \u603b\u7ed3\u4e00\u4e0b\u96be\u70b9</p> <ul> <li>\u5982\u4f55\u5224\u65adcpu\u7684\u4e2a\u6570? NCPU</li> <li> <p>\u5206\u914d\u7ed9\u6bcf\u4e00\u4e2acpu\u7a7a\u95f4\u7684\u5927\u5c0f\u662f\u591a\u5c11? </p> <p>naive thought \u6bcf\u4e00\u4e2acpu\u5206\u5230 MEM / NCPU \u5927\u5c0f\u5185\u5b58 \u4f46\u662f\u6587\u6863\u91cc\u8bf4\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528 <code>freerange</code> \u65f6,\u628a\u6240\u6709\u7684\u5185\u5b58\u90fd\u7ed9\u5b83, \u5c31\u4e0d\u77e5\u9053\u600e\u4e48\u60f3\u7684.</p> </li> </ul> <p>A: \u53ea\u6709 cpuid==0 \u624d\u4f1a\u6267\u884c kinit \u51fd\u6570\uff0c\u6240\u4ee5\u8bf4 freerange \u53ea\u4f1a\u7ed9\u7b2c\u4e00\u4e2a cpu\u5206\u914d\u5185\u5b58\u3002\u4e4b\u540e\u518d\u542f\u52a8\u7684cpu\u5c31\u8981\u9760\u5077\u4e86\u3002</p> <p>\u5982\u679c\u53ef\u4ee5\u501f\u5185\u5b58\u7684\u8bdd,\u600e\u6837\u624d\u80fd\u786e\u5b9a\u67d0\u4e00\u5feb\u5185\u5b58\u9875\u7684\u5927\u5c0f\u5462?</p> <pre><code>naive thought: \u589e\u52a0\u4e00\u4e2a `owner` \u57df,\u8868\u793a\u8fd9\u4e2a\u5185\u5b58\u662f\u501f\u7684 id \u4e3a `owner` cpu\u7684.\n\u4f46\u662f, \u5728\u91ca\u653e\u5185\u5b58\u7684\u65f6\u5019, \u7531\u4e8e\u66f4\u6539\u7684\u662f owner \u7684\u5185\u5b58\u94fe\u8868\u7ed3\u6784, \u53ef\u80fd\u4f1a\u51fa\u73b0 `race condition` \u7684\u60c5\u51b5,\u4e0d\u77e5\u9053\u600e\u4e48\u52a0\u9501\u907f\u514d.\n\u56e0\u4e3a\u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u4e0d\u80fd\u7528\u9501\u6765\u8fdb\u884c\u540c\u6b65\u7684.\u9047\u5230\u5185\u5b58\u4e0d\u591f\u7684\u60c5\u51b5,\u518d\u83b7\u53d6\u9501\u4e5f\u6ca1\u6709\u610f\u4e49.\n</code></pre> <p>A: \u7b80\u5355\uff0c\u52a0\u9501\u5c31\u5b8c\u4e8b\u4e86\u3002\u8fd9\u91cc\u7684\u52a0\u9501\u5e76\u4e0d\u4f1a\u9020\u6210 lock contention, \u56e0\u4e3a\u5927\u5bb6\u90fd\u6709\u81ea\u5df1\u7684 freelist, \u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u662f\u4e00\u4e2a\u4eba\u83b7\u53d6\u9501 \u81ea\u5a31\u81ea\u4e50 233\u3002</p>"},{"location":"notes/6.s081%20OS/lab8/#memory-allocater","title":"\u5b9e\u9a8c\u7b2c\u4e00\u90e8\u5206 memory allocater","text":"<p>multicore means: multiple CPUs that share memory but execute in parallel, each with its own set of registers.</p> <p>\u591a\u6838\u5904\u7406\u5668\u662f\u600e\u4e48\u542f\u52a8\u7684     \u6bcf\u4e00\u4e2a\u6838\u90fd\u4f1a\u8d70\u4e00\u6b21\u5b8c\u6574\u7684\u542f\u52a8\u7a0b\u5e8f\u5417? A: \u5e76\u4e0d\u662f\uff0c\u6ca1\u6709\u6ce8\u610f\u770b <code>main.c</code> \u4e2d\u7684 if \u6761\u4ef6 <code>cpuid() == 0</code> \uff0c\u663e\u7136\u53ea\u9700\u8981\u7b2c\u4e00\u4e2a\u6838\u505a\u865a\u62df\u5730\u5740\u3001\u786c\u4ef6\u8bbe\u5907\u7684\u521d\u59cb\u5316, \u5176\u4ed6\u6838\u5fc3\u8d70 else \u5206\u652f \u6240\u4ee5\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u6838\u5fc3\u5206\u914d\u5230\u4e86\u7a7a\u95f4\u3002\u5176\u4ed6\u6838\u5fc3\u7684\u5185\u5b58\u7a7a\u95f4\u90fd\u662f 0\uff0c \u8fd0\u884c\u65f6\u9700\u8981\u5411\u7b2c\u4e00\u4e2a\u6838\u5fc3\u501f\u5185\u5b58\u3002\u8fd9\u4e5f\u602a\u4e0d\u5f97\u53ea\u6709\u7b2c\u4e00\u4e2a \u6838\u5fc3 \u624d\u80fd\u6b63\u5e38\u542f\u52a8\u3002(kalloc \u6ca1\u5b9e\u73b0\u501f\u5185\u529f\u80fd)</p> <p>\u5bf9\u4e0e\u7528\u6237\u7a0b\u5e8f\u6765\u8bf4     \u5982\u679c\u624d\u80fd\u5728\u4e0d\u540c\u7684\u6838\u5fc3\u4e0a\u8dd1\u8005\u76f8\u540c\u7684\u7a0b\u5e8f     \u80fd\u8dd1\u7684\u8bdd\uff0c\u7a0b\u5e8f\u7684\u6267\u884c\u987a\u5e8f\u662f\u600e\u4e48\u6837\u7684</p> <pre><code>\u4e00\u822c\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u5668\u51b3\u5b9a\u7ebf\u7a0b\u5230\u5e95\u8dd1\u5728\u90a3\u4e00\u4e2a core \u4e0a\u3002\n\u7a0b\u5e8f\u6267\u884c\u987a\u5e8f\uff0c\u76f8\u4e92\u72ec\u7acb\uff1b\u8d44\u6e90\u6709\u53ef\u80fd\u5171\u4eab\u3002\n</code></pre>"},{"location":"notes/6.s081%20OS/lab8/#buffer-cache","title":"\u5b9e\u9a8c\u7b2c\u4e8c\u90e8\u5206 buffer cache","text":"<p>\u9898\u76ee\u8981\u6c42\u7ffb\u8bd1:  \u8bf7\u4ee5 \"bcache\" \u5f00\u5934\u4e3a\u4f60\u7684\u9501\u8d77\u540d\u3002</p> <p>\u89e3\u51b3block cache\u7684\u8d44\u6e90\u7ade\u4e89\u8981\u6bd4 kalloc \u9ebb\u70e6\u3002\u56e0\u4e3a\u4e0d\u80fd\u50cf\u5185\u5b58\u4e00\u6837\u5427block cache \u62c6\u5206\u7ed9\u5404\u4e2a cpu\u3002\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u54c8\u5e0c\u8868\u67e5\u627e block,\u518d\u7ed9\u54c8\u5e0c\u8868\u7684 block \u4e0a\u9501\u3002</p> <p>\u4ee5\u4e0b\u60c5\u51b5\u6709\u7ade\u4e89\u4e5f\u6ca1\u6709\u5173\u7cfb</p> <ol> <li>\u4e24\u4e2a\u8fdb\u7a0b\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u7684\u6247\u533a</li> <li>\u4e24\u4e2a\u8fdb\u7a0b\u540c\u65f6\u6ca1\u80fd\u627e\u5230\u7f13\u5b58</li> <li>\u54c8\u5e0c\u51b2\u7a81 (\u5e94\u8be5\u5c1d\u8bd5\u51cf\u5c0f\u51b2\u7a81\u7684\u53ef\u80fd)</li> </ol> <p>\u63d0\u793a\uff1a</p> <ol> <li>\u8bfb\u624b\u518c</li> <li>\u4f7f\u7528\u5b9a\u957f\u54c8\u5e0c\u8868\uff0c\u5e76\u4e14\u4f7f\u7528\u7d20\u6570\u4f5c\u4e3a bucket size</li> <li>\u5206\u914d buffer \u5fc5\u987b\u4e3a \u539f\u5b50\u64cd\u4f5c</li> <li>\u7ed9 buffer \u6807\u8bb0\u4e0a\u4f7f\u7528\u65f6\u95f4 (\u53ef\u53c2\u8003 trap.c) </li> <li>bget \u7684 eviction \u8fc7\u7a0b\u53ef\u4ee5\u53d1\u751f\u51b2\u7a81</li> <li>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u4fdd\u6301\u4e24\u4e2a\u9501\uff0c\u6bd4\u5982\u5728 evict \u7684\u65f6\u5019\u3002</li> <li>\u66ff\u6362 block \u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u5c06\u4e00\u4e2a struct buf \u4ece\u4e00\u4e2a bucket \u79fb\u52a8\u5230 \u53e6\u4e00\u4e2a bucket\u3002\u56e0\u4e3a\u65b0\u7684 block \u54c8\u5e0c\u503c\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u4f46\u662f\u4e5f\u6709\u51e0\u7387\u662f\u4e00\u6837\u7684\u3002\u5982\u679c\u76f8\u540c\u8bb0\u5f97\u907f\u514d\u6b7b\u9501 (\u6ca1\u61c2\u4ec0\u4e48\u610f\u601d)</li> <li>\u9996\u5148\u4e00\u628a\u5927\u9501\u4fdd\u5e73\u5b89 (\u5728 bget \u51fd\u6570\u4e2d\u4f7f\u7528 \u5168\u5c40 bcache.lock) \u4fdd\u8bc1\u6b63\u786e\u6027\u540e\uff0c\u518d\u5c06 \u5927\u9501\u6ce8\u91ca\u6389\u6d4b\u8bd5\u3002</li> </ol> <p>\u7591\u95ee\uff1a</p> <p>Q: \u6839\u636e\u4ec0\u4e48\u6765hash  A: blockno</p> <p>Q: \u600e\u4e48\u6837\u6839\u636e time-stamp \u50a8\u5b58   A: \u76f4\u63a5\u5b58 tick \u5b57\u6bb5.</p> <p>Q: \u4e3a\u4ec0\u4e48\u6709\u8fd9\u4e2a\u5b57\u6bb5\uff0c brelse \u5c31\u4e0d\u9700\u8981 bcache.lock  A: brelse \u4e0d\u518d\u9700\u8981\u66f4\u6539 bucket \u94fe\u8868\u7ed3\u6784\uff0c\u53ea\u9700\u8981\u66f4\u65b0 block \u7684\u4f7f\u7528\u65f6\u95f4, \u548c\u5f15\u7528\u8ba1\u6570\u5668</p> <p>Q: \u66ff\u6362 block \u662f\u4ec0\u4e48\u610f\u601d\uff0c\u4e0d\u662fevict \u5417\uff0c\u90fd\u9a71\u9010\u4e86\u8fd8\u548cbuf\u6709\u4ec0\u4e48\u5173\u7cfb\u3002  A: buf \u5c31\u662f bcache list \u7684\u8282\u70b9\uff0cevict \u7684\u65f6\u5019\uff0c\u53ef\u80fd\u9700\u8981\u79fb\u52a8\u3002(\u7531\u4e8e\u8fd9\u91cc\u91c7\u7528 blockno \u4f5c\u4e3a block \u7684 hash \u503c, \u4e0d\u9700\u8981\u79fb\u52a8bucket) </p> <p>Q: \u600e\u4e48\u8bf4 \u5f53\u6ca1\u6709\u627e\u5230 buffer \u7684\u65f6\u5019\uff0c\u4e3a\u5176\u5206\u914d\u7a7a\u95f4\u5fc5\u987b\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u7136\u800c\u53c8\u8bf4 bget \u7684 evict \u64cd\u4f5c\u53ef\u4ee5\u662f\u7ebf\u6027\u7684\uff1f \u8fd9\u4e24\u4e2a\u503c\u5f97\u4e0d\u662f\u540c\u4e00\u4e2a\u60c5\u51b5\u5417\uff1f </p> <p>A: \u539f\u5b50\u64cd\u4f5c\u662f\u6307: \u6d88\u9664 race condition, \u8fd9\u4e0e\u7ebf\u6027\u67e5\u627e\u4e0d\u51b2\u7a81</p> <p>Q: \u4e0d\u4f7f\u7528 cnt \u7684\u8bdd\uff0c\u8981\u600e\u4e48\u89e3\u51b3\u591a\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u540c\u4e00\u4e2abuffer\u554a (\u5982\u679c\u4f7f\u7528\u65f6\u95f4\u4e3a 0 \u7684\u8bdd\uff0c\u53ef\u4ee5\u8bf4\u660e\u6ca1\u6709\u88ab\u4f7f\u7528\u5417\uff1f)</p> <p>A:\u6211\u4eec\u4ecd\u5c06\u4f7f\u7528 ref cnt\u3002</p> <p>\u6ce8\u610f\u8fd9\u91cc\u7531\u4e8e\u6211\u4eec\u4e8b\u5148\u5206\u914d\u597d\u4e86\u8282\u70b9\uff0c\u6240\u4ee5 \u5206\u914d\u65b0\u8282\u70b9 \u548c \u9a71\u9010\u65e7\u8282\u70b9 \u7684\u64cd\u4f5c\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"notes/6.s081%20OS/lab9/","title":"Lab9","text":""},{"location":"notes/6.s081%20OS/lab9/#file-system","title":"File System","text":""},{"location":"notes/6.s081%20OS/lab9/#81","title":"8.1","text":"<p>some challenge for the file system</p> <ul> <li>data structrue to represnt file and directory</li> <li>handle crash </li> <li>concurrency</li> <li> <p>fast I/O</p> \u4e03\u5c42\u6a21\u578b \u63cf\u8ff0 File Descriptor \u62bd\u8c61Unix\u7cfb\u7edf\u8d44\u6e90\uff0c\u6bd4\u5982 pipe, files, devices \u7b49 Pathname \u8def\u5f84\u67e5\u627e Directory \u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6 Inode \u62bd\u8c61\u6587\u4ef6 Logging \u5141\u8bb8\u9ad8\u5c42\u5c06\u591a\u4e2a update \u5408\u5e76\u5230\u4e00\u4e2a commit Buffer cache \u7f13\u5b58 block, \u5e76\u4e14\u5c06\u5bf9\u7f13\u5b58\u7684\u66f4\u6539\u540c\u6b65\u5230 disk Disk \u4ece\u786c\u76d8\u8bfb\u53d6 block </li> </ul> <p>blocks(sectors)</p> <p>The blocks size file system uses is usally a multiple of sector size disk uses. </p> <p>Xv6 \u628a\u4ece\u78c1\u76d8\u8bfb\u53d6\u5230\u7684\u6570\u636e\u5b58\u653e\u5728 struct buf \u91cc\u3002(might be out of sync)</p> <p>\u6587\u4ef6\u7cfb\u7edf\u5fc5\u987b\u89c4\u5212\u597d\u5728\u54ea\u91cc\u5b58\u653e\u6570\u636e\u3002\u4e3a\u6b64\uff0c\u6587\u4ef6\u7cfb\u7edf\u5c06\u786c\u76d8\u5206\u6210\u4e86\u51e0\u90e8\u5206.</p> \u6247\u533a\u53f7 \u63cf\u8ff0 Block 0 \u4e0d\u4f7f\u7528 Block 1 superblock, stores metadata about file system Block 2 - XX Hold Log After log inodes After inodes bitmap blocks tracking which block are in use After data block <p>buffer cache </p> <ol> <li>\u540c\u6b65\u66f4\u6539</li> <li>\u7f13\u5b58\u6700\u5e38\u8bbf\u95ee\u5feb (LRU)</li> </ol> <p><code>bread</code> and <code>bwrite</code> </p> <p>bread(dev, blockno) read data from disk to block. It calls bget search the doubled linkedlist for cached data. If not found, will recycle a not-used block.</p> <p>bwrite write data in block to disk</p> <p><code>brelse</code> put the used buffer to the head of the doubled linkedlist.</p> <p>Logging Layer </p> <p>crash recovery. use Log to make the process atomic </p> <p>\u5728\u628a\u5185\u5bb9\u5199\u5165\u78c1\u76d8\u524d\uff0c\u5148\u5c06\u6240\u6709 \u78c1\u76d8\u5199\u5165\u7684\u63cf\u8ff0\u4fe1\u606f \u5199\u5165\u786c\u76d8\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5982\u679c\u662fLog\u8fd8\u6ca1\u6709\u5199\u5165\u5b8c\u6210\u65f6\uff0c\u7cfb\u7edf\u5d29\u6e83\u3002\u91cd\u542f\u540e\uff0c\u7cfb\u7edf\u4f1a\u5ffd\u89c6\u8fd9\u4e2a\u4e0d\u5168\u7684\u65e5\u5fd7\u4fe1\u606f\u3002 \u5982\u679c\u662f\u5199\u5165\u78c1\u76d8\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5d29\u6e83\uff0c\u90a3\u4e48\u7cfb\u7edf\u4f1a\u6839\u636e\u65e5\u5fd7\u6587\u4ef6\u91cd\u65b0\u64cd\u4f5c\u4e00\u904d\u3002</p> <p>Log design </p> <p>Group commit. squash multiple operation into one commits to save disk access time</p> <p>\u7531\u4e8e Log \u7684\u8bbe\u8ba1\u5bfc\u81f4\u6240\u6709\u7684 \u7cfb\u7edf\u8c03\u7528\u4e00\u6b21\u5411\u78c1\u76d8\u5199\u5165\u7684\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7 \u5206\u914d\u7ed9 Log \u7684\u7f13\u5b58\u7a7a\u95f4 <code>write</code> \u7cfb\u7edf\u8c03\u7528\u5c31\u5fc5\u987b\u5c06\u5bf9\u5927\u6587\u4ef6\u7684\u5199\u5165\u62c6\u5206\u6210\u591a\u4e2a operation.</p> <p>code: Loging </p> <p><code>begin_op</code> \u7b49\u5f85\u6587\u4ef6\u7cfb\u7edf\u4e0d\u518d\u8fdb\u884c <code>commit</code> \uff0c\u4e14\u6709\u7a7a\u4f59\u7684 Log \u7a7a\u95f4\u3002</p> <p><code>log_write</code> \u5c06\u8981\u66f4\u6539\u7684\u6247\u533a\u53f7\u5199\u5165\u5185\u5b58, \u5e76\u4e14\u5bf9\u8fd9\u4e2a\u6247\u533a\u7684\u8ba1\u6570\u5668\u52a0\u4e00\u3002\u8003\u8651\u5230\u6211\u4eec\u53ef\u80fd\u5bf9\u591a\u6b21\u5bf9\u76f8\u540c\u7684\u6247\u533a\u8fdb\u884c\u5199\u5165\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a <code>absorption</code> \u673a\u5236, \u5c31\u662f\u5faa\u73af\u904d\u5386 log \u6570\u7ec4\uff0c\u770b\u4e00\u4e0b\u4e4b\u524d\u662f\u5426\u5df2\u7ecf\u4fdd\u5b58\u4e86\u76ee\u524d\u60f3\u8981\u66f4\u6539\u7684\u6247\u533a\u53f7\u3002</p> <p><code>end_op</code> \u63d0\u4ea4\u66f4\u6539\u3002</p> <p>block allocator </p> <p>balloc and bfree</p> <p>Inode layer </p> <p>\u4e24\u79cd inode. - \u50a8\u5b58\u78c1\u76d8\u6570\u636e\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6587\u4ef6\u5927\u5c0f\u3001\u7c7b\u578b\u3001\u4ee5\u53ca\u50a8\u5b58\u7684\u4f4d\u7f6e - \u50a8\u5b58\u5185\u5b58\u4e2d\u7684\u6570\u636e\u7ed3\u6784\uff0c\u78c1\u76d8\u4fe1\u606f+\u64cd\u4f5c\u7cfb\u7edf\u9644\u52a0\u4e0a\u7684\u989d\u5916\u4fe1\u606f</p> <p>dinode </p> <pre><code>struct dinode {\n  short type;           // File type\n  short major;          // Major device number (T_DEVICE only)\n  short minor;          // Minor device number (T_DEVICE only)\n  short nlink;          // Number of links to inode in file system\n  uint size;            // Size of file (bytes)\n  uint addrs[NDIRECT+1];   // Data block addresses\n};\n</code></pre> <ul> <li>The type field distin-guishes between files, directories, and special files (devices). A type of zero indicates that an on-disk inode is free. </li> <li>The nlink field counts the number of directory entries that refer to this inode, in order to recognize when the on-disk inode and its data blocks should be freed.</li> <li>The size field records the number of bytes of content in the file. </li> <li>The addrs array records the block numbers of the disk blocks holding the file\u2019s content.</li> </ul> <p><code>itable</code> stores active inodes</p> <p>inode is a in-memory copy of <code>dinode</code> </p> <ul> <li><code>iget</code> <code>iput</code> function modifies the ref count of i <code>inode</code> </li> </ul> <p>Invariants</p> <ul> <li><code>itable.lock</code> protests a inode is present in itable only once and <code>ref</code> is only modified by one process</li> <li><code>sleeplock</code> ensures exclusive access to inode's fields.</li> <li><code>ref</code> maintain inode in itable when ref != 0  (count c pointers)</li> <li><code>nlink</code> won't free a inode when nlink != 0 (count directory reference)</li> </ul> <p>code Inodes  Call <code>ialloc</code> to allocat a new inode. ialloc loops over the inode structures, looking for one that is marked free (type == 0). Once found, it calls <code>iget</code> to get the corresponding entry from <code>itable</code></p> <p><code>ilock</code> :Before reading the metadata from the file, we must call <code>ilock</code> . </p> <p><code>iput</code> : decrement the referecnt pointer. If the <code>ref</code>  and <code>nlink</code> is  both less that 1, it calls <code>itrunk</code> to remove the data.</p> <p>Inode content (data) </p> <p>dinode \u50a8\u5b58\u6570\u636e\u7684\u7ed3\u6784\uff1a</p> <p>\u6570\u636e\u662f\u5206\u6bb5\u5b58\u50a8\u7684\uff0c\u4e00\u4e2a\u6570\u636e\u6bb5\u7684\u5927\u5c0f\u662f 1024 \u5b57\u8282\u3002 dinode \u5c06\u6bcf\u4e00\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u5b58\u653e\u5728\u6570\u7ec4 <code>addr</code> \u4e2d\u3002 \u6570\u636e\u6bb5\u5206\u4e3a\u4e24\u7c7b\uff0c12\u4e2a\u76f4\u63a5\u8bbf\u95ee\u6bb5(NDIRECT)\u548c256\u4e2a\u95f4\u63a5\u8bbf\u95ee\u6bb5(NINDIRECT)\u3002addr[1~12] \u5b58\u653e\u7684\u662f\u76f4\u63a5\u8bbf\u95ee\u6bb5\u7684\u5176\u5b9e\u5730\u5740\uff0caddr[13] \u5b58\u653e\u7684\u662f\u95f4\u63a5\u8bbf\u95ee\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u3002</p> <p><code>bmap</code> \u4e3a inode \u83b7\u53d6\u67d0\u4e00\u4e2a\u6570\u636e\u6bb5\u7684\u4fe1\u606f\u3002(\u5fc5\u8981\u65f6\u8c03\u7528 <code>balloc</code> \u5206\u914d\u7a7a\u95f4)</p> <p>Code: directory layer </p> <p>\u76ee\u5f55\u662f\u7279\u6b8a\u7684inode\uff0c\u5b83\u7531\u8bb8\u591a\u4e2a directory entry \u6784\u6210\uff0c \u6bcf\u4e00\u4e2aentry \u90fd\u662f <code>struct dirent</code> </p> <p><code>dirlookup</code> <code>dirlink</code> </p> <p>Code: Path names </p> <p>involves a succession of calls to <code>dirlookup</code> </p> <p>File Descriptor Layer</p> <p>every open file is <code>struct file</code>, which is wrapper around either <code>PIPE</code> or <code>INODE</code> or <code>DEVICE</code> . </p> <p>All the open files are kept in the global open files <code>ftable</code> </p> <p><code>filealloc</code> \u8ba1\u6570\u5668\u7f6e1</p> <p><code>filedup</code> \u8ba1\u6570\u5668+1</p> <p><code>fileclose</code> \u8ba1\u6570\u5668-1, \u5982\u679c\u8c03\u52300\uff0c\u91ca\u653e\u8d44\u6e90</p> <p><code>filestat</code> \u628ainode\u7684\u4fe1\u606f\u4f20\u5230 \u7528\u6237\u5730\u5740\u7a7a\u95f4</p> <p><code>fileread</code> </p> <p><code>filewrite</code> </p> <p>Code System calls </p> <p><code>sys_link</code> </p> <p>creat new name for existing inodes.</p> <p><code>create</code> </p> <p>create new name for new inodes.</p>"},{"location":"notes/6.s081%20OS/lab9/#lab","title":"Lab","text":""},{"location":"notes/6.s081%20OS/lab9/#big-file","title":"Big File","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u4e8c\u7ea7 buffer. \u4e0d\u96be, \u5c31\u662f\u8981\u6ce8\u610f\u5bf9 buffer \u7684\u5185\u5bb9\u8fdb\u884c\u66f4\u6539\u540e\uff0c\u8981\u5c06\u6539\u52a8\u5199\u5165 log. \u7136\u540e bread \u548c brelse \u6210\u5bf9\u51fa\u73b0\u3002bread \u4e00\u4e2a block, \u8981 brelse \u540e\u624d\u80fd bread \u4e0b\u4e00\u4e2a buffer.</p>"},{"location":"notes/6.s081%20OS/lab9/#symbolic-links","title":"Symbolic links","text":"<ol> <li>\u600e\u6837\u521b\u9020\u4e00\u4e2a\u5408\u6cd5\u7684 symbolic links. </li> </ol> <p>naive thought: use namei find the inode corresponding to the path, using ialloc to allocate a new inode for symbolic link.</p> <ul> <li>we already have <code>create</code> function to create a new inode.</li> </ul> <p>error cases:     1. src do not exists     2. target is not vaild     3. src is directory or a symblic link</p> <p>Q: inode \u672c\u8eab\u81ea\u5df1\u6ca1\u6709\u529e\u6cd5 \u50a8\u5b58\u504f\u79fb\u91cf\uff0c\u90a3\u6211\u8981\u628a\u5b57\u7b26\u4e32\u653e\u5728\u54ea\u91cc\u5462</p> <p>A: inode \u4e0d\u9700\u8981\u50a8\u5b58\u504f\u79fb\u91cf\uff0c\u5b83\u53ea\u5199\u5165\u4e00\u6b21\u6570\u636e\u5440\u3002</p> <p>Q: \u4ec0\u4e48\u65f6\u5019 iput \u548c iunlock. iput \u662f\u4ec0\u4e48\u610f\u601d\u3002</p> <ul> <li> <p>iput: \u5f53\u6709\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6307\u9488\u6307\u5411\u4e00\u4e2ainode \u65f6\uff0cinode \u7684 refcount \u4f1a\u81ea\u589e\uff1b\u5f53\u8fd9\u4e2a\u6307\u9488\u4e0d\u518d\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u8c03\u7528 iput</p> </li> <li> <p>iunlock: \u662f\u7528\u6765\u7ef4\u62a4 inode \u7684\u4e0d\u53d8\u91cf\u7684\u3002\u518d\u9700\u8981\u66f4\u6539\u7684 inode \u7684\u5185\u5bb9\u65f6\uff0c\u9700\u8981\u52a0\u9501\u3002\u4e0d\u518d\u66f4\u6539\u5c31\u91ca\u653e\u3002</p> </li> <li> <p>\u901a\u5e38 iput \u548c iunlock \u662f\u4e00\u8d77\u4f7f\u7528\u7684\uff0c\u4e8e\u662f\u5c31\u6709\u4e86 iunlockput</p> </li> </ul> <p>Q: \u4e3a\u4ec0\u4e48 create \u65f6\uff0c\u4e0d\u9700\u8981\u91ca\u653e\u9501\uff1b</p> <p>A: \u56e0\u4e3a create \u662f\u4e2a static \u51fd\u6570\uff0c\u53ea\u5728 sys_file.c \u5185\u90e8\u4f7f\u7528\uff0c\u8c03\u7528 create \u7684 \u51fd\u6570\u8d1f\u8d23\u91ca\u653e\u9501\u3002</p> <p>Q: \u4e3a\u4ec0\u4e48 brelse \u5728 bmap \u65f6\uff0c\u53ef\u4ee5\u7d27\u63a5\u7740\u653e\u5728\u7b2c\u4e00\u4e2a bread \u4e4b\u540e\uff0c\u800c\u5728 itrunk \u4e2d\uff0c\u5c31\u4f1a\u51fa\u73b0 <code>free free block</code> \u7684\u9519\u8bef\u5462\uff1f</p> <p>A: \u56e0\u4e3a <code>brelse</code> \u4f1a\u9012\u51cf <code>bread</code> \u83b7\u53d6\u7684 block \u7684 refcnt\u3002\u800c bfree \u4f1a\u56de\u6536 ref count \u4e3a 0 \u7684 block\u3002\u5728 <code>bmap</code> \u51fd\u6570\u5b9e\u73b0\u4e2d\uff0c\u6ca1\u6709\u8c03\u7528 <code>bfree</code> \u51fd\u6570, \u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u63d0\u524d\u56de\u6536(refcnt == 0)\u7684\u60c5\u51b5\uff0c\u800c\u5728 itrunk \u4e2d\uff0c<code>ip-&gt;addr[NDIRECT + 1]</code> \u6240\u6307\u5411\u7684block\u53ef\u80fd\u5728\u6267\u884c\u5916\u5c42\u7684 <code>bfree</code> \u4e4b\u524d\uff0c\u5c31\u5df2\u7ecf\u88ab\u5185\u5c42\u5faa\u73af\u7684 <code>bfree</code> \u56de\u6536\u4e86\u3002\u6700\u540e\u518d\u6b21\u6267\u884c <code>bfree(ip-&gt;addr[NDIRECT + 1])</code> \u5c31\u51fa\u9519\u4e86\u3002</p> <p>bget \u4f7f\u7528\u4e86\u4e24\u628a\u9501</p> <ul> <li> <p>bcache lock     \u4fdd\u62a4 bache \u7684\u94fe\u8868\u7ed3\u6784\u548c\u8282\u70b9\u4fe1\u606f\u4e0d\u53d1\u751f race condition; </p> </li> <li> <p>block lock     \u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u5728\u5bf9 block cache \u91cc\u7684\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u8fdb\u7a0b\u5bf9 block cache \u7684\u4fee\u6539\u88ab serilzie \u4e86\u3002\u53ef\u80fd\u4f1a\u5f71\u54cd\u6027\u80fd\u3002</p> </li> </ul>"},{"location":"notes/6.s081%20OS/summery/","title":"6.s081 \u603b\u7ed3","text":""},{"location":"notes/6.s081%20OS/summery/#lab","title":"Lab \u5b8c\u6210\u60c5\u51b5","text":"<ul> <li>\u9664\u4e86 cowlab \u6ca1\u6709\u901a\u8fc7 usertests, \u5176\u4f59\u5b9e\u9a8c\u5747\u901a\u8fc7\u4e86\u6240\u6709\u6d4b\u8bd5\u3002\u5e0c\u671b\u540e\u7eed\u80fd\u8865\u4e0a</li> <li>\u7528\u65f6\u6700\u957f\u7684\u4e09\u4e2a\u5b9e\u9a8c Lab1 utils (5\u5929) \u4e00\u5f00\u59cb\u662f\u771f\u7684\u4e0d\u4e60\u60efunix\u7684api\u98ce\u683c  \ud83d\ude22 , Lab5 COW (20h), Lab10 mmap(14h)</li> </ul>"},{"location":"notes/6.s081%20OS/summery/#_1","title":"\u8bfe\u7a0b\u4ecb\u7ecd","text":"<ul> <li> <p>6.s081 \u662f MIT \u5927\u4e8c\u5b66\u751f\u9009\u4fee\u7684\u4e00\u95e8\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u3002\u8fd9\u95e8\u8bfe\u7a0b\u4f9d\u6258\u4e8e XV6 (\u4e00\u4e2a MIT \u7814\u53d1\u7684\u5c0f\u578b\u7c7b Unix \u64cd\u4f5c\u7cfb\u7edf) \u8bb2\u89e3\u64cd\u4f5c\u7cfb\u7edf, \u901a\u8fc7\u7406\u89e3 XV6 \u7684\u4ee3\u7801\u6765\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u6784\u5efa\uff0c\u5982\u4f55\u5de5\u4f5c\u7684\u3002</p> </li> <li> <p>\u8bfe\u7a0b\u7684\u524d15\u8282\u8bfe\u4e3b\u8981\u8bb2\u89e3\u7684\u662f XV6 \u7684\u5404\u4e2a\u7ec4\u6210\u90e8\u5206\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u540e\u4e03\u8282\u8bfe\u7a0b\u5219\u662f\u8bba\u6587\u8bfe\uff0c\u6bcf\u8282\u8bfe\u8bb2\u89e3\u4e00\u7bc7 paper, \u8ba9\u4f60\u4e86\u89e3\u64cd\u4f5c\u7cfb\u7edf\u8fd9\u4e2a\u9886\u57df\u7684\u53d1\u5c55\u524d\u6cbf\u3002</p> </li> <li> <p>\u5982\u679c\u4f60\u8d76\u65f6\u95f4\uff0c\u53ea\u662f\u60f3\u5b8c\u6210 lab \u6216\u8005\u542c\u4e0d\u4e0b\u53bb\u82f1\u6587\u6388\u8bfe\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5b66\u4e60 XV6 \u7684\u5b98\u65b9\u624b\u518c \u548c XV6\u7684\u6e90\u4ee3\u7801\u3002\u56e0\u4e3a\u524d15\u8282\u8bfe\u8001\u5e08\u4e5f\u5c31\u662f\u8bb2\u89e3\u4e00\u4e0b XV6 \u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u548c\u4f60\u81ea\u5df1\u770b\u624b\u518c\u3001\u4ee3\u7801\u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u5982\u679c\u80fd\u6d88\u5316\u7684\u8bdd \u4e0d\u8fc7\u89c6\u9891\u4e2d\u8001\u5e08\u6709\u65f6\u4f1a\u9b54\u6539XV6 \u5199\u4e00\u4e9b\u5c0f demo \u6765\u52a0\u6df1\u7406\u89e3\uff0c\u4ee5\u53ca\u4f1a\u56de\u7b54\u5b66\u751f\u7684\u7591\u95ee\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u9519\u8fc7\u8fd9\u4e9b\u90e8\u5206\u7684\u8bdd\uff0c\u90a3\u6211\u63a8\u8350\u4f60\u770b\u4e00\u4e0b\u8fd9\u4e2a \u4ed3\u5e93\u3002\u5b83\u5c06 081 \u7684\u6240\u6709lecture \u6574\u7406\u6210\u4e86\u6587\u672c\u5e76\u8fdb\u884c\u4e86\u7ffb\u8bd1\u3002\u540c\u65f6\uff0c\u6587\u672c\u4e2d\u4e5f\u5305\u542b\u4e86\u89c6\u9891\u4e2d\u5173\u952e\u7684\u56fe\u50cf\uff0c\u6bd4\u5982\u6559\u6388\u5c55\u793a\u7684\u4ee3\u7801\uff0c\u6216\u8005\u7ed8\u5236\u7684\u56fe\u89e3\u3002</p> </li> </ul>"},{"location":"notes/6.s081%20OS/summery/#_2","title":"\u611f\u609f","text":""},{"location":"notes/6.s081%20OS/summery/#_3","title":"\u5b9e\u9a8c\u6709\u5c40\u9650\u6027","text":"<ul> <li>\u5b9e\u9a8c\u7684\u4ee3\u7801\u91cf\u5e76\u4e0d\u662f\u5f88\u5927\uff0c\u5355\u4e2a\u5b9e\u9a8c\u6700\u591a\u4e5f\u5c31 \u4e00\u767e\u6765\u884c\u4ee3\u7801\u3002\u53ef\u4ee5\u8bf4\u662f\u5728 XV6 \u8fd9\u4e2a\u6846\u67b6\u4e0b \u8fdb\u884c\u4e00\u4e2a\u7a0b\u5e8f\u586b\u7a7a\u3002\u4e0d\u8fc7\u867d\u7136\u4ee3\u7801\u91cf\u4e0d\u5927\uff0c\u8981\u5199\u7684\u6b63\u786e\u8fd8\u662f\u5f88\u96be\u7684\u3002\u6bcf\u4e00\u4e2a\u5b9e\u9a8c\u7684handout \u5728\u6700\u5f00\u59cb\u90fd\u4f1a\u8bf4\u660e\u5b9e\u9a8c\u7684\u524d\u7f6e\u8981\u6c42\uff0c\u6bd4\u5982 \u9700\u8981\u770b\u5b8c chapter x.x - x.x \u7684\u5185\u5bb9\u518d\u5f00\u59cb\u3002\u53ea\u7528\u5c06\u8fd9\u4e9b\u4ee3\u7801\u7406\u89e3\u4e86\u518d\u5f00\u59cb\u5b9e\u9a8c\uff0c\u624d\u4e0d\u4f1a\u50cf\u65e0\u5934\u82cd\u8747\u4e00\u6837\u832b\u7136\u3002</li> <li>\u7531\u4e8e XV6 \u672c\u8eab\u7684\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u5f88\u591a\u7ed3\u6784\u505a\u4e86\u7b80\u5316\u5904\u7406\u3002\u800c\u4e14\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u6211\u4eec\u53ea\u662f\u5728\u505a\u7a0b\u5e8f\u586b\u7a7a\uff0c\u8ddd\u79bb\u771f\u6b63\u7684\u7406\u89e3\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u662f\u6709\u5f88\u5927\u8ddd\u79bb\u3002 \u6240\u4ee5\u4e0d\u8981\u5984\u81ea\u83f2\u8584 \u524d\u9762\u7684\u8def\u8fd8\u5f88\u957f\u3002\u8fd9\u4e2a\u8bfe\u7a0b\u53ea\u662f\u5165\u95e8\u3002</li> </ul>"},{"location":"notes/6.s081%20OS/summery/#_4","title":"\u597d\u7684\u5de5\u5177\u662f\u5f00\u59cb\u7684\u7b2c\u4e00\u6b65","text":"<p>\u4efb\u4f55 tedious \u7684\u5de5\u4f5c\u90fd\u80fd\u88ab\u7b80\u5316 by jyy</p> <ol> <li> <p>\u5728\u5199 lab util \u7684\u65f6\u5019\uff0c\u6211\u662f\u5728 wsl (ubuntu) \u4e0b\u5b8c\u6210\u7684\u3002\u867d\u7136\u8bfe\u7a0b\u5b98\u7f51\u7ed9\u51fa\u4e86\u914d\u7f6e\u73af\u5883\u6240\u9700\u8981\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u6211\u5728\u5b8c\u6210\u5b9e\u9a8c\u7684\u8fc7\u7a0b\u603b\u662f\u9047\u5230\u5947\u5947\u602a\u602a\u7684\u95ee\u9898\u3002\u6bd4\u5982\u6211\u7684 gdb \u8c03\u8bd5\u754c\u9762\u6ca1\u6709 syntax highligh, \u4e0e\u89c6\u9891\u91cc\u7684 \u8c03\u8bd5\u754c\u9762\u5929\u5dee\u5730\u522b\u3002\u8fd9\u4e5f\u662f\u6211\u5728\u5199\u7b2c\u4e00\u4e2a\u5b9e\u9a8c\u7684\u65f6\u5019\u603b\u60f3\u6446\u70c2\u7684\u539f\u56e0 (\u4e4b\u540e\u610f\u8bc6\u5230\u5e94\u8be5\u662f apt \u5b89\u88c5\u7684\u8f6f\u4ef6\u7248\u672c\u8fc7\u4f4e\u4e86)\u3002\u4e4b\u540e\uff0c\u6211\u628a\u7cfb\u7edf\u5207\u6362\u5230\u4e86 manjaro, \u4ec0\u4e48\u6bdb\u75c5\u4e5f\u6ca1\u4e86\ud83e\udd24 \u3002  manjaro \u914d\u7f6e\u73af\u5883\u8bf7\u53c2\u8003 </p> </li> <li> <p>\u5728\u8fdb\u884c\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u6211\u4eec\u603b\u662f\u9700\u8981\u5728\u4e00\u4e2a\u7ec8\u7aef\u91cc\u8f93\u5165 <code>make CPUS=1 qemu-gdb</code>\uff0c \u53e6\u4e00\u4e2a\u4e2d\u65ad\u8f93\u5165 <code>riscv64-linux-gnu-gdb</code>\u3002\u8fd9\u6837\u602a\u9ebb\u70e6\u7684\u3002\u6211\u7684\u89e3\u51b3\u65b9\u5f0f\u662f\u5b89\u88c5\u4e00\u4e2a <code>zellij</code>, \u8fd9\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7ec8\u7aef\u5e03\u5c40\uff0c\u5e76\u4e14\u6307\u5b9a\u7ec8\u7aef\u6267\u884c\u7684\u547d\u4ee4\u3002  <pre><code>        layout {\n            pane split_direction=\"vertical\" {\n                pane {\n                        size \"50%\"\n                        cwd \"/home/trace/trace/learning/open_course/6.s081/xv6-labs-2021\"\n                        command \"make\"\n                        args \"CPUS=1\" \"qemu-gdb\" \n                }\n                pane {\n                        size \"50%\"\n                        focus true\n                        cwd \"/home/trace/trace/learning/open_course/6.s081/xv6-labs-2021\"\n                        command \"riscv64-linux-gnu-gdb\"\n                }\n            }\n        } \n</code></pre></p> </li> <li>\u914d\u7f6e\u4e00\u4e2a\u597d\u7528\u7684\u7f16\u8f91\u5668\u3002\u65e0\u8bba\u662f vim \u8fd8\u662f vscode, \u719f\u7ec3\u4f7f\u7528\u4e00\u4e2a\u7f16\u8f91\u5668\u53ef\u4ee5\u8ba9\u4f60\u5728\u5199\u4ee3\u7801\u65f6\uff0c\u8fbe\u5230\u4e00\u79cd\u5fc3\u6d41\u7684\u72b6\u6001\u3002 (\u5b89\u5229\u4e00\u4e0b neovim \u771f\u5fc3\u597d\u7528)</li> </ol>"},{"location":"notes/6.s081%20OS/summery/#codebase","title":"\u5982\u4f55\u5b66\u4e60\u4e00\u4e2acodebase","text":"<p>XV6 \u603b\u5171\u4ee3\u7801\u4e24\u4e07\u591a\u884c\uff0c\u4e5f\u7b97\u662f\u4e2a\u4e2d\u5c0f\u578b\u9879\u76ee\u4e86\u3002\u4e00\u5f00\u59cb\uff0c\u9762\u5bf9\u8fd9\u6837\u5e9e\u5927\u7684 codebase, \u4e0d\u77e5\u9053\u4ece\u90a3\u4e00\u4e2a\u5730\u65b9\u5165\u624b\u3002\u6211\u89c9\u7684\u53ef\u4ee5\u53c2\u8003\u4e00\u4e0b\u77e5\u4e4e\u8fd9\u4f4d dalao \u7684\u505a\u6cd5 link </p> <p>\u626b\u8bfb\u5728\u8bfe\u7a0b\u8868\u4e0a\u91cd\u70b9\u6307\u51fa\u7684\u51e0\u4e2axv6\u6e90\u4ee3\u7801\u6587\u4ef6. \u4e00\u822c\u6765\u8bf4\u6bcf\u8282\u8bfe\u4e5f\u5c311, 2\u4e2a\u6e90\u6587\u4ef6, \u91cf\u4e0d\u5927. \u5728\u8fd9\u4e2a\u9636\u6bb5, \u4e3b\u8981\u662f\u770b\u4ee3\u7801\u6587\u4ef6\u91cc\u4e0d\u540c\u51fd\u6570\u7684\u547c\u53eb\u4f9d\u8d56, \u5bf9\u4e8e\u5177\u4f53\u600e\u4e48\u5b9e\u73b0\u7684\u53ef\u4ee5\u5148\u653e\u4e00\u4e0b. \u4e89\u53d6\u505a\u5230\u5728\u9605\u8bfb\u5b8c\u540e, \u5bf9\u4e8e\u4e00\u4e2a\u76f8\u5173\u529f\u80fd, \u80fd\u5728\u5fc3\u4e2d\u5927\u81f4\u8bf4\u51fa\u5b83\u7684\u4e00\u4e2a\u51fd\u6570\u547c\u53eb\u94fe, \u6bd4\u5982 a() -&gt; b() -&gt; c() -&gt; a().</p>"},{"location":"notes/6.s081%20OS/summery/#_5","title":"\u5982\u4f55\u66f4\u597d\u7684\u8fdb\u884c\u8c03\u8bd5","text":"<p>\u53c2\u8003jyy\u7684\u8c03\u8bd5\u7406\u8bba</p>"},{"location":"notes/6.s081%20OS/summery/#_6","title":"\u753b\u997c","text":"<ol> <li>\u53c2\u8003 \u964d\u661f\u9a70 , \u5c06 xv6 \u542f\u52a8\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u6838\u5fc3\u6a21\u5757\u7684\u51fd\u6570\u8c03\u7528\u5173\u7cfb\uff0c\u6838\u5fc3\u6570\u636e\u7ed3\u6784\u7528\u56fe\u89e3\u7684\u5f62\u5f0f\u7ed8\u5236\u51fa\u6765\u3002</li> <li>\u7ed3\u5408 osetp \u5b8c\u6574\u7684 \u770b\u4e00\u904d\u848b\u8001\u5e08\u7684\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u3002</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/","title":"\u7b97\u6cd5\u7b14\u8bb0","text":"<p>${toc}</p> <p>1e5 is 100000 bushi 10000 n, n != n, m != &amp; ==  i &amp; n</p> <p>\u65e0\u5411\u8fb9\uff0c\u6709\u5411\u8fb9</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_1","title":"\u5e38\u7528\u5de5\u5177","text":"<ul> <li>\u524d\u7f00\u548c</li> </ul> Property Explaination \u529f\u80fd \u53ef\u4ee5\u5728 \\(\\Theta (1)\\) \u65f6\u95f4\u5185\u6c42\u4e00\u6bb5\u533a\u95f4\u7684\u548c \u7528\u6cd5 sum[i] = sum[i - 1] + a[i] <ul> <li>\u6ed1\u52a8\u7a97\u53e3</li> <li>\u8f93\u5165\u8f93\u51fa</li> </ul> <pre><code>  public static void main(String[] args) throws Exception {\n\n    BufferedReader br = new BufferedReader(new InputStreamReader(System.in));\n    BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(System.out));\n\n    String[] values = br.readLine().split(\"\\\\s+\");\n    n = Integer.parseInt(values[0]);\n    m = Integer.parseInt(values[1]);\n\n    List&lt;Integer&gt; distinctSortedAlls = all.stream().distinct().sorted()\n        .collect(Collectors.toList());\n\n    int aftIdx = Collections.binarySearch(distinctSortedAlls, preIdx) + 1;\n\n    Arrays.fill(h, -1);\n    // read input\n\n    bw.write(ret + \"\\n\");\n    bw.flush();\n    bw.close();\n    br.close();\n  }\n}\n</code></pre> <p>\u8f93\u5165\u8f93\u51fa\u52a0\u901f </p> <pre><code>public static StreamTokenizer in = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in), 32768));\n  public static PrintWriter out = new PrintWriter(new OutputStreamWriter(System.out));\n\n  public static double nextDouble() throws IOException {\n    in.nextToken();\n    return in.nval;\n  }\n\n  public static float nextFloat() throws IOException {\n    in.nextToken();\n    return (float) in.nval;\n  }\n\n  public static int nextInt() throws IOException {\n    in.nextToken();\n    return (int) in.nval;\n  }\n\n  public static String next() throws IOException {\n    return in.sval;\n  }\n\n  public static long nextLong() throws Exception {\n    in.nextToken();\n    return (long) in.nval;\n  }\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#hash","title":"\u5b57\u7b26\u4e32hash","text":"<pre><code> p[0] = 1;\n for (int i = 1; i &lt;= n; i++) {\n   p[i] = (p[i - 1] * P) % Q;\n   h[i] = (h[i - 1] * P + c[i]) % Q;\n }\n\n while (m-- != 0) {\n   int x = scan.nextInt();\n   int y = scan.nextInt();\n   int x1 = scan.nextInt();\n   int y1 = scan.nextInt();\n\n   long res = h[y] - h[x - 1] * p[y - x + 1];\n   long res1 = h[y1] - h[x1 - 1] * p[y1 - x1 + 1];\n\n   if (res == res1) {\n     System.out.println(\"Yes\");\n   } else {\n     System.out.println(\"No\");\n   }\n }\n</code></pre> <p>&lt;++&gt;</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_2","title":"\u6709\u5173 \u6a21\u8fd0\u7b97\u7684 \u4e00\u4e9b\u6a21\u677f","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_3","title":"\u6700\u5927\u516c\u7ea6\u6570","text":"<p>gcd short for greater common divisor</p> <p>\u9996\u5148\u4ecb\u7ecd\u4e00\u4e0b \u6a21\u8fd0\u7b97 \u7684\u5b9a\u4e49\u3002\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u6574\u6570 \\(n\\) , \u4e00\u5b9a\u5b58\u5728\u4e24\u4e2a\u6574\u6570  \\(k, r\\) \u4f7f\u5f97\u4ee5\u4e0b\u7b49\u5f0f\u6210\u7acb</p> \\[ n = k * p + r \\] <p>\u90a3\u4e48\u6211\u4eec\u5b9a\u4e49\\(k\\)\u4e3a\\(n\\)\u9664\u4ee5\\(p\\) \u7684\u5546\\,  \\(r\\)\u4e3a\\(n\\)\u9664\u4ee5\\(p\\) \u7684\u4f59\u6570, \u8fd9\u53c8\u53ef\u4ee5\u8868\u793a\u4e3a</p> \\[ n \\% p = r \\qquad (n \\text{ mod } p  = r) \\] <ul> <li>\u6a21\u8fd0\u7b97\u7684\u56db\u5219\u8fd0\u7b97</li> </ul> <p></p> <ul> <li>\u8f97\u8f6c\u76f8\u9664\u6cd5\u6c42 gcd </li> </ul> <p>\u8fd8\u662f\u62ff\u4e0a\u6587\u7684\u7b49\u5f0f\u4e3e\u4f8b</p> \\[ n = k * p + r \\] <p>\u5047\u8bbe \\(n\\) \u4e0e \\(p\\) \u6709\u6700\u5927\u516c\u56e0\u6570 \\(m\\), \u7b49\u5f0f\u4e24\u7aef\u540c\u65f6 \u9664\u4ee5 \\(m\\) </p> \\[ \\frac{n}{m} = k * \\frac{p}{m} + \\frac{r}{m}  \\\\ \\implies n' = k * p'  + \\frac{r}{m}  \\\\ \\] <p>\u7531\u4e8e \\(n', p', k\\) \u90fd\u662f\u6574\u6570, \u6240\u4ee5 \\(\\frac{r}{m}\\) \u4e5f\u662f\u6574\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4 \\(m\\) \u4e5f\u662f \\(r\\) \u7684\u56e0\u5b50\u3002</p> \\[ gcd(n, p) = gcd(p, r) \\]"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_4","title":"\u5206\u89e3\u8d28\u56e0\u6570","text":"<pre><code>ArrayList&lt;Integer&gt; divide(long n) {\n  ArrayList&lt;Integer&gt; factors = new ArrayList&lt;&gt;();\n  for (int i = 2; i &lt;= n / i; i++) {\n    if (n % i == 0) \n    {\n      factors.add(i);\n      while (n % i == 0) n /= i;\n    }\n  }\n  if (n &gt; 1) {factors.add(x); factors.add(1); }\n}\n</code></pre> <p>\u9996\u5148\u8bc1\u660e\u5143\u7d20\u5747\u4e3a \\(N\\) \u7684\u7d20\u56e0\u6570\uff1a\u56e0\u4e3a\u5f53\u4e14\u4ec5\u5f53 <code>N % i == 0</code> \u6ee1\u8db3\u65f6\uff0c<code>result</code> \u53d1\u751f\u53d8\u5316\uff1a\u50a8\u5b58 <code>i</code>, \u8bf4\u660e\u6b64\u65f6 <code>i</code> \u53ef\u4ee5\u6574\u9664 \\(\\frac{N}{A}\\)\u3002\u8bf4\u660e\u5b58\u5728\u4e00\u4e2a\u6570 \\(p\\) \u4f7f\u5f97 \\(p \\cdot i = \\frac{N}{A}\\) \u3002(\u5176\u4e2d, <code>A</code> \u4e3a <code>N</code> \u81ea\u8eab\u53d1\u751f\u53d8\u5316\u540e\u9047\u5230 <code>i</code> \u65f6\u6240\u9664\u7684\u6570\u3002\u6b64 <code>N</code> \u975e \u5f7c \\(N\\) )\u3002</p> <p>\u5176\u6b21\u8bc1\u660e <code>result</code> \u4e2d\u7684\u6570\u5747\u4e3a\u7d20\u6570\u3002\u6211\u4eec\u5047\u5b9a\u5b58\u5728\u4e00\u4e2a\u5728 <code>result</code> \u7684\u5408\u6570 \\(K\\) , \u5e76\u6839\u636e\u6574\u6570\u57fa\u672c\u5b9a\u7406 \\(K = K_1^{e_1} \\cdot  K_2^{e_2} \\cdots K_n^{e_n} \\cdot\\), \u56e0\u4e3a \\(K_1 &lt; K - 1\\) \u6240\u4ee5\u4ed6\u4e00\u5b9a\u4f1a\u5728 \\(K\\) \u524d\u88ab\u904d\u5386\u5230\u3002\u6709\u56e0\u4e3a <code>while(N % k1 != 0) N /= k1</code>\uff0c\u5373\u8ba9 \\(N\\) \u6ca1\u6709\u4e86 \u7d20\u56e0\u5b50 <code>K1</code>\uff0c \u987e\u904d\u5386\u5230 <code>K</code> \u65f6\uff0c <code>N</code> \u548c \\(K\\) \u5df2\u7ecf\u6ca1\u6709\u6574\u9664\u5173\u7cfb\u4e86\u3002 </p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_5","title":"\u5173\u4e8e\u7ea6\u6570","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_6","title":"\u6570\u636e\u7ed3\u6784","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_7","title":"\u5355\u94fe\u8868","text":"<pre><code>  static int[] e = new int[N], ne = new int[N];\n  // e[i] \u53ef\u4ee5\u88ab\u89e3\u8bfb\u4e3a \u8282\u70b9 i \u5bf9\u5e94\u7684 \u503c \u4e3a e[i]\n  // ne[i] \u53ef\u4ee5\u88ab\u89e3\u8bfb\u4e3a \u8282\u70b9 i \u5bf9\u5e94\u7684 next \u6307\u9488 \u6307\u5411 ne[i]\n  static int idx;\n  // idx \u6c38\u8fdc\u6307\u5411 \u4e0b\u4e00\u4e2a \u5b58\u50a8\u4f4d\u7f6e\n  static void init() {\n    head = -1;\n    idx = 0;\n  }\n\n  static void insert_head(int value) {\n\n    e[idx] = value;\n    ne[idx] = head;\n    head = idx++;\n\n  }\n\n  static void remove_head() {\n    head = ne[head];\n  }\n\n  // \u5728\u4e0b\u6807\u4e3a k \u7684\u8282\u70b9\u540e\u9762 \u63d2\u5165\u4e00\u4e2a \u503c\u4e3a value \u7684\u8282\u70b9\n  static void insert(int k, int value) {\n    e[idx] = value;\n    ne[idx] = ne[k];\n    ne[k] = idx;\n    idx++;\n  }\n\n  // \u5220\u9664 \u4e0b\u6807\u4e3a k \u7684\u8282\u70b9\u540e\u9762\u7684\u4e00\u4e2a\u8282\u70b9\n  static void remove(int k) {\n    if (k == -1) {\n      remove_head();\n    } else if (ne[k] != -1) {\n      ne[k] = ne[ne[k]];\n    }\n  }\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_8","title":"\u6a21\u62df\u961f\u5217","text":"<p>\u9700\u8981\u6ce8\u610f\u4e24\u70b9</p> <ol> <li>hh \u662f\u961f\u5934\uff0c tt \u662f\u961f\u5c3e</li> <li>\u4ece\u6570\u7ec4\u4e0b\u6807\u7684\u5c42\u9762\u770b\uff0chh \u662f\u8981\u6bd4 tt \u5c0f\uff08\u6216\u8005\u7b49\u4e8e\u7684\uff09\u3002 \u6240\u4ee5 \u5224\u65ad\u961f\u5217\u662f\u5426\u4e3a\u7a7a\u7684\u8bed\u53e5\u662f <code>if(hh &lt;= tt )</code> </li> </ol> <pre><code>public class Main {\n\n    static int N = (int) (1e6 + 10);\n\n    static int[] q = new int[N]; // q is queue\n    static int hh = 0, tt = -1; // hh is head, tt is rear\n\n    public static void main(String[] args) {\n        Scanner scan = new Scanner(System.in);\n\n        int n = scan.nextInt();\n        while (n-- != 0){\n            String op = scan.next();\n            switch(op) {\n                case \"push\":\n                    q[++ tt] = scan.nextInt();\n                    break;\n                case \"pop\":\n                    hh ++;\n                    break;\n                case \"empty\":\n                    if (hh &lt;= tt) {\n                        System.out.println(\"NO\");\n                    } else {\n                        System.out.println(\"YES\");\n                    }\n                    break;\n                case \"query\":\n                    System.out.println(q[hh]);\n            }\n        }\n        scan.close();\n\n    }\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#trie","title":"Trie","text":"<p>\u529f\u80fd\uff1a \u53ef\u4ee5\u5feb\u901f\u5728\u4e00\u7ec4\u5b57\u7b26\u4e32\u4e2d\u627e\u5230\u7b26\u5408 \u67d0\u4e9b \u7279\u6b8a\u6761\u4ef6 \u7684\u4e00\u4e2a\u6216\u8005 \u591a\u4e2a\u5b57\u7b26\u4e32 </p> <p>Trie \u6240\u7528\u5230\u7684\u6570\u636e\u7ed3\u6784 </p> <pre><code>int son[N][26]; // son[i] \u53ef\u4ee5\u8bfb\u4f5c \u8282\u70b9 i \u7684 \u5b69\u5b50\u6570\u7ec4\n// son[i][j] = u, \u53ef\u4ee5\u8bfb\u4f5c\u8282\u70b9 i \u7684\u5b69\u5b50 j \u6307\u5411 u \u8fd9\u4e2a\u8282\u70b9 \n// \u4e3a\u4ec0\u4e48\u662f 26 \u56e0\u4e3a \u8fd9\u91cc\u53ea\u5b58\u50a8\u5c0f\u5199\u5b57\u7b26\uff0c\u5c0f\u5199\u5b57\u7b26\u4e00\u5171 26 \u4e2a\n\nint cnt[N]; // cnt[i] \u8bfb\u4f5c \u4ee5 i \u8282\u70b9 \u7ed3\u5c3e\u7684\u5b57\u7b26\u51fa\u73b0\u7684\u6b21\u6570\u3002\nint idx; // idx \u540c\u6837\u662f\u7528\u6765\u5206\u914d\u8282\u70b9 \n</code></pre> <pre><code>static void insert(String ss) {\n      int r = 0;\n\n      for (int i = 0; i &lt; ss.length(); i++) {\n          int u = ss.charAt(i) - 'a';\n          if (son[r][u] == 0) {\n              son[r][u] = idx;\n              idx++;\n          }\n          r = son[r][u];\n      }\n      cnt[r] ++;\n  } \n\n  static void query(String ss) {\n\n      int r = 0;\n\n      for (int i = 0; i &lt; ss.length(); i++) {\n          int u = ss.charAt(i) - 'a';\n\n          if (son[r][u] == 0) {\n              System.out.println(\"0\");\n              return;\n          } else {\n              r = son[r][u];\n          }\n      }\n\n      System.out.println(cnt[r]);\n</code></pre> <p>ps: \u4f7f\u7528\u6570\u7ec4\u5b9e\u73b0 Trie \u5c31\u662f CS61B \u91cc \u8bb2\u89e3trie \u63d0\u5230\u7684 naive approach,  \u7b97\u6cd5\u6bd4\u8d5b\u53ef\u4ee5\u8fd9\u4e48\u5199\uff0c\u4f46\u662f\u5982\u679c\u5b9e\u9645\u5f00\u53d1\u91cc\u4e2d \u8fd9\u4e48\u5199 \u5185\u5b58\u662f\u8981\u7206\u70b8\u7684\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a143","title":"\u6700\u5927\u5f02\u6216\u548c A143","text":"<p>\u601d\u8def\uff1a</p> <ol> <li>\u5c06\u6574\u6570\u8f6c\u6362\u4e3a2\u8fdb\u5236\u6570\u4e32\uff0c\u63d2\u5165 Trie \u4e2d\u3002(\u6b62\u6b65\u4e8e\u6b64)</li> <li>\u4ece 1 .. n \u904d\u5386\uff0c \u5728 Trie \u4e2d\u67e5\u8be2 \u4e0e a[i] \u5f02\u6216\u7ed3\u679c\u6700\u5927\u7684\u6570\u5f02\u6216\u7ed3\u679c\u4e0e res \u6bd4\u8f83\u5927\u5c0f\uff0c \u4fdd\u5b58\u8f83\u5927\u8005\u3002\uff08\u53ef\u89c1 Trie \u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7684\u80fd\u529b\u662f\u5728\u4e00\u7ec4\u5b57\u7b26\u4e32\u4e2d\uff0c\u627e\u5230\u67d0\u4e2a\u5177\u6709\u7279\u6b8a\u6027\u8d28\u7684\u5b57\u7b26\u4e32\uff09</li> <li>\u8f93\u51fa\u7ed3\u679c</li> </ol> <p>\u8fd9\u9053\u9898\u7684\u5173\u952e\u5728\u4e8e query</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a3585","title":"A3585 \u6700\u5927\u5f02\u6216\u548c","text":"<p>\u601d\u8def\uff1a 1. \u9996\u5148\u4f7f\u7528\u524d\u7f00\u548c\u5904\u7406\u8bfb\u5165\u7684\u6570\u7ec4\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u7528 \\(\\Theta (1)\\) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8ba1\u7b97 \u67d0\u6bb5\u533a\u95f4\u7684 \u5f02\u6216\u548c  2. \u904d\u5386 \u5f02\u6216\u548c\u6570\u7ec4    - \u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6570\uff0c\u9996\u5148\u5728 Trie \u4e2d\u67e5\u627e\u80fd\u4e0e\u4e4b\u4ea7\u751f\u6700\u5927\u5f02\u6216\u7684\u6570   - \u8ba1\u7b97\u5f02\u6216\u7ed3\u679c\uff0c\u4e0eres\u6bd4\u8f83\uff0c\u4fdd\u5b58\u6700\u5927\u503c   - \u5c06\u8be5 \u6570 \u63d2\u5165 trie \u4e2d    - \u82e5 \\(i \\ge  m\\) \u90a3\u4e48\u4ecetrie \u4e2d\u5220\u9664 sum[i - m]</p> <p>\u5982\u4f55\u5b9e\u73b0\u5220\u9664\uff1a 1. \u5728\u63d2\u5165\u65f6\uff0c\u4e3a\u6bcf\u4e00\u4e2a\u8282\u70b9\u589e\u52a0\u4e00\u4e2a cnt \u6570\u636e\u57df\uff0c\u8bb0\u5f55\u8be5\u8282\u70b9\u4e0b\u5b58\u5728\u7684\u5b57\u7b26\u4e32\u6570\u76ee\u3002  - \u63d2\u5165\u65f6 cnt++  - \u5220\u9664\u65f6 cnt--</p> <ol> <li>query \u65f6\uff0c \u589e\u52a0\u4e00\u4e2a \u5224\u65ad\u6761\u4ef6 cnt[son[r][i]] &gt; 0</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_9","title":"\u4e8c\u53c9\u6811\u7684\u904d\u5386","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_10","title":"\u6839\u636e\u540e\u5e8f\u548c\u524d\u5e8f\u6784\u5efa\u4e8c\u53c9\u6811","text":"<p>\u9012\u5f52\u6784\u5efa\u3002 \u8981\u70b9 1. \u904d\u5386\u6570\u7ec4\u4e0b\u6807\u4ece 1 \u5f00\u59cb\u6bd4\u8f83\u597d 2. \u53ef\u4ee5\u7528 hash \u8868 \u5b58\u50a8 \u4e2d\u5e8f\u904d\u5386 \u8282\u70b9 \u4e0e \u4e0b\u6807\u7684\u6620\u5c04\u3002\u56e0\u4e3a\u5206\u88c2\u70b9\u662f\u7531 \u540e\u5e8f\u904d\u5386\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u6bcd\u5bf9\u5e94\u4e2d\u5e8f\u904d\u5386\u7684\u4e0b\u6807 \u786e\u5b9a\u7684\u3002 3. \u5c06\u6bcf\u4e00\u6b21\u51fd\u6570\u9012\u5f52\u7684\u8c03\u7528\u53c2\u6570\u6253\u5370\u51fa\u6765\uff0c\u518d\u6839\u636e\u53c2\u6570\u8fdb\u884c\u8c03\u6574\u533a\u95f4\u3002(\u5982\u679c\u7b54\u6848\u4e0d\u6b63\u786e\u7684\u8bdd)</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_11","title":"\u5b57\u7b26\u4e32\u5904\u7406","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_12","title":"\u5faa\u73af\u79fb\u4f4d\u627e\u5b50\u4e32","text":"<p>\u5224\u65ad\u4e00\u4e2a\u5b57\u7b26\u4e32 a \u662f\u4e0d\u662f\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u5faa\u73af\u79fb\u4f4d\u540e\u7684\u5b57\u4e32\u3002</p> <ul> <li>\u9996\u5148\u9700\u8981\u4fdd\u8bc1 a \u7684\u957f\u5ea6\u5c0f\u4e8e b</li> <li>\u4e4b\u540e\u4ee4 b = b + b; \u5728\u62fc\u63a5\u540e\u7684b\u4e32\u4e2d\u4f7f\u7528 find \u6307\u4ee4\u6765\u5224\u65ad a \u662f\u5426\u5b58\u5728\u3002</li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_13","title":"\u56fe","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dfs","title":"DFS","text":"<p>DFS \u95ee\u9898     \u91cd\u70b9\u5728\u4e8e \u5982\u4f55\u5c06\u5b9e\u9645\u95ee\u9898\u62bd\u8c61\u6210\u4e00\u4e2a graph     \u62bd\u8c61\u6210\u56fe\u540e\u8981\u660e\u786e dfs \u8fd9\u4e2a\u51fd\u6570\u7684\u542b\u4e49\u662f\u4ec0\u4e48\uff0c\u518d\u6839\u636e\u8fd9\u4e2a\u542b\u4e49\u60f3\u76ee\u529e\u91cc\u52a0\u4e1c\u897f\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a842","title":"A842 \u6392\u5217\u6570\u5b57","text":"<p>\u5176\u5b9e\u5c31\u662f 1, 2, 3 \u4e09\u4e2a\u8282\u70b9\uff0c\u4e24\u4e24\u76f8\u8fde\u5f62\u6210\u4e00\u4e2a\u65e0\u5411\u56fe\u3002\u6c42\u8fd9\u4e2a\u56fe\u7684\u6240\u7528\u4e0d\u540c\u7684\u4fbf\u5229\u65b9\u5f0f</p> <p></p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\n\nconst int N = 7;\nbool st[N + 1];\nint path[N + 1];\nint n; \n\n// dfs \u51fd\u6570\uff1a\u6253\u5370 \u4ee5 u \u4e3a \u7b2c\u4e00\u4e2a\u6570\u7684\u6240\u6709\u8def\u5f84\nvoid dfs(int u, int cnt) {\n\n    // printf(\"dfs(%d, %d)\\n\", u, cnt);\n    st[u] = true;\n    path[cnt] = u;\n\n\n    if (cnt == n) {\n        for (int i = 1; i &lt;= n; i++) {\n            printf(\"%d \", path[i]);\n        }\n        printf(\"\\n\");\n        return;\n    }\n\n    for (int i = 1; i &lt;= n; i++) {\n        if (st[i] == false) {\n            dfs(i, cnt + 1);\n            st[i] = false;\n        }\n    }\n}\n\nint main()\n{\n    cin &gt;&gt; n;\n    for (int i = 1; i &lt;= n; i++) {\n        dfs(i, 1);\n        st[i] = false;\n    }\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#bfs","title":"BFS","text":"<p>\u5206\u6790\u641c\u7d22\u95ee\u9898\u4e3b\u8981\u9075\u5faa\u4ee5\u4e0b\u6b65\u9aa4\uff1a 1. \u5b9a\u4e49 fringe \u4f7f\u7528\u7684 \u6570\u636e\u7ed3\u6784 2. \u5c06\u5b9e\u9645\u95ee\u9898\u62bd\u8c61\u6210 \u4ee3\u7801\u4e2d\u7684 \u4e00\u4e2a\u72b6\u6001 3. \u5982\u4f55\u83b7\u53d6 \u6bcf\u4e00\u4e2a \u72b6\u6001\u7684 \u540e\u7eed\u72b6\u6001 4. \u5982\u4f55\u5224\u65ad \u72b6\u6001\u662f\u5426\u5904\u4e8e \u76ee\u6807\u72b6\u6001 5. \u6ce8\u610f\u4e0d\u8981\u56de\u6eaf \u8bb0\u5f55\u641c\u7d22\u72b6\u6001</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a844-bfs","title":"A844 BFS","text":"<p>\u4e0d\u80fd\u4f7f\u7528\u6570\u7ec4\u6765\u5b58\u53d6\u5bf9\u5e94\u8282\u70b9\u7684\u7236\u8282\u70b9\uff0c\u56e0\u4e3a\u53ef\u80fd\u5982\u679c\u540e\u7eed\u8282\u70b9\u53c8\u6269\u5c55\u4e86\u539f\u59cb\u8282\u70b9\uff0c \u90a3\u4e48\u6839\u636e\u6211\u4eec\u7684\u7b97\u6cd5\u903b\u8f91\uff0c \u539f\u59cb\u8282\u70b9\u7684\u7236\u8282\u70b9\u4e5f\u4f1a\u88ab\u66f4\u6539\u3002</p> <ul> <li> <p>\u5b9a\u4e49 fringe \u4f7f\u7528\u7684 \u6570\u636e\u7ed3\u6784</p> <p>queue</p> </li> <li> <p>\u5c06\u5b9e\u9645\u95ee\u9898\u62bd\u8c61\u6210 \u4ee3\u7801\u4e2d\u7684 \u4e00\u4e2a\u72b6\u6001 </p> <p>class Pair</p> </li> <li> <p>\u5982\u4f55\u83b7\u53d6 \u6bcf\u4e00\u4e2a \u72b6\u6001\u7684 \u540e\u7eed\u72b6\u6001</p> </li> </ul> <pre><code>int[] dx = {0, 1, 0, 1}, dy = {-1, 0, -1, 0};\nfor (int i = 0; i &lt; 4; i++) {\n  int nx = front.x + dx[i], ny = front.y + dy[i];\n  // check if (nx, ny) legal \n}\n</code></pre> <pre><code>#include &lt;stdio.h&gt;\n#define N 110\n\nint maze[N][N]; // maze[i][j] means the value in the row i, colunm j\nint d[N][N]; // means the path taken from pos(0, 0) to pos(i, j);\n\ntypedef struct {\n    int x, y;\n} node;\n\nnode q[N * N];\nint hh = 0, tt = -1;\n\nint dx[] = {-1, 0, 1, 0};\nint dy[] = {0, -1, 0, 1};\n\nint n, m;\n\n\nvoid bfs() \n{\n    memset(d, -1, sizeof d);\n\n    d[0][0] = 0; \n    node entry = {0, 0};\n    q[++tt] = entry;\n\n\n    while (hh &lt;= tt) \n    {\n        node top = q[hh++];\n\n        // printf(\"(%d %d)\\n\", top.x, top.y);\n\n        if (top.x == n - 1 &amp;&amp; top.y == m - 1) {\n            printf(\"%d\\n\", d[n - 1][m - 1]);\n            return;\n        }\n\n        for (int i = 0; i &lt;= 3; i++) {\n            int x = dx[i], y = dy[i];\n            node expand;\n            expand.x = top.x + x;\n            expand.y = top.y + y;\n\n            if (expand.x &gt;= 0 &amp;&amp; expand.x &lt;= n - 1 &amp;&amp; \\\n             expand.y &gt;= 0 &amp;&amp; expand.y &lt;= m - 1 &amp;&amp; \\\n             maze[expand.x][expand.y] == 0 &amp;&amp; d[expand.x][expand.y] == -1) {\n                // printf(\"enqueue(%d, %d), maze %d\\n\", expand.x, expand.y, maze[expand.x][expand.y]);\n                q[++tt] = expand;\n                d[expand.x][expand.y] = d[top.x][top.y] + 1;\n            } \n        }\n    }\n}\n\nint main(void)\n{\n    scanf(\"%d %d\", &amp;n, &amp;m);\n    for (int i = 0; i &lt; n; i++) {\n        for (int j = 0; j &lt; m; j++) {\n            scanf(\"%d\", &amp;maze[i][j]);\n        }\n    }\n\n    bfs();\n}\n</code></pre> <p>&lt;++&gt;</p> <ul> <li>\u5982\u4f55\u5224\u65ad \u72b6\u6001\u662f\u5426\u5904\u4e8e \u76ee\u6807\u72b6\u6001</li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a845","title":"A845 \u516b\u6570\u7801","text":"<p>bfs \u6c42 \u6700\u77ed\u8def\u5f84\u95ee\u9898\u9700\u8981\u6ce8\u610f\u4e24\u70b9 1. \u5982\u4f55\u5b58\u50a8 \u961f\u5217 2. \u5982\u4f55\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u72b6\u6001\u7684\u8ddd\u79bb (\u4e5f\u5c31\u662f \u8fd9\u4e2a\u8282\u70b9\u662f\u7b2c\u51e0\u5c42\u5c55\u5f00\u7684)</p> <ul> <li>\u72b6\u6001\u8868\u793a</li> <li>\u4f7f\u7528\u5b57\u7b26\u4e32\u6765\u8868\u793a\u6bcf\u4e00\u4e2a\u8282\u70b9\u7684\u72b6\u6001 \"123456X78\"</li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_14","title":"\u6811","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a846","title":"A846 \u6811\u7684\u91cd\u5fc3","text":"<p>\u4f55\u4e3a\u91cd\u5fc3\uff1a \u91cd\u5fc3\u662f\u6307\u6811\u4e2d\u7684\u4e00\u4e2a\u7ed3\u70b9\uff0c\u5982\u679c\u5c06\u8fd9\u4e2a\u70b9\u5220\u9664\u540e\uff0c\u5269\u4f59\u5404\u4e2a\u8fde\u901a\u5757\u4e2d\u70b9\u6570\u7684\u6700\u5927\u503c\u6700\u5c0f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8282\u70b9\u88ab\u79f0\u4e3a\u6811\u7684\u91cd\u5fc3</p> <p>\u901a\u4fd7\u7684\u6765\u8bb2\uff0c\u5c31\u662f\u5220\u9664\u6811\u4e2d\u7684\u67d0\u4e00\u4e2a\u8282\u70b9\u540e\uff0c\u4f1a\u4ea7\u751f\u8bb8\u591a\u8fde\u901a\u5206\u91cf;  \u5982\u679c\u8fd9\u4e2a\u8282\u70b9\u662f\u91cd\u5fc3\u7684\u8bdd\uff0c\u8fde\u901a\u5206\u91cf\u7684\u6700\u5927\u503c\u6700\u5c0f\u3002</p> <p>\u53ef\u4ee5\u7528 dfs \u7684\u65b9\u5f0f\u6765\u7edf\u8ba1</p> <p>dfs \u7684 \u6a21\u677f\u5982\u4e0b</p> <pre><code>int dfs(int u) {\n    st[u] = true;\n    for (int j = h[u]; j != -1; j = ne[j]) {\n        int i = e[j];\n        if (!st[i]) {\n            dfs(i);\n            // \u53ef\u4ee5\u5728\u8fd9\u91cc\u5bf9 dfs \u5f97\u5230\u7684\u7ed3\u679c\u5904\u7406\n        }\n    }\n}\n</code></pre> <p>\u5728\u672c\u9898\u4e2d\uff0c dfs(u) \u662f\u7528\u6765\u5bfb\u627e \u4ee5\u8282\u70b9 u \u4e3a\u6839\u7684\u6240\u6709\u5b50\u6811\u7684 \u8282\u70b9 \u7684\u6570\u91cf\u3002</p> <p>dfs \u5c31\u548c dp \u7c7b\u4f3c\uff0c\u8981\u641e\u6e05\u695a\u4e0d\u540c\u7684 dfs \u5728\u4e0d\u540c\u9898\u76ee\u4e0b\u7684\u542b\u610f\u662f\u4ec0\u4e48\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_15","title":"\u6811\u7684\u5c42\u6b21\u904d\u5386","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_16","title":"\u62d3\u6251\u6392\u5e8f","text":"<p>\u6709\u5173\u56fe\u7684\u6027\u8d28</p> <ul> <li>\u6709\u5411\u65e0\u73af\u56fe\u4e00\u5b9a\u80fd\u591f\u627e\u5230\u4e00\u6761\u62d3\u6251\u5e8f\u5217</li> <li>\u6709\u73af\u56fe\u4e0d\u5b58\u5728\u62d3\u6251\u5e8f\u5217</li> </ul> <p>\u6240\u4ee5 \u62d3\u6251\u6392\u5e8f\u53ef\u4ee5\u68c0\u6d4b \u73af\u8def</p> <p>\u62d3\u6251\u6392\u5e8f\u7b97\u6cd5\u6b65\u9aa4:</p> \\[ \\begin{align*}   &amp;\\text{Init queue\uff0c\u5c06\u4e34\u754c\u8868\u4e2d\u6240\u6709\u5165\u5ea6\u4e3a0\u7684\u70b9\u52a0\u5165\u961f\u5217} \\\\   &amp; \\text{while queue not empty: } \\\\   &amp; \\qquad  \\text{front = queue.poll()}   \\\\    &amp; \\qquad  for \\text{ edge (front, j) } in \\text{ graph[front] } \\\\    &amp; \\qquad \\qquad del \\, (\\text { front, j })  \\\\    &amp; \\qquad \\qquad if \\text { degree[j] } == 0 \\\\    &amp; \\qquad \\qquad \\qquad \\text{ queue.enque(j) } \\\\  \\end{align*} \\] <p>\u89e3\u9898\u9700\u8981\u4f7f\u7528\u5230\u90bb\u63a5\u8868\uff0c\u7531\u4e8e\u5b98\u65b9\u63d0\u4f9b\u7684stl\u5e93\u6548\u7387\u4e0d\u662f\u5f88\u9ad8\u3002 \u6211\u4eec\u8003\u8651\u7528\u6570\u7ec4\u6765\u6a21\u62df\u90bb\u63a5\u8868\u3002</p> <pre><code>int h[N]; // \u8be5\u6570\u7ec4\u50a8\u5b58\u5934\u8282\u70b9\u3002h[i] \u53ef\u4ee5\u7406\u89e3\u4e3a \u8282\u70b9 i \u5728\u90bb\u63a5\u8868\u4e2d \u6240\u5bf9\u5e94\u7684 \u90a3\u4e00\u6761\u94fe\u8868\u7684 \u5934\u8282\u70b9\nint e[N], ne[N], idx; // \u8001\u670b\u53cb\u4e86\uff0c\u53c2\u89c1\u5355\u94fe\u8868\nint d[N]; // \u8be5\u6570\u7ec4\u50a8\u5b58\u8282\u70b9\u7684\u5165\u5ea6\u3002d[i] \u53ef\u4ee5\u7406\u89e3\u4e3a \u7b2c i \u4e2a\u8282\u70b9\u7684 \u5165\u5ea6\u4e3a d[i]\nint q[N];\n\n// \u6a21\u62df\u90bb\u63a5\u94fe\u8868 \nstatic void add(int a, int b, int c) {\n  e[idx] = b; // idx.e = b\n  ne[idx] = h[a]; // \u4ee4 idx.next = a.head;\n  h[a] = idx++; // update a.head = idx;\n}\n</code></pre> <p>\u6838\u5fc3\u4ee3\u7801</p> <p><pre><code> static void tsort(int n) {\n    for (int i = 1; i &lt;= n; i++) {\n      if (d[i] == 0) {\n        q[++tt] = i;\n      }\n    }\n\n    while (hh &lt;= tt) {\n      int front = q[hh++];\n\n      for (int i = h[front]; i != -1; i = ne[i]) {\n        int j = e[i]; // \u5e76\u4e0d\u771f\u7684\u9700\u8981\u4ece\u94fe\u8868\u4e2d\u628a\u6570\u5220\u9664\n        d[j]--;\n        if (d[j] == 0) {\n          q[++tt] = j;\n        }\n      }\n    }\n\n    if (tt == n - 1) {\n      for (int i = 0; i &lt; n; i++) {\n        System.out.println(q[i] + \" \");\n      }\n    } else {\n      System.out.println(\"-1\");\n    }\n\n  }\n</code></pre> \u6a21\u677f\u6613\u9519\u70b9</p> <ol> <li>\u6ca1\u6709\u521d\u59cb\u5316\u5934\u7ed3\u70b9\u6570\u7ec4 <code>h[N]</code> </li> <li>\u4f7f\u7528\u6570\u7ec4\u6a21\u62df\u961f\u5217\u65f6\uff0c\u6ca1\u6709\u6b63\u786e\u5bf9 <code>hh</code> \u548c <code>tt</code> \u8d4b\u503c</li> <li>\u4f7f\u7528 \u4f18\u5148\u961f\u5217 \u65f6\uff0c\u6ce8\u610f\u4f7f\u7528\u5934\u6587\u4ef6 <code>queue</code> \u3002<code>greater</code> \u662f\u5c0f\u6839\u5806\uff0c<code>less</code> \u662f\u5927\u6839\u5806</li> <li>\u6ca1\u80fd\u7406\u89e3 \u6570\u7ec4\u6a21\u62df\u94fe\u63a5\u94fe\u8868\u7684 \u5185\u6db5\u3002(\u8bf7\u53c2\u89c1\u4e0a\u6587) </li> <li>\u6ca1\u80fd\u7406\u89e3 N, M\u3002\u6709\u5173\u56fe\u8282\u70b9\u7684\u6570\u7ec4\u521d\u59cb\u5316\u5927\u5c0f\u4e3a N\uff0c \u6709\u5173\u94fe\u63a5\u94fe\u8868\u8282\u70b9\u5927\u5c0f\u521d\u59cb\u5316\u4e3a M</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dijkstra","title":"Dijkstra","text":"<p>\u9002\u7528\u6761\u4ef6 </p> <p>\u8fea\u6770\u65af\u7279\u62c9\u7b97\u6cd5\u9002\u7528\u4e8e\u6c42\u6b63\u6743\u6709\u5411\u56fe\u4e2d\uff0c\u6e90\u70b9\u5230\u5176\u4f59\u5404\u4e2a\u8282\u70b9\u7684\u6700\u77ed\u8def\u5f84\u3002\u6ce8\u610f\uff1a\u56fe\u4e2d\u53ef\u4ee5\u6709\u73af\uff0c\u4f46\u4e0d\u80fd\u6709\u8d1f\u6743\u8fb9</p> <p></p> <p>\u7b97\u6cd5\u601d\u8def\uff1a</p> \\[ \\begin{align*}   &amp;\\text{dist[1]} = 0, \\text{dist[i]} = +\\infty  \\\\   &amp; for  \\text{ i }  in  \\text{ 1 .. n }   \\\\    &amp; \\qquad \\text{find node \\textbf{t}  that has minimum distance and not visited in dist array}  \\\\    &amp; \\qquad \\text{ set visited[t] } = \\text{true}  \\\\    &amp; \\qquad \\text { update weight for node that t can traverse to }\\\\  \\end{align*} \\]"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a849","title":"\u6734\u7d20\u7248 A849","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a850","title":"\u5806\u4f18\u5316 A850","text":"<pre><code>  // \u9057\u5fd8\n  static void add(int a, int b, int c) {\n    e[idx] = b; // idx.e = b\n    ne[idx] = h[a]; // \u4ee4 idx.next = a.head;\n    w[idx] = c;\n\n    h[a] = idx++; // update a.head = idx;\n  }\n</code></pre> <pre><code>  static int dijkstra() {\n\n    Queue&lt;int[]&gt; q = new PriorityQueue&lt;int[]&gt;(n, (a, b) -&gt; {\n      return a[1] - b[1];\n    });\n\n    Arrays.fill(dist, INF);\n    q.offer(new int[] { 1, 0 });\n    // init for head;\n\n    while (q.size() &gt; 0) {\n      int[] t = q.poll();\n      int ver = t[0];\n      int dis = t[1];\n      st[ver] = true;\n\n      for (int j = h[ver]; j != -1; j = ne[j]) { // h[i] \u7684\u542b\u4e49\u6ca1\u6709\u7406\u89e3\u900f\u5f7b \u904d\u5386\u90bb\u63a5\u8868\n        int node = e[j];\n        if (dist[node] &gt; dis + w[j]) { // \u4f1a \u6ea2\u51fa\n\n          // System.out.printf(\"dist[%d] = %d &gt; t.dist = %d + w[%d] = %d\\n\", node,\n          //     dist[node], dis, j, w[j]);\n\n          dist[node] = dis + w[j];\n          q.offer(new int[] { node, dist[node] });\n        }\n      }\n    }\n\n    return dist[n] == INF ? -1 : dist[n];\n\n  }\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#spfa","title":"spfa","text":"<p>\u7b97\u6cd5\u601d\u8def\uff1a</p> \\[ \\begin{align*}   &amp;\\text{dist[1]} = 0, \\text{dist[i]} = +\\infty, \\text{queue.enqueue(1)}, \\text{st}[1] = 1    \\\\   &amp; for  \\text{ i }  in  \\text{ 1 .. n }   \\\\    &amp; \\qquad \\text{\u53d6\u5bf9\u5934\u5143\u7d20}  \\\\    &amp; \\qquad \\text { update weight for node that t can traverse to }\\\\    &amp; \\qquad \\qquad \\text{if update, enqueue and mark}   \\\\  \\end{align*} \\]"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#1488","title":"1488 \u6700\u77ed\u8ddd\u79bb","text":"<p>dijkstra \u7b97\u6cd5\u662f\u6c42\u4e00\u4e2a\u70b9 \u5230 \u5176\u4ed6\u6240\u6709\u70b9\u7684\u6700\u77ed\u8ddd\u79bb\u3002</p> <p>\u672c\u9898\u662f \u6c42\u6240\u6709\u70b9\u5230 \u5230 k \u4e2a\u5546\u5e97\u7684\u6700\u77ed\u8ddd\u79bb\u3002</p> <p>\u5c06\u8fd9\u4e2a k \u4e2a\u5546\u5e97 \u5408\u5e76\u6210\u4e00\u4e2a\u70b9\uff0c\u5c31\u53ef\u4ee5\u8f6c\u5316\u4e3a dijkstra \u95ee\u9898\u3002</p> <p></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#854-floyd","title":"854 floyd \u6c42\u6700\u77ed\u8def","text":"<ol> <li>\u521d\u59cb\u5316\uff0c\u5bf9\u89d2\u7ebf := 0, \u5176\u4ed6 := INF</li> <li>\u8bfb\u53d6 \u8fb9\u957f\uff0c\u6ce8\u610f\u6709\u91cd\u8fb9</li> <li>\u6c42\u6700\u5c0f\u503c<ul> <li>\u6ce8\u610f k \u5728\u5916\u5c42\u5faa\u73af</li> <li>\u66f4\u65b0\u601d\u8def\u4e3a\uff1a\u76f4\u63a5\u4ece \u8282\u70b9 i \u5230 \u8282\u70b9 j \u4f1a\u6bd4 \u501f\u52a9 \u8282\u70b9 k \u5230\u8282\u70b9 j \u66f4\u5212\u7b97\u5417 (i -&gt; j compared with i-&gt;k-&gt;j)\uff1f</li> </ul> </li> </ol> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\n#define N 210\n#define INF 0x3f3f3f3f\n\nint g[N][N];\n\nint n, m, k;\n\nvoid floyd()\n{\n    for (int k = 1; k &lt;= n; k++) {\n        for (int i = 1; i &lt;= n; i++) {\n            for (int j = 1; j &lt;= n; j++) {\n                if (g[i][j] &gt; g[i][k] + g[k][j]) {\n                    g[i][j] = g[i][k] + g[k][j];\n                }\n            }\n        }\n    }\n}\n\nint main()\n{\n\n    // \u521d\u59cb\u5316\uff0c\u5bf9\u89d2\u7ebf := 0, \u5176\u4ed6 := INF\n    memset(g, 0x3f, sizeof g);\n    scanf(\"%d %d %d\", &amp;n, &amp;m, &amp;k);\n    for (int i = 1; i &lt;= n; i++) \n        for (int j = 1; j &lt;= n; j++)\n            if (i == j) \n                g[i][j] = 0;\n\n    // \u8bfb\u53d6 \u8fb9\u957f\uff0c\u6ce8\u610f\u6709\u91cd\u8fb9\n    while (m--)\n    {\n        int x, y, z;\n        scanf(\"%d %d %d\", &amp;x, &amp;y, &amp;z);\n        g[x][y] = g[x][y] &lt; z ? g[x][y]: z; \n    }\n\n    // \u6c42\u6700\u5c0f\u503c\n    floyd();\n\n    // \u8bfb\u53d6\u8be2\u95ee\n    while(k--)\n    {\n        int x, y;\n        scanf(\"%d %d\", &amp;x, &amp;y);\n        if (g[x][y] &lt;= INF / 2) \n            printf(\"%d\\n\", g[x][y]);\n        else \n            printf(\"impossible\\n\");\n    }\n\n    return 0;\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_17","title":"\u6700\u5c0f\u751f\u6210\u6811","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#858-prim","title":"858 Prim \u7b97\u6cd5","text":"<ol> <li> <p>\u521d\u59cb\u5316 dist (\\(\\infty\\)), state (0), pre (-1); </p> <ul> <li>dist[i] \u8868\u793a\u8282\u70b9 <code>i</code> \u8ddd\u79bb\u8fde\u901a\u90e8\u5206\u7684\u8ddd\u79bb\u4e3a <code>dist[i]</code>\u3002\u4ec5\u5f53 <code>state[i]</code> \u4e3a0\u65f6\u6709\u610f\u4e49</li> <li>state[i] \u8868\u793a\u8282\u70b9 <code>i</code> \u7684\u72b6\u6001\u4e3a state[i] (0 \u8868\u793a\u8fd8\u672a\u8fde\u901a)</li> <li>pre[i] \u8868\u793a\u8282\u70b9 <code>i</code> \u4e0e \u8282\u70b9 <code>pre[i]</code> \u76f8\u8fde\u3002</li> </ul> </li> <li> <p>\u5c06 \u8282\u70b9 1 \u52a0\u5165 \u8fde\u901a\u96c6\u5408 (dist[1] = 0, state[1] = 1);</p> </li> <li>\u5faa\u73af </li> </ol> \\[ \\begin{align*}   &amp; for  \\text{ i }  in  \\text{ 1 .. n }   \\\\    &amp; \\qquad \\text{find the closet node \\textbf{t} to the connected region (and not connected)}  \\\\    &amp; \\qquad \\text{ set state[t] } = \\text{true}  \\\\    &amp; \\qquad \\text { update pre and dist array for node that t can traverse to }\\\\  \\end{align*} \\] <p>\u6ce8\u610f \u65e0\u5411\u8fb9\uff0c\u6709\u5411\u8fb9\u3002 \u56e0\u4e3a \u5355\u5411\u8fde\u63a5\u4e0d\u7b97\u8fde\u901a\u7684\u3002</p> <p> <pre><code>void prim()\n{\n    dist[1] = 0;\n    // state[1] = true;\n\n    for (int i = 1; i &lt;= n; i++) \n    {\n        // check point \n        int minn = -1, minw = INF;\n        for (int j = 1; j &lt;= n; j++) \n        {\n            if (state[j] == false &amp;&amp; dist[j] &lt; minw) \n            {\n                minw = dist[j];\n                minn = j;\n            }\n        }\n\n        // printf(\"choose node %d with wight %d\\n\", minn, minw);\n\n        state[minn] = true;\n\n        //check point: update\n        for (int j = 1; j &lt;= n; j++) \n        {\n            if (g[minn][j] != INF &amp;&amp; state[j] == false &amp;&amp; dist[j] &gt; g[minn][j]) // == &amp; !=\n            {\n                //printf(\"updateing node= %d w= %d pre= %d\\n\", j, g[minn][j], minn);\n                dist[j] = g[minn][j];\n                pre[j] = minn;\n            }\n        }\n    }\n}\n</code></pre></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dynamic-programming","title":"Dynamic Programming","text":"<p>\u52a8\u6001\u89c4\u5212\u5206\u6790\u6b65\u9aa4 </p> <ol> <li>Define Objective function</li> <li>Identify base cases</li> <li>Write down a recurrence relation for the optimized Objective function</li> <li>What is the order of exeution</li> <li>where to look for answear</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_18","title":"\u80cc\u5305\u95ee\u9898","text":"<p>\u6709\u9650\u96c6\u5408\u627e\u6700\u503c</p> <ol> <li>\u72b6\u6001\u8868\u793a (Objective function) f(i, j) </li> <li>\u96c6\u5408 \u6700\u4e3b\u8981\u662f\u628a\u76ee\u6807\u51fd\u6570\u7684\u96c6\u5408\u8868\u793a\u51fa\u6765\uff0c\u7136\u540e\u518d\u8003\u8651\u5212\u5206</li> <li>\u5c5e\u6027</li> <li>\u72b6\u6001\u8ba1\u7b97</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#01","title":"01 \u80cc\u5305\u95ee\u9898","text":"\\[ \\begin{align*}     f(i, j) = \\underset{0 \\le  k \\le  \\text{min}(1,  j / v[j]) }{\\text{max} } (f( i-1, v - k * v[i] ) + k * w[i]) \\end{align*} \\]"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_19","title":"\u5b8c\u5168\u80cc\u5305\u95ee\u9898","text":"<p>\u6734\u7d20\u89e3\u6cd5 1. Define Objective function</p> <pre><code>f[n][volume] \u4ece1\u5230n\u4e2a\u7269\u54c1\u9009\uff0c\u4f7f\u5f97\u80cc\u5305\u4f53\u79ef\u5c0f\u4e8e\u7b49\u4e8evolume\uff0c\u6240\u80fd\u8fbe\u5230\u7684\u6700\u5927\u4ef7\u503c\n</code></pre> <ol> <li> <p>Identify base cases</p> <p>f[0][0] = 0,</p> </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> </li> </ol> \\[ \\begin{align*}   f(i, j) = \\underset{0 \\le  k \\le  j / v[j]}{\\text{max} } (f[i-1][v - k * v[i]] + k * w[i]) \\end{align*} \\] <ol> <li> <p>What is the order of exeution</p> <p>Down to Top</p> </li> <li> <p>where to look for answear</p> <p>f[n][v]</p> </li> </ol> <p></p> <p>\u4f18\u5316\u89e3\u6cd5 1. Define Objective function</p> <pre><code>f[volume] \u80cc\u5305\u4f53\u79ef\u5c0f\u4e8e\u7b49\u4e8evolume\u65f6\uff0c\u6240\u80fd\u8fbe\u5230\u7684\u6700\u5927\u4ef7\u503c\n</code></pre> <ol> <li> <p>Identify base cases</p> <p>f[0] = 0, 3. Write down a recurrence relation for the optimized Objective function</p> </li> </ol> <p>\u6211\u4eec\u5df2\u77e5 (\\(v\\) \u6307\u4ee3 \\(v_i\\)\uff0c\\(w\\) \u6307\u5411 \\(w_i\\)) $$</p> <p>\\begin{align}   f(i, j) &amp;= \\underset{0 \\le  k \\le  j / v[j]}{\\text{max} } (f[i-1][v - k * v[i]] + k * w[i]) \\       &amp;= \\text{max} (f(i-1, j), f(i-1, j - v) + w, \\            &amp; \\qquad \\qquad f(i-1, j - 2\\cdot v) + 2\\cdot w, \\cdots , f(i-1, j - k\\cdot v) + k\\cdot w) \\ \\end{align} $$</p> <p>\u53c8\u56e0\u4e3a\u6709</p> \\[ \\begin{align*}   f(i, j - v) &amp;= max(f(i-1, j - v) , \\\\            &amp; f(i-1, j - 2\\cdot v) + w, \\cdots , f(i-1, j - k\\cdot v) + (k - 1)\\cdot w) \\\\ \\end{align*} \\] <p>\u4f7f\u7528 \\(f(i, j - v)\\) \u8fdb\u884c\u53d8\u91cf\u4ee3\u6362\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5316\u7b80\u5f0f</p> <p>$$ \\begin{align}   f(i, j ) &amp;= max(f(i-1, j), f(i, j - v) + w) \\end{align} $$ 4. What is the order of exeution</p> <pre><code>Down to Top\n</code></pre> <ol> <li> <p>where to look for answear</p> <p>f[v]</p> </li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_20","title":"\u591a\u91cd\u80cc\u5305\u95ee\u9898","text":"<p>\u6700\u521d\u65e0\u6cd5\u7406\u89e3 \u5982\u4f55\u5224\u65ad\u67d0\u4e00\u4e2a\u7269\u54c1\u6709\u6ca1\u6709\u4f7f\u7528\u5b8c</p> <p>\u6700\u540e\u53d1\u73b0\u5b8c\u5168\u4e0d\u9700\u8981\u5224\u65ad\uff0c\u6700\u91cc\u5c42\u7684\u5faa\u73af (k), \u5df2\u7ecf\u904d\u5386\u4e86\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\uff0c\u4e0d\u518d\u9700\u8981\u5355\u72ec\u8ddf\u8e2a\u3002</p> <p>\u4e3e\u4e00\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe n = 1, v = 2 \u65f6\uff0c\u4ea7\u751f\u6700\u5927\u4ef7\u503c\u7684 k \u7b49\u4e8e aa, \u800c\u6211\u4eec\u4e00\u5171\u6709bb \u4e2a\u7269\u54c1 1, \u90a3\u4e48\u505a\u4e86\u4e0a\u8ff0\u51b3\u7b56\u540e\uff0c  \u5269\u4e0b\u7684\u7269\u54c11\u6709 bb - aa\u4e2a\u3002\u800c bb - aa \u8fd9\u4e2a\u503c\u5bf9\u6211\u4eec\u7684\u540e\u7eed\u51b3\u7b56\u5b8c\u5168\u6ca1\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u8bb0\u5f55\uff0c\u6211\u4eec\u7684\u9009\u62e9\u5bf9\u7269\u54c1\u4e2a\u6570\u7684\u5f71\u54cd\u3002</p> <p>\u6734\u7d20\u89e3\u6cd5 1. Define Objective function</p> <pre><code>f[n][volume] \u4ece1\u5230n\u4e2a\u7269\u54c1\u9009\uff0c\u4f7f\u5f97\u80cc\u5305\u4f53\u79ef\u5c0f\u4e8e\u7b49\u4e8evolume\uff0c\u6240\u80fd\u8fbe\u5230\u7684\u6700\u5927\u4ef7\u503c\n</code></pre> <ol> <li> <p>Identify base cases</p> <p>f[0][0] = 0,</p> </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> </li> </ol> \\[ f[i][j] = \\underset{0 \\le  k \\le  \\text{min}(j / v[i], s[i])}{\\text{max} } (f[i-1][v - k * v[i]] + k * w[i]) % k from 0 to v / k \\] <ol> <li> <p>What is the order of exeution</p> <p>Down to Top</p> </li> <li> <p>where to look for answear</p> <p>f[n][v]</p> </li> </ol> <p>\u4e8c\u8fdb\u5236\u4f18\u5316</p> <p>\u5c06\u6bcf\u4e00\u4e2a\u7269\u54c1\u6309\u7167 \u4e8c\u8fdb\u5236 \u62c6\u5206, \u6bd4\u5982\u5047\u8bbe i \u7269\u54c1 \u6709 10\u4e2a</p> <p>\u90a3\u4e48 s[i] = 1 + 2 + 4 + 3; \u5c06 10 i \u7269\u54c1\uff0c\u62c6\u5206\u62104\u7ec4\u65b0\u7269\u54c1 </p> <pre><code>for (int i = 1; i &lt;= n; i++) {\n    for (int t = 1; (s[i] - t) &gt; 0; t *= 2){\n        goods.push_back({v[i] * t, w[i] * t});\n        s[i] -= t;\n    }\n    goods.push_back({v[i] * s[i], w[i] * s[i]});\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_21","title":"\u5206\u7ec4\u80cc\u5305\u95ee\u9898","text":"<p>\u5904\u7406\u65b9\u5f0f\u548c \u591a\u91cd\u80cc\u5305\u95ee\u9898 \u4e00\u6a21\u4e00\u6837 </p> <p></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_22","title":"\u6574\u6570\u62c6\u5206","text":"<p> \u9519\u8bef\u89e3\u6cd5  </p> <ul> <li> <p>Define Objective function</p> <p>\\(f(n)\\) \u6574\u6570n \u6700\u591a\u6709\u591a\u5c11\u79cd\u62c6\u5206\u65b9\u5f0f  - Identify base cases</p> <p>\\(f(0) = 0\\), \\(f(1) = 1\\) - Write down a recurrence relation for the optimized Objective function</p> <p>\\(f(n) = \\sum (f(n - 2^0) + f(n - 2^1) + \\cdots + f(n - 2^k))\\), \u5176\u4e2d \\(k = \\lfloor \\log2 (n) \\rfloor\\)  - What is the order of execution</p> <p>bottom to top  - where to look for answer</p> <p>\\(f(n)\\) </p> </li> </ul> <p> \u6b63\u786e\u89e3\u6cd5 </p> <ul> <li> <p>Define Objective function</p> <p>f(i, j) \u5728\u524di\u4e2a\u7269\u54c1\u91cc\u9009\uff0c\u4f7f\u5f97\u4f53\u79ef\u6070\u597d\u4e3a j \u7684\u65b9\u6cd5\u6570  - Identify base cases</p> <p>f[0][0] = 1 - Write down a recurrence relation for the optimized Objective function</p> </li> </ul> \\[ f(i, j) = \\underset{0 \\le m \\le j / v[i]}{\\text{sum}} f(i - 1, j - m * v[i]) \\] <ul> <li> <p>What is the order of execution</p> <p>Bottom to Top - where to look for answer</p> <p>f[m][n] \u5176\u4e2d \\(m = \\lfloor \\log2 (n) \\rfloor\\)</p> </li> </ul> <p> \u65f6\u95f4\u4f18\u5316  </p> <p>\u6211\u4eec\u5df2\u77e5 (\\(v\\) \u6307\u4ee3 \\(v_i\\))</p> <p>$$</p> <p>\\begin{align*}   f(i, j) &amp;= \\sum (f[i-1][v - k * v[i]]) \\       &amp;= (f(i-1, j) + f(i-1, j - v) + \\            &amp; \\qquad \\qquad f(i-1, j - 2\\cdot v) +  \\cdots ) \\</p> <p>\\end{align*} $$</p> <p>\u53c8\u56e0\u4e3a\u6709</p> <p>$$</p> <p>\\begin{align}   f(i, j - v) &amp;= (f(i-1, j - v) + f(i-1, j - 2v) +  \\            &amp; \\qquad \\qquad f(i-1, j - 2\\cdot v) +  \\cdots ) \\</p> <p>\\end{align*}</p> <p>$$</p> <p>\u4f7f\u7528 \\(f(i, j - v)\\) \u8fdb\u884c\u53d8\u91cf\u4ee3\u6362\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5316\u7b80\u5f0f</p> \\[ \\begin{align*}   f(i, j) &amp;= f(i-1, j) + f(i, j - v)  \\end{align*} \\] <p> \u7a7a\u95f4\u4f18\u5316  </p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06 <code>f(i, j) = f(i - 1, j) + f(i, j - v)</code> \u4f18\u5316\u4e3a <code>f(j) = f(j) + f(j - v)</code>\u3002 \u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u662f\u4ece\u5c0f\u5230\u5927\u904d\u5386 \u4f53\u79ef\u7684\uff0c\u5728\u8ba1\u7b97<code>f(j)</code> \u65f6, <code>f(j - v)</code> \u5df2\u7ecf\u88ab\u66f4\u65b0\uff0c\u6240\u4ee5 \u5728\u66f4\u65b0 <code>f(j)</code> \u524d\uff0c <code>f(j)</code> \u662f\u4e0a\u4e00\u5c42\u7684<code>j</code> (\u5373 <code>i-1</code> \u5c42), <code>f(j- v)</code> \u5df2\u7ecf\u88ab\u8986\u76d6\u4e86\uff0c\u662f\u5f53\u524d\u5c42(\u5373\u7b2c <code>i</code> \u5c42)\u7684 <code>j - v</code>\u3002</p> <p>\u7531\u6b64\u6211\u4eec\u53d1\u73b0\uff0c\u4f18\u5316\u524d\u548c\u4f18\u5316\u540e\uff0c\u4e24\u4e2a\u8868\u8fbe\u5f0f\u662f\u5b8c\u5168\u7b49\u4ef7\u7684\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_23","title":"\u603b\u7ed3","text":"<p>\u80cc\u5305\u7684\u9002\u7528\u573a\u666f\uff1a \u6709\u9650\u5236\u7684\u9009\u62e9\u95ee\u9898</p> <ul> <li>01 \u80cc\u5305\u95ee\u9898 &lt;--&gt; \u591a\u91cd\u80cc\u5305\u95ee\u9898 &lt;--&gt; \u5206\u7ec4\u80cc\u5305\u95ee\u9898</li> <li>\u5b8c\u5168\u80cc\u5305\u95ee\u9898 </li> </ul> <p></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dp","title":"\u7ebf\u6027 dp","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a898","title":"A898 \u6570\u5b57\u4e09\u89d2\u5f62","text":"<p>\u8def\u5f84\u95ee\u9898\uff0c\u72b6\u6001\u8868\u793a\u4e00\u822c\u90fd\u7528 \u5750\u6807</p> <ul> <li> <p>Define Objective function</p> <p>f(i, j), \u4ee5 \u5750\u6807(1, 1) \u4e3a\u8d77\u70b9\uff0c(i, j) \u4e3a\u7ec8\u70b9\u7684\u8def\u5f84\u6700\u5927\u503c - Identify base cases</p> \\[ f(i,j ) = \\begin{cases}    0 &amp;\\qquad i = 0, j = 0  \\\\    -\\infty &amp;\\qquad other \\end{cases} \\] </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> </li> </ul> \\[ f(i, j) = \\text{max}(f(i - 1, j - 1), f(i - 1, j)) \\] <ul> <li> <p>What is the order of execution</p> <p>Down to Top  - where to look for answer</p> </li> </ul> <p>$$   \\underset{1 \\le k \\le n}{\\text{max} } (f(n, k));   $$</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a895","title":"A895 \u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217","text":"<ul> <li> <p>Define Objective function</p> <p>f(i), \u4ee5\u7b2ci\u4e2a\u6570\u7ed3\u5c3e\u7684\u5355\u8c03\u9012\u589e\u5b50\u5e8f\u5217 \uff08\u4e2a\u6570\uff09  - Identify base cases</p> <p>\\(f(i) = 1 \\quad (1 \\le i \\le n)\\)  - Write down a recurrence relation for the optimized Objective function</p> </li> </ul> \\[ f(i) = \\begin{cases}    \\text{max} (f(i), f(j) + 1) &amp;\\quad a[i] &gt; a[j], 1 \\le j &lt; i  \\\\    f(i) &amp;\\quad otherwise \\end{cases} \\] <ul> <li>What is the order of execution</li> <li>where to look for answer</li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a897","title":"A897 \u6700\u957f\u516c\u5171\u5b50\u5e8f\u5217","text":"<p>\u96be\u70b9\uff1a\u4e0d\u592a\u597d\u8fdb\u884c \u72b6\u6001\u8868\u793a</p> <ul> <li> <p>Define Objective function</p> <p>f(i, j) \u8868\u793a A[1 \\(\\sim\\) i], B[1 \\(\\sim\\) j] \u7684\u6700\u5927\u516c\u5171\u5b50\u5e8f\u5217\u96c6\u5408  - Identify base cases</p> <p>f(0, 0) = 0 - Write down a recurrence relation for the optimized Objective function</p> </li> </ul> \\[ f(i, j) = \\begin{cases} \\text{max} (f(i - 1, j), f(i, j - 1), f(i - 1, j - 1) + 1) &amp; \\quad a[i] == b[j] \\\\ \\text{max} (f(i -1, j), f(i, j - 1))   &amp;  otherwise \\\\  \\end{cases} \\] <ul> <li> <p>What is the order of execution</p> <p>Down to Top  - where to look for answer</p> <p>f(n, m)</p> </li> </ul> <p>\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u89e3\u91ca\uff1a \u96c6\u5408\u5212\u5206\u65b9\u5f0f\uff1a \u6839\u636e\u4e24\u4e2a\u5b57\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u6765\u5212\u5206 </p> <p>\u82e5 a[i] == b[i], \u90a3\u4e48\u7531 A[i], B[j] \u6784\u6210\u7684 \u516c\u5171\u5b50\u5e8f\u5217\u5fc5\u5b9a\u5305\u542b a[i] \u4e0e b[i], \u95ee\u9898\u5c31\u8f6c\u5316\u4e3a \u6c42 f(i -1, j -1) \u7684\u6700\u957f\u516c\u5171\u5b50\u5e8f\u5217</p> <p>\u82e5 a[i] != b[i], \u90a3\u4e48\u4e24\u4e2a\u5b57\u7b26\u91cc\u9762\u4e00\u5b9a\u6709\u4e00\u4e2a\u53ef\u4ee5\u629b\u5f03\u7684\uff0c\u53ef\u4ee5\u5bf9 f(i -1, j), f(i, j -1) \u4e24\u79cd\u72b6\u6001\u53d6 max \u6765\u8f6c\u79fb </p> <pre><code>int main()\n{\n    int n, m;\n    cin &gt;&gt; n &gt;&gt; m;\n    for (int i = 1; i &lt;= n; i++) {\n        cin &gt;&gt; a[i];\n    }\n    getchar();\n    for (int i = 1; i &lt;= m; i++) {\n        cin &gt;&gt; b[i];\n    }\n\n    for (int i = 1; i &lt;= n; i++) {\n        for (int j = 1; j &lt;= m; j++) {\n            f[i][j] = max(f[i - 1][j], f[i][j - 1]);\n            if (a[i] == b[j]) f[i][j] = max(f[i - 1][j - 1] + 1, f[i][j]);\n        }\n    }\n\n    cout &lt;&lt; f[n][m];\n\n    return 0;\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a899","title":"A899 \u7f16\u8f91\u8ddd\u79bb","text":"<p>\u96be\u70b9\uff1a\u72b6\u6001\u8868\u793a\u96be\u4ee5\u60f3\u5230\u3002 \u96be\u4ee5\u5199\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff0c\u4e0d\u77e5\u9053\u5982\u4f55\u5212\u5206\u96c6\u5408</p> <p>\u96c6\u5408\u5212\u5206\u65b9\u5f0f\uff1a - Define Objective function</p> <pre><code>f(i, j) \u8868\u793a \u5c06 A[1 $\\sim$ i] \u53d8\u4e3a B[1 $\\sim$ j] \u6240\u9700\u8981\u7684\u6700\u5c11\u6b65\u9aa4\uff0c\n\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u7ecf\u8fc7 f(i, j)\u6b65\u9aa4\u540e\uff0cA[1 .. i] \u5df2\u7ecf\u548c B[1 .. j] \u5b8c\u5168\u4e00\u6837\n</code></pre> <ul> <li>Identify base cases</li> </ul> \\[ f(i, 0) = i \\qquad (1 \\le i \\le n) \\\\ f(0, j) = j \\qquad (1 \\le j \\le m) \\] <ul> <li>Write down a recurrence relation for the optimized Objective function</li> </ul> \\[ f(i, j) = \\begin{cases} \\text{min} (f(i - 1, j) + 1, f(i, j - 1) + 1, f(i - 1, j - 1) + 1) &amp; \\quad a[i] != b[j] \\\\ \\text{min} (f(i - 1, j) + 1, f(i, j - 1) + 1, f(i - 1, j - 1) + 0) &amp; \\quad a[i] == b[j] \\\\ \\end{cases} \\] <ul> <li>What is the order of execution</li> <li>where to look for answer</li> </ul> <p>\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u89e3\u91ca:</p> <p>f(i, j) \u53ef\u4ee5\u5206\u89e3\u4e3a 4 \u4e2a \u5b50\u95ee\u9898\u3002</p> <p>\u5982\u679c A[1 .. i - 1] \u5df2\u7ecf\u548c B[1 .. j] \u5b8c\u5168\u4e00\u81f4 \uff08\u4e5f\u5373 \u7ecf\u8fc7\u4e86 f(i-1, j) \u6b65\uff09, \u90a3\u4e48\u53ea\u9700\u8981\u5c06 a[i] \u5220\u9664\u5373\u53ef\u3002</p> <p>\u5982\u679c A[1 .. i] \u5df2\u7ecf\u548c B[1 .. j - 1] \u5b8c\u5168\u4e00\u81f4 \uff08\u4e5f\u5373 \u7ecf\u8fc7\u4e86 f(i , j - 1) \u6b65\uff09, \u90a3\u4e48\u53ea\u9700\u8981 \u589e\u52a0\u4e00\u4e2a b[j] \u5373\u53ef\u3002</p> <p>\u5982\u679c A[1 .. i - 1] \u5df2\u7ecf\u548c B[1 .. j - 1] \u5b8c\u5168\u4e00\u81f4 \uff08\u4e5f\u5373 \u7ecf\u8fc7\u4e86 f(i - 1 , j - 1) \u6b65\uff09, \u5982\u679c a[i] \u4e0d\u7b49\u4e8e b[i], \u5c31\u4fee\u6539\u4e00\u6b21\uff0c\u5982\u679c a[i] == b[i] \u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c</p> <p> \u867d\u7136 f(i, j) \u53ea\u662f\u4e00\u4e2a\u6570\uff0c\u4f46\u662f\u8981\u8ba4\u771f\u8003\u8651\u5176\u80cc\u540e\u7684\u610f\u4e49  </p> <p></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a1051","title":"A1051 \u6700\u5927\u7684\u548c","text":"<ul> <li> <p>Define Objective function</p> </li> <li> <p>Identify base cases</p> </li> <li>Write down a recurrence relation for the optimized Objective function</li> <li>What is the order of execution</li> <li>where to look for answer</li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dp_1","title":"\u6811\u5f62 dp","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a285","title":"A285 \u6ca1\u6709\u4e0a\u53f8\u7684\u805a\u4f1a","text":"<ul> <li> <p>Define Objective function</p> <ol> <li>\\(f(u, 0)\\) \u4ece\u6240\u6709\u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u9009\u62e9\uff0c\u5e76\u4e14\u4e0d\u9009u\u8fd9\u4e2a\u70b9\u7684\u65b9\u6848\u6570 </li> <li>\\(f(u, 1)\\) \u4ece\u6240\u6709\u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u9009\u62e9\uff0c\u5e76\u4e14\u9009u\u8fd9\u4e2a\u70b9\u7684\u65b9\u6848\u6570</li> </ol> </li> </ul> <p>(\u6c42\u786e\u5b9a\u7684\u96c6\u5408\u7684\u6700\u5927\u503c)</p> <ul> <li> <p>Identify the base case</p> <p>f[u][1] = happy[u]</p> </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> <p>\u8bbe u \u7684\u5b69\u5b50\u6570\u7ec4\u4e3av $$ f(u, 0) = sum \\big( max(f(v_1, 0), f(v_1,1)) +  max(f(v_2, 0), f(v_1, 1)) + \\cdots \\big) $$</p> </li> </ul> \\[ f(u, 1) = sum (f(v_1, 0) + f(v_2, 0 ) + \\cdots + f(v_n, 0)) \\] <ul> <li> <p>What is the order of execution</p> <p>Top to Down </p> </li> <li> <p>where to look for answer</p> <p>max(f(root, 0), f(root, 1))</p> </li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a1072","title":"A1072 \u6700\u5927\u8def\u5f84\u548c","text":"<p> Naive Approach, \u590d\u6742\u5ea6 \\(\\Theta(n^2)\\) \u4f1a\u8d85\u65f6</p> <ul> <li> <p>Define Objective function</p> </li> <li> <p>f(u, 0) \u4ee5u\u4e3a\u6839\u8282\u70b9\uff0c\u4e14\u4e0d\u9009u\u8fd9\u4e2a\u8282\u70b9\u7684\u8def\u5f84\u65b9\u6848\u6570</p> </li> <li>f(u, 1) \u4ee5u\u4e3a\u6839\u8282\u70b9\uff0c\u4e14\u9009u\u8fd9\u4e2a\u8282\u70b9\u7684\u8def\u5f84\u65b9\u6848\u6570</li> </ul> <p>(\u6c42\u786e\u5b9a\u65b9\u6848\u96c6\u5408\u7684\u6700\u5927\u503c)</p> <ul> <li> <p>Identify base cases</p> <p>f(u, 1) = w[u]</p> </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> </li> </ul> <p>\u8bbe u \u7684\u5b69\u5b50\u6570\u7ec4\u4e3a v, \u5047\u8bbe\u6709 n \u4e2a\u5b69\u5b50</p> \\[ f(u, 0) = \\underset{1 \\le j \\le n}{max} (f(v_j, 0), f(v_j, 1)) \\] \\[ f(u, 1) = \\text{max} (w[u], w[u] +  \\underset{1 \\le j \\le n}{max} ( f(v_j, 1))) \\] <ul> <li> <p>What is the order of execution</p> <p>Top to Bottom</p> </li> <li> <p>where to look for answer</p> <p>\\(\\underset{1 \\le i \\le  n}{\\text{max}}(\\text{max} (f(i, 0), f(i, 1)))\\)</p> </li> </ul> <p>\\(Q\\): \u4e3a\u4ec0\u4e48\u4e0a\u9762\u8fd9\u79cd\u7b97\u6cd5\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a\u9876\u70b9\uff0c\u624d\u80fd\u627e\u5230\u6700\u5927\u503c\u3002</p> <p>\\(A\\): \u56e0\u4e3a\u8fd9\u91cc\u7684\u8fb9\u90fd\u662f\u65e0\u5411\u8fb9\uff0c\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u8fd9\u548c A285 \u9898\u6709\u6240\u4e0d\u540c </p> <p> \u6b63\u786e\u89e3\u6cd5  </p> <p></p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dp_2","title":"\u533a\u95f4 dp","text":"<p>\u51e1\u662f\u548c\u64cd\u4f5c\u6570\u6709\u5173\u7cfb\u7684\uff0c\u90fd\u9700\u8981\u5173\u5fc3 dp \u51fd\u6570\u5bf9 \u5e8f\u5217\u9020\u6210\u7684\u5f71\u54cd\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a282","title":"A282 \u77f3\u5b50\u5408\u5e76","text":"<ul> <li> <p>Define Objective function</p> <p>f(i, j) \u5c06 i \\(\\sim\\) j \u4e4b\u95f4\u7684\u533a\u95f4\u5408\u5e76\u6240\u9700\u8981\u7684\u65b9\u6848\u6570 (\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u533a\u95f4\\([i, j]\\) \u8fd9\u6bb5\u77f3\u5b50\uff0c\u7ecf\u8fc7 \\(f(i, j)\\) \u6b65\u540e\uff0c\u5df2\u7ecf\u5408\u5e76\u6210\u4e00\u5806\u77f3\u5b50\u4e86)  \u6c42 \u6700\u5c0f\u503c </p> </li> <li> <p>Identify base cases</p> </li> </ul> \\[ f(i, j)\\begin{cases}   0 &amp; \\text{if } i=j \\\\   \\infty &amp; \\text{otherwise}  \\end{cases} \\] <ul> <li>Write down a recurrence relation for the optimized Objective function</li> </ul> \\[ f(i, j) = \\underset{0 \\le k \\le j - i - 1}{\\text{min}} (f(i, i + k), f(i + k + 1, j)) \\] <p> </p> <ul> <li> <p>What is the order of execution</p> <p>Bottom to Top</p> </li> <li> <p>where to look for answer</p> <p>f(1, n)</p> </li> </ul> <p>\u533a\u95f4dp \u6a21\u677f </p> <pre><code>for (int len = 1; len &lt;= n; len++) {         // \u533a\u95f4\u957f\u5ea6\n    for (int i = 1; i + len - 1 &lt;= n; i++) { // \u679a\u4e3e\u8d77\u70b9\n        int j = i + len - 1;                 // \u533a\u95f4\u7ec8\u70b9\n        if (len == 1) {\n            dp[i][j] = \u521d\u59cb\u503c\n            continue;\n        }\n\n        for (int k = i; k &lt; j; k++) {        // \u679a\u4e3e\u5206\u5272\u70b9\uff0c\u6784\u9020\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n            dp[i][j] = min(dp[i][j], dp[i][k] + dp[k + 1][j] + w[i][j]);\n        }\n    }\n}\n</code></pre>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#dp_3","title":"\u72b6\u6001\u538b\u7f29dp","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_24","title":"\u6700\u77ed\u54c8\u5bc6\u987f\u8def\u5f84","text":"<ul> <li> <p>Define Objective function</p> <p>\\(f(i, j)\\) \u6240\u6709\u4ece \\(0\\) \u8d70\u5230 \\(j\\) \uff0c\u8d70\u8fc7\u7684\u8def\u5f84\u5b58\u5728 \\(i\\) \u4e2d\u3002  \u6c42\u6700\u5c0f\u503c </p> </li> <li> <p>Identify base cases</p> </li> </ul> \\[ f(i, j) = \\infty \\qquad \\text{iff }  (i, j) \\ne (1, 0) \\\\  f(1, 0) = 0  \\] <p>\\(Q:\\) \u4e3a\u4ec0\u4e48 \\(f(0, 0)\\) \u7b49\u4e8e \\(\\infty\\) </p> <p>\\(A:\\) \u6309\u7167\u5b9a\u4e49, \\(f(0, 0)\\) \u8868\u793a\u4ece\u8d77\u70b9\u5230 0 \u8fd9\u4e2a\u70b9\u6240\u7ecf\u8fc7\u7684\u72b6\u6001\u4e3a \\(i\\), \u4f46\u662f \\(i\\) \u7684\u503c\u662f \\(0\\) \uff0c \u8868\u793a\u4e00\u4e2a\u70b9\u90fd\u4e0d\u7ecf\u8fc7\uff0c\u8fd9\u4e0e\u4e8b\u5b9e\u76f8\u6096\uff08\u56e0\u4e3a\u5230\u8fbe\u4e86 \\(0\\) \u8fd9\u4e2a\u8282\u70b9, \u6240\u4ee5 i \u7684\u503c\u5e94\u8be5\u4e3a \\(1\\)\uff09 \\((0 | 1 &lt;&lt; 1 = 1)\\)</p> <ul> <li>Write down a recurrence relation for the optimized Objective function</li> </ul> <p></p> \\[ f(i, j) = \\underset{0 \\le k \\le n - 1}{\\text{min}} \\big( f(i - \\{J\\}, k)  \\big) \\] <ul> <li> <p>What is the order of execution</p> <p>Bottom To Top</p> </li> <li> <p>where to look for answer</p> <p>f((1 &lt;&lt; n) - 1, n)</p> </li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#l21a04","title":"L21A04 \u56de\u8def\u8ba1\u6570","text":"<ul> <li> <p>Define Objective function</p> <p>\\(f(i, j)\\) \u4ece 0 \u5230\u8fbe j \u8282\u70b9\u7684 \u8def\u5f84 \u50a8\u5b58\u5728 i \u4e2d  \u6c42 \u65b9\u6848\u603b\u548c</p> </li> <li> <p>Identify base cases</p> </li> </ul> \\[     f(i, j) = 0 \\qquad \\text{iff }   (i, j) \\ne (1, 0)\\\\      f(1, 0) = 1  \\] <ul> <li>Write down a recurrence relation for the optimized Objective function</li> </ul> \\[ f(i, j) = \\underset{0 \\le k \\le n - 1}{\\text{sum}} \\big( f(i - \\{J\\}, k)    \\big) \\] <ul> <li> <p>What is the order of execution</p> <p>Bottom To Top</p> </li> <li> <p>where to look for answer</p> <p>\\(\\sum_{1 \\le i \\le n-1} f((1 &lt;&lt; n) - 1, i)\\) </p> </li> </ul>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_25","title":"\u6811\u72b6\u6570\u7ec4","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#a3662","title":"A3662 \u6700\u5927\u4e0a\u5347\u5b50\u5e8f\u5217","text":"<p> TLE  </p> <ul> <li> <p>Define Objective function</p> <p>f(i) \u8868\u793a \\(1 \\sim i\\) \u4e2d\u4ee5 i \u7ed3\u5c3e\u7684\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u548c </p> </li> <li> <p>Identify base cases</p> <p>f(i) = a[i]</p> </li> <li> <p>Write down a recurrence relation for the optimized Objective function</p> </li> </ul> <p>$$ f(i) = \\begin{cases}</p> <p>\\underset{1 \\le j \\le i - 1}{\\text{max}} (f(i), a[i] + f(j)) &amp; \\text{if } a[i] &gt; a[j]   \\</p> <p>a[i] &amp; \\end{cases} $$</p> <ul> <li> <p>What is the order of execution</p> <p>Bottom To Top </p> </li> <li> <p>where to look for answer</p> </li> </ul> <p>\\(\\underset{1 \\le i \\le n}{\\text{max} } (f(i))\\)</p> <p> \u4f18\u5316\u505a\u6cd5  </p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_26","title":"\u7ebf\u6bb5\u6811","text":"<p>Lead in</p> <p>\u7ebf\u6bb5\u6811\u7528\u4e8e\u5904\u7406 \u5bf9\u4e8e \u6570\u7ec4\u7684\u533a\u95f4\u67e5\u8be2\u3002\u6bd4\u5982\uff0c\u6c42 \u6570\u7ec4 l - r \u8303\u56f4 \u5185\u7684\u548c\u3002</p> <p>build </p> <p>\u7ebf\u6bb5\u6811\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u5b83\u7684\u6bcf\u4e00\u4e2a\u7aef\u70b9\u90fd\u8868\u793a\u4e00\u6bb5\u533a\u95f4 (\u548c\u4e00\u4e9b\u533a\u95f4\u7684\u6027\u8d28 \uff0cmin | max | sum)</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u81ea\u4f4e\u5411\u4e0a\u7684\u65b9\u5f0f\uff0c\u6784\u5efa\u7ebf\u6bb5\u6811\u3002\u4ece\u53f6\u5b50\u8282\u70b9\u5f00\u59cb, \u5411\u8005\u6839\u8282\u70b9\u7684\u65b9\u5411\u5ef6\u4f38\u3002</p> <p>\u6bcf\u4e00\u4e2a\u9012\u5f52\u7684\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u9700\u8981\u4f7f\u7528\u4e24\u4e2a\u5b69\u5b50\u8282\u70b9\u7684\u6570\u636e\u53bb\u5f62\u6210\u4e00\u4e2a\u7236\u8282\u70b9\u3002 \u5982\u4f55\u5408\u5e76\u4e0e\u5177\u4f53\u9898\u76ee\u6709\u5173\u3002</p> <p>\u64cd\u4f5c </p> <p>\u7ebf\u6bb5\u6811\u652f\u6301\u4e24\u79cd\u64cd\u4f5c:</p> <ol> <li><code>update</code> </li> </ol> <p>\u6bcf\u4e00\u6b21\u9012\u5f52\u90fd\u9009\u4e00\u4e2a\u65b9\u5411</p> <ol> <li><code>query</code> </li> </ol> <p>\u4e09\u79cd\u60c5\u51b5 - <code>l r start end</code>, <code>start end l r</code> \u5f53\u524d\u533a\u95f4 <code>(start end)</code> \u5728 \u6240\u6c42\u533a\u95f4 <code>(l, r)</code> \u4e4b\u5916  </p> <pre><code>\u76f4\u63a5 `return` \u4e00\u4e2a\u65e0\u6548\u503c\n</code></pre> <ul> <li> <p><code>l start end r</code> \u5f53\u524d\u533a\u95f4 <code>(start end)</code> \u5728 \u6240\u6c42\u533a\u95f4 <code>(l, r)</code> \u5185\u90e8 </p> <p>\u76f4\u63a5 <code>return</code> \u5f53\u524d\u533a\u95f4\u6240\u4fdd\u5b58\u7684\u503c </p> </li> <li> <p>\u5f53\u524d\u533a\u95f4 <code>(start end)</code> \u4e0e \u6240\u6c42\u533a\u95f4 <code>(l, r)</code> \u6709\u4ea4\u53c9  </p> <p>\u9012\u5f52\u6c42\u89e3 </p> </li> </ul> <p>\u533a\u95f4\u66f4\u65b0 </p> <p>\u61d2\u6807\u8bb0\uff0c</p> <p>\u95ee\u9898\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898 </p> <ol> <li>\u9012\u5f52\u65f6\u8981\u52a0\u4e00\u4e2a\u5224\u65ad\u662f\u5426\u4e3a \u7a7a\u7684\u6761\u4ef6 </li> <li><code>&lt;&lt;</code> <code>&gt;&gt;</code> \u641e\u6df7\u4e86</li> <li>\u57fa\u7ebf\u6761\u4ef6\u8bb0\u5f97return</li> </ol>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_27","title":"\u53cc\u6307\u9488\u7b97\u6cd5","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#leetcode-3","title":"leetcode 3","text":"<p>\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32 <code>s</code> \uff0c\u8bf7\u4f60\u627e\u51fa\u5176\u4e2d\u4e0d\u542b\u6709\u91cd\u590d\u5b57\u7b26\u7684\u00a0\u6700\u957f\u5b50\u4e32\u00a0\u7684\u957f\u5ea6\u3002</p>"},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#_28","title":"\u5b57\u7b26\u4e32\u67e5\u627e","text":""},{"location":"notes/Algo/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/#kmp","title":"KMP","text":"<p>kmp \u7b97\u6cd5\u53ef\u4ee5\u5728 \\(\\Theta(n)\\) \u67e5\u627e n \u7684\u5b50\u4e32\u3002\u5b83\u7684\u539f\u7406\u662f\uff0c\u5728\u5b50\u4e32\u67e5\u627e\u4e4b\u524d\uff0c\u6784\u5efa\u4e00\u4e2a\u5b50\u4e32\u7684 \u6709\u9650\u72b6\u6001\u673a, \u7528\u4e8e\u907f\u514d\u56de\u6eaf\u3002</p> <p>\u5982\u4f55\u6839\u636e\u5b50\u4e32\u6784\u5efa\u4e00\u4e2a DFA \u5462\u3002 DFA\u7531\u72b6\u6001\u548c\u8f6c\u6362\u5173\u7cfb\u6784\u6210\uff1a</p> <p>\u72b6\u6001\uff1a \u9996\u5148\uff0c\u5b50\u4e32\u7684\u6bcf\u4e00\u4e2a\u5b57\u7b26\u90fd\u8868\u793a\u4e00\u4e2a\u72b6\u6001\uff0c\u6240\u4ee5 \u8fd9\u4e2a DFA \u7684\u603b\u72b6\u6001\u6570\u5c31\u662f\u5b50\u4e32\u7684\u957f\u5ea6\uff0c\u518d\u52a0\u4e0a\u6700\u540e\u7684\u4e00\u4e2a\u7ec8\u6b62\u72b6\u6001\u3002 \u6bd4\u5982\u5b50\u4e32 <code>aaa</code> \u7684\u72b6\u6001\u6570\u5c31\u662f <code>3 + 1 = 4</code> </p> <ul> <li> \u6b64\u5904\u5e94\u8be5\u753b\u51fa aaa \u7684\u72b6\u6001\u8868\u793a</li> </ul> <p>\u8f6c\u6362\u5173\u7cfb\uff1a \u5b57\u7b26\u8868\u4e2d\u7684\u5b57\u7b26\uff0c\u4f1a\u4f7f\u5f97 dfa \u4e2d\u7684\u72b6\u6001\u53d1\u751f\u8f6c\u6362\u3002\u8fd9\u79cd\u8f6c\u6362\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b</p> <ul> <li> \u5339\u914d\u8f6c\u6362\uff0c \u53ef\u4ee5\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001</li> <li> \u4e0d\u5339\u914d\u8f6c\u6362\uff0c \u5411\u4e4b\u524d\u7684\u72b6\u6001\u8f6c\u79fb</li> </ul> <p>\u5982\u4f55\u6784\u5efa DFA \u5462\uff1f </p> <ul> <li>\u521d\u59cb\u5316 \u9996\u5148\uff0c<code>0</code> \u72b6\u6001 \u5982\u679c\u9047\u5230 \u5b50\u4e32\u4e0b\u6807\u4e3a <code>0</code> \u7684\u5b57\u7b26\uff0c\u90a3\u4e48\u4f1a\u5411 \u72b6\u6001 <code>1</code> \u8fdb\u884c\u8f6c\u5316\u3002\u5982\u679c\u662f\u5176\u4ed6\u5b57\u7b26\uff0c\u90a3\u4e48\u5c31\u4fdd\u6301 <code>0</code>. \u6211\u4eec\u518d\u8003\u8651 <code>restart state</code> X \u7684\u521d\u59cb\u503c\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5904\u5c31\u4e0d\u5339\u914d\uff0c\u90a3\u4e48\u663e\u7136\u6211\u4eec\u5e94\u8be5\u4ece \u4e0b\u6807\u4e3a 0 \u5904 \u91cd\u65b0\u5f00\u59cb\uff0c\u6240\u4ee5 X \u7684\u521d\u503c\u4e3a 0\u3002</li> </ul> <pre><code>dfs[pattern[0]][0] = 1; \nX = 0\n</code></pre> <ul> <li>\u5f00\u59cb\u9884\u5904\u7406</li> </ul> <p>\u5bf9\u4e8e\u4e4b\u540e\u7684\u72b6\u6001 i\uff0c i \u4ece 1 \u5f00\u59cb\u3002</p> <ul> <li> \u5982\u679c\u53d1\u751f\u5339\u914d\u8f6c\u6362\uff0c \u53ef\u4ee5\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001 (ch == pattern[i]) <code>dfs[ch][i] = i + 1</code> </li> <li> \u4e0d\u5339\u914d\u8f6c\u6362\uff0c \u5411\u4e4b\u524d\u7684\u72b6\u6001\u8f6c\u79fb <code>dfs[ch][i] = dfs[ch][X]</code> </li> </ul> <p>\u6700\u540e\uff0c\u5229\u7528 DFA \u66f4\u65b0 <code>restart state</code> </p> <pre><code>X = dfs[pattern[i]][X]\n</code></pre> <p>X \u6784\u5efa\u7684\u662f pattern[1: len] \u7684\u72b6\u6001\u673a (\u8fd9\u70b9\u8fd8\u662f\u96be\u4ee5\u7406\u89e3)</p>"},{"location":"notes/Android/Room/","title":"Room","text":""},{"location":"notes/Android/Room/#procedure","title":"procedure","text":""},{"location":"notes/Android/Room/#add-dependencies","title":"add dependencies","text":"<p>room dependencies </p>"},{"location":"notes/Android/Room/#deal-with-data-layer","title":"deal with data layer","text":"<ol> <li>\u8bbe\u8ba1\u5b9e\u4f53\u7c7b</li> <li>\u8bbe\u8ba1 Dao \u63a5\u53e3</li> <li>\u521b\u5efa database</li> <li>\u4e3a database \u8fd9\u4e2a\u6570\u636e\u6e90\u521b\u5efa repository</li> </ol>"},{"location":"notes/Android/Room/#deal-with-dependency-injection","title":"deal with Dependency injection","text":"<ol> <li>\u521b\u5efa container (\u5f88\u591a\u4e2arepository)</li> <li>\u521b\u5efa application (\u4e3b\u8981\u662f\u628a context \u4f20\u7ed9 container)</li> <li>\u5728 android manifest \u91cc \u6ce8\u518c application</li> </ol>"},{"location":"notes/Android/Room/#deal-with-viewmodel","title":"deal with viewModel","text":"<p>\u4ece repository \u83b7\u53d6\u6570\u636e</p>"},{"location":"notes/Android/Room/#more-complex-data","title":"more complex data","text":"<p>\u8003\u8651\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\uff1a \u6211\u4eec\u6b63\u5728\u6784\u5efa\u4e00\u4e2a\u804a\u5929\u673a\u5668\u4eba\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u90fd\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u804a\u5929\u8bb0\u5f55\u3002\u90a3\u4e48\u6211\u4eec\u8981\u5982\u4f55\u5b58\u50a8\u7528\u6237\u7684\u804a\u5929\u8bb0\u5f55\u5462\uff1f \u4f60\u53ef\u80fd\u4f1a\u8fd9\u4e48\u60f3\uff1a <pre><code>data class User {\n    val id: Int,\n    val name: String,\n    val password: String,\n    val message: Message\n}\n</code></pre></p> <p>\u4f46\u662f message \u8fd9\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u662f\u5b58\u4e0d\u8fdb\u6570\u636e\u5e93\u4e2d\u7684\uff0c\u90a3\u6211\u4eec\u8981\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f \u53ef\u4ee5\u5171\u7528\u4e00\u4e2a\u4e3b\u952e id, \u4ee4 id \u540c\u65f6\u4e3a User \u548c Message \u7684\u4e3b\u952e</p> <pre><code>data class Message {\n    val id: Int // same as User\n    val history: List&lt;String&gt;\n}\n</code></pre> <p>&lt;++&gt; <pre><code>@Database(\n    entities = [Message::class, User::class, Config::class],\n    version = 6,\n    exportSchema = false\n)\n</code></pre></p>"},{"location":"notes/Android/cornell_lec01/","title":"Cornell lec01","text":""},{"location":"notes/Android/cornell_lec01/#activity-and-intent","title":"Activity and intent","text":""},{"location":"notes/Android/cornell_lec01/#intents","title":"intents","text":"<ul> <li>Explict intents calls antther <code>oncreate()</code> method of anther activity</li> </ul> <p>To transition to a new activity, we first create an intent with the following code <pre><code>var intent = Intent(this, TargetActivity::class.java)\n</code></pre></p> <p>The <code>.java</code> is some sort of convention, though it might seem wierd. To launch an activity with the given intent, we write <pre><code> startActivity(intent)\n</code></pre></p> <p>To close <pre><code>finish()\n</code></pre></p>"},{"location":"notes/Android/cornell_lec01/#send-data","title":"send data","text":"<p>include info within intent. we write  <pre><code>putExtra(key, value)\n</code></pre></p> <p>This stores everythings in a bundle</p>"},{"location":"notes/Android/cornell_lec01/#receive-data","title":"receive data","text":"<pre><code>// eateryName = \"Okenshields\"\nvar eateryName = getIntent().extras?.getString(\"EATERY_NAME\")\n</code></pre>"},{"location":"notes/Android/cornell_lec01/#send-back-info","title":"send back info","text":"<p>In the above content, we have implemented function like  launching a new activity,  sending info from current acti to target acti. And now, we wonder how to send data back to a launched acti Introduction a new method</p> <p><pre><code>// In MainActivity.kt\nregisterForActivityResult(ActivityResultContract, ActivityResultCallback)\n</code></pre> <pre><code>private lateinit var intentLauncher: ActivityResultLauncher&lt;Intent&gt;\n// ...\nintentLauncher = registerForActivityResult(\n   ActivityResultContracts.StartActivityForResult()\n) {\n   result -&gt;\n   if (result.resultCode == SOME_UNIQUE_INTEGER) {\n       val hi = result.data?.extras?.get(\"hi\")\n       println(\"MainMain\")\n       binding.textviewId.text = hi as String\n    }\n   }\n  // ...\n   intentLauncher.launch(intent) // use intentLauncher\n   // ...\n\n companion object {\n        // Can be referenced both within the MainActivity and other\n        // Activities (e.g. your TargetActivity)\n        const val SOME_UNIQUE_INTEGER = 1\n</code></pre></p> <p>we mark the return value of above code as <code>intentLauncher</code> and use <code>intentLauncher.launch()</code> to load intent, instead of  <code>startActivity</code>.</p> <p>In targetActivity </p> <p>we create a new intent, load info, and setResult <pre><code>override fun onBackPressed() {\n     val intent = Intent()\n     println(\"asasasa\")\n     intent.putExtra(\"hi\", \"hi\")\n     setResult(SOME_UNIQUE_INTEGER, intent)\n     super.onBackPressed()\n}\n// Interger \u4f5c\u4e3aresultCode, \u53ef\u4ee5\u5229\u7528\u5b83\u6765\u6807\u8bb0\u591a\u79cd\u529f\u80fd \n</code></pre></p>"},{"location":"notes/Android/cornell_lec01/#implicit-intent","title":"implicit intent","text":"<p>implicit means we do not call <code>onCreate</code> method. It is a feature that allows us to communicate among other apps</p>"},{"location":"notes/Android/cornell_lec02/","title":"Cornell lec02","text":""},{"location":"notes/Android/cornell_lec02/#recycle-view","title":"Recycle View","text":""},{"location":"notes/Android/cornell_lec02/#background-infomation","title":"background infomation","text":"<ul> <li>Recycle view</li> <li>Recycleview.viewholder</li> <li>Recycleview.adapter</li> <li>layout manager</li> </ul> <pre><code>graph LR\nA[Recycle view] --&gt; |view adapter| B[view holder]  \n</code></pre>"},{"location":"notes/Android/cornell_lec02/#how-to-display-a-recycle-view","title":"How to display a recycle view","text":"<ul> <li>for adapter, we need to override<ul> <li><code>onCreateViewHolder</code></li> <li><code>onBindViewHoldr</code></li> <li><code>getItemCount</code> </li> </ul> </li> </ul> <p><pre><code>package com.example.cornell\n\nimport android.view.LayoutInflater\nimport android.view.View\nimport android.view.ViewGroup\nimport androidx.recyclerview.widget.RecyclerView\nimport androidx.recyclerview.widget.RecyclerView.ViewHolder\nimport com.example.cornell.databinding.ActivityMainBinding\nimport com.example.cornell.databinding.BookRowItemBinding\n\nclass MyBookAdapter(\n    private val dataSet: List&lt;Book&gt;,\n    private val printPos: (Int) -&gt; Unit\n    ):\n    RecyclerView.Adapter&lt;MyBookAdapter.MyViewHolder&gt;(){\n    inner class MyViewHolder(val binding: BookRowItemBinding) : ViewHolder(binding.root)\n    private var dataFiltered: List&lt;Book&gt; = dataSet;\n\n    var filterTest: CharSequence = \"\"\n        set(value) {\n            field = value\n            onFilterChange(value)\n        }\n\n    private fun onFilterChange(charString: CharSequence) {\n        dataFiltered = if (charString.isEmpty()) {\n            // There's no query, should return back the unfiltered list.\n            dataSet\n        } else {\n            // The filter function returns a list containing only elements\n            // matching the given predicate. In this case, we can choose\n            // our predicate to be what we want to filter by. Since we are working\n            // with books, let's allow filtering by author and title!\n            dataSet.filter { book -&gt;\n                book.bookName.contains(charString) || book.author.contains(charString)\n            }\n        }\n\n        notifyDataSetChanged()\n    }\n    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {\n        val binding = BookRowItemBinding.inflate(LayoutInflater.from(parent.context))\n        return MyViewHolder(binding)\n    }\n\n    override fun onBindViewHolder(holder: MyViewHolder, position: Int) {\n        with(holder) {\n            this.binding.button.setOnClickListener {\n                printPos(position)\n            }\n            with (dataFiltered[position]) {\n                binding.bookName.text = this.bookName\n                binding.author.text = this.author\n                binding.publisher.text = this.publisher\n            }\n        }\n    }\n\n    override fun getItemCount(): Int {\n        return dataFiltered.size\n    }\n}\n</code></pre> <pre><code>package com.example.cornell\n\nimport android.content.Intent\nimport android.os.Bundle\nimport com.google.android.material.snackbar.Snackbar\nimport androidx.appcompat.app.AppCompatActivity\nimport androidx.navigation.findNavController\nimport androidx.navigation.ui.AppBarConfiguration\nimport androidx.navigation.ui.navigateUp\nimport androidx.navigation.ui.setupActionBarWithNavController\nimport android.view.Menu\nimport android.view.MenuItem\nimport androidx.recyclerview.widget.GridLayoutManager\nimport androidx.recyclerview.widget.LinearLayoutManager\nimport com.example.cornell.databinding.ActivityMainBinding\n\nclass MainActivity : AppCompatActivity() {\n\n    private lateinit var binding: ActivityMainBinding\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        binding = ActivityMainBinding.inflate(layoutInflater)\n        val book_recycle_view = binding.bookList\n        book_recycle_view.setHasFixedSize(true)\n        book_recycle_view.layoutManager = GridLayoutManager(this, 2)\n\n        val dataSet = mutableListOf&lt;Book&gt;();\n\n        for (i in 1..20) {\n            dataSet.add(Book(\"Harry Potter$i\", \"Lorin$i\", \"Wizard$i\"))\n        }\n        book_recycle_view.adapter = MyBookAdapter(dataSet) {\n            val intent = Intent(this, NextActivity::class.java)\n            intent.putExtra(\"Pos\", it.toString())\n            startActivity(intent)\n        }\n        setContentView(binding.root)\n    }\n}\n</code></pre></p>"},{"location":"notes/Android/cornell_lec03/","title":"Cornell lec03","text":""},{"location":"notes/Android/cornell_lec03/#lec-5","title":"lec 5","text":""},{"location":"notes/Android/cornell_lec03/#fragment","title":"Fragment","text":"<p>Why fragment 1. reuse  2. reduce redundant</p> <p>Lifecycle 1. tied to host activity</p> <p>FragmentManager</p> <p>FragmentTransactions     - creating     - launching     - caching</p> <p>group transaction</p> <pre><code>val fM = sFM;\nfM.beginT\n    .add(.., ..)\n    .commit()\n</code></pre> <pre><code>graph TD\nB[F B] --&gt; |setFR| F[FM]\nF --&gt;|request| A[F A]\nA --&gt; |setFRL| F\n</code></pre>"},{"location":"notes/Android/cornell_lec03/#navigation","title":"Navigation","text":"<ul> <li>Botton Navigation View</li> <li>TopBar</li> <li></li> </ul>"},{"location":"notes/Android/coroutine/","title":"Coroutine","text":""},{"location":"notes/Android/coroutine/#coroutine-concepts","title":"Coroutine concepts","text":"<ul> <li>How the work will be excuted</li> <li>How long the coroutine should exist for </li> <li>what should happen if coroutine get canceled</li> </ul> <p>what is Job  - a handle to coroutine </p> <p>what is CorountineScope - manage to keep check of a group of </p> <p>Structured concurrency</p>"},{"location":"notes/Android/dataStore/","title":"dataStore","text":""},{"location":"notes/Android/dataStore/#datastore","title":"dataStore","text":""},{"location":"notes/Android/dataStore/#dependencies","title":"dependencies","text":"<p><code>implementation \"androidx.datastore:datastore-preferences:1.0.0\"</code> </p>"},{"location":"notes/Android/dataStore/#setup-repo","title":"setup repo","text":"<ol> <li> <p>create a new kotlin class called <code>xxxPreferenceRepository</code>,      this class takes one parameter <code>dataStore: DataStore&lt;Preference&gt;</code> </p> </li> <li> <p>list every element you want to save</p> </li> </ol> <pre><code>val themeMode: Flow&lt;String&gt;\n...\n</code></pre> <ol> <li>define saveXXX method</li> </ol> <pre><code>suspend fun saveThemePreference(themeMode: String){\n        dataStore.edit { preferences -&gt;\n            preferences[THEME_MODE] = themeMode\n        }\n    }\n</code></pre> <ol> <li>put key for dataStore in companion object</li> </ol> <pre><code> private companion object {\n        val THEME_MODE = stringPreferencesKey(\"theme_mode\")\n        const val TAG = \"UserPreferencesRepo\"\n    }\n</code></pre> <ol> <li>config dependency injection in application</li> </ol> <pre><code>// create A dataStore named SETTINGS \nprivate const val SETTINGS = \"settings\"\nprivate val Context.dataStore: DataStore&lt;Preferences&gt; by preferencesDataStore(\n    name = SETTINGS\n)\n\nclass AudioApplication: Application(){\n\n    lateinit var container: AppContainer\n    lateinit var userPreferencesRepository: UserPreferencesRepository\n\n\n    override fun onCreate() {\n        super.onCreate()\n        container = AppDataContainer(this)\n        userPreferencesRepository = UserPreferencesRepository(dataStore)\n    }\n}\n</code></pre>"},{"location":"notes/Android/dataStore/#setup-viewmodel","title":"setup viewModel","text":""},{"location":"notes/Android/error/","title":"Error","text":""},{"location":"notes/Android/error/#_1","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<ol> <li>\u5982\u4f55\u6839\u636e\u7cfb\u7edf\u4e3b\u9898\u66f4\u6362\u5e94\u7528\u4e3b\u9898</li> <li> <p><code>isSysteminDarkTheme</code> &lt;++&gt;</p> </li> <li> <p>navigation with arguments</p> </li> <li> <p>\u8bbf\u95ee\u7f51\u7edc\u8bf7\u6c42\u6210\u529f\uff0c\u4f46\u662fui \u83b7\u53d6\u4e0d\u4e86\u8bbf\u95ee\u7684\u6570\u636e.</p> </li> </ol> <p>\u539f\u56e0\uff1a\u7531\u4e8e\u7f51\u7edc\u8bf7\u6c42\u662f\u5728\u643a\u7a0b\u4e2d\u8fdb\u884c\uff0c\u6e32\u67d3Ui\u5219\u662f\u5728\u4e3b\u7ebf\u7a0b\u8fdb\u884c\uff0c\u53c8\u56e0\u4e3a\u7f51\u7edc\u8bf7\u6c42\u6bd4\u8f83\u7f13\u6162\uff0c\u8fd9\u5c31\u5bfc\u81f4\u5e94\u7528\u5728\u83b7\u53d6\u5230 \u7f51\u7edc\u8bf7\u6c42\u6240\u8fd4\u56de\u7684\u6570\u636e\u524d\uff0c\u5c31\u5df2\u7ecf\u628a\u9ed8\u8ba4\u503c\u7ed9\u4f20\u9012\u4e0b\u53bb\uff0c\u5bfc\u81f4\u89e3\u6790\u5f02\u5e38\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u4e3aUi\u8bbe\u8ba1\u4e00\u4e9b\u72b6\u6001\uff0c\u6bd4\u5982 </p> <pre><code>enum class STATUS {\n    SUCCESS,\n    LOADING,\n    FAILURE\n}\n\n\nfun getUrl() {\n        viewModelScope.launch {\n            playUiState =  try {\n                val url = songRepository.getSongUrl(songId).url\n                PlayUiState(url, STATUS.SUCCESS)\n            } catch (e: IOException) {\n                Log.e(\"Play\", \"io exception\")\n                PlayUiState(status = STATUS.FAILURE)\n            } catch (e: HttpException) {\n                PlayUiState(status = STATUS.FAILURE)\n            }\n        }\n    }\n</code></pre> <p>\u800c\u5728 UI layer \u4e2d\uff0c \u6211\u4eec\u6839\u636e Ui \u6240\u5904\u7684\u72b6\u6001 \u6765 \u52a8\u6001\u8c03\u6574 \u754c\u9762\u7684\u663e\u793a\u6548\u679c</p> <pre><code> when (uiState.status) {\n        STATUS.SUCCESS -&gt; Player(url = uiState.url)\n        else -&gt; Loading()\n    }\n</code></pre> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u6709\u5f53 \u7f51\u8def\u8bf7\u6c42\u7ed3\u675f\u540e\uff0cUi layer \u624d\u4f1a\u5c06 url \u4f20\u9012\u7ed9\u64ad\u653e\u5668\u3002</p> <ol> <li>json \u89e3\u6790\u5f02\u5e38. </li> </ol> <p>\u95ee\u9898\uff1a \u7f51\u7edc\u8bf7\u6c42\u8fd4\u56dejson\u6570\u636e\u4e2d year \u5b57\u6bb5\u4e3a\u7a7a\uff0c\u4f1a\u5bfc\u81f4 kotlin serialization \u89e3\u6790\u5f02\u5e38</p> <p>\u539f\u56e0\uff1a schema \u91cc year \u7684\u5b57\u6bb5\u4e3a Int, kotlin.serialization \u65e0\u6cd5\u5c06 \u7a7a\u5b57\u7b26\u4e32\u89e3\u6790\u4e3a Int </p> <p>\u89e3\u51b3\u65b9\u6848\uff1a \u5c06 year \u5b57\u6bb5 \u7684\u7c7b\u578b\u8c03\u6574\u4e3a String</p> <ol> <li>\u83b7\u53d6\u6570\u636e\u5e93\u6570\u636e\u5931\u8d25</li> </ol> <p>\u95ee\u9898\uff1a\u5728\u4ece dataStore \u83b7\u53d6\u5230\u6570\u636e\u4e4b\u524d\uff0cuid\u7684\u503c\u5c31\u4f20\u9012\u7ed9\u4e86\u6570\u636e\u5e93</p> <p>\u89e3\u51b3\u65b9\u6848 \u5c06 \u4ece dataStore \u83b7\u53d6\u6570\u636e \u548c \u4ece \u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e \u5206\u522b\u653e\u5728 \u4e24\u6bb5 viewModelScope \u4e2d \u5373\u53ef</p> <pre><code>fun closeDrawer() = _uiState.update { it.copy(drawerValue = DrawerValue.Closed) }\n    private fun openDrawer() = _uiState.update { it.copy(drawerValue = DrawerValue.Open) }\n    fun onDrawerStateChange () {\n        if (uiState.value.drawerValue == DrawerValue.Closed) {\n            openDrawer()\n        } else {\n            closeDrawer()\n        }\n    }\n</code></pre>"},{"location":"notes/Android/http/","title":"Http","text":""},{"location":"notes/Android/http/#learn-http","title":"Learn http","text":"<ul> <li>privacy</li> <li>integrity</li> <li>indentification</li> </ul>"},{"location":"notes/Android/http/#about-deployment","title":"About Deployment","text":""},{"location":"notes/Android/http/#retrofit","title":"retrofit","text":""},{"location":"notes/Android/http/#dependency","title":"dependency","text":"<p>version for <code>org.jetbrains.kotlin.plugin.serialization</code> might leads to error, need some change based on project</p> <pre><code>id 'org.jetbrains.kotlin.plugin.serialization' version '1.7.10'\n\n\n// Retrofit \nimplementation \"com.squareup.retrofit2:retrofit:2.9.0\"\n// Retrofit with Scalar Converter\nimplementation \"com.squareup.retrofit2:converter-scalars:2.9.0\"\n\n// Kotlin serialization \nimplementation \"org.jetbrains.kotlinx:kotlinx-serialization-json:1.4.0\"\n\n// Retrofit with Kotlin serialization Converter  convert json to kotlin objects\nimplementation \"com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:0.8.0\"\n\n// OKHTTP3\nimplementation 'com.squareup.okhttp3:okhttp:4.10.0'\nimplementation 'com.squareup.okio:okio:3.2.0'\n</code></pre>"},{"location":"notes/Android/http/#android-permissions","title":"Android permissions","text":"<p>in <code>&lt;activity&gt;</code> tag add <code>&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;</code>  in <code>&lt;activity&gt;</code> tag add <code>android:usesCleartextTraffic=\"true\"</code> </p>"},{"location":"notes/Android/http/#how-to-use-retrofit","title":"How to use retrofit","text":"<ol> <li>creat <code>dataclass</code> with <code>@Serializable</code></li> </ol> <pre><code>@Serializable\ndata class MarsPhoto(\nval id: String,\n@SerialName(value = \"img_src\")\nval imgSrc: String\n)\n</code></pre> <ol> <li>creat network request api</li> </ol> <pre><code>interface SongApiService {\n@GET(\"music/{name}\")\nsuspend fun getSongInfo(@Path(\"name\") name: String): List&lt;SongInfo&gt;\n\n@GET(\"music/id/{rid}\")\nsuspend fun getSongUrl(@Path(\"rid\") rid: Int): MusicUrl\n}\n</code></pre> <ol> <li> <p>register in AppContainer</p> </li> <li> <p>initilize retrofit objects     <pre><code>private val retrofit: Retrofit = Retrofit.Builder()\n.addConverterFactory(Json.asConverterFactory(\"application/json\".toMediaType()))\n.baseUrl(SONG_URL)\n.build()\n</code></pre></p> </li> <li> <p>creat retrofit service based on api you create     <pre><code>private val retrofitService by lazy {\nretrofit.create(SongApiService::class.java)\n}\n</code></pre></p> </li> <li> <p>set up repositorty <code>override val songRepository: SongRepository by lazy { SongRepository(retrofitService) }</code></p> </li> <li> <p>set up viewModel</p> </li> </ol>"},{"location":"notes/Android/kotlin_syntax/","title":"Kotlin syntax","text":""},{"location":"notes/Android/kotlin_syntax/#kotlin_syntax","title":"kotlin_syntax","text":""},{"location":"notes/Android/kotlin_syntax/#lambda-expression","title":"lambda expression","text":"<p>In <code>kotlin</code>, lambda expression is widely used, now let us dive into  this feature.</p> <p>Suppose we want to get the item that has max lenghth in a list, we might write the following code <pre><code>val list = listOf(\"Apple\", \"Banana\", \"Orange\", \"Pear\", \"Grape\", \"Watermelon\")\n    var max = \"\"\n    for (fruit in list) {\n        if (fruit.length &gt; max.length) {\n            max = fruit\n        }\n}\n</code></pre> actually the above code can be shorten to oneline <pre><code>max = list.maxBy { it.length }\n</code></pre></p> <p>So, How does it work? - First, we need to know that maxBy actually takes a lambda function as an its arugment. In kotlin, if tha lambda expression is the only argument for a funtion, then the lambda expression could be extract outside, and parentheses could be omitted.(if the function have more than one argument, then we should keep it.)</p> <ul> <li>Ok, now we know, maxBy actually take a lambda, So what is the lambda function we are looking for. You could think about how <code>maxBy</code> are implemented</li> </ul> <pre><code>T maxBy (lambda f) {\n    max = \"\"\n    for (l in list) {\n        if (f(l) &gt;f(max)) {\n            max := l\n        }\n\n    }\n}  \n</code></pre> <p>Well, the function simply takes in an item, and return its length. Ok, now we could start to write the lambda <pre><code>val lambda = {f: String -&gt; f.length}\n\nmax = list.maxBy(lambda)\n=&gt; max = list.maxBy({f: String -&gt; f.length})\n=&gt; max = list.maxBy(){f: String -&gt; f.length}\n=&gt; max = list.maxBy {f: String -&gt; f.length}\n=&gt; max = list.maxBy{it.length}\n</code></pre> it reads, for every elemnet in a list, we will apply lambda and perform that function</p>"},{"location":"notes/Android/kotlin_syntax/#java-api","title":"Java \u51fd\u6570\u5f0f API \u7684\u4f7f\u7528","text":"<pre><code>new Thread(new Runnable() {\n@Override\npublic void run() {\n    System.out.println(\"Thread is running\");\n}\n}).start();\n=&gt; \nThread(object : Runnable {\noverride fun run() {\n  println(\"Thread is running\")\n}\n}).start()\n=&gt;\n\nThread(Runnable {\n    println(\"Thread is running\")\n}).start()\n\n=&gt; (\u7531\u4e8e\u51fd\u6570\u5217\u8868\u53ea\u6709\u4e00\u4e2a \u63a5\u53e3)\nThread({ \n    println(\"Thread is running\")\n}).start()\n\n=&gt; (\u7531\u4e8e lambda \u662f\u552f\u4e00\u4e00\u4e2a\u53c2\u6570)\nThread {\n    println(\"Thread is running\")\n}.start()\n</code></pre>"},{"location":"notes/Android/kotlin_syntax/#with-let-apply","title":"\u975e\u7a7a\u68c0\u67e5, with, let, apply","text":""},{"location":"notes/Android/kotlin_syntax/#_1","title":"\u975e\u7a7a\u68c0\u67e5","text":"<p><code>?.</code>, <code>!!</code>, <code>?:</code> <pre><code>fun getTextLength(text: String?) = text?.length ?: 0\nval upperCase = content!!.toUpperCase()\n</code></pre></p>"},{"location":"notes/Android/kotlin_syntax/#let","title":"let","text":"<p><pre><code>fun doStudy(study: Study?) {\n    study?.let {\n        it.readBooks()\n        it.doHomework()\n    }\n}\n</code></pre> actually it is  <pre><code>void let() \n{\n    for (s in study) \n    {\n        s?.some_function\n        s?.some_function\n        ...\n    }\n}\n</code></pre></p>"},{"location":"notes/Android/kotlin_syntax/#with-apply-run","title":"with apply run","text":"<p><pre><code>val result = with(StringBuilder()) {\n    append(\"Start eating fruits.\\n\")\n    for (fruit in list) {\n        append(fruit).append(\"\\n\")\n    }\n    append(\"Ate all fruits.\")\n    toString()\n}\n\n? with(object, f: lambda) \n{\n    f(object)\n}\n</code></pre> <pre><code>val result = StringBuilder().run {\n    append(\"Start eating fruits.\\n\")\n    for (fruit in list) {\n       append(fruit).append(\"\\n\")\n    }\n    append(\"Ate all fruits.\")\n    toString()\n}\n</code></pre></p> <pre><code>val result = obj.apply {\n// \u8fd9\u91cc\u662fobj\u7684\u4e0a\u4e0b\u6587\n}\n// result == obj\n\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u518d\u4f7f\u7528apply\u51fd\u6570\u6765\u4fee\u6539\u4e00\u4e0b\u5403\u6c34\u679c\u7684\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a\nval list = listOf(\"Apple\", \"Banana\", \"Orange\", \"Pear\", \"Grape\")\nval result = StringBuilder().apply {\n    append(\"Start eating fruits.\\n\")\n    for (fruit in list) {\n        append(fruit).append(\"\\n\")\n    }\n    append(\"Ate all fruits.\")\n}\n</code></pre>"},{"location":"notes/Android/kotlin_syntax/#summary","title":"Summary","text":"<p>if we want to perform some actions on the list of objects, we could use <code>let</code> funtion</p> <p>if we want to perform some operation on the spercific objects, we could use <code>run</code> , <code>apply</code> , <code>with</code> .</p>"},{"location":"notes/Android/material_design/","title":"Material design","text":""},{"location":"notes/Android/material_design/#material_design","title":"material_design","text":"<p>material design aims to provide a design standard for all android apps. It not only reduece the time developers spending in Ui design, but also provides users a consistent experience using different apps</p> <p>it mainly has five parts</p>"},{"location":"notes/Android/material_design/#color","title":"color","text":"<p>color spread in four places TopAppBar primary App: background item: surface (content) icon: secondary</p> <ul> <li>define color in <code>ui/theme/color.kt</code></li> <li>set up color in <code>ui/theme/Theme.kt</code> </li> </ul> <p>code sample</p> <pre><code>// in color \n//Light Theme\nval Grey50 = Color(0xFFF8F9FA)\n...\n\n//Dark Theme\nval White = Color(0xFFFFFFFF)\n...\n\n// in theme\n\nprivate val DarkColorPalette = darkColors(\n    background = Cyan900,\n    surface = Cyan700,\n    onSurface = Grey100,\n    primary = White,\n    onPrimary = Grey100,\n    secondary = Grey900\n)\n</code></pre>"},{"location":"notes/Android/material_design/#typo","title":"typo","text":"<ul> <li>new a <code>Android resource directory</code> named <code>font</code> in <code>res</code> foldr</li> <li>put downloaded font in <code>font</code> dir</li> <li> <p>set up font in <code>ui/theme/typo.kt</code> </p> </li> <li> <p>initilize Fonts <pre><code>// Set of Material typography styles to start with\nval AbrilFatface = FontFamily(\n    Font(R.font.abril_fatface_regular)\n)\n\nval Montserrat = FontFamily(\n    Font(R.font.montserrat_regular),\n    Font(R.font.montserrat_bold, FontWeight.Bold)\n)\n</code></pre></p> </li> <li> <p>set up for font size range from h1 - h6 &amp; body</p> </li> </ul> <pre><code>val Typography = Typography(\n    h1 = TextStyle(\n        fontFamily = AbrilFatface,\n        fontWeight = FontWeight.Normal,\n        fontSize = 30.sp\n    ),\n    h2 = TextStyle(\n        fontFamily = Montserrat,\n        fontWeight = FontWeight.Bold,\n        fontSize = 20.sp\n    ),\n    h3 = TextStyle(\n        fontFamily = Montserrat,\n        fontWeight = FontWeight.Bold,\n        fontSize = 14.sp\n    ),\n    body1 = TextStyle(\n        fontFamily = Montserrat,\n        fontWeight = FontWeight.Normal,\n        fontSize = 14.sp\n    )\n\n)\n</code></pre> <p>&lt;++&gt;</p>"},{"location":"notes/Android/material_design/#shape","title":"shape","text":""},{"location":"notes/Android/material_design/#some-great-functions","title":"some great functions","text":"<ol> <li><code>modifier.weight()</code> specify the propotion of current component <p>some question, where did this component align to given allocated space</p> </li> <li><code>modifier.padding(horizonal = , vertical = )</code> \u8fd9\u6307\u5b9a\u4e86 <code>modifier</code> \u4fee\u9970\u7684\u5bf9\u8c61\u4e0e\u5916\u90e8\u5bf9\u8c61\u7684 <code>padding</code> </li> <li></li> </ol>"},{"location":"notes/Android/navigation/","title":"Navigation","text":""},{"location":"notes/Android/navigation/#how-to-use-navagation","title":"How to use navagation","text":"<ol> <li> <p>add dependency <code>implementation \"androidx.navigation:navigation-compose:2.5.3\"</code> </p> </li> <li> <p>using enum or object to distinguish screen.</p> </li> </ol> <p>sample code</p> <pre><code>enum class LunchTrayScreens(@StringRes val title: Int) {\n    START(title = R.string.start_order),\n    ENTREE_MENU(title = R.string.choose_entree),\n    SIDE_DISH_MENU(title = R.string.choose_side_dish),\n    ACCOMPANIMENT_MENU(title = R.string.choose_accompaniment),\n    CHECKOUT(title = R.string.order_summary),\n}\n</code></pre> <p>&lt;++&gt;</p> <ol> <li>build Up Navgation host <code>NavHost</code> </li> </ol> <p><code>NavHost</code> is responsible for choose screen to display</p> <p>It basically takes four arguments</p> <ul> <li><code>modifier</code> </li> <li><code>navController</code> get it by <code>rememberNavController</code> </li> <li><code>startLocation</code> initial screen to display</li> <li><code>content</code> compose function<ul> <li>the content is consisted of multiple <code>composable</code>, each of which is the screen to display</li> <li><code>composable</code> take <code>location</code> and <code>content</code> as its arguments</li> </ul> </li> </ul> <p>sample code</p> <pre><code> NavHost(\n            navController = naviController,\n            startDestination = LunchTrayScreens.START.name,\n            modifier = Modifier.padding(innerPadding)\n        ) {\n            composable(LunchTrayScreens.START.name) {\n                StartOrderScreen(onStartOrderButtonClicked = {\n                    naviController.navigate(LunchTrayScreens.ENTREE_MENU.name)\n                })\n            }\n            // ...\n    }\n</code></pre> <ol> <li>build up TopAppbar</li> </ol> <p>sample code</p> <pre><code> TopAppBar(\n        modifier = modifier,\n        title = { Text(text = stringResource(id = currentScreens.title)) },\n        navigationIcon = {\n            if (canNavigateBack) {\n                IconButton(onClick = navigateUp) {\n                    Icon(\n                        imageVector = Icons.Filled.ArrowBack,\n                        contentDescription = stringResource(id = R.string.back_button)\n                    )\n                }\n            }\n        }\n    )\n</code></pre> <p>In main activity <pre><code> val backStackEntry by naviController.currentBackStackEntryAsState()\n    // TODO: Get the name of the current screen\n    val currentScreen = LunchTrayScreens.valueOf(backStackEntry?.destination?.route  ?:\n    LunchTrayScreens.START.name)\n</code></pre></p> <ol> <li> <p>useful function</p> </li> <li> <p>popstack <code>navController.popBackStack(LunchTrayScreens.START.name, false)</code></p> </li> <li> <p>\u8fd4\u56de\u4e0a\u4e00\u7ea7\u76ee\u5f55 <code>navController.navigateUp()</code> </p> </li> <li> <p>Navigating With arguments</p> </li> <li> <p>\u53d1\u9001\u53c2\u6570 <code>navController.navigate(\"${route}\"/${id})</code>. Note The the value of <code>id</code> is specified by you. (act as a <code>key</code> to get value)</p> </li> <li> <p>\u63a5\u53d7\u53c2\u6570 </p> </li> </ol> <p>note the brackets <pre><code>// \u63a5\u6536 \u4e00\u4e2a\u53c2\u6570\ncompose(route = ${route}\"/{${id}}) \n// \u63a5\u6536\u591a\u4e2a\u53c2\u6570\ncompose(route = ${route}\"/{${id}}, arguments = listOf(navArgument(ItemDetailsDestination.itemIdArg) {\n                type = NavType.IntType })) \n</code></pre> - \u83b7\u53d6\u53c2\u6570 1. using <code>viewModel</code> </p> <pre><code>private val songId: Int = checkNotNull(savedStateHandle[\"id\"])\n</code></pre> <ol> <li>using <code>navigation</code> </li> </ol> <pre><code>composable(\"profile/{userId}\") { backStackEntry -&gt;\n    Profile(navController, backStackEntry.arguments?.getString(\"userId\"))\n}\n</code></pre>"},{"location":"notes/Android/viewModel/","title":"viewModel","text":""},{"location":"notes/Android/viewModel/#viewmodel","title":"viewModel","text":"<ol> <li>dependency</li> </ol> <pre><code>ext {\n        compose_version = '1.3.0'\n        compose_compiler_version = '1.3.0'\n        lifecycle_version = '2.5.1'\n    }\n\n\nimplementation \"androidx.lifecycle:lifecycle-viewmodel-compose:$lifecycle_version\"\n</code></pre> <p>&lt;++&gt;</p> <ol> <li>create uiState. <p>\u4ec0\u4e48\u5c5e\u6027\u8981\u88ab\u653e\u8fdb uiState \u91cc\u5462, \u539f\u672c\u5728Ui\u754c\u9762\uff0c\u7c7b\u578b\u4e3a<code>mutableState</code> \u7684\u53d8\u91cf\u90fd\u5e94\u8be5\u653e\u5165uiState \u8fd9\u4e2a\u7c7b\u4e2d</p> </li> </ol> <p>\u6700\u597d\u7ed9\u6bcf\u4e00\u4e2a\u5c5e\u6027\u8d4b\u521d\u59cb\u503c\uff0c\u5728viewModel\u4e2d\u7528\u7684\u4e0a 2. create viewModel</p> <p>\u6bcf\u4e00\u4e2a <code>viewModel</code> \u5e94\u8be5\u6709\u4e00\u4e2a <code>uiStata</code> \u7528\u6765\u53cd\u6620 Ui \u5f53\u524d\u6240\u5904\u7684\u72b6\u6001.</p> <p>sample code</p> <pre><code>// why mutable: mutable means we can change value for current stateflow\n    // when _uiState changes, schedule a recomposition\n    private var _uiState = MutableStateFlow(DessertUiState())\n\n    // the uiState we expose to user is immutable\n    val uiState: StateFlow&lt;DessertUiState&gt; = _uiState.asStateFlow()\n\n    private var revenue by mutableStateOf(0)\n\n    var dessertSold by mutableStateOf(0)\n            private set\n\n    var currentDessert by mutableStateOf(dessertList[0])\n</code></pre> <ol> <li> <p>\u5728 Ui layer \u4e2d\uff0c\u521d\u59cb\u5316 <code>viewModel</code></p> </li> <li> <p>\u53ef\u4ee5\u76f4\u63a5\u5728\u51fd\u6570\u7684\u53c2\u6570\u5904\uff0c\u521b\u5efa<code>viewModel</code> </p> </li> </ol> <p>sample code</p> <pre><code>@Composable\nprivate fun DessertClickerApp(\n    viewModel:DessertViewModel = DessertViewModel()\n) {\n    val uiState = viewModel.uiState.collectAsState()\n    // if you use `by`, then you do not need `uiState.value` to get value, \n    // it auto - overloads get method \n//    val uiState by viewModel.uiState.collectAsState()\n// ... ... \n}\n</code></pre>"},{"location":"notes/Android/%E7%88%AC%E8%99%AB%E5%88%86%E6%9E%90/","title":"\u722c\u866b\u5206\u6790","text":"<ol> <li>\u5728\u5bf9\u7f51\u9875\u8fdb\u884c\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u7559\u610f\u4e00\u4e0b \u8bf7\u6c42\u7684\u7b5b\u9009\u680f \u548c \u65f6\u95f4\u7684\u7b5b\u9009\u680f\u3002</li> <li>\u9177\u6211\u97f3\u4e50\u66f4\u65b0\u4e86\u7f51\u8def\u8bf7\u6c42 \u5173\u952e\u8bcd\u662f searchMusicbyKeyWord, \u8fd4\u56de\u7684\u6570\u636e\u5bf9\u5e94\u7684\u540d\u79f0\u662f abslist, \u7136\u540e\u6240\u6709\u5c5e\u6027\u540d\u90fd\u53d8\u6210\u5927\u5199\u4e86\u3002</li> <li>rid \u53d8\u6210\u4e86 DC_xxx</li> <li>song_info \u7684\u7c7b\u578b\u8981\u548cAndroid\u7684type\u4e00\u81f4\u3002(String -&gt; Str, Int -&gt; int) \u4e0d\u4e00\u81f4\u7684\u8bdd\uff0c\u4f1a\u51fa\u73b0\u95ea\u9000     \u4e4b\u524d\u6ca1\u6709\u95ee\u9898\u662f\u56e0\u4e3a\uff0c\u867d\u7136 python class \u7684 SongInfo \u7684 year \u7684\u7c7b\u578b\u6807\u6ce8\u662f Int\uff0c \u4f46\u662fpython\u662f\u5f31\u7c7b\u578b\u8bed\u8a00\uff0c\u6211\u5c31\u7b97\u7ed9\u4ed6\u8d4b\u503c\u4e00\u4e2a     string \u4e5f\u6ca1\u5173\u7cfb\u3002</li> <li>\u6700\u540e\u5c31\u662f\uff0c\u901a\u8fc7 python \u7684 fstring \u4f20\u9012\u53c2\u6570\u53ef\u4ee5\u907f\u514d\u4e2d\u6587\u4e71\u7801\u95ee\u9898 (\u5982\u679c\u901a\u8fc7 response(params=params)) \u4f20\u9012\u7684\u8bdd\uff0c\u7528\u6237\u8bf7\u6c42\u4e2d\u6587     \u6b4c\u66f2\u4f1a\u4e71\u7801\u3002</li> <li>This completes the project</li> </ol>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/","title":"\u9700\u6c42\u6587\u6863","text":""},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_1","title":"\u79fb\u52a8\u5e94\u7528\u5f00\u53d1\u5b9e\u9a8c\u671f\u672b\u6280\u672f\u62a5\u544a","text":""},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_2","title":"\u9009\u9898\u5efa\u8bae","text":"<ul> <li>\u5728\u7ebf\u97f3\u4e50\u64ad\u653eAPP</li> <li>\u5728\u7ebf\u9884\u544a\u7247\u64ad\u653eAPP</li> <li>\u5728\u7ebf\u5929\u6c14\u9884\u62a5APP</li> <li>\u5728\u7ebf\u65b0\u51a0\u80ba\u708e\u75ab\u60c5\u64ad\u62a5APP</li> <li>\u5728\u7ebf\u7535\u89c6\u8282\u76ee\u9884\u544aAPP</li> <li>\u5728\u7ebf\u7535\u5f71\u64ad\u653eAPP</li> <li>\u5728\u7ebf\u65b0\u95fbAPP</li> <li>\u5728\u7ebf\u65c5\u6e38\u8def\u7ebf\u89c4\u5212APP</li> <li>\u57fa\u4e8e\u4e92\u8054\u7f51\u7684\u8054\u7f51\u6e38\u620fAPP</li> <li>\u5728\u7ebf\u667a\u80fd\u804a\u5929APP</li> </ul>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_3","title":"\u529f\u80fd\u8981\u6c42","text":"<ul> <li> \u7528\u6237\u7684\u767b\u5165\u548c\u6ce8\u518c</li> <li> \u53ef\u4ee5\u81ea\u5b9a\u4e49\u7528\u6237\u4fe1\u606f</li> <li> \u53ef\u4ee5\u4fee\u6539App\u7684\u4e3b\u9898\u6837\u5f0f</li> <li> \u80fd\u591f\u8bbf\u95ee\u7f51\u7edc</li> <li> \u4f7f\u7528\u6570\u636e\u5e93</li> <li> \u4f7f\u7528\u5e76\u53d1\u5904\u7406</li> </ul>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_4","title":"\u8bbe\u8ba1\u601d\u8def","text":""},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_5","title":"\u8bbe\u8ba1\u9636\u6bb5","text":"<p>prerequest 1. finish proj for room and navigation and viewModel  2. take a look at injection and </p> <ol> <li>\u5229\u7528Room \u5b9e\u73b0\u7528\u6237\u767b\u5165\uff0c\u767b\u5165\u754c\u9762\u663e\u793a\u504f\u597d\u83dc\u5355\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u7528\u6237\u6240\u9009\u62e9\u7684\u504f\u597d \u5e76\u4e14\u80fd\u66f4\u5177\u7528\u6237\u7684\u9009\u62e9\u8c03\u6574\u754c\u9762<ol> <li>\u5b9e\u73b0\u6b4c\u5355\u529f\u80fd</li> </ol> </li> </ol>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#_6","title":"\u5b89\u88c5\u73af\u5883","text":"<ol> <li> <p>Android Studio \u603b\u662f\u9ed8\u8ba4gradle \u7684\u4f4d\u7f6e\u5728 C \u76d8\u4e0b</p> </li> <li> <p>fixed by adding Environment Variable <code>GRADLE_USER_HOME</code> in windows user <code>path</code> </p> </li> <li> <p>\u4e0b\u8f7d\u5305\u7684\u901f\u5ea6\u5f88\u6162</p> </li> <li> <p>fixed by add proxy configration in <code>${GRADLE_USER_HOME}/gradle.properties</code> (\u6ca1\u6709\u5c31 \u81ea\u5df1\u521b\u5efa\u4e00\u4e2a)</p> </li> </ol> <pre><code>systemProp.http.proxyHost=127.0.0.1\nsystemProp.http.proxyPort=7890\nsystemProp.https.proxyHost=127.0.0.1\nsystemProp.https.proxyPort=7890\n</code></pre> <ul> <li> <p>\u4e5f\u53ef\u4ee5\u5207\u6362\u955c\u50cf</p> </li> <li> <p>setup for firebase</p> </li> </ul> <p>we should only add <code>buildscript</code> in the top of <code>buidl.gradle</code> for project</p> <pre><code>// added  \u53ea\u9700\u8981\u52a0\u8fd9\u4e48\u591a\u5c31\u591f\u4e86\nbuildscript {\n    dependencies {\n        classpath 'com.google.gms:google-services:4.3.14'\n    }\n}\n// added\n\nplugins {\n    id 'com.android.application' version '7.3.0' apply false\n    id 'com.android.library' version '7.3.0' apply false\n    id 'org.jetbrains.kotlin.android' version '1.7.10' apply false\n}\n\n```xml\n// Retrofit \nimplementation \"com.squareup.retrofit2:retrofit:2.9.0\"\n// Retrofit with Scalar Converter\nimplementation \"com.squareup.retrofit2:converter-scalars:2.9.0\"\n// Kotlin serialization \nimplementation \"org.jetbrains.kotlinx:kotlinx-serialization-json:1.4.0\"\n// Retrofit with Kotlin serialization Converter\nimplementation \"com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:0.8.0\"\n // Room\nadd room_ver\nimplementation \"androidx.room:room-runtime:$room_version\"\nksp \"androidx.room:room-compiler:$room_version\"\nimplementation \"androidx.room:room-ktx:$room_version\"\n\npreference\nimplementation \"androidx.datastore:datastore-preferences:1.0.0\"\n</code></pre>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#notes","title":"notes","text":""},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#random","title":"random","text":"<ol> <li><code>mutableListOf</code> is a function, it returns <code>MutableList</code>. do not mixed method and type</li> <li><code>inline</code> function reduce the overhead for creating object for every time lambda is called</li> <li>about lambda functions. The type of lambda function is something like <code>(Int) -&gt; Unit</code>  and if you want to write a lambda fucntion, it is <code>{(a:Int, b:Int -&gt; {})}</code> </li> </ol> <p><pre><code>val demo1 = {a:Int, b:Int -&gt; {var c = a + b; println(c) }}\nval north = {game: Game -&gt; game.path.add(Directions.NORTH)}\nval south = {game: Game -&gt; game.path.add(Directions.SOUTH)}\nval west = {game: Game -&gt; game.path.add(Directions.WEST)}\nval east = {game: Game -&gt; game.path.add(Directions.EAST)}\n\nval end = {\n    game:Game -&gt; game.apply {\n        path.add(Directions.END)\n        println(path.joinToString { it.name + \" \" })\n        println(\"Game Over\")\n}\n}\n</code></pre> EditorChooseLookupItemReplace</p> <ul> <li> <p>import android.compose.runtime.* if mutableState function have some problem.</p> </li> <li> <p>why this is work <pre><code> gameViewModel: GameViewModel = viewModel()) { // gameViewModel extends viewModel, how can we assign to it\n</code></pre></p> </li> <li> <p>put attribute initilization before init function you can review that by watching viedo afterwards</p> </li> </ul> <p>be calm , you can never achieve if you stop meaningless comparsion</p> <p>JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8</p> <p>when you retrieve item from flow type - lifecycle events changes like rotatation or  quitting from the app</p> <ul> <li>cached data</li> <li>properly canceled flows</li> </ul> <p>In this step, you'll retrieve all items in the Room database as a StateFlow observable API for UI state. When the Room Inventory data changes, the UI updates <code>automatically</code>.</p> <ul> <li> <p>aspectRatio \u662f\u957f\u5bbd\u6bd4, \\(\\frac{length}{width}\\) = aspectRatio</p> </li> <li> <p>preference for simple, proto for user-defined</p> </li> </ul> \\[ \\begin{align*}     1 + 2 = 3 \\end{align*} \\] <p>&lt;++&gt; <pre><code>import math\n\nprint(\"World\")\n</code></pre></p> <p>&lt;++&gt;</p>"},{"location":"notes/Android/%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/#dependencies-and-usage","title":"dependencies and usage","text":"<ul> <li>links to error </li> <li>link to viewModel &lt;++&gt;</li> <li>link to room &lt;++&gt;</li> <li>link to navagation </li> <li>link to retrofit </li> <li>link to material design </li> <li>link to dataStore </li> <li>link to http </li> <li>link to gadgets </li> <li>link to Coroutine &lt;++&gt;</li> </ul>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/","title":"Cpp\u7b14\u8bb0","text":""},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week2","title":"week2 \u7c7b\u4e0e\u5bf9\u8c61","text":"<p>\u5b9a\u4e49\u662f\u58f0\u660e\u7684\u4e00\u79cd (defination is a type of declartion)</p> <ul> <li>\u5982\u679c\u53ea\u7ed9\u51fa\u51fd\u6570\u58f0\u660e\uff0c\u6ca1\u6709\u7ed9\u51fa\u51fd\u6570\u4f53\uff0c\u90a3\u4e48\u8fd9\u5c31\u53ea\u662f\u58f0\u660e\uff0c\u4e0d\u662f\u5b9a\u4e49\u3002</li> <li>cpp \u5141\u8bb8\u4e00\u4e2a\u53d8\u91cf\u88ab\u591a\u6b21\u58f0\u660e\uff0c\u4f46\u662f\u53ea\u80fd\u88ab\u5b9a\u4e49\u4e00\u6b21\u3002</li> </ul> <pre><code>extern int i;\nextern int i;\n</code></pre> <p>\u50cf\u4e0a\u8ff0\u60c5\u51b5\u662f\u88ab\u5141\u8bb8\u7684</p> <p>\u6210\u5458\u3001this\u3001\u7c7b\u578b\u522b\u540d </p> <pre><code>member-specificaton\n    member-declartion member-specificaton\n    access-specifier: member-specificaton\n</code></pre> <p>c++11 \u5f15\u5165\u4e86 <code>using</code> \u6765\u4ee3\u66ff <code>typedef</code> \u4f7f\u7528 <code>using</code> \u5b9a\u4e49\u7684\u522b\u540d\u540c\u6837\u4e5f\u53d7 <code>access-specifier</code> \u7684\u63a7\u5236\u3002</p> <p>\u7c7b\u5185\u7684\u6210\u5458\u51fd\u6570\u90fd\u6709\u4e00\u4e2a\u9690\u5f0f\u53c2\u6570\uff0c\u8fd9\u4e2a\u9690\u5f0f\u53c2\u6570\u662f\u6307\u5411\u6210\u5458\u51fd\u6570\u6240\u5c5e\u5bf9\u8c61\u7684\u6307\u9488\u3002</p> <pre><code>class Foo {\n    int a;\n    void bar() {\n        a += 1;\n    }\n    // \u5b9e\u9645\u4e0a\n    void bar(Foo* this) {\n        this-&gt;a += 1;\n    }\n}\n</code></pre> <p>inline substisution </p> <p>\u7531\u4e8e\u51fd\u6570\u8c03\u7528\u6709\u5f00\u9500\uff0c\u7f16\u8bd1\u5668\u4f1a\u5c06\u7c7b\u5185\u6210\u5458\u51fd\u6570\u5185\u8054\u66ff\u6362 (inline substisution)\u3002 \u6240\u8c13\u5185\u8054\u66ff\u6362\uff0c\u5c31\u662f\u6307\u5c06 \u51fd\u6570\u5185\u5bb9\u539f\u5730\u5c55\u5f00</p> <p>\u65e9\u671f\u4f7f\u7528 <code>inline</code> \u5173\u952e\u5b57\u53ef\u4ee5\u589e\u5927\u7f16\u8bd1\u5668\u5c06\u51fd\u6570\u8fdb\u884c\u5185\u8054\u7684\u53ef\u80fd\uff0c\u73b0\u4ee3\u7f16\u8bd1\u5668\u53ef\u80fd\u4e0d\u4f1a\u7ba1\u8fd9\u4e2a\u58f0\u660e\u4e86\u3002</p> <p>Compiler: Nobody knows inline function more than I do</p> <p>\u6784\u9020\u51fd\u6570 </p> <p>\u5982\u679c\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\u540c\u65f6\u88ab member initializer list \u6307\u5b9a\u4e14\u6709 default member initializer\uff0c\u6309\u524d\u8005\u6267\u884c\uff0c\u540e\u8005\u88ab\u5ffd\u7565\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4e3a\u9ed8\u8ba4\u503c\uff0c\u5c31\u4e0d\u8981\u5199\u5728 default member initializer</p>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week-3","title":"week 3","text":"<p>\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26 (copy) </p> <p>\u5728\u6211\u4eec\u4f7f\u7528 <code>a = b</code> \u7c7b\u4f3c\u7684\u8bed\u53e5\u65f6\uff0c\u6211\u4eec\u5176\u5b9e\u5728\u8c03\u7528 <code>.operator=(elem foo)</code> \u51fd\u6570\u3002 \u548c\u6784\u9020\u51fd\u6570\u7c7b\u4f3c\uff0c\u5982\u679c\u7528\u6237\u6ca1\u6709\u91cd\u8f7d\u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u90a3\u4e48cpp\u4f1a\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u7684 <code>.operator</code> \u51fd\u6570\u3002 \u8fd9\u4e2a\u51fd\u6570\u5728\u8d4b\u503c\u65f6\uff0c\u9ed8\u8ba4\u8c03\u7528\u6210\u5458\u7684 <code>.operator</code> \u8fdb\u884c\u8d4b\u503c\u3002</p> <p>\u8fd0\u7b97\u7b26\u91cd\u8f7d </p> <p>\u5f15\u7528 </p> <p>\u5f53\u5bf9\u8c61\u6240\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\u65f6\uff0c\u5728\u51fd\u6570\u4f20\u53c2\u6570\u65f6\u505a\u503c\u4f20\u9012\u5f88\u6d6a\u8d39\u7a7a\u95f4, \u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u4f20\u9012\u6307\u9488\u6216\u8005\u5f15\u7528\u3002 \u5f15\u7528\u5c31\u662f\u4e00\u4e2a\u5bf9\u8c61\u7684\u522b\u540d\u3002\u6bd4\u5982</p> <pre><code>int x = 1;\nint &amp; y = x;\n</code></pre> <p>\u4e4b\u540e\u5bf9 <code>y</code> \u7684\u64cd\u4f5c\u5c31\u7b49\u540c\u4e8e\u5bf9 <code>x</code> \u7684\u3002</p> <pre><code>y = 3; // x = 3\nint z = 4;\ny = z; // x = 4 \u6ce8\u610f\u5230\u8fd9\u91cc\u5e76\u4e0d\u662f\u5c06y\u7ed1\u5b9a\u5230z\uff0c\u800c\u662f\u5c06z\u7684\u503c\u8d4b\u503c\u7ed9y\u8bf4\u5f15\u7528\u7684\u5bf9\u8c61x\u3002\n</code></pre> <p>\u56de\u5230\u6700\u521d\u7684\u8bdd\u9898\uff0c\u6211\u4eec\u77e5\u9053\u5728c\u8bed\u8a00\u91cc\uff0c\u53ef\u4ee5\u4f7f\u7528\u6307\u9488\u6765\u907f\u514d\u53c2\u6570\u4f20\u9012\u6240\u5e26\u6765\u7684\u5185\u5b58\u6d6a\u8d39\uff0c\u54ea\u53c8\u4f55\u5fc5\u518d\u5f15\u5165\u5f15\u7528\u5462\uff1f \u8fd9\u5c31\u548c\u4e0a\u8282\u8bfe\u6240\u8bb2\u8ff0\u7684 \u8fd0\u7b97\u7b26\u91cd\u8f7d\u6709\u5173\u7cfb\u4e86\uff0c\u8003\u8651\u4e0b\u9762\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code>// Matrix.c\n\nMatrix operator-(Matrix other) {\n    ...\n    return *this;\n}\n\nMatrix m1, m2;\n\n//... initilizing m1 and m2\n\nauto m = m1 - m2;\n</code></pre> <p>\u6211\u4eec\u91cd\u8f7d\u4e86\u77e9\u9635\u7c7b\u7684\u51cf\u6cd5\u64cd\u4f5c, \u91cd\u8f7d\u51fd\u6570\u7684\u53c2\u6570\u662f <code>Matrix</code> \u7c7b\u578b\u7684\u3002\u4e0a\u9762\u6211\u4eec\u63d0\u5230\u8fc7\uff0c\u76f4\u63a5\u503c\u4f20\u9012\u4f1a\u9020\u6210\u5de8\u5927\u7684\u5185\u5b58\u6d6a\u8d39\u3002\u800c\u8fd9\u91cc\u8981\u4f7f\u7528\u6307\u9488\u8fdb\u884c\u91cd\u8f7d\u7684\u8bdd\uff0c\u4f1a\u663e\u5f97\u4e0d\u76f4\u89c2\u3002</p> <pre><code>// \u5982\u679c\u4f7f\u7528\u6307\u9488\u7c7b\u578b\u8fdb\u884c\u91cd\u8f7d\n\nauto m = m1 - &amp;m2;\naut0 m = &amp;m1 - &amp;m2;\n</code></pre> <p>\u6240\u4ee5\u6211\u4eec\u5c31\u5f15\u5165\u4e86\u5f15\u7528\u8fd9\u4e2a\u8fd0\u7b97\u7b26\u3002</p> <pre><code>Matrix operator-(Matrix &amp; other) {\n    // other \u5c31\u662f m2 \u7684\u4e00\u4e2a\u522b\u540d\uff0c\u4f20\u53c2\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u8fdb\u884c\u62f7\u8d1d\u64cd\u4f5c\n}\n\nauto m = m1 - m2; \n</code></pre> <p>\u5f15\u7528(&amp;)\u4e0e c \u8bed\u8a00\u4e2d\u7684 <code>type * const</code> \u7c7b\u578b , \u5b83\u53ea\u80fd\u6539\u53d8\u6240\u6307\u5411\u5bf9\u8c61\u7684\u503c\uff0c\u800c\u4e0d\u80fd\u81ea\u8eab\u7684\u6307\u5411\u3002 \u6211\u4eec\u53ef\u4ee5\u5bf9\u5f15\u7528\u8fdb\u4e00\u6b65\u9650\u5236\uff0c<code>const type &amp;</code> , \u8fd9\u6837\u5f15\u7528\u5bf9\u8c61\u5373\u4e0d\u53ef\u4ee5\u6539\u53d8\u6240\u6307\u5411\u5bf9\u8c61\u7684\u503c\uff0c\u4e5f\u4e0d\u80fd\u6539\u53d8\u81ea\u8eab\u7684\u6307\u5411\u3002( \u7c7b\u4f3c <code>const type * const</code> ) </p> <p>about const</p> <ul> <li>\u5982\u679c\u6210\u5458\u51fd\u6570\u6ca1\u6709\u6539\u53d8\u7c7b\u5185\u5c5e\u6027\u7684\u503c\uff0c\u5219\u5e94\u8be5\u7ed9\u5176\u52a0\u4e0aconst \u6807\u7b7e</li> <li>const iter: \u53ef\u4ee5\u6539\u53d8 iter \u6240\u6307\u5411\u7684\u503c\uff0c\u4e0d\u80fd\u6539\u53d8\u6307\u5411</li> <li> <p>const cons_iter \u53ef\u4ee5\u6539\u53d8\u6307\u5411\uff0c\u4e0d\u80fd\u6539\u53d8\u503c</p> </li> <li> <p>const \u6210\u5458\u51fd\u6570\u5b9e\u9645\u4e0a\u662f\u7ed9\u7f16\u8bd1\u5668\u63d0\u4f9b\u7684\u4e00\u4e2a\u4fdd\u8bc1\uff0c\u5982\u679c\u4e00\u4e2a \u7c7b\u7684\u7c7b\u578b\u662f const, \u90a3\u4e48\u8c03\u7528 const \u65b9\u6cd5 problem\u4fdd\u8bc1\u4e0d\u4f1a\u4fee\u6539\u8fd9\u4e2a\u7c7b\u7684\u5185\u5bb9\u3002</p> </li> <li>const \u4e0e \u975e const \u6210\u5458\u51fd\u6570\u662f\u53ef\u4ee5\u5171\u5b58\u7684\uff0c\u524d\u8005 \u7f16\u8bd1\u5668\u9690\u5f0f\u4f20\u5165\u7684\u53c2\u6570\u662f T this, \u540e\u8005\u662f const T this</li> </ul>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week-4","title":"week 4","text":"<p>\u6807\u51c6\u8f6c\u6362 \u7528\u6237\u81ea\u5b9a\u4e49\u8f6c\u6362</p> <p>\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165 \u7528\u6237\u81ea\u5b9a\u4e49\u8f6c\u6362 ?</p> <p>\u6765\u770b\u4e0b\u9762\u4e00\u4e2a\u4f8b\u5b50</p> <p>\u6ce8\u610f \u5982\u679c\u662f\u5c06 \u51fd\u6570\u58f0\u660e\u548c\u5b9e\u73b0\u5206\u5f00\u5199\u7684\uff0c\u4e14\u58f0\u660e\u6307\u5b9a\u4e86\u65b9\u6cd5\u4e3a const\uff0c \u90a3\u4e48\u5b9e\u73b0\u91cc\u7684\u51fd\u6570\u5934\u4e5f\u8981\u6307\u5b9a\u4e3a const</p> <p>copy elision </p> <p>\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u8fd4\u56de\u7684\u662f\u548c\u8fd4\u56de\u7c7b\u578b\u76f8\u540c\u7684\u4e34\u65f6\u503c\uff0c\u90a3\u4e48\u62f7\u8d1d\u4f1a\u88ab\u7701\u7565 \u5982\u679c\u4e00\u4e2a\u51fd\u6570\u8fd4\u56de\u7684\u662f\u548c\u521d\u59cb\u5316\u8868\u8fbe\u5f0f\u7c7b\u578b\u76f8\u540c\u7684\u4e34\u65f6\u503c\uff0c\u90a3\u4e48\u62f7\u8d1d\u4f1a\u88ab\u7701\u7565</p> <p><pre><code>T f() {\n    return T();\n}\n\nint main() {\n    f();\n}\n</code></pre> \u6ca1\u6709\u4f18\u5316\u7684\u65f6\u5019\uff0c\u4f1a\u5728 f() \u5185\u8c03\u7528\u4e00\u6b21 \u9ed8\u8ba4\u6784\u9020\u51fd\u6570 \u5f97\u5230\u4e34\u65f6\u5bf9\u8c611\u3002 \u4e4b\u540e\u5728 main \u4f7f\u7528 \u4e34\u65f6\u5bf9\u8c612 \u7684\u62f7\u8d1d\u6784\u9020\u51fd\u6570 \u8c03\u7528 \u4e34\u65f6\u5bf9\u8c611 \u5b8c\u6210\u6784\u9020\u3002</p> <p>\u4f18\u5316\u540e \u76f4\u63a5\u5728\u8fd4\u56de\u65f6\u8fdb\u884c\u9ed8\u8ba4\u6784\u9020\u3002</p> <p>rule of three: rule of zero: </p>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week-5-6","title":"week 5, 6","text":"<p>\u6a21\u677f\u548c\u5143\u7f16\u7a0b \u5177\u6709\u770b cpp reference \u5b66\u4e60\u7684\u80fd\u529b</p> <p>\u5bb9\u5668\u548c\u7b97\u6cd5\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u8fed\u4ee3\u5668\u662f\u5728\u4e24\u8005\u6c9f\u901a\u7684\u6865\u6881\u3002</p> <p>ptr++ \u548c ++ptr \u8fd9\u4e24\u8005\u7684\u8fd0\u7b97\u7b26\u91cd\u8f7d\u7a0d\u6709\u533a\u522b</p> <p>\u6cdb\u578b\u7f16\u7a0b\u4e0e\u6a21\u677f </p> <p>\u901a\u8fc7\u7ee7\u627f\u5b9e\u73b0\u6cdb\u578b\u548c\u901a\u8fc7\u6a21\u677f\u5b9e\u73b0\u6cdb\u578b\u6709\u4ec0\u4e48\u533a\u522b</p> <p>Java \u7684\u8bbe\u8ba1\u662f\uff0c\u4efb\u4f55\u5bf9\u8c61\u90fd\u7ee7\u627f\u4e8e Object \u5bf9\u8c61\uff0c\u8fd9\u6837\u4efb\u4f55\u5bb9\u5668\u90fd\u53ef\u4ee5\u8fd9\u4e2a\u57fa\u7c7b\u4f5c\u4e3a\u5176\u6210\u5458\u7684\u7c7b\u578b\u3002 Cpp \u4e0d\u540c \u4e0e java \u6ca1\u6709\u91c7\u7528\u5355\u6839\u7ed3\u6784\uff0c\u800c\u662f\u901a\u8fc7\u5f15\u5165\u6a21\u677f\u5b9e\u73b0\u6cdb\u578b\u3002</p> <p>\u663e\u7136\uff0c\u7c7b\u6a21\u677f\u672c\u8eab\u4e0d\u662f\u4e00\u4e2a\u7c7b\uff0c\u4ec5\u5305\u542b\u6a21\u677f\u5b9a\u4e49\u7684\u6e90\u6587\u4ef6\u4e0d\u4f1a\u751f\u6210\u4efb\u4f55\u4ee3\u7801\u3002\u5f53\u6211\u4eec\u8981\u4f7f\u7528\u8fd9\u6837\u7684\u6a21\u677f\u65f6\uff0c\u6211\u4eec\u5e94\u5f53\u6307\u660e\u5176\u53c2\u6570\uff0c\u7f16\u8bd1\u5668\u4f1a\u6839\u636e\u53c2\u6570\u548c\u6a21\u677f\u751f\u6210\u51fa\u4e00\u4e2a\u5b9e\u9645\u7684\u7c7b\uff08\u6211\u4eec\u79f0\u8fd9\u4e2a\u7c7b\u4e3a\u5bf9\u5e94\u6a21\u677f\u7684\u4e00\u4e2a \u7279\u5316 (specialization)\uff1b\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a\u6a21\u677f\u7684 \u5b9e\u4f8b\u5316 (instantiation)\uff08\u5bf9\u51fd\u6570\u6a21\u677f\u800c\u8a00\u4e5f\u4e00\u6837\uff09</p> <p>STL \u5bb9\u5668 </p> <p>Alogrithm \u5e93 </p> <p>\u6bd4\u8f83\u91cd\u8981\u7684\u6709  - <code>upper_bound</code> , <code>lower_bound</code> \u8fd9\u5bf9\u51fd\u6570\u53ef\u4ee5\u5728\u6307\u5b9a\u8303\u56f4\u5185\u627e\u5230\u4e00\u4e2a\u6570\u7684\u4e0a\u754c\u548c\u4e0b\u754c (\u5de6\u5f00\u53f3\u95ed\u533a\u95f4) - <code>count</code>  - <code>find</code>  - <code>sort</code> </p> <p>\u8fed\u4ee3\u5668\u7684\u5206\u7c7b </p> <p>Sequential container:</p> <ul> <li>array: contiguous </li> <li>vector: contiguous</li> <li>deque: Input   Random Access  </li> <li>forwardlist: Forward</li> <li>list: Bidirectional</li> </ul> <p>Associative container: - map, set, multimap, multiset: Forward  Bidirectional </p> <p>unassociative container: - unordered_map, unordered_set, unordered_multimap, unordered_multiset: Input  Forward  </p> <p>\u8fed\u4ee3\u5668\u7684\u5206\u7c7b\u4e0d\u662f\u4e00\u79cd\u7c7b\u578b\uff0c\u800c\u662f\u4e00\u79cd\u8981\u6c42\u3002\u8fed\u4ee3\u5668\u662f\u6cdb\u578b\u51fd\u6570\u5bf9\u4f20\u5165\u53c2\u6570\u8981\u6c42\u7684\u7edf\u79f0\u3002</p> <p>\u51fd\u6570\u5bf9\u8c61 </p> <p>\u51fd\u6570\u6307\u9488\uff0c\u4ee5\u53ca\u91cd\u8f7d\u4e86 function call operator operator () \u7684\u7c7b\u7684\u5bf9\u8c61\u3002\u4e8b\u5b9e\u4e0a\uff0cC++ \u5c06\u4efb\u4f55\u5b9a\u4e49\u4e86 function call operator \u7684\u5bf9\u8c61\u7edf\u79f0\u4e3a \u51fd\u6570\u5bf9\u8c61 (Function Object) \u3002</p>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week-7","title":"week 7 \u5de6\u503c\u53f3\u503c \u79fb\u52a8\u8bed\u4e49 \u5b8c\u7f8e\u8f6c\u53d1","text":"<p>\u5de6\u503c\u53f3\u503c </p> <p>\u4ec0\u4e48\u662f\u8868\u8fbe\u5f0f (expression)</p> <p>Primary expressions - this - \u5b57\u9762\u91cf - id-expressions - lambda - fold-expressions - require-expressions</p> <p>\u4ec0\u4e48\u662f\u8bed\u53e5 (statement)</p> <p>\u8868\u8fbe\u5f0f\u5177\u6709\u4ec0\u4e48\u6837\u7684\u6027\u8d28</p> <ul> <li>\u7c7b\u578b\u3002\u6bd4\u5982 <code>int n = 1</code>, n \u7684\u7c7b\u578b\u662f <code>int</code> . \u5b57\u9762\u91cf <code>1</code> \u7684\u7c7b\u578b\u4e5f\u662f <code>int</code> </li> <li>\u5206\u7c7b <ul> <li><code>lvalue</code> \u8868\u5f81\u4e00\u4e2a\u5bf9\u8c61\u7684\u8868\u8fbe\u5f0f (n)</li> <li><code>rvalue</code> \u4e0d\u4e0e\u5bf9\u8c61\u5173\u8054\u7684\u8868\u8fbe\u5f0f (1)</li> </ul> </li> </ul> <p>\u89c6\u9891\u4ece\u6c47\u7f16\u5c42\u5c42\u9762\u9610\u8ff0\u4e86 \u533a\u5206\u5de6\u503c\u53f3\u503c \u53ef\u80fd\u5e26\u6765\u7684\u4f18\u5316, \u6709\u52a9\u4e8e\u7406\u89e3\u6982\u5ff5\u3002</p> <p>\u5c55\u793a\u4e86\u5728 cpp \u4e2d\u54ea\u4e00\u4e9b\u5177\u4f53\u7684\u8868\u8fbe\u5f0f\u662f - lvalue (\u9664\u4e86\u679a\u4e3e\u7c7b\uff0c\u5176\u4ed6\u6709\u540d\u5b57\u7684\u90fd\u662f\u5de6\u503c) - rvalue (\u9664\u4e86\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff0c\u5176\u4ed6\u5e38\u91cf\u90fd\u662f\u53f3\u503c)</p> <p>\u53f3\u503c\u4e0e\u5c06\u4ea1\u503c </p> <p>pvalue -&gt; pure value \u6ca1\u6709\u540d\u5b57, \u4e00\u822c\u4e0d\u5360\u636e\u5185\u5b58 xvalue -&gt; eXpired value \u4e34\u65f6\u5360\u636e\u5185\u5b58</p> <p>\u79fb\u52a8\u8bed\u4e49</p> <p>move sementics - \u79fb\u52a8\u6784\u9020 - \u79fb\u52a8\u8d4b\u503c</p> <p>\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u79fb\u52a8\u8d4b\u503c\uff1f \u4f8b\u5b50\uff1a</p> <p>\u8fd0\u7b97\u4f18\u5148\u7ea7</p> <p>copy-elision -&gt; move assignment             -&gt; copy assignment</p> <p>\u7cbe\u786e\u5b9a\u4e49\u4ec0\u4e48\u662f \u4e34\u65f6 -- \u80fd\u5426\u590d\u7528\u8d44\u6e90</p> <p><pre><code>template&lt;class T&gt;\nvoid swap(T&amp; a, T&amp;b) {\n    T tmp(a); // \u62f7\u8d1d\u6784\u9020\n    a = b; // \u62f7\u8d1d\u8d4b\u503c\n    b = tmp; // \u79fb\u52a8\u8d4b\u503c (\u56e0\u4e3a tmp \u5728\u4e4b\u540e\u5c31\u88ab\u9500\u6bc1\u4e86) \u9519\u8bef\u7684\uff0c\u4ecd\u7136\u662f\u62f7\u8d1d\u8d4b\u503c\uff0c\u56e0\u4e3a tmp \u6709\u540d\u5b57\u3002\n}\n</code></pre> SMF - \u6784\u9020\u51fd\u6570 - \u6790\u6784\u51fd\u6570 - \u62f7\u8d1d\u8d4b\u503c - \u62f7\u8d1d\u6784\u9020 - \u79fb\u52a8\u8d4b\u503c - \u79fb\u52a8\u6784\u9020</p> <p>\u5171\u6027:     \u5982\u679c\u7528\u6237\u81ea\u5df1\u6ca1\u6709\u5b9a\u4e49 smf\uff0c \u800c\u5728\u4ee3\u7801\u4e2d\u53c8\u4f7f\u7528\u4e86\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u751f\u6210 \u9ed8\u8ba4\u7684 smf.     \u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5220\u9664\u4e00\u4e2asmf (= delete)\u3002\u6ce8\u610f\u5982\u679c\u4f60\u58f0\u660e\u67d0\u4e2a smf \u4e3a \u5220\u9664\uff0c\u8fd9\u4e0d\u4ec5\u8868\u793a\u4f60\u60f3\u8981\u5220\u9664\u7f16\u8bd1\u5668\u9ed8\u8ba4\u751f\u6210\u7684 smf\uff0c\u800c\u662f\u8868\u793a\u4f60\u4e0d\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a smf (\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f60\u4e0d\u80fd\u81ea\u5df1\u5b9a\u4e49)\u3002</p> <p>materialization      \u5c06\u4e00\u4e2a pxvalue -&gt; xvalue     \u53ef\u4ee5\u901a\u8fc7\u5c06 prvalue \u7ed1\u5b9a\u7ed9\u4e00\u4e2a const \u5f15\u7528\uff0c     \u4e5f\u53ef\u4ee5\u5c06 prvalue \u7ed1\u5b9a\u7ed9\u4e00\u4e2a \u53f3\u503c\u5f15\u7528</p> <p>copy elision</p> <p><pre><code>Foo baz() {\n    Foo f;\n    return f;\n}\n\nint main() \n{\n    Foo f = baz();\n}\n</code></pre> \u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u7684\u6267\u884c\u6b65\u9aa4\u53ef\u4ee5\u5206\u4e3a\u4e09\u6b65</p> <ol> <li>baz \u51fd\u6570\u5185\u90e8\u4f7f\u7528\u6784\u9020\u51fd\u6570\u521b\u5efa\u4e00\u4e2a Foo \u5bf9\u8c61\uff0c\u5e76\u5c1d\u8bd5\u4ee5 \u79fb\u52a8\u5f62\u5f0f \u8fd4\u56de</li> <li>\u6211\u4eec\u8bb0\u51fd\u6570\u8c03\u7528\u8868\u8fbe\u5f0f\u7684\u503c\u4e3a __call_expr, Foo __call_expr = std::move(return_value)</li> <li>Foo f = __call_expr\u3002\u7531\u4e8e __call_expr \u662f\u4e00\u4e2a prvalue, \u4f1a\u89e6\u53d1 \u79fb\u52a8\u6784\u9020</li> </ol> <p>\u91cd\u70b9\u662f\u7406\u89e3 __call_expr \u8fd9\u4e2a\u4e2d\u95f4\u8fc7\u7a0b</p> <p>\u5b8c\u7f8e\u8f6c\u53d1 perfect forwarding</p> <p>\u89c1 <code>container.cpp</code> \u4ee3\u7801</p>"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#week-8","title":"week 8 \u667a\u80fd\u6307\u9488","text":"<p>\u667a\u80fd\u4f53\u73b0\u5728?</p> <ul> <li>\u81ea\u52a8\u56de\u6536\u8d44\u6e90</li> <li>\u53ef\u4ee5\u5f3a\u5236\u8981\u6c42\u6307\u9488\u4e0d\u4e3a\u7a7a</li> <li>\u66f4\u591a\u7684\u5b89\u5168\u68c0\u67e5\u548c\u9650\u5236</li> </ul> <p>unique pointer </p> <ul> <li>\u662f\u5bf9\u8c61\u7684\u62e5\u6709\u8005\uff0c\u5e76\u5047\u8bbe\u662f\u552f\u4e00\u7684\u6240\u6709\u8005</li> <li>\u81ea\u52a8\u56de\u6536\u8d44\u6e90</li> <li>\u53ea\u80fd\u79fb\u52a8\uff0c\u4e0d\u80fd\u62f7\u8d1d</li> </ul> <p>std::unique_ptr ptr = std::unique_ptr ( new HelperType() ); auto ptr = std::make_unique(Args ...)"},{"location":"notes/CS106L%20cpp%20/cpp%E7%AC%94%E8%AE%B0/#_1","title":"\u56f0\u60d1","text":"<p>Q: \u5047\u8bbe\u6709\u4ee3\u7801 <code>Foo bar() { return Foo(); }</code>,  <code>Foo f = bar();</code> \u4e3a\u4f55\u8fd9\u91cc\u7684 bar \u662f prvalue, bar() \u5b83\u4e0d\u662f\u5360\u636e\u5185\u5b58\u5417 ?</p> <p>Q: void may_share( const shared_ptr&amp; ) \u4f20\u9012\u4e00\u4e2a const \u5bf9\u8c61\uff0c\u53c8\u5982\u4f55\u5bf9 cnt \u8fdb\u884c\u4fee\u6539\u5462 <p>\u56e0\u4e3a shared_ptr \u672c\u8eab\u5e76\u4e0d\u50a8\u5b58 cnt, \u8fd8\u662f\u5355\u72ec\u5f00\u8f9f\u4e86\u4e00\u5757\u5185\u5b58\u50a8\u5b58 cnt\uff0cshared_ptr \u672c\u8eab\u5b58\u50a8\u7684\u662f\u6307\u5411\u5185\u5b58\u7684\u90a3\u4e00\u5757\u5730\u5740\uff0c \u5728\u9012\u589ecnt\u7684\u540c\u65f6\uff0c\u8fd9\u4e2a\u5730\u5740\u5e76\u4e0d\u6539\u53d8\u3002</p>"},{"location":"notes/CS106L%20cpp%20/operator/","title":"Operator","text":""},{"location":"notes/CS106L%20cpp%20/operator/#operator-overloading","title":"operator overloading","text":"<p>There are two types of overloading, one is Member function overloading,  that is,  the overloading funtion belongs to the class(instance),  this overloading funcion overloading can directly access inner private varible</p> <pre><code>//fraction.h\n\nbool operator &lt; (const Fraction&amp; rhs) const;\n</code></pre> <p>The above funtion override the &lt; operator, takes the  variable that is on the right hand side of the operator as  arugmnet, compare to it, and return the result. <pre><code>//fraction.cpp\n// because it is a member function, we need to add `Fraction::`\n// to specity the namespace of the faction (differ funtion from different class)\nbool Fraction::operator &lt; (const Fraction&amp; rhs) const {\n    return rhs.denom * num &lt; rhs.num * denom;\n}\n</code></pre> The other is <code>non member funtion</code>, You may wonder why we need <code>non memeber function</code>. Well, consider a stiatuon, when  you want to compare two different types   - e.g. we want to compare a double and a Fraction</p> <p>we cannot use member funtion since the LHS is not a fraction at all. OK, we then introduce how to write <code>non member function</code> <pre><code>friend Fraction&amp; operator += (Fraction&amp; lhs, const Fraction&amp; rhs);\nfriend bool operator &lt; (const double&amp; lhs, const Fraction&amp; rhs);\nfriend std::ostream&amp; operator &lt;&lt; (std::ostream&amp; out, const Fraction&amp; target);\n</code></pre> since non-member function does not belongs to the class, it is not possible for it to directly access private varivable  of the arugment passed in. To achieve this goal, we need to add a <code>friend</code> descripnator in function declaration</p> <p>do not add <code>friend</code>   in the function implementation</p> <pre><code>Fraction&amp; operator += (Fraction&amp; lhs, const Fraction&amp; rhs) {\n    lhs.num = lhs.num * rhs.denom + lhs.denom * rhs.num;\n    lhs.denom = lhs.denom * rhs.denom;\n    lhs.reduce();\n    return lhs;\n}\n// Implementing the * operation in a non-member function\nbool operator &lt; (const double&amp; lhs, const Fraction&amp; rhs) {\n    return lhs &lt; (double)rhs.num / rhs.denom;\n}\n// Overloading &lt;&lt; to allow for passing Fractions into streams.\n\nstd::ostream&amp; operator &lt;&lt; (std::ostream&amp; out, const Fraction&amp; target) {\n    out &lt;&lt; target.num &lt;&lt; \"/\" &lt;&lt; target.denom;\n    return out;\n}\n</code></pre>"},{"location":"notes/CS106L%20cpp%20/operator/#special-member-function","title":"special member function","text":"<p><pre><code>class Widget {\n public:\n    Widget(); // default constructor\n    Widget (const Widget&amp; w); // copy constructor\n    Widget&amp; operator = (const Widget&amp; w); // copy assignment operator\n    ~Widget(); // destructor\n    Widget (Widget&amp;&amp; rhs); // move constructor\n    Widget&amp; operator = (Widget&amp;&amp; rhs); // move assignment operator\n}\n</code></pre> - \u9ed8\u8ba4\u6784\u9020\u5668 - \u62f7\u8d1d\u6784\u9020\u5668  (\u4f20\u53c2\u7684\u65f6\u5019) -</p>"},{"location":"notes/CS106L%20cpp%20/operator/#difference-between-assignment-and-initilize-list","title":"difference between assignment and initilize list","text":"<p>When you initialize fields via initializer list the constructors will be called once. If you use the assignment then the fields will be first initialized with default constructors  and then reassigned (via assignment operator) with actual values.</p>"},{"location":"notes/CS106L%20cpp%20/operator/#on-delete-and-on-default","title":"on delete and on default","text":"<ul> <li><code>on delete</code> tell compiliers do not generate SMF functions for we want to write our own</li> <li><code>on default</code> tell compiliers keep SMF functions when we want to write our own</li> </ul>"},{"location":"notes/CS106L%20cpp%20/template_function/","title":"About template","text":"<ul> <li> <p>How to write template function in a class</p> <p>write implematation  in the header file</p> </li> <li> <p>vscode \u4e0d\u80fd\u8fdb\u884c\u4ee3\u7801\u8865\u5168</p> <ol> <li> <p>\u53ef\u80fd\u662finclude \u7684\u8def\u5f84\u6ca1\u6709\u8bbe\u7f6e\u597d</p> <p>\u4f7f\u7528 find . -name \"cpr*\" \u627e\u5230\u5f53\u524d\u6587\u4ef6\u4e0b\u5305\u542bcpr \u7684\u8def\u5f84</p> <p>\u5728c++ \u8bbe\u7f6e\u4e2d\uff0c\u5728include path \u4e2d\u6dfb\u52a0 </p> <p>\u200b 2. cmake \u62a5\u9519 </p> </li> <li> <p>cpr_Dir not set  </p> </li> </ol> <p>\u5728 cmakelist \u91cc \u52a0\u4e0a <code>set(cpr_DIR \"./vcpkg/installed/x64-linux/share/cpr\")</code>\u200b * Could NOT find CURL (missing: CURL_LIBRARY CURL_INCLUDE_DIR) <code>sudo apt update &amp;&amp; sudo apt upgrade &amp;&amp; sudo apt install curl &amp;&amp; sudo apt-get install libcurl4-openssl-dev</code>\u200b</p> </li> </ul>"},{"location":"notes/CS106L%20cpp%20/template_function/#_1","title":"\u914d\u7f6e\u95ee\u9898","text":""},{"location":"notes/CS106L%20cpp%20/template_function/#lec-56-stl-lib","title":"Lec 5,6 STL lib","text":""},{"location":"notes/CS106L%20cpp%20/template_function/#sequence-data-structure","title":"sequence data structure","text":""},{"location":"notes/CS106L%20cpp%20/template_function/#associative-data-structure","title":"associative data structure","text":"<ul> <li>map, set</li> <li> <p>shared method:</p> </li> <li> <p>count(key) : \u7edf\u8ba1 \u542b\u6709key\u7684\u5143\u7d20\u6570\u91cf</p> </li> <li>find(key):   \u8fd4\u56de \u6307\u5411 key\u7684\u8fed\u4ee3\u5668</li> </ul>"},{"location":"notes/CS106L%20cpp%20/template_function/#std-lib","title":"std lib","text":"<pre><code>std::find() return iterator\nstd::sort(begin(), end()) return none\nstd::fill(begin(), end(), 10) return none\nstd::copy(begin(), end(), container) return none\nstd::lower_bound()\nstd::upper_bound()\nstd::accmulate(begin, end, 0 / 0.0) // \u6ce8\u610f \u6d6e\u70b9\u6570\u4f7f\u7528 0.0\n</code></pre>"},{"location":"notes/CS106L%20cpp%20/template_function/#bug","title":"bug","text":"<p>std::find \u51fd\u6570\u9700\u8981 algorthim \u5934\u6587\u4ef6</p>"},{"location":"notes/CS106L%20cpp%20/template_function/#lec-6-classesp","title":"Lec 6 classesp","text":""},{"location":"notes/CS106L%20cpp%20/template_function/#a-bug","title":"a bug","text":"<ul> <li>\u51fa\u73b0\u7684\u95ee\u9898</li> </ul> <pre><code>student.cpp:5:18: error: definition of implicitly-declared \u2018Student::Student()\u2019\n    5 | Student::Student() {\n      |                  ^\n./build.sh: 4: ./main2: not found\n</code></pre> <ul> <li>\u5728 .cpp \u6587\u4ef6\u5b9a\u4e49\u4e86 \u6784\u9020\u5668\uff0c\u4f46\u662f\u6ca1\u6709\u5728\u5934\u6587\u4ef6\u5b9a\u4e49</li> </ul>"},{"location":"notes/CS106L%20cpp%20/template_function/#a-tip","title":"a tip","text":"<p>\u6211\u4eec\u4e0d\u9700\u8981\u624b\u52a8\u6267\u884c ~constructor \u5f53\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u5143\u7d20\u6307\u5411\u8fd9\u4e2a\u5bf9\u8c61\u65f6\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u9500\u6bc1</p>"},{"location":"notes/CS106L%20cpp%20/template_function/#lec-7-template","title":"Lec 7 template","text":"<ul> <li>class / typename</li> <li>\u4e3a \u6cdb\u578b\u7c7b \u5199 \u6cdb\u578b\u51fd\u6570\u7684\u65f6\u5019\uff0c\u547d\u540d\u7a7a\u95f4\u8981\u52a0\u4e0a generic typenames</li> <li>\u5199\u6cdb\u578b\u7c7b\u65f6\uff0c\u8981\u5728.h \u6587\u4ef6\u91cc \u5f15\u7528.cpp \u6587\u4ef6\uff0c\u800c\u4e0d\u662f \u5728.cpp\u6587\u4ef6\u91cc\u5f15\u7528 .h \u6587\u4ef6 (multiple definiton)</li> </ul>"},{"location":"notes/CS106L%20cpp%20/template_function/#some-tips","title":"some tips","text":"<ul> <li>Add template before class definition in .h 1. <p>\u5728\u5934\u6587\u4ef6\u4e2d\u7c7b\u7684\u5b9a\u4e49\u524d\u52a0\u4e0a template </p> <ul> <li>Add templatebefore all function   signatures in .cpp <p>\u5728\u6a21\u677f\u7c7b\u7684\u6bcf\u4e00\u4e2a\u51fd\u6570\u524d\u52a0\u4e0a \u6cdb\u578b\u58f0\u660e</p> <ul> <li>When returning nested types (like iterator types), put typename   ClassName::member_type as return type, not   just member_type <p>\u5982\u679c\u8fd4\u56de\u7c7b\u578b(we call it return type) \u672c\u8eab\u4e5f\u5305\u542b\u6cdb\u578b\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5176\u6539\u5199\u4e3a (typename className::return_type)</p> <pre><code>//\u6bd4\u5982\ntemplate &lt;typename T&gt;\niterator myVector&lt;T&gt;::cbegin() const {\n    return elem;  \n}\n\n||\n||\n  \ntemplate &lt;typename T&gt;\ntypename myVector&lt;T&gt;::iterator myVector&lt;T&gt;::cbegin() const {\n    return elem;  \n}\n</code></pre> <ul> <li>Templates don\u2019t emit code until instantiated, so #include the   .cpp file in the .h file, not the other way around!</li> </ul> <p>\u5728\u5934\u6587\u4ef6\u672b\u5c3e\u5305\u542b .cpp \u6587\u4ef6\uff0c\u4e0d\u8981\u5728.cpp \u6587\u4ef6\u4e2d\u5305\u542b\u5934\u6587\u4ef6</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"\u6df1\u5ea6\u5b66\u4e60\u7b14\u8bb0","text":"<p>${toc}</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_1","title":"\u672f\u8bed","text":"zh en \u5f20\u91cf Tensor &lt;++&gt; \u6807\u91cf\u51fd\u6570 Scalar fucntion &lt;++&gt; \u5168\u8fde\u63a5\u5c42 full connected layer \u8f93\u51fa\u5c42\u4e2d\u7684\u795e\u7ecf\u5143\u548c\u8f93\u2f0a\u5165\u5c42\u4e2d\u5404\u4e2a\u8f93\u2f0a\u5165\u5b8c\u5168\u8fde \u63a5 \u7279\u5f81 feature \u9884\u6d4b\u6807\u7b7e\u7684\u56e0\u5b50 (\u6743\u91cd) \u6807\u7b7e label \u771f\u5b9e\u503c"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#dl-lec-1","title":"DL Lec 1","text":"<p>some concepts </p> <ul> <li><code>deep learning</code> is a subset of <code>machine learning</code></li> <li><code>machine learning</code> is a subset of <code>artificial intelligence</code></li> </ul> <p>The difference between DL and traditional ML</p> <ul> <li>\u6df1\u5ea6\u5b66\u4e60\u4e0d\u9700\u8981\u4eba\u5de5\u63d0\u53d6\u7279\u5f81\uff0c\u4f20\u7edf\u673a\u5668\u5b66\u4e60\u9700\u8981 </li> </ul> <p>Important factors(\u5173\u952e\u8981\u7d20) </p> <ul> <li>\u6df1\u5ea6\u795e\u7ecf\u7f51\u7edc\u6a21\u578b</li> <li>\u5927\u89c4\u6a21\u6570\u636e\u96c6</li> <li>\u5927\u89c4\u6a21\u8ba1\u7b97\u8d44\u6e90 </li> </ul> <p>Q: \u89e3\u91ca\u6df1\u5ea6\u5b66\u4e60\u8fd1\u51e0\u5e74\u706b\u7206\u7684\u539f\u56e0  A: \u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u7f51\u7edc\u4e0a\u7684\u8bed\u6599\u548c\u89c6\u9891\u6570\u636e\u8db3\u591f\u5e9e\u5927      GPU \u7684\u7b97\u529b\u9010\u5e74\u589e\u957f </p> <p>Classifying dataset </p> <ol> <li>tranning Set</li> <li>validating Set</li> <li>test Set </li> </ol> <p>genenralization (\u6cdb\u5316) </p> <ul> <li>\u8fc7\u62df\u5408 \u6cdb\u5316\u8bef\u5dee\u5927  </li> <li>\u6b20\u62df\u5408 \u8bad\u7ec3\u96c6\u4e0a\u548c\u6d4b\u8bd5\u96c6\u4e0a\u6548\u679c\u90fd\u5dee  </li> </ul> <p></p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#lab1","title":"lab1 \u73af\u5883\u914d\u7f6e","text":"<ul> <li>\u9996\u5148\u9700\u8981\u88c5 <code>anaconda</code> </li> </ul> <p><code>yay -S anaconda</code></p> <ul> <li>\u6362\u6e90</li> </ul> <pre><code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\nconda config --set show_channel_urls yes\n</code></pre> <ul> <li>\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6 </li> </ul> <p><code>source /opt/anaconda/bin/activate root</code></p> <ul> <li>\u5b89\u88c5 <code>pytorch</code> \u7684\u5e93</li> </ul> <p></p> <p>\u6ce8\u610f\u52a0\u4e0a <code>sudo</code> \u56e0\u4e3a\u8981\u5bf9 <code>/opt</code> \u76ee\u5f55\u8fdb\u884c\u5199\u5165\u64cd\u4f5c</p> <ul> <li>\u6d4b\u8bd5 minst \u6570\u636e\u96c6</li> </ul>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_2","title":"\u52a8\u624b\u5b66\u4e60\u6df1\u5ea6\u5b66\u4e60\u7b2c\u4e8c\u7ae0","text":""},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#lec-3","title":"Lec 3 \u795e\u7ecf\u7f51\u7edc\u7b80\u4ecb","text":"<p>\u795e\u7ecf\u7f51\u7edc\u57fa\u672c\u7ed3\u6784 </p> <ul> <li>\u8f93\u5165\u5c42\u3002\u8868\u793a\u539f\u59cb\u8f93\u5165\u6570\u636e\uff0c\u4e00\u822c\u53ea\u6709\u4e00\u5c42, \u8f93\u5165\u7b2c\u4e00\u5c42\u8bb0\u4e3a\u795e\u7ecf\u7f51\u7edc\u7684\u7b2c0\u5c42</li> <li>\u9690\u85cf\u5c42\u3002\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c \u975e\u7ebf\u6027\u53d8\u6362 ,\u4ee5\u8fdb\u884c\u7279\u5f81\u63d0\u53d6\u548c\u52a0\u5de5\uff0c\u4e00\u822c\u6709\u591a\u4e2a\u9690\u85cf\u5c42\u3002 \u7b2c\u4e00\u4e2a\u9690\u85cf\u5c42\u8bb0\u4e3a\u795e\u7ecf\u7f51\u7edc\u7684\u7b2c\u4e00\u5c42</li> <li>\u8f93\u51fa\u5c42\u3002\u8868\u793a\u5206\u7c7b\u7684\u7ed3\u679c\u3002\u8981\u5206\u6210\u51e0\u7c7b\uff0c\u8f93\u51fa\u5c42\u5c31\u6709\u51e0\u4e2a\u795e\u7ecf\u5143, \u8f93\u51fa\u5c42\u53ea\u6709\u4e00\u5c42\u3002</li> </ul> <p>\u795e\u7ecf\u7f51\u7edc\u7684\u91cd\u8981\u6982\u5ff5 </p> <ul> <li>\u8f93\u5165</li> <li>\u8f93\u51fa</li> <li>\u6fc0\u6d3b\u51fd\u6570</li> <li>\u53c2\u6570</li> </ul> <p>Q: \u5168\u8fde\u63a5\u795e\u7ecf\u7f51\u7edc\u4e2d\u67d0\u4e00\u5c42\u7684\u8f93\u5165\u8f93\u51fa\u7ef4\u5ea6\u5982\u4f55\u786e\u5b9a  A: \u8f93\u5165\u7ef4\u5ea6\u7531\u4e0a\u4e00\u5c42\u795e\u7ecf\u5143\u4e2a\u6570\u786e\u5b9a\uff0c\u8f93\u51fa\u7ef4\u5ea6\u7531\u672c\u5c42\u795e\u7ecf\u5143\u786e\u5b9a </p> <p>\u8f93\u5165\u8f93\u51fa </p> <p>\\(H_i^{(i)}\\) \u4e0b\u6807 i \u8868\u793a\u7b2c\u4e2a\u795e\u7ecf\u539f\uff0c\u4e0a\u6807 1 \u8868\u793a\u5728\u7b2c I \u5c42, \u6574\u4e2a\u8868\u8fbe\u5f0f\u542b\u610f\u4e3a \u7b2c I \u5c42 \u7b2c i \u4e2a\u795e\u7ecf\u5143\u7684\u503c</p> <p>\\(w_{i j}^{(k)}\\)  i \u8868\u793a\u524d\u4e00\u5c42\u795e\u7ecf\u5143\u7684\u4f4d\u7f6e\uff0c j \u8868\u793a\u540e\u4e00\u5c42\u795e\u7ecf\u5143\u7684\u4f4d\u7f6e\uff0ck \u8868\u793a\u5728\u7b2c k \u5c42 \u6574\u4e2a\u8868\u8fbe\u5f0f\u7684\u542b\u610f\u4e3a \u4ece k - 1 \u5c42 \u7684 \u7b2c i \u4e2a\u795e\u7ecf\u5143 \u5230 k \u7684\u7b2c j \u4e2a\u795e\u7ecf\u5143\u7684\u6743\u503c</p> <p>\\(b_i^{(i)}\\) \u4e0b\u6807 i \u8868\u793a\u7b2c\u4e2a\u795e\u7ecf\u539f\uff0c\u4e0a\u6807 i \u8868\u793a\u5728\u7b2c i \u5c42, \u6574\u4e2a\u8868\u8fbe\u5f0f\u542b\u610f\u4e3a \u7b2c i \u5c42 \u7b2c i \u4e2a\u795e\u7ecf\u5143\u7684\u504f\u7f6e\u7684\u503c </p> <p>\u8ba1\u7b97\u516c\u5f0f</p> <p>\u77e9\u9635\u5f62\u5f0f\uff1a</p> \\[ h^{(i)} = h^{(i - 1)} \\cdot W^{(i)} + b^{(i)} \\] <p>\u5c55\u5f00\uff1a</p> \\[ (h_1^{(i)} ,h_2^{(i)}, \\cdots h_n^{(i)}) = (h_1^{(i-1)} ,h_2^{(i-1)}, \\cdots h_m^{(i-1)})   \\begin{bmatrix} w_{11}^{(i)} &amp; \\dots &amp; w_{1n}^{(i)}\\\\   &amp; \\ddots &amp; \\vdots\\\\ w_{m1}^{(i)} &amp; &amp; w_{mn}^{(i)} \\end{bmatrix} + (b_1^{(i)} ,b_2^{(i)}, \\cdots b_n^{(i)}) \\] <p>\u6fc0\u6d3b\u51fd\u6570</p> <p>\u5e38\u89c1\u7684\u6fc0\u6d3b\u51fd\u6570\u6709</p> <ul> <li><code>softmax</code> \\(\\frac{1}{1 + e^{-x}}\\) </li> <li><code>tan(h(x))</code> \\(tan(x)\\) </li> <li><code>ReLU</code> max(0, x)</li> </ul> \\[ h^{(i)} = f(h^{(i - 1)} \\cdot W^{(i)} + b^{(i)}) \\] <p>Q: \u6fc0\u6d3b\u51fd\u6570\u7684\u4f5c\u7528\u662f\u4ec0\u4e48 A: \u5bf9\u795e\u7ecf\u7f51\u7edc\u52a0\u5165\u975e\u7ebf\u6027\u64cd\u4f5c\uff0c\u589e\u5f3a\u795e\u7ecf\u7f51\u7edc\u7684\u62df\u5408\u80fd\u529b\uff0c \u5982\u679c\u4e0d\u52a0\u5165\u6fc0\u6d3b\u51fd\u6570\uff0c\u90a3\u4e48\u9690\u85cf\u5c42\u5c06\u9000\u5316\u4e3a\u4e00\u5c42</p> <p>\u6700\u540e\u5bf9\u8f93\u5165\u91c7\u7528 <code>softmax</code> \u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002(\u4fdd\u8bc1\u6570\u636e\u8303\u56f4\u5728 (0, 1) \u5185, \u4e14\u6240\u6709\u8f93\u51fa\u7684\u503c\u76f8\u52a0\u4e3a\u4e00)</p> <p>\u5e38\u89c1\u8bad\u7ec3\u6a21\u578b </p> <p></p> <p>\u795e\u7ecf\u7f51\u7edc-\u53c2\u6570 </p> <p>\u5168\u76f8\u8fde\u795e\u7ecf\u7f51\u7edc\u7684\u53c2\u6570\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u6743\u91cd\u548c\u53c2\u6570</p> <p>\u6743\u91cd\u6570 = \u4e0a\u4e00\u5c42\u795e\u7ecf\u5143 * \u672c\u5c42\u795e\u7ecf\u5143 \u504f\u7f6e\u6570 = \u672c\u5c42\u795e\u7ecf\u5143\u6570\u91cf </p> <p>\u8bad\u7ec3\u7f51\u7edc\u76ee\u7684\u5c31\u662f\u4e86\u627e\u5230\u5408\u9002\u7684\u6743\u91cd\u548c\u504f\u7f6e</p> <p>\u8bad\u7ec3\u6d41\u7a0b </p> <p>\u521d\u59cb\u5316\u53c2\u6570: \u9ad8\u65af\u968f\u673a</p> <p>\u795e\u7ecf\u7f51\u7edc\u8bad\u7ec3\u603b\u63fd </p> <p></p> <p>\u968f\u673a\u68af\u5ea6\ud83d\udcc9</p> <p>batch: \u6279, \u8ba1\u7b97\u4e00\u4e2a batch \u5373 \u4e00\u6b21\u8fed\u4ee3     batch-size</p> <p>epoch: \u8f6e</p> <p></p> <p>\u9a8c\u8bc1\u96c6\u6d4b\u8bd5</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#lab2","title":"lab2","text":"<p>\u4f5c\u4e1a: </p> <p></p> <p>\u9996\u5148\u6211\u4eec\u6765\u5b9e\u73b0\u4e00\u4e0b\u8bfe\u4e0a\u6240\u8bb2\u7684 MNIST \u6570\u636e\u96c6</p> <ul> <li>\u7b2c\u4e00\u6b65 \u5b9a\u4e49\u7f51\u7edc\u7ed3\u6784</li> </ul> <p>\u6211\u4eec\u9996\u5148\u4ec5\u4ec5\u8bbe\u7f6e\u4e00\u4e2a\u9690\u85cf\u5c42</p> <p></p> <p><pre><code>class FCNet1(nn.modules):\n    def __init__(self, **kwargs) -&gt; None:\n        super(FCNet1, self).__init__(**kwargs)\n\n        self.hidden = nn.Linear(784, 256)\n        self.active = nn.ReLU()\n        self.output = nn.Linear(256, 10)\n\n    def forward(self, ../img):\n        hidden = self.hidden(../img)\n        active = self.active(hidden)\n        out = self.output(active)\n\n        return out\n</code></pre> - \u52a0\u8f7d\u6570\u636e\u96c6</p> <pre><code>train_data = torchvision.datasets.MNIST(root='./data',\n                                        train=True,\n                                        download=False,\n                                        transform=trans)\n\ntest_data = torchvision.datasets.MNIST(root='./data',\n                                       train=False,\n                                       download=False,\n                                       transform=trans)\n\ntrain_data_loader = data.DataLoader(\n    dataset=train_data,\n    batch_size=200,\n    shuffle=True, # \u6bcf\u4e00\u6b21\u7528\u540c\u4e00\u4e2abatch \u90fd\u6253\u4e71\u987a\u5e8f\n    num_workers=4 # \u5de5\u4f5c\u6838\u5fc3\n)\n\ntest_data_loader = data.DataLoader(\n    dataset=test_data,\n    batch_size=200,\n    shuffle=False, # \u6bcf\u4e00\u6b21\u7528\u540c\u4e00\u4e2abatch \u90fd\u6253\u4e71\u987a\u5e8f\n    num_workers=4 # \u5de5\u4f5c\u6838\u5fc3\n)\n</code></pre> <ul> <li>\u5b9a\u4e49 loss function</li> </ul> <p><code>loss = nn.CrossEntropyLoss()</code></p> <ul> <li>\u5b9a\u4e49 \u4f18\u5316\u5668</li> </ul> <p><code>optimizer1 = optim.SGD(net1.parameters(), lr=0.01)</code></p> <ul> <li>\u5f00\u59cb\u8bad\u7ec3</li> </ul> <pre><code>def train(net,\n          train_iter,\n          test_iter,\n          loss,\n          num_epochs=10,\n          optimizer=None,\n          device=None):\n\n    n = 0 # \u603b\u6570\n    for epoch in range(1, num_epochs + 1):\n        train_loss_sum, train_acc_sum = 0, 0\n        for train_images, labels in train_iter:\n            # \u5c06\u6570\u636e\u5b58\u653e\u5728 CPU\n            assert isinstance(train_images, torch.Tensor)\n            assert isinstance(labels, torch.Tensor)\n            # torch.Size([200, 1, 28, 28])\n            train_images.to(device)\n            labels.to(device)\n            # torch.Size([200, 1])\n\n            # forward\n            output = net(train_images)\n\n            los = loss(output, labels).sum()\n\n            optimizer.zero_grad()\n\n            # backward\n            los.backward()\n            optimizer.step()\n            train_loss_sum += los\n\n            # argmax(dim=1) \u8fd4\u56de \u4e00\u5217\u5143\u7d20\u6700\u5927\u7684\u90a3\u4e2a\u4e0b\u6807 (200 * 10)\n            accruate = (output.argmax(dim=1) == labels).sum().item()\n            train_acc_sum += accruate\n            n += labels.shape[0]\n\n        test_accuracy = test(net, test_iter)\n\n        print(\n            f'epoch {epoch}, train_loss {train_loss_sum / n}, train_accuracy {train_acc_sum / n}, test_accuracy {test_accuracy}'\n        )\n        n = 0\n</code></pre> <ul> <li>\u5982\u4f55\u8c03\u6574\u5b66\u4e60\u7387</li> </ul> <p>\u9996\u5148\u4ece 0.01 \u5f00\u59cb\uff0c\u6309\u7167 10 \u7684\u6b21\u5e42\u5f00\u59cb\u8c03\u6574\u3002</p> <p>\u8c03\u6574\u5fc3\u8def\u5386\u7a0b <code>0.01 -&gt; 0.1 -&gt; 0.2 -&gt; 0.15 -&gt; 0.165</code></p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#autograd","title":"\u6709\u5173 <code>autograd</code>","text":""},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_3","title":"\u5377\u79ef\u795e\u7ecf\u7f51\u7edc","text":"<p>\u4f7f\u7528\u5168\u8fde\u63a5\u795e\u7ecf\u7f51\u7edc\uff0c \u4f1a\u6709\u54ea\u4e9b\u95ee\u9898? 1. \u8ba1\u7b97\u91cf\u592a\u5927\uff0c\u590d\u6742\u5ea6\u592a\u9ad8 2. \u4e22\u5931\u56fe\u50cf\u4fe1\u606f</p> <p>\u5377\u79ef\u795e\u7ecf\u7f51\u7edc\u7684\u7279\u70b9 </p> <ol> <li>\u5c40\u90e8\u8fde\u63a5</li> <li>\u53c2\u6570\u5171\u4eab</li> </ol> <p>\u5377\u79ef\u6838\u7684\u4f5c\u7528 </p> <p></p> <p>interview </p> <p>\u5377\u79ef\u5c42\u7684\u5c40\u90e8\u8fde\u63a5\u7279\u70b9\u6307\u7684\u662f\u4ec0\u4e48 </p> <p>\u76f8\u5f53\u4e0e \u5c40\u90e8\u8fde\u63a5\u7684 \u5168\u8fde\u63a5\u5c42, </p> <p>\u5377\u79ef\u5c42\u7684\u5c40\u90e8\u8fde\u63a5 \u6709\u4ec0\u4e48\u597d\u5904</p> <p>\u51cf\u5c11\u53c2\u6570\u6570\u76ee, \u63d0\u5347\u8ba1\u7b97\u901f\u5ea6</p> <p>\u5377\u79ef\u5c42\u7684 \u53c2\u6570\u5171\u4eab \u7279\u70b9\u6307\u7684\u662f\u4ec0\u4e48 </p> <p>\u5bf9\u4e8e \u4e0d\u540c\u7684 \u56fe\u50cf\u4f4d\u7f6e,\u4f7f\u7528\u540c\u4e00\u4e2a\u5377\u79ef\u6838 </p> <p>\u5377\u79ef\u5c42\u7684 \u53c2\u6570\u5171\u4eab \u6709\u4ec0\u4e48\u597d\u5904 </p> <p>\u4e0d\u4f1a\u4e22\u5931\u56fe\u50cf\u7684\u5c40\u90e8\u4fe1\u606f</p> <p>\u7b49\u8fb9\u8868\u793a: \u5c40\u90e8\u7279\u5f81\u6240\u5904\u7684\u4f4d\u7f6e \u4e0d\u4f1a\u5f71\u54cd\u5377\u79ef\u7684 \u7ed3\u679c?</p> <p>padding </p> <p>\u56e0\u4e3a\u7ecf\u8fc7\u5377\u79ef\u64cd\u4f5c\u540e, \u5f97\u5230\u7684\u7279\u5f81\u77e9\u9635\u7684\u7ef4\u6570\u4f1a\u53d8\u5c0f \\(m = n - k + 1\\), \u4e3a\u4e86\u4fdd\u8bc1 \u77e9\u9635\u7ef4\u6570\u4e0d\u53d8, \u6211\u4eec\u53ef\u4ee5\u5148\u5bf9\u77e9\u9635\u8fdb\u884c\u586b\u5145\u540e,\u518d\u505a\u5377\u79ef\u8fd0\u7b97. \\(p = \\frac{k - 1}{2}\\) </p> <ul> <li> <p>Vaild \u5377\u79ef \u4e0d\u586b\u5145 </p> </li> <li> <p>Sane \u5377\u79ef \u586b\u5145, \u4e0d\u4f1a\u4e22\u5931\u56fe\u50cf\u7684\u8fb9\u754c\u4fe1\u606f</p> </li> </ul> <p>\u5377\u79ef\u8fd0\u7b97\u6b65\u957f </p> <p>\u8fdb\u884c\u8fd0\u7b97\u65f6, \u77e9\u9635\u7684\u504f\u79fb\u91cf</p> <p>\u591a\u901a\u9053\u5377\u79ef\u8fd0\u7b97 </p> <p>\u5206\u6210\u4e09\u4e2a\u77e9\u9635, \u5206\u522b\u8ba1\u7b97\u5377\u79ef, \u6700\u540e\u5c06\u5bf9\u5e94\u4f4d\u7f6e\u7684\u6570\u6c42\u548c.</p> <p></p> <p>\u6c60\u5316\u5c42 </p> <p> </p> <ul> <li>\u5747\u503c\u6c60\u5316</li> <li>\u6700\u5927\u6c60\u5316</li> </ul> <p>\u4f5c\u7528:  1. \u51cf\u5c11\u7279\u5f81\u7ef4\u5ea6, (\u964d\u7ef4, \u51cf\u5c11\u590d\u6742\u5ea6) 2. \u4fdd\u7559\u4e3b\u8981\u7279\u5f81</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_4","title":"\u95ee\u9898","text":"<ol> <li><code>root='./data'</code>, \u4e0d\u8981\u5fd8\u4e86 <code>.</code></li> <li>\u6709\u8da3\u7684 <code>id</code> \u51fd\u6570     <code>id</code> \u51fd\u6570\u8fd4\u56de\u7684\u5b9e\u9645\u4e0a\u662f \u53d8\u91cf\u6240\u50a8\u5b58\u7684 \u5bf9\u8c61\u7684 \u5730\u5740\uff0c \u800c\u4e0d\u662f\u81ea\u8eab\u7684\u5730\u5740?</li> </ol> <ol> <li>why update happens outside the net class ? </li> <li>where we store the value of the weight parameter ?</li> </ol> <pre><code>for epoch in range(1, num_epoch + 1):\n        train_loss_sum, train_acc_sum = 0, 0\n        for train_images, labels in train_data_loader:\n            # \u5c06\u6570\u636e\u5b58\u653e\u5728 CPU\n            assert isinstance(train_images, torch.Tensor)\n            train_images.to(device)\n            labels.to(device)\n\n            breakpoint()\n            # torch.Size([200, 1, 28, 28])\n\n            # forward\n            output = net(train_images)\n\n            los = loss(output, labels).sum()\n\n            optimizer.zero_grad()\n\n            # backward\n            los.backward()\n            optimizer.step()\n            train_loss_sum += los\n</code></pre> <ul> <li>\u6ce8\u610f \u4f18\u5316\u5668 \u7ed1\u5b9a\u4e86 \u4e00\u4e2a\u7f51\u7edc\u7684 \u6240\u6709\u53c2\u6570\u3002\u6240\u4ee5 \u4e00\u4e2a\u4f18\u5316\u5668\u53ea\u80fd\u5bf9\u5e94\u4e00\u4e2a \u7f51\u7edc\u7ed3\u6784\u3002\u5982\u679c\u8981\u5728\u4e00\u4e2a\u7a0b\u5e8f\u4e2d \u6d4b\u8bd5\u591a\u4e2a \u7f51\u7edc\u7ed3\u6784\u7684\u51c6\u786e\u6027\uff0c\u5c31\u9700\u8981\u5b9a\u4e49\u591a\u4e2a\u7f51\u7edc\u7ed3\u6784\u3002</li> </ul> <p>\u4ee5\u4e0b\u9762\u8fd9\u4e2a\u7f51\u7edc\u7ed3\u6784\u4e3a\u4f8b</p> <pre><code>train(net=net1,\n          train_iter=train_data_loader,\n          test_iter=test_data_loader,\n          loss=loss,\n          num_epochs=10,\n          optimizer=optimizer1,\n          device=device)\n\n    print(\"\u7f51\u7edc\u7ed3\u6784 784 - 32 - 16 - 10\")\n    train(net=net2,\n          train_iter=train_data_loader,\n          test_iter=test_data_loader,\n          loss=loss,\n          num_epochs=15,\n          optimizer=optimizer1,\n          device=device)\n</code></pre> <p>\u5982\u679c \u4e24\u6b21\u8bad\u7ec3\u7684 \u4f18\u5316\u5668\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21\u8bad\u7ec3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u4f1a\u53d1\u73b0 \u6d4b\u8bd5\u51c6\u786e\u7387\u662f\u4e2a\u5b9a\u503c\u3002(\u56e0\u4e3a\u4f18\u5316\u5668\u53ea\u4f1a\u6539\u53d8\u7b2c\u4e00\u4e2a\u7f51\u7edc\u7ed3\u6784\u7684\u53c2\u6570)</p> <ol> <li> <p><code>lab3</code> \u9047\u5230\u7684\u95ee\u9898</p> </li> <li> <p>matXX and matXX is not XX. \u7f51\u7edc\u7ed3\u6784\u6ca1\u8c03\u6574\u597d\uff0c \u77e9\u9635\u76f8\u4e58\u65f6\uff0c\u7ef4\u5ea6\u51fa\u73b0\u4e86\u95ee\u9898</p> </li> <li>\u6253\u5f00\u56fe\u7247, \u8f6c\u5316\u4e3a tensor, \u518d \u589e\u52a0\u7ef4\u5ea6  </li> </ol> <pre><code># \u6253\u5f00\u56fe\u7247\ntest_../img = Image.open(path)\ntest_../img = test_img.convert('L')\ndata = list(test_../img.getdata())\n\n# \u8f6c\u5316\u4e3a float32 \u7c7b\u578b\ndata = np.array(data, np.float32)\ndata.resize(32, 32)\n\n# \u5f52\u4e00\u5316\ndata /= 255\n\n# \u6dfb\u52a0 \u7ef4\u5ea6 28 * 28 -&gt; 1 * 1 * 28 * 28\ntrains_../img = torch.from_numpy(data).unsqueeze(0).unsqueeze(0)\n</code></pre>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/","title":"\u6df1\u5ea6\u5b66\u4e60\u8bba\u6587\u7b14\u8bb0","text":"<p>${toc}</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#_1","title":"\u8bba\u6587\u8981\u70b9","text":""},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#alexnet","title":"AlexNet","text":"<p>\u95ee\u9898 </p> <ul> <li> <p>\\(Q\\): AlexNet \u4e2d\u4f7f\u7528\u4e86\u4ec0\u4e48\u6fc0\u6d3b\u51fd\u6570\uff1f ReLU \u76f8\u6bd4 Sigmoid \u7684\u4e3b\u8981\u4f18\u52bf\u6709\u54ea\u4e9b\uff1f     &gt; \\(A\\): ReLU\u3002\u4f18\u70b9\uff1a1. \u786c\u4ef6\u53cb\u597d\uff0c\u8ba1\u7b97\u901f\u5ea6\u5feb\u30022.\u4e0d\u4f1a\u53d1\u751f\u9971\u548c\uff0c\u53ef\u4ee5\u7f13\u89e3\u68af\u5ea6\u6d88\u5931\u7684\u60c5\u51b5</p> </li> <li> <p>\\(Q\\): Dropout \u4e3a\u4ec0\u4e48\u53ef\u4ee5\u51cf\u5c11\u8fc7\u62df\u5408\uff1fDropout \u662f\u600e\u4e48\u8ba1\u7b97\u7684\uff1f      &gt; \\(A\\): \u4f7f\u7528 Dropout \u7684\u8bdd\uff0c\u76f8\u5f53\u4e8e\u8bad\u7ec3\u4e86\u5f88\u591a\u4e2a\u795e\u7ecf\u7f51\u7edc\uff0c\u8fd9\u4e9b\u7f51\u7edc\u5171\u4eab\u53c2\u6570     &gt; \u6bcf\u4e00\u4e2a\u7f51\u7edc\u8fc7\u62df\u5408\u7684\u5730\u65b9\u4e0d\u540c\uff0c\u6d4b\u8bd5\u65f6\uff0c\u5bf9\u8fd9\u4e9b\u7f51\u7edc\u53d6\u5e73\u5747\uff0c\u8fc7\u62df\u5408\u76f8\u4e92\u62b5\u9500\u3002</p> </li> <li> <p>\\(Q\\): AlexNet \u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684\uff0c\u51e0\u4e2a\u5377\u79ef\u5c42\uff0c\u51e0\u4e2a\u5168\u8fde\u63a5\u5c42      &gt; \\(A\\):  5\u4e2a\u5377\u79ef\u5c42\uff0c3\u4e2a\u5168\u8fde\u63a5\u5c42</p> </li> <li> <p>\\(Q\\): AlexNet \u4f7f\u7528\u4e86\u54ea\u4e9b\u51cf\u5c11\u8fc7\u62df\u5408\u7684\u65b9\u6cd5     &gt; \\(A\\): \u6570\u636e\u6269\u589e \u548c Dropout\u3002 </p> </li> <li> <p>\\(Q\\): AlextNet \u7684\u6570\u636e\u6269\u589e\u662f\u600e\u4e48\u505a\u7684      &gt; \\(A\\): \u6570\u636e\u6269\u589e\u6709\u4e24\u79cd     &gt; 1. \u5e73\u79fb\u548c\u6c34\u5e73\u53cd\u8f6c\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u56fe\u7247\u7684\u4e3b\u4f53\u79fb\u52a8\u5230\u4e2d\u5fc3\u4f4d\u7f6e     &gt; 2. \u6539\u53d8 RGB \u7684\u503c\u3002\u5229\u7528 pca \u83b7\u53d6\u4e3b\u6210\u5206\uff0c\u7136\u540e\u5728\u7279\u5f81\u503c\u4e0a\u4e58\u4e0a\u9ad8\u65af\u968f\u673a\u6570</p> </li> <li> <p>\\(Q\\): AlexNet \u7684\u7f51\u7edc\u7ed3\u6784\u4e2d\uff0c\u6709\u4ec0\u4e48\u4e0d\u5408\u7406\u7684\u5730\u65b9\u5417\uff1f      &gt; \\(A\\):  \u7b2c\u4e00\u4e2a\u5c42\u7684\u5377\u79ef\u6838\u8fc7\u5927\uff0c\u8fd9\u5bfc\u81f4\u8ba1\u7b97\u91cf\u4f1a\u5f88\u5927</p> </li> <li> <p>\\(Q\\): AlexNet \u6709\u4ec0\u4e48\u540e\u9762\u4eba\u4eec\u4e0d\u518d\u4f7f\u7528\u7684\u7ed3\u6784\u5417\uff1f     &gt; \\(A\\):  LRN</p> </li> </ul>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#vgg","title":"VGG","text":"<p>\u80cc\u666f\u4ecb\u7ecd </p> <p>2014 \u5e74 ImageNet \u6bd4\u8d5b\u7b2c\u4e8c\u540d</p> <p>\u63d0\u5347\u65b9\u5f0f </p> <p>\u589e\u52a0\u5377\u79ef\u5c42\u4e2a\u6570\uff0c\u589e\u52a0\u7f51\u7edc\u6df1\u5ea6\u3002</p> <p>\u6210\u679c </p> <ul> <li>\u5728 ImageNet \u6bd4\u8d5b\u4e2d\u53d6\u5f97\u826f\u597d\u6210\u7ee9</li> <li>\u6cdb\u5316\u6548\u679c\u597d</li> </ul> <p>\u95ee\u9898 </p> <ul> <li> <p>\\(Q\\): VGG\u7684\u7f51\u7edc\u7ed3\u6784\u6709\u4ec0\u4e48\u7279\u70b9\uff1f\u5377\u79ef\u5c42\u548cmaxpool\u5c42\u662f\u6309\u4ec0\u4e48\u89c4\u5f8b\u6392\u5e03\u7684?      &gt; \\(A\\): \u7279\u70b9:\u7f51\u7edc\u5c42\u6b21\u5f88\u6df1, \u7531\u4e94\u4e2a\u5377\u79ef\u5757\u548c\u4e09\u4e2a\u5168\u8fde\u63a5\u5c42\u6784\u6210; \u6bcf\u4e00\u4e2a\u5377\u79ef\u5757\u7531\u82e5\u5e72\u4e2a\u5377\u79ef\u5c42\u6784\u6210\uff0c\u6bcf\u4e00\u4e2a\u5377\u79ef\u5c42\u7684\u5377\u79ef\u6838\u5927\u5c0f\u90fd\u662f3*3, padding=1\u3002\u5377\u79ef\u5757\u4e4b\u95f4\u6709\u6c60\u5316\u5c42\uff0ckernel_size = 2, \u6b65\u957f\u4e3a2\u3002 \u89c4\u5f8b\uff1a\u4e00\u4e2a\u5377\u79ef\u5757\u540e\u8ddf\u4e0a\u4e00\u4e2a maxpool \u5c42\u3002</p> </li> <li> <p>\\(Q\\): \u5982\u4f55\u7406\u89e3 VGG \u4e2d\u7684\u5377\u79ef\u5757\uff1f\u591a\u4e2a 33 \u4e3a\u4ec0\u4e48\u53ef\u4ee5\u66ff\u4ee3\u4e00\u4e2a\u5927\u5377\u79ef\u6838\uff1f\u4ee3\u66ff\u540e\u6709\u54ea\u4e9b\u597d\u5904\uff1f     &gt; \\(A\\): \u4e00\u4e2a\u5377\u79ef\u5feb\u7531\u82e5\u5e72\u4e2a\u5377\u79ef\u5c42\u6784\u6210\uff0c\u6bcf\u4e00\u4e2a\u5377\u79ef\u5c42\u540e\u90fd\u6709\u4e00\u4e2a relu\u5c42\u3002\u56e0\u4e3a\u65bd\u7528\u591a\u4e2a33\u7684\u5377\u79ef\u6838\u7684\u6548\u679c\u548c\u5927\u5377\u79ef\u6838\u7684\u611f\u53d7\u91ce\u662f\u4e00\u6837\u7684\u3002\u597d\u5904\uff1a(1) \u53c2\u6570\u4e2a\u6570\u51cf\u5c11\uff0c\u8ba1\u7b97\u91cf\u4e0b\u964d\uff0c\u53ef\u4ee5\u51cf\u5c11\u8fc7\u62df\u5408\u3002(2) \u5377\u79ef\u5c42\u4e4b\u95f4\u6709 relu\uff0c\u589e\u52a0\u975e\u7ebf\u6027\u64cd\u4f5c\uff0c\u63d0\u5347\u9274\u522b\u80fd\u529b</p> </li> <li> <p>\\(Q\\): VGG \u662f\u5426\u4f7f\u7528\u4e86 LRN, \u4e3a\u4ec0\u4e48      &gt; \\(A\\): \u6ca1\u6709\uff0c\u56e0\u4e3a \u4f7f\u7528 LRN \u4e0d\u80fd\u63d0\u9ad8\u6a21\u578b\u7684\u6b63\u786e\u7387\uff0c\u5f92\u589e\u8ba1\u7b97\u91cf</p> </li> <li> <p>\\(Q\\): \u4ec0\u4e48\u662f\u611f\u53d7\u91ce\uff1f      &gt; \\(A\\): \u8f93\u51fa\u7279\u5f81\u56fe\u7684\u50cf\u7d20\u70b9\u5728\u8f93\u5165\u7279\u5f81\u56fe\u4e0a\u6620\u5c04\u7684\u533a\u57df \uff08\u795e\u7ecf\u7f51\u7edc\u4e2d\uff0c\u4e00\u4e2a\u795e\u7ecf\u5143\u770b\u5230\u7684\u533a\u57df\uff09</p> </li> <li> <p>\\(Q\\): \u8bad\u7ec3\u4e2d\u4f7f\u7528\u52a8\u91cf\uff0c\u4f1a\u5bf9\u68af\u5ea6\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f\u4f7f\u7528\u52a8\u91cf\u6709\u4ec0\u4e48\u597d\u5904\uff1f      &gt; \\(A\\): \u5bf9\u6bcf\u6b21\u8fed\u4ee3\u8ba1\u7b97\u7684\u68af\u5ea6\u505a\u52a0\u6743\u5e73\u5747\uff0c\u4f7f\u7528\u52a8\u91cf\u7684\u597d\u5904\u662f\u80fd\u591f\u62b5\u6d88\u68af\u5ea6\u7684\u6296\u52a8\uff0c\u52a0\u5feb\u7b97\u6cd5\u6536\u655b\u7684\u901f\u5ea6\u3002</p> </li> </ul> <p></p> <ul> <li>\\(Q\\): weight decay \u5bf9\u76ee\u6807\u51fd\u6570\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f\u4f7f\u7528 weight decay \u6709\u4ec0\u4e48\u597d\u5904\uff1f      &gt; \\(A\\): \u7ea6\u675f\u6743\u91cd weight \u8fc7\u62df\u5408\uff0c\u7f13\u89e3\u8fc7\u62df\u5408</li> </ul> <p></p> <ul> <li> <p>\\(Q\\): VGG \u662f\u5982\u4f55\u521d\u59cb\u5316\u7684      &gt; \\(A\\): \u5148\u7528\u6700\u6d45\u7684\u795e\u7ecf\u7f51\u7edc A \u6765\u8bad\u7ec3\uff0c\u8bad\u7ec3\u66f4\u6df1\u5c42\u6b21\u7684\u7f51\u7edc\u65f6\uff0c\u5c31\u5c06 A \u6a21\u578b\u8bad\u7ec3\u5f97\u5230\u7684\u53c2\u6570\u4f5c\u4e3a\u6df1\u5c42\u7f51\u7edc\u7684\u521d\u59cb\u53c2\u6570\u3002\u540e\u9762\u4f5c\u8005\u53d1\u73b0\u4f7f\u7528 Xavier/Kaiming \u7684\u521d\u59cb\u5316\u65b9\u5f0f\u4e5f\u884c\u3002</p> </li> <li> <p>\\(Q\\): \u5982\u4f55\u7406\u89e3 Xavier \u548c Kaiming \u7684\u521d\u59cb\u5316\u601d\u8def\uff1f      &gt; \\(A\\):  \u4e3a\u4e86\u9632\u6b62\u51fa\u73b0 \u68af\u5ea6\u6d88\u5931 \u548c \u68af\u5ea6\u7206\u70b8, \u5408\u7406\u7684\u521d\u59cb\u5316\u5e94\u8be5\u4fdd\u8bc1 \u8f93\u5165\u548c\u8f93\u51fa\u7684\u5206\u5e03\u76f8\u540c </p> </li> <li> <p>\\(Q\\): VGG \u5728\u8bad\u7ec3\u548c\u6d4b\u8bd5\u65f6\u90fd\u4f7f\u7528\u4e86\u591a\u5c3a\u5ea6\u56fe\u50cf\u6269\u589e\uff0c\u6709\u4ec0\u4e48\u6548\u679c      &gt; \\(A\\):  \u591a\u5c3a\u5ea6\u7684\u6548\u679c\u4f1a\u6bd4\u5355\u5c3a\u5ea6\u597d (256-512) \u968f\u673a\u9009\u53d6\u56fe\u50cf</p> </li> <li> <p>\\(Q\\): VGG \u8fd8\u5c1d\u8bd5\u4e86\u591a\u4e2a\u6a21\u578b\u878d\u5408\uff0c\u6709\u4ec0\u4e48\u6548\u679c     &gt; \\(A\\):  \u591a\u6a21\u578b\u878d\u5408\u7684\u6548\u679c\u4f1a\u66f4\u597d</p> </li> <li> <p>\\(Q\\): \u4e3a\u4ec0\u4e48 VGG \u6700\u6df1\u4e3a19\u5c42      &gt; \\(A\\):  \u56e0\u4e3a\u5230\u4e8619\u5c42\uff0c\u6a21\u578b\u57fa\u672c\u5df2\u7ecf\u9971\u548c\u4e86\uff0c\u518d\u589e\u52a0\u5c42\u6570\u6a21\u578b\u7684\u51c6\u786e\u7387\u4e0d\u4f1a\u518d\u6709\u6240\u53d8\u5316\u3002</p> </li> </ul>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#googlenet","title":"GoogLeNet","text":"<p>\u80cc\u666f  2014 \u5e74 \u5206\u7c7b\u51a0\u519b</p> <ul> <li> <p>\\(Q\\): GoogLeNet \u7684\u603b\u4f53\u8bbe\u8ba1\u76ee\u6807\u662f\u4ec0\u4e48\uff1f     &gt; \\(A\\): 1. \u63d0\u5347\u6df1\u5ea6\u795e\u7ecf\u7f51\u7edc\u7684\u6df1\u5ea6\u548c\u5bbd\u5ea6\u3002 2. \u4e0d\u589e\u52a0 (\u51cf\u5c11) \u8ba1\u7b97\u91cf\u3002</p> </li> <li> <p>\\(Q\\): \u76f4\u63a5\u53bb\u6389\u7f51\u7edc\u4e2d\u8f83\u5927\u6743\u91cd\u7684\u7a00\u758f\u65b9\u6cd5\u6709\u4ec0\u4e48\u7f3a\u9677     &gt; \\(A\\): 1. \u7f51\u7edc\u635f\u5931\uff1a\u76f4\u63a5\u526a\u679d\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f51\u7edc\u7684\u6027\u80fd\u4e0b\u964d\uff0c\u56e0\u4e3a\u526a\u679d\u4f1a\u5220\u9664\u67d0\u4e9b\u6743\u91cd\uff0c\u4ece\u800c\u4e22\u5931\u4e00\u90e8\u5206\u7f51\u7edc\u6240\u5b66\u5230\u7684\u77e5\u8bc6\u3002     &gt; \\(A\\): 2. \u4e0d\u89c4\u5219\u6027\uff1a\u76f4\u63a5\u526a\u679d\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f51\u7edc\u4e2d\u7684\u7a00\u758f\u6027\u53d8\u5f97\u4e0d\u89c4\u5219\u3002     &gt; \\(A\\): 3. \u8bad\u7ec3\u4ee3\u4ef7\uff1a\u76f4\u63a5\u526a\u679d\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u591a\u8f6e\u7684\u8fed\u4ee3\u8bad\u7ec3\u548c\u526a\u679d\u8fc7\u7a0b\uff0c\u4ee5\u627e\u5230\u8981\u5220\u9664\u7684\u6743\u91cd\u3002</p> </li> <li> <p>\\(Q\\): \u4ece\u8bbe\u8ba1\u601d\u8def\u8bb2\uff0cInception \u662f\u5982\u4f55\u5b9e\u73b0\u7a00\u758f\u7684      &gt; \\(A\\): \u901a\u8fc7\u4f7f\u7528 1*1 \u7684\u5377\u79ef\u5c42\uff0c\u8fd9\u662f\u56e0\u4e3a 1*1 \u7684\u7f51\u7edc\u7ed3\u6784\u53ef\u505a\u5230\u6570\u636e\u964d\u7ef4\uff0c\u4f7f\u5f97\u7f51\u7edc\u5b66\u4e60\u5230\u4e3b\u8981\u4fe1\u606f\uff0c\u5ffd\u7565\u6b21\u8981\u4fe1\u606f\u3002</p> </li> <li> <p>\\(Q\\): \u5982\u4f55\u5c06\u8d6b\u5e03\u7406\u8bba (fire togethe, wire together) \u8fd0\u7528\u5230 Inception \u7684\u8bbe\u8ba1\u4e2d     &gt; \\(A\\): \u901a\u8fc7\u4f7f\u7528 1*1 \u5377\u79ef\uff0c\u5c06\u795e\u7ecf\u5143\u805a\u5408\u5728\u4e00\u8d77</p> </li> <li> <p>\\(Q\\): Inception \u7684\u7ed3\u6784\u5927\u6982\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u6709\u51e0\u4e2a\u5206\u652f\uff0c\u5206\u522b\u662f\u4ec0\u4e48\u3002      &gt; \\(A\\): \u7531\u8f93\u5165\u5206\u6210\u56db\u4e2a\u5206\u652f\uff0c\u5206\u522b\u8fdb\u884c\u4e0d\u540c\u7684\u5377\u79ef\u8fd0\u7b97\uff0c\u6700\u540e\u6c47\u603b\u5230\u8f93\u51fa\u5c42\u3002     &gt; \u6709\u56db\u4e2a\u5206\u652f\uff0c\u7b2c\u4e00\u4e2a\u5206\u652f\u662f 1*1\uff0c \u7b2c\u4e8c\u4e2a\u5206\u652f 1*1 \u548c 3*3\uff0c \u7b2c\u4e09\u4e2a\u5206\u652f 1*1 \u548c 5*5, \u7b2c\u56db\u4e2a\u5206\u652f max-pool \u548c 1*1</p> </li> <li> <p>\\(Q\\): Inception \u4e2d 1*1 \u7684\u5377\u79ef\u4f5c\u7528\u662f\u4ec0\u4e48?     &gt; \\(A\\): 1. \u7528\u4e8e\u6570\u636e\u964d\u7ef4\uff0c\u51cf\u5c11\u8bad\u7ec3\u53c2\u6570\uff0c\u51cf\u5c11\u6570\u636e\u91cf\u30022. \u589e\u52a0\u975e\u7ebf\u6027\uff0c \u9632\u6b62\u8fc7\u62df\u5408</p> </li> <li> <p>\\(Q\\): GoogleNet \u4e2d\u6dfb\u52a0\u8f85\u52a9 loss \u7684\u76ee\u7684\u662f\u4ec0\u4e48\uff1f \u6d4b\u8bd5\u7684\u65f6\u5019\u662f\u5426\u8fd8\u9700\u8981\u8f85\u52a9 loss\u3002     &gt; \\(A\\): GoogLeNet \u7f51\u7edc\u5c42\u6b21\u592a\u6df1\uff0c\u5728\u53cd\u76f8\u4f20\u64ad\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u53d1\u751f\u68af\u5ea6\u6d88\u5931\u3002\u6d4b\u8bd5\u7684\u65f6\u5019\u4e0d\u9700\u8981\u3002</p> </li> </ul> <p>\u62d3\u5c55 </p> <p>\u795e\u7ecf\u7f51\u7edc\u51cf\u679d patch:</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#resnet","title":"ResNet","text":"<p>2015 \u5e74 ImageNet \u51a0\u519b</p> <p>2016 \u5e74 best paper</p> <ul> <li> <p>\\(Q\\): \u4ec0\u4e48\u662f\u9000\u5316\u95ee\u9898 ?     &gt; \\(A\\): \u4f7f\u7528\u8fc7\u6df1\u7684\u7f51\u7edc\u7ed3\u6784\u8bad\u7ec3\u6a21\u578b\uff0c\u8bad\u7ec3\u8bef\u5dee\u548c\u6d4b\u8bd5\u8bef\u5dee\u53cd\u800c\u4f1a\u589e\u52a0\u3002</p> </li> <li> <p>\\(Q\\): \u4ec0\u4e48\u5b9e\u9a8c\u73b0\u8c61\u8868\u660e\u662f\u9000\u5316\u95ee\u9898\u800c\u4e0d\u662f\u8fc7\u62df\u5408\u95ee\u9898 ?     &gt; \\(A\\): \u56e0\u4e3a \u5728\u9000\u5316\u95ee\u9898\u4e2d\uff0c\u8bad\u7ec3\u8bef\u5dee\u548c\u6d4b\u8bd5\u8bef\u5dee\u90fd\u589e\u52a0\u3002\u5982\u679c\u662f\u8fc7\u62df\u5408\u95ee\u9898\uff0c\u5e94\u8be5\u662f\u6d4b\u8bd5\u8bef\u5dee\u589e\u52a0     &gt;   \u8bad\u7ec3\u8bef\u5dee\u51cf\u5c11\u3002</p> </li> <li> <p>\\(Q\\): \u5982\u4f55\u7406\u89e3\u6b8b\u5dee\u8fde\u63a5\uff0c\u4e3a\u4ec0\u4e48\u6b8b\u5dee\u8fde\u63a5\u53ef\u4ee5\u89e3\u51b3\u9000\u5316\u95ee\u9898?     &gt; \\(A\\): \u56e0\u4e3a\u6b8b\u5dee\u8fde\u63a5\u662f\u7528 \u975e\u7ebf\u6027\u5c42\u6765 \u62df\u5408 \u6b8b\u5dee\u51fd\u6570\uff0c\u6bd4\u8d77\u76f4\u63a5\u7528\u6765\u62df\u5408\u6700\u4f18\u51fd\u6570\u6548\u679c     &gt; \u8981\u597d\u7684\u591a\u3002</p> </li> <li> <p>\\(Q\\): \u5728\u7f51\u7edc\u7ed3\u6784\u4e0a\u5982\u4f55\u5b9e\u73b0\u6b8b\u5dee\u8fde\u63a5\uff1f\uff08\u5206\u7ef4\u5ea6\u4e0d\u53d8\u548c\u7ef4\u5ea6\u6539\u53d8\u4e24\u79cd\u60c5\u51b5\uff09      &gt; \\(A\\): \u7ef4\u5ea6\u4e0d\u53d8\uff0c\u4e4b\u95f4\u5c06\u4e4b\u524d\u5c42\u7684\u8f93\u51fa\u6309\u5143\u7d20\u52a0\u5165\u5f53\u524d\u5c42\u7684\u8f93\u51fa\u3002     &gt;  \u7ef4\u5ea6\u6539\u53d8\uff0c\u4e4b\u95f4\u5c06\u4e4b\u524d\u5c42\u7684\u8f93\u51fa\u7ecf\u8fc7\u6295\u5f71\u77e9\u9635\u540e\uff0c\u6309\u5143\u7d20\u52a0\u5165\u5f53\u524d\u5c42\u7684\u8f93\u51fa\u3002</p> </li> <li> <p>\\(Q\\): \u4ece\u53c2\u6570\u548c\u8ba1\u7b97\u91cf\u4e0a\uff0c\u6b8b\u5dee\u8fde\u63a5\u6709\u4ec0\u4e48\u4f18\u52bf\uff1f      &gt; \\(A\\): \u6b8b\u5dee\u8fde\u63a5\u4e0d\u4f1a\u589e\u52a0\u53c2\u6570, \u8ba1\u7b97\u91cf\u5f88\u5c0f</p> </li> <li> <p>\\(Q\\): bottleneck \u7ed3\u6784\u662f\u600e\u6837\u7684\uff1f \u5176\u4e2d 1*1 \u5377\u79ef\u7684\u4f5c\u7528\u662f\u4ec0\u4e48? \u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1bottleneck\u7ed3\u6784?     &gt; \\(A\\)\uff1abottleneck \u6709\u4e09\u4e2a\u5377\u79ef\u5c42\u6784\u6210\uff0c\u5206\u522b\u4e3a 1*1, 3*3, 1*1, \u7b2c\u4e00\u4e2a 1*1\u662f\u4e3a\u4e86\u964d\u7ef4\uff0c\u51cf\u5c11 3*3     &gt; \u7684\u8ba1\u7b97\u91cf\uff0c\u7b2c\u4e8c\u4e2a 1*1\u4e3a\u4e86\u5347\u7ef4\u3002\u4f7f\u7528 bottleneck \u7ed3\u6784\u53ef\u4ee5\u51cf\u5c11\u8ba1\u7b97\u91cf\uff0c\u52a0\u5feb\u8bad\u7ec3\u901f\u5ea6\u3002 </p> </li> </ul> <p></p> <ul> <li> <p>\\(Q\\): BN \u548c conv relu \u7684\u5173\u7cfb\u662f\u4ec0\u4e48 ?     &gt; \\(A\\): bn \u5c42\u5728 conv \u548c relu \u4e4b\u95f4</p> </li> <li> <p>\\(Q\\): BN \u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898 ?     &gt; \\(A\\): BN \u662f\u4e3a\u4e86\u89e3\u51b3 \u5185\u90e8\u534f\u53d8\u91cf\u504f\u79fb\uff0cbn \u7684\u505a\u6cd5\u662f\u5c06\u4e2d\u95f4\u5c42\u53c2\u6570\u6309\u7167\u5747\u503c\u4e3a0\uff0c\u6807\u51c6\u5dee\u4e3a1\u7684\u9ad8\u65af\u5206\u5e03\u6807\u51c6\u5316\u3002     &gt; BN \u80fd\u591f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\uff1a(\u540c\u65f6\u4e5f\u4fdd\u8bc1\u4e0d\u4f1a\u53d1\u751f\u68af\u5ea6\u6d88\u5931\u7684\u95ee\u9898)</p> </li> <li> <p>\\(Q\\): \u8bad\u7ec3\u548c\u6d4b\u8bd5\u65f6\uff0cBN\u7684\u8ba1\u7b97\u8fc7\u7a0b\u5206\u522b\u662f\u600e\u4e48\u6837\u7684\uff1f      &gt; \\(A\\): \u8bad\u7ec3\u65f6: \u8ba1\u7b97\u4e00\u4e2a batch \u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u505a\u5f52\u4e00\u5316\uff0c\u7136\u540e\u8fdb\u884c     &gt; scale and shift, \u540c\u65f6\u5b66\u4e60 scale \u548c shift \u7684\u53c2\u6570      &gt; \u6d4b\u8bd5\u65f6\uff0c\u7528\u8bad\u7ec3\u65f6\u5f97\u5230\u7684\u5747\u503c\u548c\u65b9\u5dee\u6807\u51c6\u6cd5\uff0c\u5e76\u8fdb\u884c scale \u548c shift</p> </li> <li> <p>\\(Q\\): \u6709\u54ea\u4e9b\u8bad\u7ec3\u548c\u6d4b\u8bd5\u65f6\uff0c\u8ba1\u7b97\u65b9\u5f0f\u4e0d\u540c\u7684\u5c42 ?     &gt; \\(A\\): BN \u5c42\u3002\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0cBatch Normalization\u4f1a\u6839\u636e\u6bcf\u4e2a\u6279\u6b21\u7684\u6570\u636e\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\uff0c\u5e76\u4e14\u7ef4\u62a4\u6bcf\u4e2a\u6279\u6b21\u7684\u5747\u503c\u548c\u65b9\u5dee\u3002\u4f46\u662f\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u65e0\u6cd5\u5f97\u77e5\u6574\u4e2a\u6d4b\u8bd5\u96c6\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u8bad\u7ec3\u9636\u6bb5\u79ef\u7d2f\u7684\u79fb\u52a8\u5e73\u5747\u5747\u503c\u548c\u79fb\u52a8\u5e73\u5747\u65b9\u5dee\u6765\u8fdb\u884c\u5f52\u4e00\u5316\u3002</p> </li> <li> <p>\\(Q\\): \u52a0\u5165 BN \u540e\uff0c\u7f51\u7edc\u7ed3\u6784\u548c\u8bad\u7ec3\u8d85\u53c2\u6570\u9700\u8981\u505a\u51fa\u54ea\u4e9b\u8c03\u6574 ?     &gt; \\(A\\): 1.\u5728\u5377\u79ef\u5c42\u548crelu\u5c42\u4e4b\u524d\uff0c\u9700\u8981\u52a0\u5165 bn \u5c42     &gt; 2. \u8c03\u6574\u6279\u5927\u5c0f </p> </li> <li> <p>\\(Q\\): \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528 bn \u548c dropout      &gt; \\(A\\):  1. \u51b2\u7a81\u7684\u566a\u58f0\u5f15\u5165\uff1aBN\u5c42\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5f52\u4e00\u5316\uff0c\u6709\u4e00\u5b9a\u7684\u6b63\u5219\u5316\u6548\u679c\uff0c\u800cDropout\u5c42\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u968f\u673a\u4e22\u5f03\u795e\u7ecf\u5143\uff0c\u5f15\u5165\u4e86\u53e6\u4e00\u79cd\u566a\u58f0\u3002\u540c\u65f6\u4f7f\u7528\u5b83\u4eec\u53ef\u80fd\u4f1a\u5f15\u5165\u51b2\u7a81\u7684\u566a\u58f0\u4fe1\u53f7\uff0c\u53ef\u80fd\u4f1a\u5e72\u6270\u6a21\u578b\u7684\u5b66\u4e60\u8fc7\u7a0b\u3002</p> <p> 2.\u51cf\u5f31BN\u7684\u4f18\u52bf\uff1aBN\u5c42\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u5bf9\u6bcf\u4e2a\u6279\u6b21\u7684\u5f52\u4e00\u5316\u6765\u52a0\u901f\u6a21\u578b\u7684\u8bad\u7ec3\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u5b9a\u7684\u6b63\u5219\u5316\u6548\u679c\u3002\u800cDropout\u5c42\u7684\u5f15\u5165\u53ef\u80fd\u4f1a\u524a\u5f31BN\u5c42\u7684\u6b63\u5219\u5316\u6548\u679c\uff0c\u4f7f\u5f97\u6a21\u578b\u7684\u8bad\u7ec3\u8fc7\u7a0b\u4e0d\u518d\u90a3\u4e48\u7a33\u5b9a\u548c\u9ad8\u6548\u3002</p> </li> </ul> <p>\u5c55\u671b </p> <p>\u5f88\u5927\u4e00\u90e8\u5206\u5de5\u4f5c\u90fd\u5728\u4f7f\u7528 ResNet \u505a backbone (\u9aa8\u5e72)</p>"},{"location":"notes/DL/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/#transformer","title":"transformer \u6a21\u578b","text":"<ul> <li> <p>\\(Q\\): 1.Transformer\u4e3a\u4f55\u4f7f\u7528\u591a\u5934\u6ce8\u610f\u529b\u673a\u5236\uff1f\uff08\u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528\u4e00\u4e2a\u5934\uff09     &gt; \\(A\\): \u4e3a\u4e86\u80fd\u5b66\u5230\u4e0d\u540c\u6a21\u5f0f\u4e0b\u7684\u4fe1\u606f\uff0c\u8fbe\u5230\u7c7b\u4f3c\u5377\u79ef\u591a\u901a\u9053\u7684\u6548\u679c</p> </li> <li> <p>\\(Q\\): 2.Transformer\u4e3a\u4ec0\u4e48Q\u548cK\u4f7f\u7528\u4e0d\u540c\u7684\u6743\u91cd\u77e9\u9635\u751f\u6210\uff0c\u4e3a\u4f55\u4e0d\u80fd\u4f7f\u7528\u540c\u4e00\u4e2a\u503c\u8fdb\u884c\u81ea\u8eab\u7684\u70b9\u4e58\uff1f \uff08\u6ce8\u610f\u548c\u7b2c\u4e00\u4e2a\u95ee\u9898\u7684\u533a\u522b\uff09     &gt; \\(A\\): - \u4f7f\u7528 Q \u70b9\u4e58 K \u672c\u8d28\u4e0a\u662f\u6c42\u51fa\u4e00\u4e2a attention score \u77e9\u9635\uff0c \u8fd9\u4e2a\u77e9\u9635\u5b58\u50a8\u4e86\u4e00\u4e2a\u53e5\u5b50\u4e2d\u6bcf\u4e00\u4e2a\u8bcd\u4e0e\u5176\u4ed6     &gt; \u8bcd\u7684\u8ddd\u79bb\u5927\u5c0f\u3002\u5982\u679c\u662f K * K\uff0c\u56e0\u4e3a\u662f\u540c\u6837\u4e00\u4e2a\u77e9\u9635\uff0c\u90fd\u6295\u5f71\u5230\u4e86\u540c\u6837\u4e00\u4e2a\u7a7a\u95f4\uff0c\u6240\u4ee5\u6cdb\u5316\u80fd\u529b\u5f88\u5dee\u3002     &gt;  - \u4f7f\u7528\u4e0d\u540c\u6743\u91cd\u77e9\u9635\u53ef\u4ee5\u4fdd\u8bc1\u5728\u4e0d\u540c\u7a7a\u95f4\u5185\u8fdb\u884c\u6295\u5f71\uff0c\u63d0\u5347\u8868\u8fbe\u80fd\u529b\uff0c\u589e\u52a0\u4e86\u6cdb\u5316\u80fd\u529b\u3002</p> </li> <li> <p>\\(Q\\): 3.Transformer\u8ba1\u7b97attention\u7684\u65f6\u5019\u4e3a\u4f55\u9009\u62e9\u70b9\u4e58\u800c\u4e0d\u662f\u52a0\u6cd5\uff1f\u4e24\u8005\u8ba1\u7b97\u590d\u6742\u5ea6\u548c\u6548\u679c\u4e0a\u6709\u4ec0\u4e48\u533a\u522b\uff1f     &gt; \\(A\\): \u4e24\u8005\u6548\u679c\u5dee\u4e0d\u591a,  \u4f46\u662f\u77e9\u9635\u4e58\u6cd5\u66f4\u597d\u5e76\u884c\uff0c\u5bf9\u4e8e\u786c\u4ef6\u66f4\u52a0\u53cb\u597d\u3002</p> </li> <li> <p>\\(Q\\): 4.\u4e3a\u4ec0\u4e48\u5728\u8fdb\u884csoftmax\u4e4b\u524d\u9700\u8981\u5bf9attention\u8fdb\u884cscaled\uff08\u4e3a\u4ec0\u4e48\u9664\u4ee5dk\u7684\u5e73\u65b9\u6839\uff09\uff0c\u5e76\u4f7f\u7528\u516c\u5f0f\u63a8\u5bfc\u8fdb\u884c\u8bb2\u89e3     &gt; \\(A\\): \u7531\u4e8e \\(d_k\\) \u7684\u503c\u5f88\u5927\uff0c\u8fdb\u884c\u77e9\u9635\u76f8\u4e58\u540e\uff0c\u7ed3\u679c\u4f1a\u5f88\u5927\uff0c\u800c \\(\\text{ softmax}\\) \u51fd\u6570\u4f1a\u5c06\u7ed3\u679c\u5f88\u5927\u7684     &gt; \u6570\u636e\u70b9\u63a8\u5411\u66f2\u7ebf\u7684\u4e24\u7aef (\u68af\u5ea6\u5f88\u5c0f\u7684\u4f4d\u7f6e)\uff0c\u4e0d\u5229\u4e8e\u8fdb\u884c\u68af\u5ea6\u7684\u53cd\u5411\u4f20\u64ad</p> </li> <li> <p>\\(Q\\): 5.\u5728\u8ba1\u7b97attention score\u7684\u65f6\u5019\u5982\u4f55\u5bf9padding\u505amask\u64cd\u4f5c\uff1f     &gt; \\(A\\): \u5c06\u5f53\u524d\u65f6\u95f4\u540e\u7684\u6570\u503c\u66ff\u6362\u4e3a \u4e00\u4e2a\u7edd\u5bf9\u503c\u8f83\u5927\u7684\u8d1f\u6570\uff0c\u8fd9\u6837\u7ecf\u8fc7 \\(\\text{ softmax}\\)\u51fd\u6570\u540e\uff0c\u5bf9\u5e94\u503c\u4f1a\u53d8\u62100 </p> </li> <li> <p>\\(Q\\): 6.\u4e3a\u4ec0\u4e48\u5728\u8fdb\u884c\u591a\u5934\u6ce8\u610f\u529b\u7684\u65f6\u5019\u9700\u8981\u5bf9\u6bcf\u4e2ahead\u8fdb\u884c\u964d\u7ef4\uff1f\uff08\u53ef\u4ee5\u53c2\u8003\u4e0a\u9762\u4e00\u4e2a\u95ee\u9898\uff09     &gt; \\(A\\): \u5c06\u539f\u6709\u7684\u9ad8\u5ea6\u964d\u6210\u4f4e\u7ef4\u5ea6\u518d\u8fdb\u884c\u62fc\u63a5\uff0c\u53ef\u4ee5\u4e30\u5bcc\u7279\u5f81\u4fe1\u606f\u3002</p> </li> <li> <p>\\(Q\\): 7.\u5927\u6982\u8bb2\u4e00\u4e0bTransformer\u7684Encoder\u6a21\u5757\uff1f     &gt; \\(A\\): encoder \u6a21\u5757\u75316\u4e2a\u5b8c\u5168\u76f8\u540c\u7684\u5c42\u6784\u6210\uff0c\u6bcf\u4e00\u5c42\u6709\u4e24\u4e2a\u5b50\u5c42\u3002     &gt; \u7b2c\u4e00\u4e2a\u5b50\u5c42\u662f multi-head attention machanism, \u7b2c\u4e8c\u5c42\u662f mlp (\u4e24\u4e2a\u7ebf\u6027\u5c42)</p> </li> <li> <p>\\(Q\\): 8.\u4e3a\u4f55\u5728\u83b7\u53d6\u8f93\u5165\u8bcd\u5411\u91cf\u4e4b\u540e\u9700\u8981\u5bf9\u77e9\u9635\u4e58\u4ee5embedding size\u7684\u5f00\u65b9\uff1f\u610f\u4e49\u662f\u4ec0\u4e48\uff1f     &gt; \\(A\\): embedding matrix\u7684\u521d\u59cb\u5316\u65b9\u5f0f\u662fxavier init\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u65b9\u5dee\u662f1/embedding size\uff0c\u56e0\u6b64\u4e58\u4ee5embedding size\u7684\u5f00\u65b9\u4f7f\u5f97embedding matrix\u7684\u65b9\u5dee\u662f1\uff0c\u5728\u8fd9\u4e2ascale\u4e0b\u53ef\u80fd\u66f4\u6709\u5229\u4e8eembedding matrix\u7684\u6536\u655b\u3002</p> </li> <li> <p>\\(Q\\): 9.\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bTransformer\u7684\u4f4d\u7f6e\u7f16\u7801\uff1f\u6709\u4ec0\u4e48\u610f\u4e49\u548c\u4f18\u7f3a\u70b9\uff1f     &gt; \\(A\\): \u6839\u636e \u5355\u8bcd\u6240\u5728\u53e5\u5b50\u4e2d\u7684\u4f4d\u7f6e\uff0c\u751f\u6210\u4e00\u4e2a 512 \u4f4d\u7684\u4f4d\u7f6e\u7f16\u7801\uff0c\u518d\u4e0e\u5355\u8bcd\u7684\u5411\u91cf\u8fdb\u884c\u76f8\u52a0     &gt;  \u4f18\u70b9\uff0c\u4e3a \u5355\u8bcd\u6dfb\u52a0\u4e86\u4f4d\u7f6e\u4fe1\u606f\u3002</p> </li> <li> <p>\\(Q\\): 10.\u4f60\u8fd8\u4e86\u89e3\u54ea\u4e9b\u5173\u4e8e\u4f4d\u7f6e\u7f16\u7801\u7684\u6280\u672f\uff0c\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f     &gt; \\(A\\): RPE, \u548c \u590d\u6570\u51fd\u6570\u57df</p> </li> <li> <p>\\(Q\\): 11.\u7b80\u5355\u8bb2\u4e00\u4e0bTransformer\u4e2d\u7684\u6b8b\u5dee\u7ed3\u6784\u4ee5\u53ca\u610f\u4e49\u3002     &gt; \\(A\\): \u53ef\u4ee5\u89e3\u51b3 \u7f51\u7edc\u7ed3\u6784\u5c42\u8fc7\u591a\u800c\u9020\u6210\u7684\u68af\u5ea6\u6d88\u5931\u95ee\u9898 </p> </li> <li> <p>\\(Q\\): 12.\u4e3a\u4ec0\u4e48transformer\u5757\u4f7f\u7528LayerNorm\u800c\u4e0d\u662fBatchNorm\uff1fLayerNorm \u5728Transformer\u7684\u4f4d\u7f6e\u662f\u54ea\u91cc\uff1f     &gt; \\(A\\): LayerNorm \u662f\u4e00\u4e2a\u6837\u672c(\u53e5\u5b50)\u8fdb\u884c\u6807\u51c6\u5316\uff0c\u800c BatchNorm \u662f\u5bf9\u4e00\u4e2a batch \u8fdb\u884c\u6807\u51c6\u5316\u3002     &gt; \u7531\u4e8e\u5728 nlp \u4e2d, \u53e5\u5b50\u7684\u957f\u77ed\u4e0d\u540c\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e0d\u540cbatch\u7684\u957f\u5ea6\u4e0d\u540c(\u88650\u5bf9\u9f50)\uff0c\u4f7f\u7528 bn \u7684\u6548\u679c\u4e0d\u597d     &gt; encoder \u548c decoder \u6bcf\u4e00\u4e2a\u5b50\u5c42\u7684\u8f93\u51fa</p> </li> <li> <p>\\(Q\\): 13.\u7b80\u7b54\u8bb2\u4e00\u4e0bBatchNorm\u6280\u672f\uff0c\u4ee5\u53ca\u5b83\u7684\u4f18\u7f3a\u70b9\u3002     &gt; \\(A\\): \u89c1 resnet</p> </li> <li> <p>\\(Q\\): 14.\u7b80\u5355\u63cf\u8ff0\u4e00\u4e0bTransformer\u4e2d\u7684\u524d\u9988\u795e\u7ecf\u7f51\u7edc\uff1f\u4f7f\u7528\u4e86\u4ec0\u4e48\u6fc0\u6d3b\u51fd\u6570\uff1f\u76f8\u5173\u4f18\u7f3a\u70b9\uff1f     &gt; \\(A\\): relu</p> </li> <li> <p>\\(Q\\): 15.Encoder\u7aef\u548cDecoder\u7aef\u662f\u5982\u4f55\u8fdb\u884c\u4ea4\u4e92\u7684\uff1f\uff08\u5728\u8fd9\u91cc\u53ef\u4ee5\u95ee\u4e00\u4e0b\u5173\u4e8eseq2seq\u7684attention\u77e5\u8bc6\uff09     &gt; \\(A\\): encoder \u7aef\u7684\u8f93\u51fa\u4f5c\u4e3a decoder \u7b2c\u4e8c\u4e2a\u5b50\u5c42 key, value \u7684\u8f93\u5165\u3002</p> </li> <li> <p>\\(Q\\): 16.Decoder\u9636\u6bb5\u7684\u591a\u5934\u81ea\u6ce8\u610f\u529b\u548cencoder\u7684\u591a\u5934\u81ea\u6ce8\u610f\u529b\u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u4e3a\u4ec0\u4e48\u9700\u8981decoder\u81ea\u6ce8\u610f\u529b\u9700\u8981\u8fdb\u884c sequence mask)     &gt; \\(A\\): \u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u63d0\u524d\u770b\u5230 t \u65f6\u523b\u540e\u7684 token</p> </li> <li> <p>\\(Q\\): 17.Transformer\u7684\u5e76\u884c\u5316\u63d0\u73b0\u5728\u54ea\u4e2a\u5730\u65b9\uff1fDecoder\u7aef\u53ef\u4ee5\u505a\u5e76\u884c\u5316\u5417\uff1f     &gt; \\(A\\): Encoder\u4fa7\uff1a\u6a21\u5757\u4e4b\u95f4\u662f\u4e32\u884c\u7684\uff0c\u4e00\u4e2a\u6a21\u5757\u8ba1\u7b97\u7684\u7ed3\u679c\u505a\u4e3a\u4e0b\u4e00\u4e2a\u6a21\u5757\u7684\u8f93\u5165\uff0c\u4e92\u76f8\u4e4b\u524d\u6709\u4f9d\u8d56\u5173\u7cfb\u3002\u4ece\u6bcf\u4e2a\u6a21\u5757\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u6ce8\u610f\u529b\u5c42\u548c\u524d\u9988\u795e\u7ecf\u5c42\u8fd9\u4e24\u4e2a\u5b50\u6a21\u5757\u5355\u72ec\u6765\u770b\u90fd\u662f\u53ef\u4ee5\u5e76\u884c\u7684\uff0c\u4e0d\u540c\u5355\u8bcd\u4e4b\u95f4\u662f\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\u7684\u3002     &gt; Decode\u5f15\u5165sequence mask\u5c31\u662f\u4e3a\u4e86\u5e76\u884c\u5316\u8bad\u7ec3\uff0cDecoder\u63a8\u7406\u8fc7\u7a0b\u6ca1\u6709\u5e76\u884c\uff0c\u53ea\u80fd\u4e00\u4e2a\u4e00\u4e2a\u7684\u89e3\u7801\uff0c\u5f88\u7c7b\u4f3c\u4e8eRNN\uff0c\u8fd9\u4e2a\u65f6\u523b\u7684\u8f93\u5165\u4f9d\u8d56\u4e8e\u4e0a\u4e00\u4e2a\u65f6\u523b\u7684\u8f93\u51fa\u3002</p> </li> <li> <p>\\(Q\\): 19.Transformer\u7ec3\u7684\u65f6\u5019\u5b66\u4e60\u7387\u662f\u5982\u4f55\u8bbe\u5b9a\u7684\uff1fDropout\u662f\u5982\u4f55\u8bbe\u5b9a\u7684\uff0c\u4f4d\u7f6e\u5728\u54ea\u91cc\uff1fDropout \u5728\u6d4b\u8bd5\u7684\u9700\u8981\u6709\u4ec0\u4e48\u9700\u8981\u6ce8\u610f\u7684\u5417\uff1f     &gt; \\(A\\): \u6bcf\u4e00\u4e2a\u5b50\u5c42\u8f93\u51fa\u65f6\uff0c\u90fd\u8fdb\u884c dropout \uff08\u65e9\u4e8e norm\uff09\uff0c \\(P_{drop} = 0.1\\) </p> </li> </ul> <p>answear </p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/","title":"Java SSM\u7b14\u8bb0\uff08\u4e00\uff09","text":"<p>\u5efa\u8bae\uff1a\u5bf9Java\u5f00\u53d1\u8fd8\u4e0d\u662f\u5f88\u719f\u6089\u7684\u540c\u5b66\uff0c\u6700\u597d\u5148\u82b1\u8d39\u534a\u4e2a\u6708\u5230\u4e00\u4e2a\u6708\u65f6\u95f4\u5927\u91cf\u5730\u53bb\u7f16\u5199\u5c0f\u9879\u76ee\uff0c\u4e0d\u63a8\u8350\u4e00\u53e3\u6c14\u5b66\u5b8c\uff0c\u540e\u9762\u7684\u5185\u5bb9\u76f8\u6bd4\u524d\u9762\u7684\u5185\u5bb9\u51e0\u4e4e\u662f\u964d\u7ef4\u6253\u51fb\uff0c\u4e00\u53e3\u6c14\u5b66\u5b8c\u5f88\u5bb9\u6613\u5fd8\u8bb0\u4e4b\u524d\u6240\u5b66\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u5c24\u5176\u662fJavaSE\u9636\u6bb5\u7684\u5185\u5bb9\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#spring","title":"Spring\u6846\u67b6\u6280\u672f","text":"<p>\u606d\u559c\u5404\u4f4d\u987a\u5229\u8fdb\u5165\u5230SSM\uff08Spring+SpringMVC+Mybatis\uff09\u9636\u6bb5\u7684\u5b66\u4e60\uff0c\u4e5f\u7b97\u662f\u6210\u529f\u51fa\u4e86Java\u65b0\u624b\u6751\uff0c\u7531\u4e8e\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5b66\u4e60\u8fc7Mybatis\u4e86\uff0c\u56e0\u6b64\uff0c\u672c\u671f\u6559\u7a0b\u7684\u65f6\u95f4\u5b89\u6392\u76f8\u6bd4\u4e4b\u524d\u4f1a\u66f4\u77ed\u4e00\u4e9b\u3002\u4ece\u8fd9\u91cc\u5f00\u59cb\uff0c\u5f88\u591a\u7684\u6982\u5ff5\u7406\u89e3\u8d77\u6765\u5c31\u7a0d\u5fae\u6709\u4e00\u70b9\u96be\u5ea6\u4e86\uff0c\u56e0\u4e3a\u4f60\u4eec\u6ca1\u6709\u63a5\u89e6\u8fc7\u4f01\u4e1a\u5f00\u53d1\u573a\u666f\uff0c\u5f88\u96be\u4f53\u4f1a\u5230\u90a3\u79cd\u601d\u60f3\u5e26\u6765\u7684\u597d\u5904\uff0c\u751a\u81f3\u5230\u540e\u671f\u63a5\u89e6\u5230\u7684\u51e0\u4e4e\u90fd\u662f\u57fa\u4e8e\u4e91\u8ba1\u7b97\u548c\u5927\u6570\u636e\u7406\u8bba\u5b9e\u73b0\u7684\u6846\u67b6\uff08\u5f53\u4e0b\u6700\u70ed\u95e8\u6700\u524d\u6cbf\u7684\u6280\u672f\uff09\u9010\u6e10\u4e0d\u518d\u662f\u548c\u8ba1\u7b97\u673a\u57fa\u7840\u76f8\u5173\u8054\uff0c\u800c\u662f\u548c\u600e\u4e48\u9ad8\u6548\u5e72\u6d3b\u76f8\u5173\u4e86\u3002</p> <p>\u5728JavaWeb\u9636\u6bb5\uff0c\u6211\u4eec\u5df2\u7ecf\u5b66\u4e60\u4e86\u5982\u4f55\u4f7f\u7528Java\u8fdb\u884cWeb\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\uff0c\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u5177\u6709\u642d\u5efaWeb\u7f51\u7ad9\u7684\u80fd\u529b\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0\u5b58\u5728\u8bf8\u591a\u7684\u4e0d\u4fbf\uff0c\u5728\u6700\u540e\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u7f16\u7a0b\u5b9e\u6218\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u867d\u7136\u6211\u4eec\u601d\u8def\u5f88\u6e05\u6670\uff0c\u77e5\u9053\u5982\u4f55\u7f16\u5199\u5bf9\u5e94\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u5f00\u53d1\u6548\u7387\uff0c\u5b9e\u5728\u662f\u592a\u6162\u4e86\uff0c\u5e76\u4e14\u5bf9\u4e8e\u5bf9\u8c61\u521b\u5efa\u7684\u7ba1\u7406\uff0c\u5b58\u5728\u8bf8\u591a\u7684\u4e0d\u59a5\u4e4b\u5904\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u53bb\u7ee7\u7eed\u5b66\u4e60\u66f4\u591a\u7684\u6846\u67b6\u6280\u672f\uff0c\u6765\u7b80\u5316\u548c\u89c4\u8303\u6211\u4eec\u7684Java\u5f00\u53d1\u3002</p> <p>Spring\u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u6846\u67b6\uff08\u6587\u6863\uff1ahttps://docs.spring.io/spring-framework/docs/5.2.13.RELEASE/spring-framework-reference/\uff09\uff0c\u5b83\u5c31\u662f\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\u800c\u751f\uff0c\u5b83\u662f\u8f7b\u91cf\u7ea7\u7684IoC\u548cAOP\u7684\u5bb9\u5668\u6846\u67b6\uff0c\u4e3b\u8981\u662f\u9488\u5bf9JavaBean\u7684\u751f\u547d\u5468\u671f\u8fdb\u884c\u7ba1\u7406\u7684\u8f7b\u91cf\u7ea7\u5bb9\u5668\uff0c\u5e76\u4e14\u5b83\u7684\u751f\u6001\u5df2\u7ecf\u53d1\u5c55\u5f97\u6781\u4e3a\u5e9e\u5927\u3002\u90a3\u4e48\uff0c\u9996\u5148\u4e00\u95ee\uff0c\u4ec0\u4e48\u662fIoC\u548cAOP\uff0c\u4ec0\u4e48\u53c8\u662fJavaBean\u5462\uff1f\u53ea\u662f\u542c\u8d77\u6765\u6ee1\u6ee1\u7684\u9ad8\u7ea7\u611f\uff0c\u5b9e\u9645\u4e0a\u6ca1\u6709\u591a\u9ad8\u7ea7\uff08\u5f88\u591a\u4e1c\u897f\u90fd\u662f\u8fd9\u6837\uff0c\u540d\u5b57\u542c\u8d77\u6765\u5f88\u725b\uff0c\u5b9e\u9645\u4e0a\u53ea\u662f\u4e00\u4e2a\u5f88\u5bb9\u6613\u7406\u89e3\u7684\u4e1c\u897f\uff09</p> <p>\u56e0\u6b64\uff0c\u4e00\u5207\u7684\u4e00\u5207\uff0c\u6211\u4eec\u8fd8\u8981\u4eceJavaBean\u8bf4\u8d77\uff0c\u4ece\u8fd9\u9897\u8c46\u5b50\u751f\u6839\u53d1\u82bd\u5f00\u59cb\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#javabean","title":"\u4ec0\u4e48\u662fJavaBean","text":"<p>JavaBean\u5c31\u662f\u6709\u4e00\u5b9a\u89c4\u8303\u7684Java\u5b9e\u4f53\u7c7b\uff0c\u8ddf\u666e\u901a\u7c7b\u5dee\u4e0d\u591a\uff0c\u4e0d\u540c\u7684\u662f\u7c7b\u5185\u90e8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u516c\u5171\u7684\u65b9\u6cd5\u4ee5\u4fbf\u5916\u754c\u5bf9\u8be5\u5bf9\u8c61\u5185\u90e8\u5c5e\u6027\u8fdb\u884c\u64cd\u4f5c\uff0c\u6bd4\u5982set\u3001get\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\uff0c\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u4e00\u76f4\u5728\u7528\u7684\uff1a</p> <pre><code>public class User{\n    private String name;\n    private int age;\n    public String getName(){\n        return name;\n    }\n    public String getAge(){\n        return age;\n    }\n    public void setName(String name){\n        this.name = name;\n    }\n    public void setAge(int age){\n        this.age = age;\n    }\n}\n</code></pre> <p>\u5b83\u7684\u6240\u6709\u5c5e\u6027\u90fd\u662fprivate\uff0c\u6240\u6709\u7684\u5c5e\u6027\u90fd\u53ef\u4ee5\u901a\u8fc7get/set\u65b9\u6cd5\u8fdb\u884c\u8bbf\u95ee\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u6709\u4e00\u4e2a\u65e0\u53c2\u6784\u9020\uff08\u9ed8\u8ba4\u5c31\u6709\uff09</p> <p>\u56e0\u6b64\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684\u5f88\u591a\u7c7b\uff0c\u5176\u5b9e\u90fd\u53ef\u4ee5\u662f\u4e00\u4e2aJavaBean\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#ioc","title":"IoC\u7406\u8bba\u57fa\u7840","text":"<p>\u5728\u6211\u4eec\u4e4b\u524d\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edfWeb\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u6574\u4e2a\u7a0b\u5e8f\u5176\u5b9e\u662f\u4f9d\u9760\u5404\u4e2a\u90e8\u5206\u76f8\u4e92\u534f\u4f5c\uff0c\u5171\u540c\u5b8c\u6210\u4e00\u4e2a\u64cd\u4f5c\uff0c\u6bd4\u5982\u8981\u5c55\u793a\u501f\u9605\u4fe1\u606f\u5217\u8868\uff0c\u90a3\u4e48\u9996\u5148\u9700\u8981\u4f7f\u7528Servlet\u8fdb\u884c\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u6570\u636e\u5904\u7406\uff0c\u7136\u540e\u8bf7\u6c42\u7684\u6570\u636e\u5168\u90e8\u4ea4\u7ed9\u5bf9\u5e94\u7684Service\uff08\u4e1a\u52a1\u5c42\uff09\u6765\u5904\u7406\uff0c\u5f53Service\u53d1\u73b0\u8981\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6570\u636e\u65f6\uff0c\u518d\u5411\u5bf9\u5e94\u7684Mapper\u53d1\u8d77\u8bf7\u6c42\u3002</p> <p>\u5b83\u4eec\u4e4b\u95f4\u5c31\u50cf\u8fde\u63a5\u5728\u4e00\u8d77\u7684\u9f7f\u8f6e\uff0c\u8c01\u4e5f\u79bb\u4e0d\u5f00\u8c01\uff1a</p> <p></p> <p>\u5c31\u50cf\u4e00\u4e2a\u56e2\u961f\uff0c\u6bcf\u4e2a\u4eba\u7684\u5206\u5de5\u90fd\u5f88\u660e\u786e\uff0c\u6d41\u6c34\u7ebf\u4e0a\u7684\u4e00\u5957\u64cd\u4f5c\u5fc5\u987b\u73af\u73af\u76f8\u6263\uff0c\u8fd9\u662f\u4e00\u79cd\u9ad8\u5ea6\u8026\u5408\u7684\u4f53\u7cfb\u3002</p> <p>\u867d\u7136\u8fd9\u6837\u7684\u4f53\u7cfb\u903b\u8f91\u975e\u5e38\u6e05\u6670\uff0c\u6574\u4e2a\u6d41\u7a0b\u4e5f\u80fd\u591f\u8ba9\u4eba\u5feb\u901f\u4e86\u89e3\uff0c\u4f46\u662f\u8fd9\u6837\u5b58\u5728\u4e00\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u6211\u4eec\u73b0\u5728\u7684\u65f6\u4ee3\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u8f6f\u4ef6\u9879\u76ee\u9ad8\u901f\u8fed\u4ee3\u7684\u65f6\u4ee3\uff0c\u6211\u4eec\u53d1\u73b0\u5f88\u591aApp\u4e09\u5929\u4e24\u5934\u9694\u4e09\u5dee\u4e94\u5730\u5c31\u66f4\u65b0\uff0c\u800c\u4e14\u662f\u4ec0\u4e48\u529f\u80fd\u5f53\u4e0b\u6700\u706b\uff0c\u5c31\u9a6c\u4e0d\u505c\u8e44\u5730\u8fdb\u884c\u8ddf\u8fdb\u5f00\u53d1\uff0c\u56e0\u6b64\uff0c\u5c31\u5f88\u5bb9\u6613\u51fa\u73b0\uff0c\u4e4b\u524d\u5199\u597d\u7684\u4ee3\u7801\uff0c\u5b9e\u73b0\u7684\u529f\u80fd\uff0c\u9700\u8981\u5168\u90e8\u63a8\u7ffb\uff0c\u6539\u6210\u65b0\u7684\u529f\u80fd\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u5f97\u4e0d\u53bb\u4fee\u6539\u67d0\u4e9b\u6d41\u6c34\u7ebf\u4e0a\u7684\u6a21\u5757\uff0c\u4f46\u662f\u8fd9\u6837\u4e00\u4fee\u6539\uff0c\u4f1a\u76f4\u63a5\u5bfc\u81f4\u6574\u4e2a\u6d41\u6c34\u7ebf\u7684\u5f15\u7528\u5173\u7cfb\u5927\u9762\u79ef\u66f4\u65b0\u3002</p> <p>\u5c31\u50cf\u6211\u4e0d\u60f3\u7528\u8fd9\u4e2aService\u5b9e\u73b0\u7c7b\u4e86\uff0c\u6211\u60f3\u4f7f\u7528\u5176\u4ed6\u7684\u5b9e\u73b0\u7c7b\u7528\u4e0d\u540c\u7684\u903b\u8f91\u505a\u8fd9\u4e9b\u529f\u80fd\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u80fd\u6bcf\u4e2a\u7c7b\u90fd\u53bb\u6328\u4e2a\u8fdb\u884c\u4fee\u6539\uff0c\u5f53\u9879\u76ee\u7279\u522b\u5e9e\u5927\u65f6\uff0c\u5149\u662f\u6539\u4e2a\u7c7b\u540d\u5c31\u591f\u4f60\u6539\u4e00\u5929\u3002</p> <p>\u56e0\u6b64\uff0c\u9ad8\u8026\u5408\u5ea6\u5e26\u6765\u7684\u7f3a\u70b9\u662f\u5f88\u660e\u663e\u7684\uff0c\u4e5f\u662f\u73b0\u4ee3\u8f6f\u4ef6\u5f00\u53d1\u4e2d\u5f88\u81f4\u547d\u7684\u95ee\u9898\u3002\u5982\u679c\u8981\u6539\u5584\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ea\u80fd\u5c06\u5404\u4e2a\u6a21\u5757\u8fdb\u884c\u89e3\u8026\uff0c\u8ba9\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\u6027\u4e0d\u518d\u90a3\u4e48\u5730\u5f3a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cService\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0d\u518d\u7531\u6211\u4eec\u51b3\u5b9a\uff0c\u800c\u662f\u8ba9\u7a0b\u5e8f\u81ea\u5df1\u51b3\u5b9a\uff0c\u6240\u6709\u7684\u5b9e\u73b0\u7c7b\u5bf9\u8c61\uff0c\u5168\u90e8\u4ea4\u7ed9\u7a0b\u5e8f\u6765\u7ba1\u7406\uff0c\u6240\u6709\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4e5f\u7531\u7a0b\u5e8f\u6765\u52a8\u6001\u51b3\u5b9a\uff0c\u8fd9\u6837\u5c31\u5f15\u5165\u4e86IoC\u7406\u8bba\u3002</p> <p>IOC\u662fInversion of Control\u7684\u7f29\u5199\uff0c\u7ffb\u8bd1\u4e3a\uff1a\u201c\u63a7\u5236\u53cd\u8f6c\u201d\uff0c\u628a\u590d\u6742\u7cfb\u7edf\u5206\u89e3\u6210\u76f8\u4e92\u5408\u4f5c\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u7c7b\u901a\u8fc7\u5c01\u88c5\u4ee5\u540e\uff0c\u5185\u90e8\u5b9e\u73b0\u5bf9\u5916\u90e8\u662f\u900f\u660e\u7684\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u89e3\u51b3\u95ee\u9898\u7684\u590d\u6742\u5ea6\uff0c\u800c\u4e14\u53ef\u4ee5\u7075\u6d3b\u5730\u88ab\u91cd\u7528\u548c\u6269\u5c55\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u5bf9\u8c61\u4ea4\u7ed9IoC\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\uff0c\u6bd4\u5982\u5f53\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u65f6\uff0c\u7531\u5b83\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u6765\u51b3\u5b9a\u5230\u5e95\u7ed9\u6211\u4eec\u54ea\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e0d\u7528\u518d\u5173\u5fc3\u6211\u4eec\u8981\u53bb\u4f7f\u7528\u54ea\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\uff0c\u7ed9\u5230\u6211\u7684\u4e00\u5b9a\u662f\u4e00\u4e2a\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u7684\u5b9e\u73b0\u7c7b\uff0c\u80fd\u7528\u5c31\u5b8c\u4e8b\u4e86\uff0c\u53cd\u6b63\u63a5\u53e3\u5b9a\u4e49\u4e86\u5565\uff0c\u6211\u53ea\u7ba1\u8c03\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u653e\u5fc3\u5730\u8ba9\u4e00\u4e2a\u4eba\u53bb\u5199\u89c6\u56fe\u5c42\u7684\u4ee3\u7801\uff0c\u4e00\u4e2a\u4eba\u53bb\u5199\u4e1a\u52a1\u5c42\u7684\u4ee3\u7801\uff0c\u5f00\u53d1\u6548\u7387\u90a3\u662f\u9ad8\u7684\u4e00\u5339\u554a\u3002</p> <p>\u9ad8\u5185\u805a\uff0c\u4f4e\u8026\u5408\uff0c\u662f\u73b0\u4ee3\u8f6f\u4ef6\u7684\u5f00\u53d1\u7684\u8bbe\u8ba1\u76ee\u6807\uff0c\u800cSpring\u6846\u67b6\u5c31\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u4e00\u4e2aIoC\u5bb9\u5668\u8fdb\u884c\u5bf9\u8c61\u7684\u7ba1\u7406\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#ioc_1","title":"\u4f7f\u7528IoC\u5bb9\u5668","text":"<p>\u9996\u5148\u4e00\u5b9a\u8981\u660e\u786e\uff0c\u4f7f\u7528Spring\u9996\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u4f7f\u5f97\u8f6f\u4ef6\u9879\u76ee\u8fdb\u884c\u89e3\u8026\uff0c\u800c\u4e0d\u662f\u4e3a\u4e86\u53bb\u7b80\u5316\u4ee3\u7801\uff01</p> <p>Spring\u5e76\u4e0d\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u6846\u67b6\uff0c\u5b83\u5b9e\u9645\u4e0a\u5305\u542b\u4e86\u5f88\u591a\u7684\u6a21\u5757\uff1a</p> <p></p> <p>\u800c\u6211\u4eec\u9996\u5148\u8981\u53bb\u5b66\u4e60\u7684\u5c31\u662fCore Container\uff0c\u4e5f\u5c31\u662f\u6838\u5fc3\u5bb9\u5668\u6a21\u5757\u3002</p> <p>Spring\u662f\u4e00\u4e2a\u975e\u5165\u4fb5\u5f0f\u7684\u6846\u67b6\uff0c\u5c31\u50cf\u4e00\u4e2a\u5de5\u5177\u5e93\u4e00\u6837\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53ea\u9700\u8981\u76f4\u63a5\u5bfc\u5165\u5176\u4f9d\u8d56\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#spring_1","title":"\u7b2c\u4e00\u4e2aSpring\u9879\u76ee","text":"<p>\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Maven\u9879\u76ee\uff0c\u5e76\u5bfc\u5165Spring\u6846\u67b6\u7684\u4f9d\u8d56\uff0cSpring\u6846\u67b6\u7684\u5750\u6807\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n    &lt;version&gt;5.3.13&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u63a5\u7740\u5728resource\u4e2d\u521b\u5efa\u4e00\u4e2aSpring\u914d\u7f6e\u6587\u4ef6\uff0c\u547d\u540d\u4e3atest.xml\uff0c\u76f4\u63a5\u53f3\u952e\u70b9\u51fb\u5373\u53ef\u521b\u5efa\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n        https://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n\n&lt;/beans&gt;\n</code></pre> <p>\u6700\u540e\uff0c\u5728\u4e3b\u65b9\u6cd5\u4e2d\u7f16\u5199\uff1a</p> <pre><code>public static void main(String[] args) {\n    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"text\");\n\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u4e00\u4e2a\u6700\u57fa\u672c\u7684Spring\u9879\u76ee\u5c31\u521b\u5efa\u5b8c\u6210\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5411IoC\u5bb9\u5668\u4e2d\u6ce8\u518cJavaBean\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2aStudent\u7c7b\uff1a</p> <pre><code>//\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd8\u7528\u4e0d\u5230\u503c\u6ce8\u5165\uff0c\u53ea\u9700\u8981\u5305\u542b\u6210\u5458\u5c5e\u6027\u5373\u53ef\uff0c\u4e0d\u7528Getter/Setter\u3002\npublic class Student {\n    String name;\n    int age;\n}\n</code></pre> <p>\u7136\u540e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u8fd9\u4e2abean\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"/&gt;\n</code></pre> <p>\u73b0\u5728\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e0d\u9700\u8981\u6211\u4eec\u518d\u53bb\u751f\u6210\u4e86\uff0c\u800c\u662f\u7531IoC\u5bb9\u5668\u6765\u63d0\u4f9b\uff1a</p> <pre><code>public static void main(String[] args) {\n    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"test.xml\");\n    Student student = (Student) context.getBean(\"student\");\n    System.out.println(student);\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u91cc\u5f97\u5230\u7684Student\u5bf9\u8c61\u662f\u7531Spring\u901a\u8fc7\u53cd\u5c04\u673a\u5236\u5e2e\u52a9\u6211\u4eec\u521b\u5efa\u7684\uff0c\u521d\u5b66\u8005\u4f1a\u975e\u5e38\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u6765\u521b\u5efa\u5bf9\u8c61\uff0c\u6211\u4eec\u76f4\u63a5new\u4e00\u4e2a\u5b83\u4e0d\u9999\u5417\uff1f\u4e3a\u4ec0\u4e48\u8981\u4ea4\u7ed9IoC\u5bb9\u5668\u7ba1\u7406\u5462\uff1f\u5728\u540e\u9762\u7684\u5b66\u4e60\u4e2d\uff0c\u6211\u4eec\u518d\u6162\u6162\u8fdb\u884c\u4f53\u4f1a\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#javabeanioc","title":"\u5c06JavaBean\u4ea4\u7ed9IoC\u5bb9\u5668\u7ba1\u7406","text":"<p>\u901a\u8fc7\u524d\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u53d1\u73b0\u53ea\u8981\u5c06\u6211\u4eec\u521b\u5efa\u597d\u7684JavaBean\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u7f16\u5199\uff0c\u5373\u53ef\u5c06\u5176\u4ea4\u7ed9IoC\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u770b\u770b\uff0c\u4e00\u4e2aJavaBean\u7684\u8be6\u7ec6\u914d\u7f6e\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"/&gt;\n</code></pre> <p>\u5176\u4e2d<code>name</code>\u5c5e\u6027\uff08\u4e5f\u53ef\u4ee5\u662f<code>id</code>\u5c5e\u6027\uff09\uff0c\u5168\u5c40\u552f\u4e00\uff0c\u4e0d\u53ef\u51fa\u73b0\u91cd\u590d\u7684\u540d\u79f0\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u4e4b\u524d\u5176\u5b9e\u5c31\u662f\u901a\u8fc7Bean\u7684\u540d\u79f0\u6765\u5411IoC\u5bb9\u5668\u7d22\u8981\u5bf9\u5e94\u7684\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u83b7\u53d6\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u5728\u4e3b\u65b9\u6cd5\u4e2d\u8fde\u7eed\u83b7\u53d6\u4e24\u4e2a\u5bf9\u8c61\uff1a</p> <pre><code>ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"test.xml\");\nStudent student = (Student) context.getBean(\"student\");\nStudent student2 = (Student) context.getBean(\"student\");\nSystem.out.println(student);\nSystem.out.println(student2);\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u4e24\u6b21\u83b7\u53d6\u5230\u7684\u5b9e\u9645\u4e0a\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7IoC\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\u7684JavaBean\u662f\u5355\u4f8b\u6a21\u5f0f\u7684\uff0c\u65e0\u8bba\u600e\u4e48\u83b7\u53d6\u59cb\u7ec8\u4e3a\u90a3\u4e00\u4e2a\u5bf9\u8c61\uff0c\u90a3\u4e48\u5982\u4f55\u8fdb\u884c\u4fee\u6539\u5462\uff1f\u53ea\u9700\u8981\u4fee\u6539\u5176\u4f5c\u7528\u57df\u5373\u53ef\uff0c\u6dfb\u52a0<code>scope</code>\u5c5e\u6027\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\" scope=\"prototype\"/&gt;\n</code></pre> <p>\u901a\u8fc7\u5c06\u5176\u8bbe\u5b9a\u4e3a<code>prototype</code>\uff08\u539f\u578b\u6a21\u5f0f\uff09\u6765\u4f7f\u5f97\u5176\u6bcf\u6b21\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u3002\u6211\u4eec\u63a5\u7740\u6765\u89c2\u5bdf\u4e00\u4e0b\uff0c\u8fd9\u4e24\u79cd\u6a21\u5f0f\u4e0bBean\u7684\u751f\u547d\u5468\u671f\uff0c\u6211\u4eec\u7ed9\u6784\u9020\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u8f93\u51fa\uff1a</p> <pre><code>public class Student {\n    String name;\n    int age;\n\n    public Student(){\n        System.out.println(\"\u6211\u88ab\u6784\u9020\u4e86\uff01\");\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5728mian\u65b9\u6cd5\u4e2d\u6253\u4e0a\u65ad\u70b9\u6765\u67e5\u770b\u5bf9\u8c61\u5206\u522b\u662f\u5728\u4ec0\u4e48\u65f6\u5019\u88ab\u6784\u9020\u7684\u3002</p> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5f53Bean\u7684\u4f5c\u7528\u57df\u4e3a\u5355\u4f8b\u6a21\u5f0f\uff0c\u90a3\u4e48\u5b83\u4f1a\u5728\u4e00\u5f00\u59cb\u5c31\u88ab\u521b\u5efa\uff0c\u800c\u5904\u4e8e\u539f\u578b\u6a21\u5f0f\u4e0b\uff0c\u53ea\u6709\u5728\u83b7\u53d6\u65f6\u624d\u4f1a\u88ab\u521b\u5efa\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5355\u4f8b\u6a21\u5f0f\u4e0b\uff0cBean\u4f1a\u88abIoC\u5bb9\u5668\u5b58\u50a8\uff0c\u53ea\u8981\u5bb9\u5668\u6ca1\u6709\u88ab\u9500\u6bc1\uff0c\u90a3\u4e48\u6b64\u5bf9\u8c61\u5c06\u4e00\u76f4\u5b58\u5728\uff0c\u800c\u539f\u578b\u6a21\u5f0f\u624d\u662f\u76f8\u5f53\u4e8e\u76f4\u63a5new\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5e76\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\uff0c\u544a\u8bc9\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u9700\u8981\u6267\u884c\u6b64\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u4ee5\u53ca\u9500\u6bc1\u4e00\u4e2a\u5bf9\u8c61\u7684\u9500\u6bc1\u65b9\u6cd5\uff1a</p> <pre><code>public class Student {\n    String name;\n    int age;\n\n    private void init(){\n        System.out.println(\"\u6211\u662f\u521d\u59cb\u5316\u65b9\u6cd5\uff01\");\n    }\n\n    private void destroy(){\n        System.out.println(\"\u6211\u662f\u9500\u6bc1\u65b9\u6cd5\uff01\");\n    }\n\n    public Student(){\n        System.out.println(\"\u6211\u88ab\u6784\u9020\u4e86\uff01\");\n    }\n}\n</code></pre> <pre><code>public static void main(String[] args) {\n    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"test.xml\");\n    Student student = (Student) context.getBean(\"student\");\n    System.out.println(student);\n    context.close();  //\u624b\u52a8\u9500\u6bc1\u5bb9\u5668\n}\n</code></pre> <p>\u6700\u540e\u5728XML\u6587\u4ef6\u4e2d\u7f16\u5199\u914d\u7f6e\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\" init-method=\"init\" destroy-method=\"destroy\"/&gt;\n</code></pre> <p>\u63a5\u4e0b\u6765\u6d4b\u8bd5\u4e00\u4e0b\u5373\u53ef\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u624b\u52a8\u6307\u5b9aBean\u7684\u52a0\u8f7d\u987a\u5e8f\uff0c\u82e5\u67d0\u4e2aBean\u9700\u8981\u4fdd\u8bc1\u4e00\u5b9a\u5728\u53e6\u4e00\u4e2aBean\u52a0\u8f7d\u4e4b\u524d\u52a0\u8f7d\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528<code>depend-on</code>\u5c5e\u6027\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#di","title":"\u4f9d\u8d56\u6ce8\u5165DI","text":"<p>\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\u5982\u4f55\u6ce8\u518c\u548c\u4f7f\u7528\u4e00\u4e2aBean\uff0c\u90a3\u4e48\uff0c\u5982\u4f55\u5411Bean\u7684\u6210\u5458\u5c5e\u6027\u8fdb\u884c\u8d4b\u503c\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0cIoC\u5728\u521b\u5efa\u5bf9\u8c61\u65f6\uff0c\u9700\u8981\u5c06\u6211\u4eec\u9884\u5148\u7ed9\u5b9a\u7684\u5c5e\u6027\u6ce8\u5165\u5230\u5bf9\u8c61\u4e2d\uff0c\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>property</code>\u6807\u7b7e\u6765\u5b9e\u73b0\uff0c\u4f46\u662f\u4e00\u5b9a\u6ce8\u610f\uff0c\u6b64\u5c5e\u6027\u5fc5\u987b\u5b58\u5728\u4e00\u4e2aset\u65b9\u6cd5\uff0c\u5426\u5219\u65e0\u6cd5\u8d4b\u503c\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"&gt;\n    &lt;property name=\"name\" value=\"\u5c0f\u660e\"/&gt;\n&lt;/bean&gt;\n</code></pre> <pre><code>public class Student {\n    String name;\n    int age;\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public void say(){\n        System.out.println(\"\u6211\u662f\uff1a\"+name);\n    }\n}\n</code></pre> <p>\u6700\u540e\u6d4b\u8bd5\u662f\u5426\u80fd\u591f\u6210\u529f\u5c06\u5c5e\u6027\u6ce8\u5165\u5230\u6211\u4eec\u7684\u5bf9\u8c61\u4e2d\uff1a</p> <pre><code>public static void main(String[] args) {\n    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"test.xml\");\n    Student student = (Student) context.getBean(\"student\");\n    student.say();\n}\n</code></pre> <p>\u90a3\u4e48\uff0c\u5982\u679c\u6210\u5458\u5c5e\u6027\u662f\u4e00\u4e2a\u975e\u57fa\u672c\u7c7b\u578b\u975eString\u7684\u5bf9\u8c61\u7c7b\u578b\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u6ce8\u5165\u5462\uff1f</p> <pre><code>public class Card {\n}\n</code></pre> <pre><code>public class Student {\n    String name;\n    int age;\n    Card card;\n\n    public void setCard(Card card) {\n        this.card = card;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public void say(){\n        System.out.println(\"\u6211\u662f\uff1a\"+name+\"\uff0c\u6211\u90fd\u5b66\u751f\u8bc1\uff1a\"+card);\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5bf9\u5e94\u7684\u7c7b\u578b\u4e5f\u6ce8\u518c\u4e3abean\u5373\u53ef\uff0c\u7136\u540e\u76f4\u63a5\u4f7f\u7528<code>ref</code>\u5c5e\u6027\u6765\u8fdb\u884c\u5f15\u7528\uff1a</p> <pre><code>&lt;bean name=\"card\" class=\"com.test.bean.Card\"/&gt;\n&lt;bean name=\"student\" class=\"com.test.bean.Student\"&gt;\n    &lt;property name=\"name\" value=\"\u5c0f\u660e\"/&gt;\n    &lt;property name=\"card\" ref=\"card\"/&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u90a3\u4e48\uff0c\u96c6\u5408\u5982\u4f55\u5b9e\u73b0\u6ce8\u5165\u5462\uff1f\u6211\u4eec\u9700\u8981\u5728<code>property</code>\u5185\u90e8\u8fdb\u884c\u7f16\u5199\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"&gt;\n    &lt;property name=\"list\"&gt;\n        &lt;list&gt;\n            &lt;value type=\"double\"&gt;100.0&lt;/value&gt;\n            &lt;value type=\"double\"&gt;95.0&lt;/value&gt;\n            &lt;value type=\"double\"&gt;92.5&lt;/value&gt;\n        &lt;/list&gt;\n    &lt;/property&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u73b0\u5728\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ee5\u4e00\u4e2a\u6570\u7ec4\u7684\u65b9\u5f0f\u5c06\u5c5e\u6027\u6ce8\u5165\uff0c\u6ce8\u610f\u5982\u679c\u662fList\u7c7b\u578b\u7684\u8bdd\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>array</code>\u6570\u7ec4\u3002\u540c\u6837\u7684\uff0c\u5982\u679c\u662f\u4e00\u4e2aMap\u7c7b\u578b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>entry</code>\u6765\u6ce8\u5165\uff1a</p> <pre><code>public class Student {\n    String name;\n    int age;\n    Map&lt;String, Double&gt; map;\n\n    public void setMap(Map&lt;String, Double&gt; map) {\n        this.map = map;\n    }\n\n    public void say(){\n        System.out.println(\"\u6211\u7684\u6210\u7ee9\uff1a\"+ map);\n    }\n}\n</code></pre> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"&gt;\n    &lt;property name=\"map\"&gt;\n        &lt;map&gt;\n            &lt;entry key=\"\u8bed\u6587\" value=\"100.0\"/&gt;\n            &lt;entry key=\"\u6570\u5b66\" value=\"80.0\"/&gt;\n            &lt;entry key=\"\u82f1\u8bed\" value=\"92.5\"/&gt;\n        &lt;/map&gt;\n    &lt;/property&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528\u81ea\u52a8\u88c5\u914d\u6765\u5b9e\u73b0\u5c5e\u6027\u503c\u7684\u6ce8\u5165\uff1a</p> <pre><code>&lt;bean name=\"card\" class=\"com.test.bean.Card\"/&gt;\n&lt;bean name=\"student\" class=\"com.test.bean.Student\" autowire=\"byType\"/&gt;\n</code></pre> <p>\u81ea\u52a8\u88c5\u914d\u4f1a\u6839\u636eset\u65b9\u6cd5\u4e2d\u9700\u8981\u7684\u7c7b\u578b\uff0c\u81ea\u52a8\u5728\u5bb9\u5668\u4e2d\u67e5\u627e\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7c7b\u578b\u6216\u662f\u5bf9\u5e94\u540d\u79f0\u4ee5\u53ca\u5bf9\u5e94\u6784\u9020\u65b9\u6cd5\u7684Bean\uff0c\u6bd4\u5982\u6211\u4eec\u4e0a\u9762\u6307\u5b9a\u7684\u4e3a<code>byType</code>\uff0c\u90a3\u4e48\u5176\u4e2d\u7684card\u5c5e\u6027\u5c31\u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\u7c7b\u578b\u4e3aCard\u7684Bean</p> <p>\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\u5982\u4f55\u4f7f\u7528set\u65b9\u6cd5\u6765\u521b\u5efa\u5bf9\u8c61\uff0c\u90a3\u4e48\u80fd\u5426\u4e0d\u4f7f\u7528\u9ed8\u8ba4\u7684\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\uff0c\u800c\u662f\u6307\u5b9a\u4e00\u4e2a\u6709\u53c2\u6784\u9020\u8fdb\u884c\u5bf9\u8c61\u7684\u521b\u5efa\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u6784\u9020\u65b9\u6cd5\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"&gt;\n        &lt;constructor-arg name=\"name\" value=\"\u5c0f\u660e\"/&gt;\n        &lt;constructor-arg index=\"1\" value=\"18\"/&gt;\n    &lt;/bean&gt;\n</code></pre> <pre><code>public class Student {\n    String name;\n    int age;\n\n    public Student(String name, int age){\n        this.name = name;\n        this.age = age;\n    }\n\n    public void say(){\n        System.out.println(\"\u6211\u662f\uff1a\"+name+\"\u4eca\u5e74\"+age+\"\u5c81\u4e86\uff01\");\n    }\n}\n</code></pre> <p>\u901a\u8fc7\u624b\u52a8\u6307\u5b9a\u6784\u9020\u65b9\u6cd5\u53c2\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u544a\u8bc9\u5bb9\u5668\u4f7f\u7528\u54ea\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\u6765\u521b\u5efa\u5bf9\u8c61\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#aop","title":"\u9762\u5411\u5207\u9762AOP","text":"<p>\u53c8\u662f\u4e00\u4e2a\u542c\u8d77\u6765\u5f88\u9ad8\u5927\u4e0a\u7684\u540d\u8bcd\uff0cAOP\u601d\u60f3\u5b9e\u9645\u4e0a\u5c31\u662f\uff1a\u5728\u8fd0\u884c\u65f6\uff0c\u52a8\u6001\u5730\u5c06\u4ee3\u7801\u5207\u5165\u5230\u7c7b\u7684\u6307\u5b9a\u65b9\u6cd5\u3001\u6307\u5b9a\u4f4d\u7f6e\u4e0a\u7684\u7f16\u7a0b\u601d\u60f3\u5c31\u662f\u9762\u5411\u5207\u9762\u7684\u7f16\u7a0b\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528AOP\u6765\u5e2e\u52a9\u6211\u4eec\u5728\u65b9\u6cd5\u6267\u884c\u524d\u6216\u6267\u884c\u4e4b\u540e\uff0c\u505a\u4e00\u4e9b\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\uff0c\u5c31\u662f\u4ee3\u7406\uff01</p> <p>\u901a\u8fc7AOP\u6211\u4eec\u53ef\u4ee5\u5728\u4fdd\u8bc1\u539f\u6709\u4e1a\u52a1\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u989d\u5916\u7684\u52a8\u4f5c\uff0c\u6bd4\u5982\u6211\u4eec\u7684\u67d0\u4e9b\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u4e4b\u540e\uff0c\u9700\u8981\u6253\u5370\u65e5\u5fd7\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528AOP\u6765\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\uff0c\u5b83\u53ef\u4ee5\u6279\u91cf\u5730\u4e3a\u8fd9\u4e9b\u65b9\u6cd5\u6dfb\u52a0\u52a8\u4f5c\u3002\u53ef\u4ee5\u8bf4\uff0c\u5b83\u76f8\u5f53\u4e8e\u5c06\u6211\u4eec\u539f\u6709\u7684\u65b9\u6cd5\uff0c\u5728\u4e0d\u6539\u53d8\u6e90\u4ee3\u7801\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u589e\u5f3a\u5904\u7406\u3002</p> <p></p> <p>\u76f8\u5f53\u4e8e\u6211\u4eec\u7684\u6574\u4e2a\u4e1a\u52a1\u6d41\u7a0b\uff0c\u88ab\u76f4\u63a5\u65a9\u65ad\uff0c\u5e76\u5728\u65ad\u6389\u7684\u4f4d\u7f6e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u518d\u8fde\u63a5\u8d77\u6765\uff0c\u4e5f\u5c31\u662f\u5728\u4e00\u4e2a\u5207\u70b9\u4f4d\u7f6e\u63d2\u5165\u5185\u5bb9\u3002\u5b83\u7684\u539f\u7406\u5b9e\u9645\u4e0a\u5c31\u662f\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u673a\u5236\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5728JavaWeb\u9636\u6bb5\u5df2\u7ecf\u7ed9\u5927\u5bb6\u8bb2\u89e3\u8fc7\u52a8\u6001\u4ee3\u7406\u4e86\u3002\u4e0d\u8fc7Spring\u5e95\u5c42\u5e76\u4e0d\u662f\u4f7f\u7528\u7684JDK\u63d0\u4f9b\u7684\u52a8\u6001\u4ee3\u7406\uff0c\u800c\u662f\u4f7f\u7528\u7684\u7b2c\u4e09\u65b9\u5e93\u5b9e\u73b0\uff0c\u5b83\u80fd\u591f\u4ee5\u7236\u7c7b\u7684\u5f62\u5f0f\u4ee3\u7406\uff0c\u800c\u4e0d\u662f\u63a5\u53e3\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#springaop","title":"\u4f7f\u7528SpringAOP","text":"<p>Spring\u662f\u652f\u6301AOP\u7f16\u7a0b\u7684\u6846\u67b6\u4e4b\u4e00\uff08\u5b9e\u9645\u4e0a\u5b83\u6574\u5408\u4e86AspectJ\u6846\u67b6\u7684\u4e00\u90e8\u5206\uff09\uff0c\u8981\u4f7f\u7528AOP\u6211\u4eec\u9700\u8981\u5148\u5bfc\u5165\u4e00\u4e2a\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;\n    &lt;version&gt;5.3.13&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u90a3\u4e48\uff0c\u5982\u4f55\u4f7f\u7528AOP\u5462\uff1f\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\uff0c\u8981\u5b9e\u73b0AOP\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u4e9b\u5185\u5bb9\uff1a</p> <ol> <li>\u9700\u8981\u5207\u5165\u7684\u7c7b\uff0c\u7c7b\u7684\u54ea\u4e2a\u65b9\u6cd5\u9700\u8981\u88ab\u5207\u5165</li> <li>\u5207\u5165\u4e4b\u540e\u9700\u8981\u6267\u884c\u4ec0\u4e48\u52a8\u4f5c</li> <li>\u662f\u5728\u65b9\u6cd5\u6267\u884c\u524d\u5207\u5165\u8fd8\u662f\u5728\u65b9\u6cd5\u6267\u884c\u540e\u5207\u5165</li> <li>\u5982\u4f55\u544a\u8bc9Spring\u9700\u8981\u8fdb\u884c\u5207\u5165</li> </ol> <p>\u90a3\u4e48\u6211\u4eec\u4f9d\u6b21\u6765\u770b\uff0c\u9996\u5148\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\uff0c\u627e\u5230\u9700\u8981\u5207\u5165\u7684\u7c7b\uff1a</p> <pre><code>public class Student {\n    String name;\n    int age;\n\n        //\u5206\u522b\u5728test\u65b9\u6cd5\u6267\u884c\u524d\u540e\u5207\u5165\n    public int test(String str) {\n        System.out.println(\"\u6211\u662f\u4e00\u4e2a\u6d4b\u8bd5\u65b9\u6cd5\uff1a\"+str);\n        return str.length();\n    }\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5e0c\u671b\u5728<code>test</code>\u65b9\u6cd5\u6267\u884c\u524d\u540e\u6dfb\u52a0\u6211\u4eec\u7684\u989d\u5916\u6267\u884c\u7684\u5185\u5bb9\uff0c\u63a5\u7740\uff0c\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u4e3a\u65b9\u6cd5\u6267\u884c\u524d\u548c\u6267\u884c\u540e\u6dfb\u52a0\u5207\u5165\u52a8\u4f5c\u3002\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u60f3\u5728\u65b9\u6cd5\u8fd4\u56de\u4e4b\u540e\uff0c\u518d\u6267\u884c\u6211\u4eec\u7684\u52a8\u4f5c\uff0c\u9996\u5148\u5b9a\u4e49\u6211\u4eec\u8981\u6267\u884c\u7684\u64cd\u4f5c\uff1a</p> <pre><code>public class AopTest {\n\n    //\u6267\u884c\u4e4b\u540e\u7684\u65b9\u6cd5\n    public void after(){\n        System.out.println(\"\u6211\u662f\u6267\u884c\u4e4b\u540e\");\n    }\n\n    //\u6267\u884c\u4e4b\u524d\u7684\u65b9\u6cd5\n    public void before(){\n        System.out.println(\"\u6211\u662f\u6267\u884c\u4e4b\u524d\");\n    }\n}\n</code></pre> <p>\u90a3\u4e48\uff0c\u73b0\u5728\u5982\u4f55\u544a\u8bc9Spring\u6211\u4eec\u9700\u8981\u5728\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u548c\u4e4b\u540e\u63d2\u5165\u5176\u4ed6\u903b\u8f91\u5462\uff1f\u9996\u5148\u6211\u4eec\u5c06\u8981\u8fdb\u884cAOP\u64cd\u4f5c\u7684\u7c7b\u6ce8\u518c\u4e3aBean\uff1a</p> <pre><code>&lt;bean name=\"student\" class=\"com.test.bean.Student\"/&gt;\n&lt;bean name=\"aopTest\" class=\"com.test.aop.AopTest\"/&gt;\n</code></pre> <p>\u4e00\u4e2a\u662fStudent\u7c7b\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u5305\u542b\u6211\u4eec\u8981\u5207\u5165\u65b9\u6cd5\u7684AopTest\u7c7b\uff0c\u6ce8\u518c\u4e3aBean\u540e\uff0c\u4ed6\u4eec\u5c31\u4ea4\u7ed9Spring\u8fdb\u884c\u7ba1\u7406\uff0c\u8fd9\u6837Spring\u624d\u80fd\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210AOP\u64cd\u4f5c\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u9700\u8981\u544a\u8bc9Spring\uff0c\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u5207\u5165\u70b9\uff0c\u9996\u5148\u5c06\u9876\u90e8\u4fee\u6539\u4e3a\uff0c\u5f15\u5165aop\u76f8\u5173\u6807\u7b7e\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd\"&gt;\n</code></pre> <p>\u901a\u8fc7\u4f7f\u7528<code>aop:config</code>\u6765\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684AOP\u914d\u7f6e\uff1a</p> <pre><code>&lt;aop:config&gt;\n\n&lt;/aop:config&gt;\n</code></pre> <p>\u9996\u5148\u7b2c\u4e00\u884c\uff0c\u6211\u4eec\u9700\u8981\u544a\u8bc9Spring\uff0c\u6211\u4eec\u8981\u5207\u5165\u7684\u662f\u54ea\u4e00\u4e2a\u7c7b\u7684\u54ea\u4e2a\u6216\u662f\u54ea\u4e9b\u65b9\u6cd5\uff1a</p> <pre><code>&lt;aop:pointcut id=\"test\" expression=\"execution(* com.test.bean.Student.test(String))\"/&gt;\n</code></pre> <p>\u5176\u4e2d\uff0c<code>expression</code>\u5c5e\u6027\u7684<code>execution</code>\u586b\u5199\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>\u4fee\u9970\u7b26 \u5305\u540d.\u7c7b\u540d.\u65b9\u6cd5\u540d\u79f0(\u65b9\u6cd5\u53c2\u6570)\n</code></pre> <ul> <li>\u4fee\u9970\u7b26\uff1apublic\u3001protected\u3001private\u3001\u5305\u62ec\u8fd4\u56de\u503c\u7c7b\u578b\u3001static\u7b49\u7b49\uff08\u4f7f\u7528*\u4ee3\u8868\u4efb\u610f\u4fee\u9970\u7b26\uff09</li> <li>\u5305\u540d\uff1a\u5982com.test\uff08\u4ee3\u8868\u5168\u90e8\uff0c\u6bd4\u5982com.\u4ee3\u8868com\u5305\u4e0b\u7684\u5168\u90e8\u5305\uff09</li> <li>\u7c7b\u540d\uff1a\u4f7f\u7528*\u4e5f\u53ef\u4ee5\u4ee3\u8868\u5305\u4e0b\u7684\u6240\u6709\u7c7b</li> <li>\u65b9\u6cd5\u540d\u79f0\uff1a\u53ef\u4ee5\u4f7f\u7528*\u4ee3\u8868\u5168\u90e8\u65b9\u6cd5</li> <li>\u65b9\u6cd5\u53c2\u6570\uff1a\u586b\u5199\u5bf9\u5e94\u7684\u53c2\u6570\u5373\u53ef\uff0c\u6bd4\u5982(String, String)\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528*\u6765\u4ee3\u8868\u4efb\u610f\u4e00\u4e2a\u53c2\u6570\uff0c\u4f7f\u7528..\u4ee3\u8868\u6240\u6709\u53c2\u6570\u3002</li> </ul> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5c5e\u6027\u6765\u8fdb\u884c\u5339\u914d\uff0c\u6bd4\u5982<code>@annotation</code>\u53ef\u4ee5\u7528\u4e8e\u8868\u793a\u6807\u8bb0\u4e86\u54ea\u4e9b\u6ce8\u89e3\u7684\u65b9\u6cd5\u88ab\u5207\u5165\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u6b64\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u6267\u884c\u524d\u52a8\u4f5c\u548c\u4e00\u4e2a\u6267\u884c\u540e\u52a8\u4f5c\uff1a</p> <pre><code>&lt;aop:aspect ref=\"aopTest\"&gt;\n    &lt;aop:before method=\"before\" pointcut-ref=\"test\"/&gt;\n    &lt;aop:after-returning method=\"after\" pointcut-ref=\"test\"/&gt;\n&lt;/aop:aspect&gt;\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u5168\u90e8\u7684\u914d\u7f6e\uff0c\u73b0\u5728\u6765\u5b9e\u9a8c\u4e00\u4e0b\u5427\uff1a</p> <pre><code>public static void main(String[] args) {\n    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"test.xml\");\n    Student student = context.getBean(Student.class);\n    student.test(\"lbwnb\");\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u65b9\u6cd5\u6267\u884c\u524d\u540e\uff0c\u5206\u522b\u8c03\u7528\u4e86\u6211\u4eec\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u4f46\u662f\u4ec5\u4ec5\u8fd9\u6837\u8fd8\u662f\u4e0d\u80fd\u6ee1\u8db3\u4e00\u4e9b\u9700\u6c42\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u9700\u6c42\u65b9\u6cd5\u6267\u884c\u7684\u4e00\u4e9b\u53c2\u6570\uff0c\u6bd4\u5982\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u8fd4\u56de\u4e86\u4ec0\u4e48\uff0c\u6216\u662f\u65b9\u6cd5\u5f00\u59cb\u4e4b\u524d\u4f20\u5165\u4e86\u4ec0\u4e48\u53c2\u6570\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u6211\u4eec\u5207\u5165\u7684\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u53c2\u6570\uff0c\u901a\u8fc7\u6b64\u53c2\u6570\u5c31\u53ef\u4ee5\u5feb\u901f\u83b7\u53d6\u5207\u70b9\u4f4d\u7f6e\u7684\u4e00\u4e9b\u4fe1\u606f\uff1a</p> <pre><code>//\u6267\u884c\u4e4b\u524d\u7684\u65b9\u6cd5\npublic void before(JoinPoint point){\n    System.out.println(\"\u6211\u662f\u6267\u884c\u4e4b\u524d\");\n    System.out.println(point.getTarget());  //\u83b7\u53d6\u6267\u884c\u65b9\u6cd5\u7684\u5bf9\u8c61\n    System.out.println(Arrays.toString(point.getArgs()));  //\u83b7\u53d6\u4f20\u5165\u65b9\u6cd5\u7684\u5b9e\u53c2\n}\n</code></pre> <p>\u901a\u8fc7\u6dfb\u52a0JoinPoint\u4f5c\u4e3a\u5f62\u53c2\uff0cSpring\u4f1a\u81ea\u52a8\u7ed9\u6211\u4eec\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u5bf9\u8c61\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u83b7\u53d6\u65b9\u6cd5\u7684\u4e00\u4e9b\u4fe1\u606f\u4e86\u3002</p> <p>\u6700\u540e\u6211\u4eec\u518d\u6765\u770b\u73af\u7ed5\u65b9\u6cd5\uff0c\u73af\u7ed5\u65b9\u6cd5\u76f8\u5f53\u4e8e\u5b8c\u5168\u4ee3\u7406\u4e86\u6b64\u65b9\u6cd5\uff0c\u5b83\u5b8c\u5168\u5c06\u6b64\u65b9\u6cd5\u5305\u542b\u5728\u4e2d\u95f4\uff0c\u9700\u8981\u6211\u4eec\u624b\u52a8\u8c03\u7528\u624d\u53ef\u4ee5\u6267\u884c\u6b64\u65b9\u6cd5\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u66f4\u591a\u7684\u53c2\u6570\uff1a</p> <pre><code>public Object around(ProceedingJoinPoint joinPoint) throws Throwable {\n    System.out.println(\"\u65b9\u6cd5\u5f00\u59cb\u4e4b\u524d\");\n    Object value = joinPoint.proceed();\n    System.out.println(\"\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\uff0c\u7ed3\u679c\u4e3a\uff1a\"+value);\n    return value;\n}\n</code></pre> <p>\u6ce8\u610f\uff0c\u5982\u679c\u4ee3\u7406\u65b9\u6cd5\u5b58\u5728\u8fd4\u56de\u503c\uff0c\u90a3\u4e48\u73af\u7ed5\u65b9\u6cd5\u4e5f\u9700\u8981\u6709\u4e00\u4e2a\u8fd4\u56de\u503c\uff0c\u901a\u8fc7<code>proceed</code>\u65b9\u6cd5\u6765\u6267\u884c\u4ee3\u7406\u7684\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539\u53c2\u6570\u4e4b\u540e\u8c03\u7528<code>proceed(Object[])</code>\uff0c\u4f7f\u7528\u6211\u4eec\u7ed9\u5b9a\u7684\u53c2\u6570\u518d\u53bb\u6267\u884c\uff1a</p> <pre><code>public Object around(ProceedingJoinPoint joinPoint) throws Throwable {\n    System.out.println(\"\u65b9\u6cd5\u5f00\u59cb\u4e4b\u524d\");\n    String arg = joinPoint.getArgs()[0] + \"\u4f1e\u5175\u4e00\u53f7\";\n    Object value = joinPoint.proceed(new Object[]{arg});\n    System.out.println(\"\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\uff0c\u7ed3\u679c\u4e3a\uff1a\"+value);\n    return value;\n}\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#aop_1","title":"\u4f7f\u7528\u63a5\u53e3\u5b9e\u73b0AOP","text":"<p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528xml\u914d\u7f6e\u4e00\u4e2aAOP\u64cd\u4f5c\uff0c\u8fd9\u8282\u8bfe\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u4f7f\u7528Advice\u5b9e\u73b0AOP\u3002</p> <p>\u5b83\u4e0e\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u52a8\u6001\u4ee3\u7406\u66f4\u63a5\u8fd1\u4e00\u4e9b\uff0c\u6bd4\u5982\u5728\u65b9\u6cd5\u5f00\u59cb\u6267\u884c\u4e4b\u524d\u6216\u662f\u6267\u884c\u4e4b\u540e\u4f1a\u53bb\u8c03\u7528\u6211\u4eec\u5b9e\u73b0\u7684\u63a5\u53e3\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2a\u7c7b\u5b9e\u73b0Advice\u63a5\u53e3\uff0c\u53ea\u6709\u5b9e\u73b0\u6b64\u63a5\u53e3\uff0c\u624d\u53ef\u4ee5\u88ab\u901a\u77e5\uff0c\u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528<code>MethodBeforeAdvice</code>\u8868\u793a\u662f\u4e00\u4e2a\u5728\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u7684\u52a8\u4f5c\uff1a</p> <pre><code>public class AopTest implements MethodBeforeAdvice {\n    @Override\n    public void before(Method method, Object[] args, Object target) throws Throwable {\n        System.out.println(\"\u901a\u8fc7Advice\u5b9e\u73b0AOP\");\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u65b9\u6cd5\u4e2d\u5305\u62ec\u4e86\u5f88\u591a\u7684\u53c2\u6570\uff0c\u5176\u4e2dargs\u4ee3\u8868\u7684\u662f\u65b9\u6cd5\u6267\u884c\u524d\u5f97\u5230\u7684\u5b9e\u53c2\u5217\u8868\uff0c\u8fd8\u6709target\u8868\u793a\u6267\u884c\u6b64\u65b9\u6cd5\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002\u8fd0\u884c\u4e4b\u540e\uff0c\u6548\u679c\u548c\u4e4b\u524d\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u5728\u8fd9\u91cc\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u83b7\u53d6\u5230\u66f4\u591a\u4fe1\u606f\u3002</p> <pre><code>&lt;aop:config&gt;\n    &lt;aop:pointcut id=\"stu\" expression=\"execution(* com.test.bean.Student.say(String))\"/&gt;\n    &lt;aop:advisor advice-ref=\"before\" pointcut-ref=\"stu\"/&gt;\n&lt;/aop:config&gt;\n</code></pre> <p>\u9664\u4e86\u6b64\u63a5\u53e3\u4ee5\u5916\uff0c\u8fd8\u6709\u5176\u4ed6\u7684\u63a5\u53e3\uff0c\u6bd4\u5982<code>AfterReturningAdvice</code>\u5c31\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u7684\u64cd\u4f5c\uff1a</p> <pre><code>public class AopTest implements MethodBeforeAdvice, AfterReturningAdvice {\n    @Override\n    public void before(Method method, Object[] args, Object target) throws Throwable {\n        System.out.println(\"\u6211\u662f\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\uff01\");\n    }\n\n    @Override\n    public void afterReturning(Object returnValue, Method method, Object[] args, Object target) throws Throwable {\n        System.out.println(\"\u6211\u662f\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\uff01\");\n    }\n}\n</code></pre> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u64cd\u4f5c\u6b63\u597d\u5bf9\u5e94\u4e86AOP \u9886\u57df\u4e2d\u7684\u7279\u6027\u672f\u8bed\uff1a</p> <ul> <li>\u901a\u77e5\uff08Advice\uff09: AOP \u6846\u67b6\u4e2d\u7684\u589e\u5f3a\u5904\u7406\uff0c\u901a\u77e5\u63cf\u8ff0\u4e86\u5207\u9762\u4f55\u65f6\u6267\u884c\u4ee5\u53ca\u5982\u4f55\u6267\u884c\u589e\u5f3a\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u7f16\u5199\u7684\u65b9\u6cd5\u5b9e\u73b0\u3002</li> <li>\u8fde\u63a5\u70b9\uff08join point\uff09: \u8fde\u63a5\u70b9\u8868\u793a\u5e94\u7528\u6267\u884c\u8fc7\u7a0b\u4e2d\u80fd\u591f\u63d2\u5165\u5207\u9762\u7684\u4e00\u4e2a\u70b9\uff0c\u8fd9\u4e2a\u70b9\u53ef\u4ee5\u662f\u65b9\u6cd5\u7684\u8c03\u7528\u3001\u5f02\u5e38\u7684\u629b\u51fa\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6211\u4eec\u5728\u65b9\u6cd5\u6267\u884c\u524d\u6216\u662f\u6267\u884c\u540e\u9700\u8981\u505a\u7684\u5185\u5bb9\u3002</li> <li>\u5207\u70b9\uff08PointCut\uff09: \u53ef\u4ee5\u63d2\u5165\u589e\u5f3a\u5904\u7406\u7684\u8fde\u63a5\u70b9\uff0c\u53ef\u4ee5\u662f\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u4e5f\u53ef\u4ee5\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u662f\u629b\u51fa\u5f02\u5e38\u4e4b\u7c7b\u7684\u3002</li> <li>\u5207\u9762\uff08Aspect\uff09: \u5207\u9762\u662f\u901a\u77e5\u548c\u5207\u70b9\u7684\u7ed3\u5408\uff0c\u6211\u4eec\u4e4b\u524d\u5728xml\u4e2d\u5b9a\u4e49\u7684\u5c31\u662f\u5207\u9762\uff0c\u5305\u62ec\u5f88\u591a\u4fe1\u606f\u3002</li> <li>\u5f15\u5165\uff08Introduction\uff09\uff1a\u5f15\u5165\u5141\u8bb8\u6211\u4eec\u5411\u73b0\u6709\u7684\u7c7b\u6dfb\u52a0\u65b0\u7684\u65b9\u6cd5\u6216\u8005\u5c5e\u6027\u3002</li> <li>\u7ec7\u5165\uff08Weaving\uff09: \u5c06\u589e\u5f3a\u5904\u7406\u6dfb\u52a0\u5230\u76ee\u6807\u5bf9\u8c61\u4e2d\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u88ab\u589e\u5f3a\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u4e4b\u524d\u90fd\u662f\u5728\u5c06\u6211\u4eec\u7684\u589e\u5f3a\u5904\u7406\u6dfb\u52a0\u5230\u76ee\u6807\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u7ec7\u5165\uff08\u8fd9\u540d\u5b57\u633a\u6709\u6587\u827a\u8303\u7684\uff09</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#_1","title":"\u4f7f\u7528\u6ce8\u89e3\u5f00\u53d1","text":"<p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86IoC\u5bb9\u5668\u548cAOP\u5b9e\u73b0\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u8981\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\uff0c\u6211\u4eec\u5c31\u4e0d\u5f97\u4e0d\u7f16\u5199\u5927\u91cf\u7684\u914d\u7f6e\uff0c\u8fd9\u662f\u975e\u5e38\u6d6a\u8d39\u65f6\u95f4\u548c\u7cbe\u529b\u7684\uff0c\u5e76\u4e14\u6211\u4eec\u8fd8\u53ea\u662f\u6f14\u793a\u4e86\u51e0\u4e2a\u5c0f\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u662f\u50cf\u4e4b\u524d\u4e00\u6837\u53bb\u7f16\u5199\u4e00\u4e2a\u5b8c\u6574\u7684Web\u5e94\u7528\u7a0b\u5e8f\uff0c\u90a3\u4e48\u4ea7\u751f\u7684\u914d\u7f6e\u53ef\u80fd\u4f1a\u975e\u5e38\u591a\u3002\u80fd\u5426\u6709\u4e00\u79cd\u66f4\u52a0\u9ad8\u6548\u7684\u65b9\u6cd5\u80fd\u591f\u7701\u53bb\u914d\u7f6e\u5462\uff1f\u5f53\u7136\u8fd8\u662f\u6ce8\u89e3\u4e86\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u7b2c\u4e00\u6b65\u5148\u628a\u4f60\u7684xml\u914d\u7f6e\u6587\u4ef6\u5220\u4e86\u5427\uff0c\u73b0\u5728\u6211\u4eec\u5168\u90e8\u4f7f\u7528\u6ce8\u89e3\u8fdb\u884c\u5f00\u53d1\uff08\u54c8\u54c8\uff0c\u662f\u4e0d\u662f\u611f\u89c9XML\u914d\u7f6e\u767d\u5b66\u4e86\uff09</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#_2","title":"\u6ce8\u89e3\u5b9e\u73b0\u914d\u7f6e\u6587\u4ef6","text":"<p>\u90a3\u4e48\uff0c\u73b0\u5728\u65e2\u7136\u4e0d\u4f7f\u7528XML\u6587\u4ef6\u4e86\uff0c\u90a3\u901a\u8fc7\u6ce8\u89e3\u7684\u65b9\u5f0f\u5c31\u53ea\u80fd\u4ee5\u5b9e\u4f53\u7c7b\u7684\u5f62\u5f0f\u8fdb\u884c\u914d\u7f6e\u4e86\uff0c\u6211\u4eec\u5728\u8981\u4f5c\u4e3a\u914d\u7f6e\u7684\u7c7b\u4e0a\u6dfb\u52a0<code>@Configuration</code>\u6ce8\u89e3\uff0c\u6211\u4eec\u8fd9\u91cc\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7c7b<code>MainConfiguration</code>\uff1a</p> <pre><code>@Configuration\npublic class MainConfiguration {\n    //\u6ca1\u6709\u914d\u7f6e\u4efb\u4f55Bean\n}\n</code></pre> <p>\u4f60\u53ef\u4ee5\u76f4\u63a5\u628a\u5b83\u7b49\u4ef7\u4e8e\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n        https://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n        &lt;!-- \u6ca1\u6709\u914d\u7f6e\u4efb\u4f55Bean --&gt;\n&lt;/beans&gt;\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b\uff0c\u5982\u4f55\u914d\u7f6eBean\uff0c\u4e4b\u524d\u6211\u4eec\u662f\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7f16\u5199Bean\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u73b0\u5728\u5728\u914d\u7f6e\u7c7b\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7f16\u5199\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u6211\u4eec\u8981\u521b\u5efa\u7684Bean\u7684\u5bf9\u8c61\u5373\u53ef\uff0c\u5e76\u5728\u5176\u4e0a\u65b9\u6dfb\u52a0<code>@Bean</code>\u6ce8\u89e3\uff1a</p> <pre><code>@Bean\npublic Card card(){\n    return new Card();\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u7b49\u4ef7\u4e8e\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n        https://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n        &lt;bean class=\"com.test.bean.Card\"&gt;&lt;/bean&gt;\n&lt;/beans&gt;\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0<code>@Scope</code>\u6ce8\u89e3\u6765\u6307\u5b9a\u4f5c\u7528\u57df\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u7528\u539f\u578b\u6a21\u5f0f\uff1a</p> <pre><code>@Bean\n@Scope(\"prototype\")\npublic Card card(){\n    return new Card();\n}\n</code></pre> <p>\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u5730\u63a7\u5236\u4e00\u4e2aBean\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u73b0\u5728\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u5bf9\u8c61\u65f6\u7531\u6211\u4eec\u521b\u5efa\u597d\u4e86\u518d\u4ea4\u7ed9Spring\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bf9\u8c61\u521b\u5efa\u65f6\u505a\u5f88\u591a\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u5305\u62ec\u4e00\u4e9b\u5c5e\u6027\u503c\u7684\u914d\u7f6e\u7b49\u3002</p> <p>\u65e2\u7136\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u521b\u5efa\u597d\u4e86\u914d\u7f6e\u7c7b\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e3b\u65b9\u6cd5\u4e2d\u52a0\u8f7d\u6b64\u914d\u7f6e\u7c7b\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8e\u914d\u7f6e\u7c7b\u7684\u5bb9\u5668\uff1a</p> <pre><code>public class Main {\n    public static void main(String[] args) {\n        //\u4f7f\u7528AnnotationConfigApplicationContext\u6765\u5b9e\u73b0\u6ce8\u89e3\u914d\u7f6e\n        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MainConfiguration.class); //\u8fd9\u91cc\u9700\u8981\u544a\u8bc9Spring\u54ea\u4e2a\u7c7b\u4f5c\u4e3a\u914d\u7f6e\u7c7b\n        Card card = context.getBean(Card.class);  //\u5bb9\u5668\u7528\u6cd5\u548c\u4e4b\u524d\u4e00\u6837\n        System.out.println(card);\n    }\n}\n</code></pre> <p>\u5728\u914d\u7f6e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbIDEA\u5e95\u90e8\u7684Spring\u6807\u7b7e\uff0c\u6253\u5f00\u540e\u53ef\u4ee5\u5bf9\u5f53\u524d\u5411\u5bb9\u5668\u4e2d\u6ce8\u518c\u7684Bean\u8fdb\u884c\u96c6\u4e2d\u67e5\u770b\uff0c\u5e76\u4e14\u4f1a\u6807\u6ce8Bean\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0cBean\u7684\u9ed8\u8ba4\u540d\u79f0\u5b9e\u9645\u4e0a\u5c31\u662f\u9996\u5b57\u6bcd\u5c0f\u5199\u7684\u65b9\u6cd5\u540d\u79f0\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u6307\u5b9a\uff1a</p> <pre><code>@Bean(\"lbwnb\")\n@Scope(\"prototype\")\npublic Card card(){\n    return new Card();\n}\n</code></pre> <p>\u9664\u4e86\u50cf\u539f\u6765\u4e00\u6837\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u521b\u5efaBean\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5728\u7c7b\u4e0a\u6dfb\u52a0<code>@Component</code>\u6ce8\u89e3\u6765\u5c06\u4e00\u4e2a\u7c7b\u8fdb\u884c\u6ce8\u518c\uff08\u73b0\u5728\u6700\u5e38\u7528\u7684\u65b9\u5f0f\uff09\uff0c\u4e0d\u8fc7\u8981\u5b9e\u73b0\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u81ea\u52a8\u626b\u63cf\uff0c\u6765\u544a\u8bc9Spring\u9700\u8981\u5728\u54ea\u4e9b\u5305\u4e2d\u67e5\u627e\u6211\u4eec\u63d0\u4f9b<code>@Component</code>\u58f0\u660e\u7684Bean\u3002</p> <p>\u53ea\u9700\u8981\u5728\u914d\u7f6e\u7c7b\u4e0a\u6dfb\u52a0\u4e00\u4e2a<code>@ComponentScan</code>\u6ce8\u89e3\u5373\u53ef\uff0c\u5982\u679c\u8981\u6dfb\u52a0\u591a\u4e2a\u5305\u8fdb\u884c\u626b\u63cf\uff0c\u53ef\u4ee5\u4f7f\u7528<code>@ComponentScans</code>\u6765\u6279\u91cf\u6dfb\u52a0\u3002\u8fd9\u91cc\u6211\u4eec\u6f14\u793a\u5c06<code>bean</code>\u5305\u4e0b\u7684\u6240\u6709\u7c7b\u8fdb\u884c\u626b\u63cf\uff1a</p> <pre><code>@ComponentScan(\"com.test.bean\")\n@Configuration\npublic class MainConfiguration {\n\n}\n</code></pre> <p>\u73b0\u5728\u5220\u9664\u7c7b\u4e2d\u7684Bean\u5b9a\u4e49\uff0c\u6211\u4eec\u5728Student\u7c7b\u7684\u4e0a\u9762\u6dfb\u52a0<code>@Component</code>\u6ce8\u89e3\uff0c\u6765\u8868\u793a\u6b64\u7c7b\u578b\u9700\u8981\u4f5c\u4e3aBean\u4ea4\u7ed9\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\uff1a</p> <pre><code>@Component\n@Scope(\"prototype\")\npublic class Student {\n    String name;\n    int age;\n    Card card;\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u5728\u7c7b\u4e0a\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0<code>@Scope</code>\u6765\u9650\u5b9a\u4f5c\u7528\u57df\u3002</p> <p>\u6548\u679c\u548c\u521a\u521a\u5b9e\u9645\u4e0a\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u6765\u6d4b\u8bd5\u4e00\u4e0b\uff1a</p> <pre><code>public class Main {\n    public static void main(String[] args) {\n        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MainConfiguration.class);\n        System.out.println(context.getBean(Student.class));\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230IDEA\u7684Spring\u677f\u5757\u4e2d\u4e5f\u663e\u793a\u4e86\u6211\u4eec\u521a\u521a\u901a\u8fc7\u76f4\u63a5\u5728\u7c7b\u4e0a\u6dfb\u52a0<code>@Component</code>\u58f0\u660e\u7684Bean\u3002</p> <p>\u4e0e<code>@Component</code>\u540c\u6837\u6548\u679c\u7684\u8fd8\u6709<code>@Controller</code>\u3001<code>@Service</code>\u548c<code>@Repository</code>\uff0c\u4f46\u662f\u73b0\u5728\u6682\u65f6\u4e0d\u63d0\uff0c\u8bb2\u5230SpringMVC\u65f6\u518d\u6765\u63a2\u8ba8\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u5c31\u6709\u4e24\u79cd\u65b9\u5f0f\u6ce8\u518c\u4e00\u4e2aBean\u4e86\uff0c\u90a3\u4e48\u5982\u4f55\u5b9e\u73b0\u50cf\u4e4b\u524d\u4e00\u6837\u7684\u81ea\u52a8\u6ce8\u5165\u5462\uff0c\u6bd4\u5982\u6211\u4eec\u5c06Card\u4e5f\u6ce8\u518c\u4e3aBean\uff0c\u6211\u4eec\u5e0c\u671bSpring\u81ea\u52a8\u5c06\u5176\u6ce8\u5165\u5230Student\u7684\u5c5e\u6027\u4e2d\uff1a</p> <pre><code>@Component\npublic class Student {\n    String name;\n    int sid;\n    Card card;\n}\n</code></pre> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6b64\u7c7b\u578b\uff0c\u4e5f\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6ce8\u518c\u4e3a\u4e00\u4e2aBean\uff1a</p> <pre><code>@Component\n@Scope(\"prototype\")\npublic class Card {\n}\n</code></pre> <p>\u73b0\u5728\uff0c\u6211\u4eec\u5728\u9700\u8981\u6ce8\u5165\u7684\u4f4d\u7f6e\uff0c\u6dfb\u52a0\u4e00\u4e2a<code>@Resource</code>\u6ce8\u89e3\u6765\u5b9e\u73b0\u81ea\u52a8\u88c5\u914d\uff1a</p> <pre><code>@Component\npublic class Student {\n    String name;\n    int sid;\n\n    @Resource\n    Card card;\n}\n</code></pre> <p>\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u6211\u4eec\u5b8c\u5168\u4e0d\u9700\u8981\u521b\u5efa\u4efb\u4f55\u7684set\u65b9\u6cd5\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u8fd9\u6837\u7684\u4e00\u4e2a\u6ce8\u89e3\u5c31\u53ef\u4ee5\u4e86\uff0cSpring\u4f1a\u8ddf\u4e4b\u524d\u914d\u7f6e\u6587\u4ef6\u7684\u81ea\u52a8\u6ce8\u5165\u4e00\u6837\uff0c\u5728\u6574\u4e2a\u5bb9\u5668\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u5e76\u5c06\u5bf9\u5e94\u7684Bean\u5b9e\u4f8b\u5bf9\u8c61\u6ce8\u5165\u5230\u6b64\u5c5e\u6027\u4e2d\uff0c\u5f53\u7136\uff0c\u5982\u679c\u8fd8\u662f\u9700\u8981\u901a\u8fc7set\u65b9\u6cd5\u6765\u6ce8\u5165\uff0c\u53ef\u4ee5\u5c06\u6ce8\u89e3\u6dfb\u52a0\u5230\u65b9\u6cd5\u4e0a\uff1a</p> <pre><code>@Component\npublic class Student {\n    String name;\n    int sid;\n    Card card;\n\n    @Resource\n    public void setCard(Card card) {\n        System.out.println(\"\u901a\u8fc7\u65b9\u6cd5\");\n        this.card = card;\n    }\n}\n</code></pre> <p>\u9664\u4e86\u4f7f\u7528<code>@Resource</code>\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>@Autowired</code>\uff08IDEA\u4e0d\u63a8\u8350\u5c06\u5176\u4f7f\u7528\u5728\u5b57\u6bb5\u4e0a\uff0c\u4f1a\u51fa\u73b0\u9ec4\u6807\uff0c\u4f46\u662f\u53ef\u4ee5\u653e\u5728\u65b9\u6cd5\u6216\u662f\u6784\u9020\u65b9\u6cd5\u4e0a\uff09\uff0c\u5b83\u4eec\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u5b83\u4eec\u5b58\u5728\u533a\u522b\uff0c\u867d\u7136\u5b83\u4eec\u90fd\u662f\u81ea\u52a8\u88c5\u914d\uff1a</p> <ul> <li>@Resource\u9ed8\u8ba4ByName\u5982\u679c\u627e\u4e0d\u5230\u5219ByType\uff0c\u53ef\u4ee5\u6dfb\u52a0\u5230set\u65b9\u6cd5\u3001\u5b57\u6bb5\u4e0a\u3002</li> <li>@Autowired\u9ed8\u8ba4\u662fbyType\uff0c\u53ef\u4ee5\u6dfb\u52a0\u5728\u6784\u9020\u65b9\u6cd5\u3001set\u65b9\u6cd5\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u53c2\u6570\u4e0a\u3002</li> </ul> <p>\u5e76\u4e14<code>@Autowired</code>\u53ef\u4ee5\u914d\u5408<code>@Qualifier</code>\u4f7f\u7528\uff0c\u6765\u6307\u5b9a\u4e00\u4e2a\u540d\u79f0\u7684Bean\u8fdb\u884c\u6ce8\u5165\uff1a</p> <pre><code>@Autowired\n@Qualifier(\"sxc\")\npublic void setCard(Card card) {\n    System.out.println(\"\u901a\u8fc7\u65b9\u6cd5\");\n    this.card = card;\n}\n</code></pre> <p>\u5982\u679cBean\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u5b9a\u4e49\u7684\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u4f7f\u7528<code>@Autowired</code>\u6765\u8fdb\u884c\u81ea\u52a8\u6ce8\u5165\uff1a</p> <pre><code>@ComponentScan(\"com.test.bean\")\n@Configuration\npublic class MainConfiguration {\n\n    @Bean\n    public Student student(@Autowired Card card){\n        Student student = new Student();\n        student.setCard(card);\n        return student;\n    }\n}\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7<code>@PostConstruct</code>\u6ce8\u89e3\u6765\u6dfb\u52a0\u6784\u9020\u540e\u6267\u884c\u7684\u65b9\u6cd5\uff0c\u5b83\u7b49\u4ef7\u4e8e\u4e4b\u524d\u8bb2\u89e3\u7684<code>init-method</code>\uff1a</p> <pre><code>@PostConstruct\npublic void init(){\n    System.out.println(\"\u6211\u662f\u521d\u59cb\u5316\u65b9\u6cd5\uff011\");\n}\n</code></pre> <p>\u6ce8\u610f\u5b83\u4eec\u7684\u987a\u5e8f\uff1aConstructor(\u6784\u9020\u65b9\u6cd5) -&gt; @Autowired(\u4f9d\u8d56\u6ce8\u5165) -&gt; @PostConstruct</p> <p>\u540c\u6837\u7684\uff0c\u5982\u679c\u9700\u8981\u9500\u6bc1\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>@PreDestroy</code>\u6ce8\u89e3\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u6f14\u793a\u4e86\u3002</p> <p>\u8fd9\u6837\uff0c\u4e24\u79cd\u901a\u8fc7\u6ce8\u89e3\u8fdb\u884cBean\u58f0\u660e\u7684\u65b9\u5f0f\u5c31\u8bb2\u89e3\u5b8c\u6bd5\u4e86\uff0c\u90a3\u4e48\u4ec0\u4e48\u65f6\u5019\u8be5\u7528\u4ec0\u4e48\u65b9\u5f0f\u53bb\u58f0\u660e\u5462\uff1f</p> <ul> <li>\u5982\u679c\u8981\u6ce8\u518c\u4e3aBean\u7684\u7c7b\u662f\u7531\u5176\u4ed6\u6846\u67b6\u63d0\u4f9b\uff0c\u6211\u4eec\u65e0\u6cd5\u4fee\u6539\u5176\u6e90\u4ee3\u7801\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002</li> <li>\u5982\u679c\u8981\u6ce8\u518c\u4e3aBean\u7684\u7c7b\u662f\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u7684\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u7c7b\u4e0a\u6dfb\u52a0\u6ce8\u89e3\uff0c\u5e76\u5728\u914d\u7f6e\u4e2d\u6dfb\u52a0\u626b\u63cf\u3002</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#aop_2","title":"\u6ce8\u89e3\u5b9e\u73b0AOP\u64cd\u4f5c","text":"<p>\u4e86\u89e3\u4e86\u5982\u4f55\u4f7f\u7528\u6ce8\u89e3\u6ce8\u518cBean\u4e4b\u540e\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\u5982\u4f55\u901a\u8fc7\u6ce8\u89e3\u5b9e\u73b0AOP\u64cd\u4f5c\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5728\u4e3b\u7c7b\u6dfb\u52a0<code>@EnableAspectJAutoProxy</code>\u6ce8\u89e3\uff0c\u5f00\u542fAOP\u6ce8\u89e3\u652f\u6301\uff1a</p> <pre><code>@EnableAspectJAutoProxy\n@ComponentScan(\"com.test.bean\")\n@Configuration\npublic class MainConfiguration {\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u53ea\u9700\u5728\u5b9a\u4e49AOP\u589e\u5f3a\u64cd\u4f5c\u7684\u7c7b\u4e0a\u6dfb\u52a0<code>@Aspect</code>\u6ce8\u89e3\u548c<code>@Component</code>\u5c06\u5176\u6ce8\u518c\u4e3aBean\u5373\u53ef\uff0c\u5c31\u50cf\u6211\u4eec\u4e4b\u524d\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e5f\u8981\u5c06\u5176\u6ce8\u518c\u4e3aBean\uff1a</p> <pre><code>@Component\n@Aspect\npublic class AopTest {\n\n}\n</code></pre> <p>\u63a5\u7740\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u91cc\u9762\u7f16\u5199\u65b9\u6cd5\uff0c\u5e76\u5c06\u6b64\u65b9\u6cd5\u6dfb\u52a0\u5230\u4e00\u4e2a\u5207\u70b9\u4e2d\uff0c\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u5728Student\u7684test\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884c\u6211\u4eec\u7684\u65b9\u6cd5\uff1a</p> <pre><code>public int test(String str){\n    System.out.println(\"\u6211\u88ab\u8c03\u7528\u4e86:\"+str);\n    return str.length();\n}\n</code></pre> <p>\u53ea\u9700\u8981\u6dfb\u52a0<code>@Before</code>\u6ce8\u89e3\u5373\u53ef\uff1a</p> <pre><code>@Before(\"execution(* com.test.bean.Student.test(..))\")\npublic void before(){\n    System.out.println(\"\u6211\u662f\u4e4b\u524d\u6267\u884c\u7684\u5185\u5bb9\uff01\");\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u5176\u6dfb\u52a0<code>JoinPoint</code>\u53c2\u6570\u6765\u83b7\u53d6\u5207\u5165\u70b9\u4fe1\u606f\uff1a</p> <pre><code>@Before(\"execution(* com.test.bean.Student.test(..))\")\npublic void before(JoinPoint point){\n    System.out.println(\"\u53c2\u6570\u5217\u8868\uff1a\"+ Arrays.toString(point.getArgs()));\n    System.out.println(\"\u6211\u662f\u4e4b\u524d\u6267\u884c\u7684\u5185\u5bb9\uff01\");\n}\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>@AfterReturning</code>\u6ce8\u89e3\u6765\u6307\u5b9a\u65b9\u6cd5\u8fd4\u56de\u540e\u7684\u64cd\u4f5c\uff1a</p> <pre><code>@AfterReturning(value = \"execution(* com.test.bean.Student.test(..))\", returning = \"returnVal\")\npublic void after(Object returnVal){\n    System.out.println(\"\u65b9\u6cd5\u5df2\u8fd4\u56de\uff0c\u7ed3\u679c\u4e3a\uff1a\"+returnVal);\n}\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u6307\u5b9areturning\u5c5e\u6027\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u65b9\u6cd5\u67d0\u4e2a\u53c2\u6570\u7684\u5b9e\u53c2\u3002\u540c\u6837\u7684\uff0c\u73af\u7ed5\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u6ce8\u89e3\u58f0\u660e\uff1a</p> <pre><code>@Around(\"execution(* com.test.bean.Student.test(..))\")\npublic Object around(ProceedingJoinPoint point) throws Throwable {\n    System.out.println(\"\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\uff01\");\n    Object val = point.proceed();\n    System.out.println(\"\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\uff01\");\n    return val;\n}\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#_3","title":"\u5176\u4ed6\u6ce8\u89e3\u914d\u7f6e","text":"<p>\u914d\u7f6e\u6587\u4ef6\u53ef\u80fd\u4e0d\u6b62\u4e00\u4e2a\uff0c\u6211\u4eec\u6709\u53ef\u80fd\u4f1a\u6839\u636e\u6a21\u5757\u5212\u5206\uff0c\u5b9a\u4e49\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5f88\u591a\u4e2a\u914d\u7f6e\u7c7b\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981<code>@Import</code>\u6ce8\u89e3\u6765\u5feb\u901f\u5c06\u67d0\u4e2a\u7c7b\u52a0\u5165\u5230\u5bb9\u5668\u4e2d\uff0c\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5c06\u6570\u636e\u5e93Bean\u4e5f\u642c\u8fc7\u53bb\uff1a</p> <pre><code>public class Test2Configuration {\n    @Bean\n    public Connection getConnection() throws SQLException {\n        System.out.println(\"\u521b\u5efa\u65b0\u7684\u8fde\u63a5\uff01\");\n        return DriverManager.getConnection(\"jdbc:mysql://localhost:3306/study\",\n                \"root\",\n                \"root\");\n    }\n}\n</code></pre> <pre><code>@EnableAspectJAutoProxy\n@Configuration\n@ComponentScan(\"com.test\")\n@Import(Test2Configuration.class)\npublic class TestConfiguration {\n\n    @Resource\n    Connection connection;\n\n    @PostConstruct\n    public void init(){\n        System.out.println(connection);\n    }\n}\n</code></pre> <p>\u6ce8\u610f\u53e6\u4e00\u4e2a\u914d\u7f6e\u7c7b\u5e76\u6ca1\u6709\u6dfb\u52a0\u4efb\u4f55\u6ce8\u89e3\uff0c\u5b9e\u9645\u4e0a\uff0c\u76f8\u5f53\u4e8e\u5bfc\u5165\u7684\u7c7b\u88ab\u5f3a\u5236\u6ce8\u518c\u4e3a\u4e86\u4e00\u4e2aBean\uff0c\u5230\u73b0\u5728\uff0c\u6211\u4eec\u4e00\u5171\u4e86\u89e3\u4e86\u4e09\u79cd\u6ce8\u518c\u4e3aBean\u7684\u65b9\u5f0f\uff0c\u5229\u7528\u8fd9\u79cd\u7279\u6027\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5c06\u5176\u4ed6\u7684\u7c7b\u578b\u4e5f\u5f3a\u5236\u6ce8\u518c\u4e3aBean\uff1a</p> <pre><code>@EnableAspectJAutoProxy\n@Configuration\n@ComponentScan(\"com.test\")\n@Import({Test2Configuration.class, Date.class})\npublic class TestConfiguration {\n\n    @Resource\n    Connection connection;\n    @Resource\n    Date date;\n\n    @PostConstruct\n    public void init(){\n        System.out.println(date+\" -&gt; \"+connection);\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u65e5\u671f\u76f4\u63a5\u4f5c\u4e3a\u4e00\u4e2aBean\u653e\u5165\u5230IoC\u5bb9\u5668\u4e2d\u4e86\uff0c\u5e76\u4e14\u65f6\u95f4\u6c38\u8fdc\u90fd\u662f\u88abnew\u7684\u90a3\u4e2a\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\uff08\u56e0\u4e3a\u9ed8\u8ba4\u662f\u5355\u4f8b\u6a21\u5f0f\uff09\u3002</p> <p>\u901a\u8fc7<code>@Import</code>\u65b9\u5f0f\u6700\u4e3b\u8981\u4e3a\u4e86\u5b9e\u73b0\u7684\u76ee\u6807\u5e76\u4e0d\u662f\u521b\u5efaBean\uff0c\u800c\u662f\u4e3a\u4e86\u65b9\u4fbf\u4e00\u4e9b\u6846\u67b6\u7684<code>Registrar</code>\u8fdb\u884cBean\u5b9a\u4e49\uff0c\u5728\u8bb2\u89e3\u5230Spring\u539f\u7406\u65f6\uff0c\u6211\u4eec\u518d\u6765\u8be6\u7ec6\u8ba8\u8bba\uff0c\u76ee\u524d\u53ea\u505a\u4e86\u89e3\u5373\u53ef\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u5173\u4e8eSpring\u6846\u67b6\u7684\u5927\u81f4\u5185\u5bb9\u5c31\u804a\u5f97\u5dee\u4e0d\u591a\u4e86\uff0c\u5176\u4f59\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7ee7\u7eed\u8bb2\u89e3\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#mybatis","title":"\u6df1\u5165Mybatis\u6846\u67b6","text":"<p>\u5b66\u4e60\u4e86Spring\u4e4b\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u5982\u4f55\u5c06\u4e00\u4e2a\u7c7b\u4f5c\u4e3aBean\u4ea4\u7531IoC\u5bb9\u5668\u7ba1\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u66f4\u65b9\u4fbf\u7684\u65b9\u5f0f\u6765\u4f7f\u7528Mybatis\u6846\u67b6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628aSqlSessionFactory\u3001Mapper\u4ea4\u7ed9Spring\u8fdb\u884c\u7ba1\u7406\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u6ce8\u5165\u7684\u65b9\u5f0f\u5feb\u901f\u5730\u4f7f\u7528\u5b83\u4eec\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u5b66\u4e60\u4e00\u4e0b\u5982\u4f55\u5c06Mybatis\u4e0eSpring\u8fdb\u884c\u6574\u5408\uff0c\u90a3\u4e48\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5728\u4e4b\u524d\u77e5\u8bc6\u7684\u57fa\u7840\u4e0a\u7ee7\u7eed\u6df1\u5316\u5b66\u4e60\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#_4","title":"\u4e86\u89e3\u6570\u636e\u6e90","text":"<p>\u5728\u4e4b\u524d\uff0c\u6211\u4eec\u5982\u679c\u9700\u8981\u521b\u5efa\u4e00\u4e2aJDBC\u7684\u8fde\u63a5\uff0c\u90a3\u4e48\u5fc5\u987b\u4f7f\u7528<code>DriverManager.getConnection()</code>\u6765\u521b\u5efa\u8fde\u63a5\uff0c\u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u6211\u4eec\u624d\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c\u3002</p> <p>\u800c\u5b66\u4e60\u4e86Mybatis\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u4e0d\u7528\u518d\u53bb\u4f7f\u7528<code>DriverManager</code>\u4e3a\u6211\u4eec\u63d0\u4f9b\u8fde\u63a5\u5bf9\u8c61\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528Mybatis\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684<code>SqlSessionFactory</code>\u5de5\u5177\u7c7b\u6765\u83b7\u53d6\u5bf9\u5e94\u7684<code>SqlSession</code>\u901a\u8fc7\u4f1a\u8bdd\u5bf9\u8c61\u53bb\u64cd\u4f5c\u6570\u636e\u5e93\u3002</p> <p>\u90a3\u4e48\uff0c\u5b83\u5230\u5e95\u662f\u5982\u4f55\u5c01\u88c5JDBC\u7684\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u8bd5\u7740\u6765\u731c\u60f3\u4e00\u4e0b\uff0c\u4f1a\u4e0d\u4f1a\u662fMybatis\u6bcf\u6b21\u90fd\u662f\u5e2e\u52a9\u6211\u4eec\u8c03\u7528<code>DriverManager</code>\u6765\u5b9e\u73b0\u7684\u6570\u636e\u5e93\u8fde\u63a5\u521b\u5efa\uff1f\u6211\u4eec\u53ef\u4ee5\u770b\u770bMybatis\u7684\u6e90\u7801\uff1a</p> <pre><code>public SqlSession openSession(boolean autoCommit) {\n    return this.openSessionFromDataSource(this.configuration.getDefaultExecutorType(), (TransactionIsolationLevel)null, autoCommit);\n}\n</code></pre> <p>\u5728\u901a\u8fc7<code>SqlSessionFactory</code>\u8c03\u7528<code>openSession</code>\u65b9\u6cd5\u4e4b\u540e\uff0c\u5b83\u8c03\u7528\u4e86\u5185\u90e8\u7684\u4e00\u4e2a\u79c1\u6709\u7684\u65b9\u6cd5<code>openSessionFromDataSource</code>\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u5b9a\u4e49\u4e86\u4ec0\u4e48\u5185\u5bb9\uff1a</p> <pre><code>private SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) {\n    Transaction tx = null;\n\n    DefaultSqlSession var8;\n    try {\n        //\u83b7\u53d6\u5f53\u524d\u73af\u5883\uff08\u7531\u914d\u7f6e\u6587\u4ef6\u6620\u5c04\u7684\u5bf9\u8c61\u5b9e\u4f53\uff09\n        Environment environment = this.configuration.getEnvironment();\n        //\u4e8b\u52a1\u5de5\u5382\uff08\u6682\u65f6\u4e0d\u63d0\uff0c\u4e0b\u4e00\u677f\u5757\u8bb2\u89e3\uff09\n        TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);\n        //\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1a&lt;transactionManager type=\"JDBC\"/&gt;\n        //\u751f\u6210\u4e8b\u52a1\uff08\u6839\u636e\u6211\u4eec\u7684\u914d\u7f6e\uff0c\u4f1a\u9ed8\u8ba4\u751f\u6210JdbcTransaction\uff09\uff0c\u8fd9\u91cc\u662f\u5173\u952e\uff0c\u6211\u4eec\u770b\u5230\u8fd9\u91cc\u7528\u5230\u4e86environment.getDataSource()\u65b9\u6cd5\n        tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);\n        //\u6267\u884c\u5668\uff0c\u5305\u62ec\u5168\u90e8\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u65b9\u6cd5\u5b9a\u4e49\uff0c\u672c\u8d28\u4e0a\u662f\u5728\u4f7f\u7528\u6267\u884c\u5668\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u9700\u8981\u4f20\u5165\u4e8b\u52a1\u5bf9\u8c61\n        Executor executor = this.configuration.newExecutor(tx, execType);\n        //\u5c01\u88c5\u4e3aSqlSession\u5bf9\u8c61\n        var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);\n    } catch (Exception var12) {\n        this.closeTransaction(tx);\n        throw ExceptionFactory.wrapException(\"Error opening session.  Cause: \" + var12, var12);\n    } finally {\n        ErrorContext.instance().reset();\n    }\n\n    return var8;\n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u7684\u6570\u636e\u6e90\u914d\u7f6e\u4fe1\u606f\uff0c\u5b58\u653e\u5728\u4e86<code>Transaction</code>\u5bf9\u8c61\u4e2d\uff0c\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\u6267\u884c\u5668\u5230\u5e95\u662f\u5982\u4f55\u6267\u884cSQL\u8bed\u53e5\u7684\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u5230\u5e95\u5982\u4f55\u521b\u5efa<code>Connection</code>\u5bf9\u8c61\u4e86\uff0c\u5c31\u9700\u8981\u83b7\u53d6\u6570\u636e\u5e93\u7684\u94fe\u63a5\u4fe1\u606f\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b\uff0c\u8fd9\u4e2a<code>DataSource</code>\u5230\u5e95\u662f\u4e2a\u4ec0\u4e48\uff1a</p> <pre><code>public interface DataSource  extends CommonDataSource, Wrapper {\n\n  Connection getConnection() throws SQLException;\n\n  Connection getConnection(String username, String password)\n    throws SQLException;\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5b83\u662f\u5728<code>javax.sql</code>\u5b9a\u4e49\u7684\u4e00\u4e2a\u63a5\u53e3\uff0c\u5b83\u5305\u62ec\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff0c\u90fd\u662f\u7528\u4e8e\u83b7\u53d6\u8fde\u63a5\u7684\u3002\u56e0\u6b64\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u65ad\u5b9a\uff0c\u5e76\u4e0d\u662f\u901a\u8fc7\u4e4b\u524d<code>DriverManager</code>\u7684\u65b9\u6cd5\u53bb\u83b7\u53d6\u8fde\u63a5\u4e86\uff0c\u800c\u662f\u4f7f\u7528<code>DataSource</code>\u7684\u5b9e\u73b0\u7c7b\u6765\u83b7\u53d6\u7684\uff0c\u56e0\u6b64\uff0c\u4e5f\u5c31\u6b63\u5f0f\u5f15\u5165\u5230\u6211\u4eec\u8fd9\u4e00\u8282\u7684\u8bdd\u9898\u4e86\uff1a</p> <p>\u6570\u636e\u5e93\u94fe\u63a5\u7684\u5efa\u7acb\u548c\u5173\u95ed\u662f\u6781\u5176\u8017\u8d39\u7cfb\u7edf\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u901a\u8fc7DriverManager\u83b7\u53d6\u7684\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\u5bf9\u8c61\u5747\u5bf9\u5e94\u4e00\u4e2a\u7269\u7406\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u6bcf\u6b21\u64cd\u4f5c\u90fd\u6253\u5f00\u4e00\u4e2a\u7269\u7406\u8fde\u63a5\uff0c\u4f7f\u7528\u5b8c\u540e\u7acb\u5373\u5173\u95ed\u8fde\u63a5\uff0c\u9891\u7e41\u7684\u6253\u5f00\u3001\u5173\u95ed\u8fde\u63a5\u4f1a\u6301\u7eed\u6d88\u8017\u7f51\u7edc\u8d44\u6e90\uff0c\u9020\u6210\u6574\u4e2a\u7cfb\u7edf\u6027\u80fd\u7684\u4f4e\u4e0b\u3002</p> <p>\u56e0\u6b64\uff0cJDBC\u4e3a\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6570\u636e\u6e90\u7684\u6807\u51c6\uff0c\u4e5f\u5c31\u662f<code>DataSource</code>\u63a5\u53e3\uff0c\u544a\u8bc9\u6570\u636e\u6e90\u6570\u636e\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5e76\u5c06\u6240\u6709\u7684\u8fde\u63a5\u5168\u90e8\u4ea4\u7ed9\u6570\u636e\u6e90\u8fdb\u884c\u96c6\u4e2d\u7ba1\u7406\uff0c\u5f53\u9700\u8981\u4e00\u4e2a<code>Connection</code>\u5bf9\u8c61\u65f6\uff0c\u53ef\u4ee5\u5411\u6570\u636e\u6e90\u7533\u8bf7\uff0c\u6570\u636e\u6e90\u4f1a\u6839\u636e\u5185\u90e8\u673a\u5236\uff0c\u5408\u7406\u5730\u5206\u914d\u8fde\u63a5\u5bf9\u8c61\u7ed9\u6211\u4eec\u3002</p> <p>\u4e00\u822c\u6bd4\u8f83\u5e38\u7528\u7684<code>DataSource</code>\u5b9e\u73b0\uff0c\u90fd\u662f\u91c7\u7528\u6c60\u5316\u6280\u672f\uff0c\u5c31\u662f\u5728\u4e00\u5f00\u59cb\u5c31\u521b\u5efa\u597dN\u4e2a\u8fde\u63a5\uff0c\u8fd9\u6837\u4e4b\u540e\u4f7f\u7528\u5c31\u65e0\u9700\u518d\u6b21\u8fdb\u884c\u8fde\u63a5\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u73b0\u6210\u7684<code>Connection</code>\u5bf9\u8c61\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4f20\u7edf\u7684\u5373\u7528\u5373\u8fde\u7684\u65b9\u5f0f\u83b7\u53d6<code>Connection</code>\u5bf9\u8c61\uff0cMybatis\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u51e0\u4e2a\u9ed8\u8ba4\u7684\u6570\u636e\u6e90\u5b9e\u73b0\uff0c\u6211\u4eec\u4e4b\u524d\u4e00\u76f4\u5728\u4f7f\u7528\u7684\u662f\u5b98\u65b9\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u6c60\u5316\u6570\u636e\u6e90\uff1a</p> <pre><code>&lt;dataSource type=\"POOLED\"&gt;\n      &lt;property name=\"driver\" value=\"${driver}\"/&gt;\n      &lt;property name=\"url\" value=\"${url}\"/&gt;\n      &lt;property name=\"username\" value=\"${username}\"/&gt;\n      &lt;property name=\"password\" value=\"${password}\"/&gt;\n    &lt;/dataSource&gt;\n</code></pre> <p>\u4e00\u5171\u4e09\u4e2a\u9009\u9879\uff1a</p> <ul> <li>UNPOOLED    \u4e0d\u4f7f\u7528\u8fde\u63a5\u6c60\u7684\u6570\u636e\u6e90</li> <li>POOLED      \u4f7f\u7528\u8fde\u63a5\u6c60\u7684\u6570\u636e\u6e90</li> <li>JNDI        \u4f7f\u7528JNDI\u5b9e\u73b0\u7684\u6570\u636e\u6e90</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#mybatis_1","title":"\u89e3\u8bfbMybatis\u6570\u636e\u6e90\u5b9e\u73b0","text":"<p>\u90a3\u4e48\u6211\u4eec\u5148\u6765\u770b\u770b\uff0c\u4e0d\u4f7f\u7528\u6c60\u5316\u7684\u6570\u636e\u6e90\u5b9e\u73b0\uff0c\u5b83\u53eb\u505a<code>UnpooledDataSource</code>\uff0c\u6211\u4eec\u6765\u770b\u770b\u6e90\u7801\uff1a</p> <pre><code>public class UnpooledDataSource implements DataSource {\n    private ClassLoader driverClassLoader;\n    private Properties driverProperties;\n    private static Map&lt;String, Driver&gt; registeredDrivers = new ConcurrentHashMap();\n    private String driver;\n    private String url;\n    private String username;\n    private String password;\n    private Boolean autoCommit;\n    private Integer defaultTransactionIsolationLevel;\n    private Integer defaultNetworkTimeout;\n</code></pre> <p>\u9996\u5148\u8fd9\u4e2a\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u7684\u6210\u5458\uff0c\u5305\u62ec\u6570\u636e\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u3001\u6570\u636e\u5e93\u9a71\u52a8\u4fe1\u606f\u3001\u4e8b\u52a1\u76f8\u5173\u4fe1\u606f\u7b49\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u5b83\u662f\u5982\u4f55\u5b9e\u73b0<code>DataSource</code>\u4e2d\u63d0\u4f9b\u7684\u63a5\u53e3\u7684\uff1a</p> <pre><code>public Connection getConnection() throws SQLException {\n    return this.doGetConnection(this.username, this.password);\n}\n\npublic Connection getConnection(String username, String password) throws SQLException {\n    return this.doGetConnection(username, password);\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u90fd\u6307\u5411\u4e86\u5185\u90e8\u7684\u4e00\u4e2a<code>doGetConnection</code>\u65b9\u6cd5\uff0c\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770b\uff1a</p> <pre><code>private Connection doGetConnection(String username, String password) throws SQLException {\n    Properties props = new Properties();\n    if (this.driverProperties != null) {\n        props.putAll(this.driverProperties);\n    }\n\n    if (username != null) {\n        props.setProperty(\"user\", username);\n    }\n\n    if (password != null) {\n        props.setProperty(\"password\", password);\n    }\n\n    return this.doGetConnection(props);\n}\n</code></pre> <p>\u9996\u5148\u5b83\u5c06\u6570\u636e\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u4e5f\u7ed9\u6dfb\u52a0\u5230<code>Properties</code>\u5bf9\u8c61\u4e2d\u8fdb\u884c\u5b58\u653e\uff0c\u5e76\u4ea4\u7ed9\u4e0b\u4e00\u4e2a<code>doGetConnection</code>\u6765\u5904\u7406\uff0c\u5957\u5a03\u5c31\u5b8c\u4e8b\u4e86\u5457\uff0c\u63a5\u7740\u6765\u770b\u4e0b\u4e00\u5c42\u6e90\u7801\uff1a</p> <pre><code>private Connection doGetConnection(Properties properties) throws SQLException {\n    //\u82e5\u672a\u521d\u59cb\u5316\u9a71\u52a8\uff0c\u9700\u8981\u5148\u521d\u59cb\u5316\uff0c\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u4e2aMap\u6765\u8bb0\u5f55\u521d\u59cb\u5316\u4fe1\u606f\uff0c\u8fd9\u91cc\u4e0d\u591a\u4ecb\u7ecd\u4e86\n    this.initializeDriver();\n    //\u4f20\u7edf\u7684\u83b7\u53d6\u8fde\u63a5\u7684\u65b9\u5f0f\n    Connection connection = DriverManager.getConnection(this.url, properties);\n    //\u5bf9\u8fde\u63a5\u8fdb\u884c\u989d\u5916\u7684\u4e00\u4e9b\u914d\u7f6e\n    this.configureConnection(connection);\n    return connection;\n}\n</code></pre> <p>\u5230\u8fd9\u91cc\uff0c\u5c31\u8fd4\u56de<code>Connection</code>\u5bf9\u8c61\u4e86\uff0c\u800c\u6b64\u5bf9\u8c61\u6b63\u662f\u901a\u8fc7<code>DriverManager</code>\u6765\u521b\u5efa\u7684\uff0c\u56e0\u6b64\uff0c\u975e\u6c60\u5316\u7684\u6570\u636e\u6e90\u5b9e\u73b0\u4f9d\u7136\u4f7f\u7528\u7684\u662f\u4f20\u7edf\u7684\u8fde\u63a5\u521b\u5efa\u65b9\u5f0f\uff0c\u90a3\u6211\u4eec\u63a5\u7740\u6765\u770b\u6c60\u5316\u7684\u6570\u636e\u6e90\u5b9e\u73b0\uff0c\u5b83\u662f<code>PooledDataSource</code>\u7c7b\uff1a</p> <pre><code>public class PooledDataSource implements DataSource {\n    private static final Log log = LogFactory.getLog(PooledDataSource.class);\n    private final PoolState state = new PoolState(this);\n    private final UnpooledDataSource dataSource;\n    protected int poolMaximumActiveConnections = 10;\n    protected int poolMaximumIdleConnections = 5;\n    protected int poolMaximumCheckoutTime = 20000;\n    protected int poolTimeToWait = 20000;\n    protected int poolMaximumLocalBadConnectionTolerance = 3;\n    protected String poolPingQuery = \"NO PING QUERY SET\";\n    protected boolean poolPingEnabled;\n    protected int poolPingConnectionsNotUsedFor;\n    private int expectedConnectionTypeCode;\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u8fd9\u91cc\u7684\u5b9a\u4e49\u5c31\u6bd4\u975e\u6c60\u5316\u7684\u5b9e\u73b0\u590d\u6742\u5f97\u591a\u4e86\uff0c\u56e0\u4e3a\u5b83\u8fd8\u8981\u8003\u8651\u5e76\u53d1\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u8fd8\u8981\u8003\u8651\u5982\u4f55\u5408\u7406\u5730\u5b58\u653e\u5927\u91cf\u7684\u94fe\u63a5\u5bf9\u8c61\uff0c\u8be5\u5982\u4f55\u8fdb\u884c\u5408\u7406\u5206\u914d\uff0c\u56e0\u6b64\u5b83\u7684\u73a9\u6cd5\u975e\u5e38\u4e4b\u9ad8\u7ea7\uff0c\u4f46\u662f\uff0c\u518d\u9ad8\u7ea7\u7684\u73a9\u6cd5\uff0c\u6211\u4eec\u90fd\u8981\u62ff\u4e0b\u3002</p> <p>\u9996\u5148\u6ce8\u610f\uff0c\u5b83\u5b58\u653e\u4e86\u4e00\u4e2aUnpooledDataSource\uff0c\u6b64\u5bf9\u8c61\u662f\u5728\u6784\u9020\u65f6\u5c31\u88ab\u521b\u5efa\uff0c\u5176\u5b9e\u521b\u5efaConnection\u8fd8\u662f\u4f9d\u9760\u6570\u636e\u5e93\u9a71\u52a8\u521b\u5efa\uff0c\u6211\u4eec\u540e\u9762\u6162\u6162\u89e3\u6790\uff0c\u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u5b83\u662f\u5982\u4f55\u5b9e\u73b0\u63a5\u53e3\u65b9\u6cd5\u7684\uff1a</p> <pre><code>public Connection getConnection() throws SQLException {\n    return this.popConnection(this.dataSource.getUsername(), this.dataSource.getPassword()).getProxyConnection();\n}\n\npublic Connection getConnection(String username, String password) throws SQLException {\n    return this.popConnection(username, password).getProxyConnection();\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u8c03\u7528\u4e86<code>popConnection()</code>\u65b9\u6cd5\u6765\u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61\uff0c\u7136\u540e\u8fdb\u884c\u4e86\u4e00\u4e2a\u4ee3\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u731c\u6d4b\uff0c\u6709\u53ef\u80fd\u6574\u4e2a\u8fde\u63a5\u6c60\u5c31\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u6808\u7684\u96c6\u5408\u7c7b\u578b\u7ed3\u6784\u5b9e\u73b0\u7684\u3002\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770b\u770b<code>popConnection</code>\u65b9\u6cd5\uff1a</p> <pre><code>private PooledConnection popConnection(String username, String password) throws SQLException {\n    boolean countedWait = false;\n    //\u8fd4\u56de\u7684\u662fPooledConnection\u5bf9\u8c61\uff0c\n    PooledConnection conn = null;\n    long t = System.currentTimeMillis();\n    int localBadConnectionCount = 0;\n\n    while(conn == null) {\n        synchronized(this.state) {   //\u52a0\u9501\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u5f88\u591a\u4e2a\u7ebf\u7a0b\u90fd\u9700\u8981\u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61\n            PoolState var10000;\n            //PoolState\u5b58\u4e86\u4e24\u4e2aList\uff0c\u4e00\u4e2a\u662f\u7a7a\u95f2\u5217\u8868\uff0c\u4e00\u4e2a\u662f\u6d3b\u8dc3\u5217\u8868\n            if (!this.state.idleConnections.isEmpty()) {   //\u6709\u7a7a\u95f2\u8fde\u63a5\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u5206\u914dConnection\n                conn = (PooledConnection)this.state.idleConnections.remove(0);  //ArrayList\u4e2d\u53d6\u7b2c\u4e00\u4e2a\u5143\u7d20\n                if (log.isDebugEnabled()) {\n                    log.debug(\"Checked out connection \" + conn.getRealHashCode() + \" from pool.\");\n                }\n              //\u5982\u679c\u5df2\u7ecf\u6ca1\u6709\u591a\u4f59\u7684\u8fde\u63a5\u53ef\u4ee5\u5206\u914d\uff0c\u90a3\u4e48\u5c31\u68c0\u67e5\u4e00\u4e0b\u6d3b\u8dc3\u8fde\u63a5\u6570\u662f\u5426\u8fbe\u5230\u6700\u5927\u7684\u5206\u914d\u4e0a\u9650\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5c31new\u4e00\u4e2a\n            } else if (this.state.activeConnections.size() &lt; this.poolMaximumActiveConnections) {\n                //\u6ce8\u610fnew\u4e86\u4e4b\u540e\u5e76\u6ca1\u6709\u7acb\u5373\u5f80List\u91cc\u9762\u585e\uff0c\u53ea\u662f\u5b58\u4e86\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\n                //\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u91cc\u4f9d\u9760UnpooledDataSource\u521b\u5efa\u4e86\u4e00\u4e2aConnection\u5bf9\u8c61\uff0c\u5e76\u5c06\u5176\u5c01\u88c5\u5230PooledConnection\u4e2d\n                conn = new PooledConnection(this.dataSource.getConnection(), this);\n                if (log.isDebugEnabled()) {\n                    log.debug(\"Created connection \" + conn.getRealHashCode() + \".\");\n                }\n              //\u4ee5\u4e0a\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u90a3\u4e48\u53ea\u80fd\u4ece\u4e4b\u524d\u7684\u8fde\u63a5\u4e2d\u5bfb\u627e\u4e86\uff0c\u770b\u770b\u6709\u6ca1\u6709\u90a3\u79cd\u5361\u4f4f\u7684\u94fe\u63a5\uff08\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\u6709\u53ef\u80fd\u4e4b\u524d\u7684\u8fde\u63a5\u4e00\u76f4\u88ab\u5361\u4f4f\uff0c\u7136\u800c\u6b63\u5e38\u60c5\u51b5\u4e0b\u65e9\u5c31\u7ed3\u675f\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f8\u5f53\u4e8e\u662f\u4f18\u5316\u4e5f\u7b97\u662f\u4e00\u79cd\u6361\u6f0f\u7684\u65b9\u5f0f\uff09\n            } else {\n                //\u83b7\u53d6\u6700\u65e9\u521b\u5efa\u7684\u8fde\u63a5\n                PooledConnection oldestActiveConnection = (PooledConnection)this.state.activeConnections.get(0);\n                long longestCheckoutTime = oldestActiveConnection.getCheckoutTime();\n                //\u5224\u65ad\u662f\u5426\u8d85\u8fc7\u6700\u5927\u7684\u4f7f\u7528\u65f6\u95f4\n                if (longestCheckoutTime &gt; (long)this.poolMaximumCheckoutTime) {\n                    //\u8d85\u65f6\u7edf\u8ba1\u4fe1\u606f\uff08\u4e0d\u91cd\u8981\uff09\n                    ++this.state.claimedOverdueConnectionCount;\n                    var10000 = this.state;\n                    var10000.accumulatedCheckoutTimeOfOverdueConnections += longestCheckoutTime;\n                    var10000 = this.state;\n                    var10000.accumulatedCheckoutTime += longestCheckoutTime;\n                    //\u4ece\u6d3b\u8dc3\u5217\u8868\u4e2d\u79fb\u9664\u6b64\u94fe\u63a5\u4fe1\u606f\n                    this.state.activeConnections.remove(oldestActiveConnection);\n                    //\u5982\u679c\u5f00\u542f\u4e8b\u52a1\uff0c\u8fd8\u9700\u8981\u56de\u6eda\u4e00\u4e0b\n                    if (!oldestActiveConnection.getRealConnection().getAutoCommit()) {\n                        try {\n                            oldestActiveConnection.getRealConnection().rollback();\n                        } catch (SQLException var15) {\n                            log.debug(\"Bad connection. Could not roll back\");\n                        }\n                    }\n\n                    //\u8fd9\u91cc\u5c31\u6839\u636e\u4e4b\u524d\u7684\u8fde\u63a5\u5bf9\u8c61\u76f4\u63a5new\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\uff08\u6ce8\u610f\u4f7f\u7528\u7684\u8fd8\u662f\u4e4b\u524d\u7684Connection\u5bf9\u8c61\uff0c\u53ea\u662f\u88ab\u91cd\u65b0\u5c01\u88c5\u4e86\uff09\n                    conn = new PooledConnection(oldestActiveConnection.getRealConnection(), this);\n                    conn.setCreatedTimestamp(oldestActiveConnection.getCreatedTimestamp());\n                    conn.setLastUsedTimestamp(oldestActiveConnection.getLastUsedTimestamp());\n                    //\u8fc7\u671f\n                    oldestActiveConnection.invalidate();\n                    if (log.isDebugEnabled()) {\n                        log.debug(\"Claimed overdue connection \" + conn.getRealHashCode() + \".\");\n                    }\n                } else {\n                  //\u786e\u5b9e\u662f\u6ca1\u5f97\u7528\u4e86\uff0c\u53ea\u80fd\u5361\u4f4f\u4e86\uff08\u963b\u585e\uff09\n                  //\u7136\u540e\u8bb0\u5f55\u4e00\u4e0b\u6709\u51e0\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u5f53\u524d\u7684\u4efb\u52a1\u641e\u5b8c\n                    try {\n                        if (!countedWait) {\n                            ++this.state.hadToWaitCount;\n                            countedWait = true;\n                        }\n\n                        if (log.isDebugEnabled()) {\n                            log.debug(\"Waiting as long as \" + this.poolTimeToWait + \" milliseconds for connection.\");\n                        }\n\n                        long wt = System.currentTimeMillis();\n                        this.state.wait((long)this.poolTimeToWait);   //\u8981\u662f\u8d85\u8fc7\u7b49\u5f85\u65f6\u95f4\u8fd8\u662f\u6ca1\u7b49\u5230\uff0c\u53ea\u80fd\u653e\u5f03\n                        //\u6ce8\u610f\u8fd9\u6837\u7684\u8bddcon\u5c31\u4e3anull\u4e86\n                        var10000 = this.state;\n                        var10000.accumulatedWaitTime += System.currentTimeMillis() - wt;\n                    } catch (InterruptedException var16) {\n                        break;\n                    }\n                }\n            }\n\n            //\u7ecf\u8fc7\u4e4b\u524d\u7684\u64cd\u4f5c\uff0c\u5df2\u7ecf\u6210\u529f\u5206\u914d\u5230\u8fde\u63a5\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\n            if (conn != null) {\n                if (conn.isValid()) {  //\u662f\u5426\u6709\u6548\n                    if (!conn.getRealConnection().getAutoCommit()) {  //\u6e05\u7406\u4e4b\u524d\u9057\u7559\u7684\u4e8b\u52a1\u64cd\u4f5c\n                        conn.getRealConnection().rollback();\n                    }\n\n                    conn.setConnectionTypeCode(this.assembleConnectionTypeCode(this.dataSource.getUrl(), username, password));\n                    conn.setCheckoutTimestamp(System.currentTimeMillis());\n                    conn.setLastUsedTimestamp(System.currentTimeMillis());\n                    //\u6dfb\u52a0\u5230\u6d3b\u8dc3\u8868\u4e2d\n                    this.state.activeConnections.add(conn);\n                    //\u7edf\u8ba1\u4fe1\u606f\uff08\u4e0d\u91cd\u8981\uff09\n                    ++this.state.requestCount;\n                    var10000 = this.state;\n                    var10000.accumulatedRequestTime += System.currentTimeMillis() - t;\n                } else {\n                    //\u65e0\u6548\u7684\u8fde\u63a5\uff0c\u76f4\u63a5\u629b\u5f02\u5e38\n                    if (log.isDebugEnabled()) {\n                        log.debug(\"A bad connection (\" + conn.getRealHashCode() + \") was returned from the pool, getting another connection.\");\n                    }\n\n                    ++this.state.badConnectionCount;\n                    ++localBadConnectionCount;\n                    conn = null;\n                    if (localBadConnectionCount &gt; this.poolMaximumIdleConnections + this.poolMaximumLocalBadConnectionTolerance) {\n                        if (log.isDebugEnabled()) {\n                            log.debug(\"PooledDataSource: Could not get a good connection to the database.\");\n                        }\n\n                        throw new SQLException(\"PooledDataSource: Could not get a good connection to the database.\");\n                    }\n                }\n            }\n        }\n    }\n\n    //\u6700\u540e\u8be5\u5e72\u561b\u5e72\u561b\uff0c\u62ff\u4e0d\u5230\u8fde\u63a5\u76f4\u63a5\u629b\u5f02\u5e38\n    if (conn == null) {\n        if (log.isDebugEnabled()) {\n            log.debug(\"PooledDataSource: Unknown severe error condition.  The connection pool returned a null connection.\");\n        }\n\n        throw new SQLException(\"PooledDataSource: Unknown severe error condition.  The connection pool returned a null connection.\");\n    } else {\n        return conn;\n    }\n}\n</code></pre> <p>\u7ecf\u8fc7\u4e0a\u9762\u4e00\u987f\u731b\u5982\u864e\u7684\u64cd\u4f5c\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <p>\u5982\u679c\u6700\u540e\u5f97\u5230\u4e86\u8fde\u63a5\u5bf9\u8c61\uff08\u6709\u53ef\u80fd\u662f\u4ece\u7a7a\u95f2\u5217\u8868\u4e2d\u5f97\u5230\uff0c\u6709\u53ef\u80fd\u662f\u76f4\u63a5\u521b\u5efa\u7684\u65b0\u7684\uff0c\u8fd8\u6709\u53ef\u80fd\u662f\u7ecf\u8fc7\u56de\u6536\u7b56\u7565\u56de\u6536\u5f97\u5230\u7684\uff09\uff0c\u90a3\u4e48\u8fde\u63a5(Connection)\u5bf9\u8c61\u4e00\u5b9a\u4f1a\u88ab\u653e\u5728\u6d3b\u8dc3\u5217\u8868\u4e2d(state.activeConnections)</p> <p>\u90a3\u4e48\u80af\u5b9a\u6709\u4e00\u4e2a\u7591\u95ee\uff0c\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u83b7\u53d6\u4e00\u4e2a\u94fe\u63a5\u4f1a\u76f4\u63a5\u8fdb\u5165\u5230\u6d3b\u8dc3\u5217\u8868\u4e2d\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u4e00\u4e2a\u8fde\u63a5\u88ab\u5173\u95ed\uff0c\u53c8\u4f1a\u53d1\u751f\u4ec0\u4e48\u4e8b\u60c5\u5462\uff0c\u6211\u4eec\u6765\u770b\u770b\u6b64\u65b9\u6cd5\u8fd4\u56de\u4e4b\u540e\uff0c\u4f1a\u8c03\u7528<code>getProxyConnection</code>\u6765\u83b7\u53d6\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f<code>PooledConnection</code>\u7c7b\uff1a</p> <pre><code>class PooledConnection implements InvocationHandler {\n  private static final String CLOSE = \"close\";\n    private static final Class&lt;?&gt;[] IFACES = new Class[]{Connection.class};\n    private final int hashCode;\n    //\u4f1a\u8bb0\u5f55\u662f\u6765\u81ea\u54ea\u4e00\u4e2a\u6570\u636e\u6e90\u521b\u5efa\u7684\u7684\n    private final PooledDataSource dataSource;\n    //\u8fde\u63a5\u5bf9\u8c61\u672c\u4f53\n    private final Connection realConnection;\n    //\u4ee3\u7406\u7684\u94fe\u63a5\u5bf9\u8c61\n    private final Connection proxyConnection;\n  ...\n</code></pre> <p>\u5b83\u76f4\u63a5\u4ee3\u7406\u4e86\u6784\u9020\u65b9\u6cd5\u4e2d\u4f20\u5165\u7684Connection\u5bf9\u8c61\uff0c\u4e5f\u662f\u4f7f\u7528JDK\u7684\u52a8\u6001\u4ee3\u7406\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u5b83\u662f\u5982\u4f55\u8fdb\u884c\u4ee3\u7406\u7684\uff1a</p> <pre><code>public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    String methodName = method.getName();\n    //\u5982\u679c\u8c03\u7528\u7684\u662fConnection\u5bf9\u8c61\u7684close\u65b9\u6cd5\uff0c\n    if (\"close\".equals(methodName)) {\n        //\u8fd9\u91cc\u5e76\u4e0d\u4f1a\u771f\u7684\u5173\u95ed\u8fde\u63a5\uff08\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u7528\u4ee3\u7406\uff09\uff0c\u800c\u662f\u8c03\u7528\u4e4b\u524d\u6570\u636e\u6e90\u7684pushConnection\u65b9\u6cd5\uff0c\u5c06\u6b64\u8fde\u63a5\u6539\u4e3a\u4e3a\u7a7a\u95f2\u72b6\u6001\n        this.dataSource.pushConnection(this);\n        return null;\n    } else {\n        try {\n            if (!Object.class.equals(method.getDeclaringClass())) {\n                this.checkConnection();\n                //\u4efb\u4f55\u64cd\u4f5c\u6267\u884c\u4e4b\u524d\u90fd\u4f1a\u68c0\u67e5\u8fde\u63a5\u662f\u5426\u53ef\u7528\n            }\n\n            //\u8be5\u5e72\u561b\u5e72\u561b\n            return method.invoke(this.realConnection, args);\n        } catch (Throwable var6) {\n            throw ExceptionUtil.unwrapThrowable(var6);\n        }\n    }\n}\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u6700\u540e\u518d\u6765\u770b\u770b<code>pushConnection</code>\u65b9\u6cd5\uff1a</p> <pre><code>protected void pushConnection(PooledConnection conn) throws SQLException {\n    synchronized(this.state) {   //\u8001\u89c4\u77e9\uff0c\u5148\u6765\u628a\u9501\n        //\u5148\u4ece\u6d3b\u8dc3\u5217\u8868\u79fb\u9664\u6b64\u8fde\u63a5\n        this.state.activeConnections.remove(conn);\n        //\u5224\u65ad\u6b64\u94fe\u63a5\u662f\u5426\u53ef\u7528\n        if (conn.isValid()) {\n            PoolState var10000;\n            //\u770b\u770b\u95f2\u7f6e\u5217\u8868\u5bb9\u91cf\u662f\u5426\u5df2\u6ee1\uff08\u5bb9\u91cf\u6ee1\u4e86\u5c31\u56de\u4e0d\u53bb\u4e86\uff09\n            if (this.state.idleConnections.size() &lt; this.poolMaximumIdleConnections &amp;&amp; conn.getConnectionTypeCode() == this.expectedConnectionTypeCode) {\n                var10000 = this.state;\n                var10000.accumulatedCheckoutTime += conn.getCheckoutTime();\n                if (!conn.getRealConnection().getAutoCommit()) {\n                    conn.getRealConnection().rollback();\n                }\n\n                //\u628a\u552f\u4e00\u6709\u7528\u7684Connection\u5bf9\u8c61\u62ff\u51fa\u6765\uff0c\u7136\u540e\u91cd\u65b0\u521b\u5efa\u4e00\u4e2aPooledConnection\n                PooledConnection newConn = new PooledConnection(conn.getRealConnection(), this);\n                //\u653e\u5165\u95f2\u7f6e\u5217\u8868\uff0c\u6210\u529f\u56de\u6536\n                this.state.idleConnections.add(newConn);\n                newConn.setCreatedTimestamp(conn.getCreatedTimestamp());\n                newConn.setLastUsedTimestamp(conn.getLastUsedTimestamp());\n                conn.invalidate();\n                if (log.isDebugEnabled()) {\n                    log.debug(\"Returned connection \" + newConn.getRealHashCode() + \" to pool.\");\n                }\n\n                this.state.notifyAll();\n            } else {\n                var10000 = this.state;\n                var10000.accumulatedCheckoutTime += conn.getCheckoutTime();\n                if (!conn.getRealConnection().getAutoCommit()) {\n                    conn.getRealConnection().rollback();\n                }\n\n                conn.getRealConnection().close();\n                if (log.isDebugEnabled()) {\n                    log.debug(\"Closed connection \" + conn.getRealHashCode() + \".\");\n                }\n\n                conn.invalidate();\n            }\n        } else {\n            if (log.isDebugEnabled()) {\n                log.debug(\"A bad connection (\" + conn.getRealHashCode() + \") attempted to return to the pool, discarding connection.\");\n            }\n\n            ++this.state.badConnectionCount;\n        }\n\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u5b8c\u5168\u4e86\u89e3\u4e86Mybatis\u7684\u6c60\u5316\u6570\u636e\u6e90\u7684\u6267\u884c\u6d41\u7a0b\u4e86\u3002\u53ea\u4e0d\u8fc7\uff0c\u65e0\u8bbaConnection\u7ba1\u7406\u65b9\u5f0f\u5982\u4f55\u53d8\u6362\uff0c\u65e0\u8bba\u6570\u636e\u6e90\u518d\u9ad8\u7ea7\uff0c\u6211\u4eec\u8981\u77e5\u9053\uff0c\u5b83\u90fd\u6700\u7ec8\u90fd\u4f1a\u4f7f\u7528<code>DriverManager</code>\u6765\u521b\u5efa\u8fde\u63a5\u5bf9\u8c61\uff0c\u800c\u6700\u7ec8\u4f7f\u7528\u7684\u4e5f\u662f<code>DriverManager</code>\u63d0\u4f9b\u7684<code>Connection</code>\u5bf9\u8c61\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#mybatis_2","title":"\u6574\u5408Mybatis\u6846\u67b6","text":"<p>\u901a\u8fc7\u4e86\u89e3\u6570\u636e\u6e90\uff0c\u6211\u4eec\u5df2\u7ecf\u6e05\u695a\uff0cMybatis\u5b9e\u9645\u4e0a\u662f\u5728\u4f7f\u7528\u81ea\u5df1\u7f16\u5199\u7684\u6570\u636e\u6e90\uff08\u6570\u636e\u6e90\u6709\u5f88\u591a\uff0c\u4e4b\u540e\u6211\u4eec\u518d\u804a\u5176\u4ed6\u7684\uff09\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u6c60\u5316\u7684\u6570\u636e\u6e90\uff0c\u5b83\u9884\u5148\u5b58\u50a8\u4e86\u5f88\u591a\u7684\u8fde\u63a5\u5bf9\u8c61\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u5982\u4f55\u5c06Mybatis\u4e0eSpring\u66f4\u597d\u7684\u7ed3\u5408\u5462\uff0c\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u5e0c\u671b\u5c06SqlSessionFactory\u4ea4\u7ed9IoC\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\uff0c\u800c\u4e0d\u662f\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u5de5\u5177\u7c7b\u6765\u7ba1\u7406\uff08\u6211\u4eec\u4e4b\u524d\u4e00\u76f4\u90fd\u5728\u4f7f\u7528\u5de5\u5177\u7c7b\u7ba1\u7406\u548c\u521b\u5efa\u4f1a\u8bdd\uff09</p> <p>\u9996\u5148\u5bfc\u5165\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;mysql&lt;/groupId&gt;\n    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n    &lt;version&gt;8.0.25&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;\n    &lt;version&gt;3.5.7&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;\n    &lt;version&gt;2.0.6&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n    &lt;version&gt;5.3.13&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5728mybatis-spring\u4f9d\u8d56\u4e2d\uff0c\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86SqlSessionTemplate\u7c7b\uff0c\u5b83\u5176\u5b9e\u5c31\u662f\u5b98\u65b9\u5c01\u88c5\u7684\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u6ce8\u518c\u4e3aBean\uff0c\u8fd9\u6837\u6211\u4eec\u968f\u65f6\u90fd\u53ef\u4ee5\u5411IoC\u5bb9\u5668\u7d22\u8981\uff0c\u800c\u4e0d\u7528\u81ea\u5df1\u518d\u53bb\u7f16\u5199\u4e00\u4e2a\u5de5\u5177\u7c7b\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u7c7b\u4e2d\u521b\u5efa\uff1a</p> <pre><code>@Configuration\n@ComponentScan(\"com.test\")\npublic class TestConfiguration {\n    @Bean\n    public SqlSessionTemplate sqlSessionTemplate() throws IOException {\n        SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(Resources.getResourceAsReader(\"mybatis-config.xml\"));\n        return new SqlSessionTemplate(factory);\n    }\n}\n</code></pre> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE configuration\n        PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;\n&lt;configuration&gt;\n    &lt;environments default=\"development\"&gt;\n        &lt;environment id=\"development\"&gt;\n            &lt;transactionManager type=\"JDBC\"/&gt;\n            &lt;dataSource type=\"POOLED\"&gt;\n                &lt;property name=\"driver\" value=\"com.mysql.cj.jdbc.Driver\"/&gt;\n                &lt;property name=\"url\" value=\"jdbc:mysql://localhost:3306/study\"/&gt;\n                &lt;property name=\"username\" value=\"root\"/&gt;\n                &lt;property name=\"password\" value=\"123456\"/&gt;\n            &lt;/dataSource&gt;\n        &lt;/environment&gt;\n    &lt;/environments&gt;\n    &lt;mappers&gt;\n        &lt;mapper class=\"com.test.mapper.TestMapper\"/&gt;\n    &lt;/mappers&gt;\n&lt;/configuration&gt;\n</code></pre> <pre><code>public static void main(String[] args) {\n    ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n    SqlSessionTemplate template = context.getBean(SqlSessionTemplate.class);\n    TestMapper testMapper = template.getMapper(TestMapper.class);\n    System.out.println(testMapper.getStudent());\n}\n</code></pre> <pre><code>@Mapper\npublic interface TestMapper {\n\n    @Select(\"select * from student where sid = 1\")\n    Student getStudent();\n}\n</code></pre> <pre><code>@Data\npublic class Student {\n    int sid;\n    String name;\n    String sex;\n}\n</code></pre> <p>\u6700\u540e\u6210\u529f\u5f97\u5230Student\u5b9e\u4f53\u7c7b\uff0c\u8bc1\u660e<code>SqlSessionTemplate</code>\u6210\u529f\u6ce8\u518c\u4e3aBean\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\u867d\u7136\u8fd9\u6837\u5df2\u7ecf\u5f88\u65b9\u4fbf\u4e86\uff0c\u4f46\u662f\u8fd8\u4e0d\u591f\u65b9\u4fbf\uff0c\u6211\u4eec\u4f9d\u7136\u9700\u8981\u624b\u52a8\u53bb\u83b7\u53d6Mapper\u5bf9\u8c61\uff0c\u90a3\u4e48\u80fd\u5426\u76f4\u63a5\u5f97\u5230\u5bf9\u5e94\u7684Mapper\u5bf9\u8c61\u5462\uff0c\u6211\u4eec\u5e0c\u671b\u8ba9Spring\u76f4\u63a5\u5e2e\u52a9\u6211\u4eec\u7ba1\u7406\u6240\u6709\u7684Mapper\uff0c\u5f53\u9700\u8981\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u7c7b\u4e0a\u65b9\u6dfb\u52a0\u6ce8\u89e3\uff1a</p> <pre><code>@MapperScan(\"com.test.mapper\")\n</code></pre> <p>\u8fd9\u6837\uff0cSpring\u4f1a\u81ea\u52a8\u626b\u63cf\u6240\u6709\u7684Mapper\uff0c\u5e76\u5c06\u5176\u5b9e\u73b0\u6ce8\u518c\u4e3aBean\uff0c\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5bb9\u5668\u83b7\u53d6\u4e86\uff1a</p> <pre><code>public static void main(String[] args) throws InterruptedException {\n    ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n    TestMapper mapper = context.getBean(TestMapper.class);\n    System.out.println(mapper.getStudent());\n}\n</code></pre> <p>\u8bf7\u4e00\u5b9a\u6ce8\u610f\uff0c\u5fc5\u987b\u5b58\u5728<code>SqlSessionTemplate</code>\u6216\u662f<code>SqlSessionFactoryBean</code>\u7684Bean\uff0c\u5426\u5219\u4f1a\u65e0\u6cd5\u521d\u59cb\u5316\uff08\u6bd5\u7adf\u8981\u6570\u636e\u5e93\u7684\u94fe\u63a5\u4fe1\u606f\uff09</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u76f4\u63a5\u53bb\u9664Mybatis\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u90a3\u4e48\u6539\u600e\u4e48\u53bb\u5b9e\u73b0\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>SqlSessionFactoryBean</code>\u7c7b\uff1a</p> <pre><code>@Configuration\n@ComponentScan(\"com.test\")\n@MapperScan(\"com.test.mapper\")\npublic class TestConfiguration {\n    @Bean\n    public DataSource dataSource(){\n        return new PooledDataSource(\"com.mysql.cj.jdbc.Driver\",\n                \"jdbc:mysql://localhost:3306/study\", \"root\", \"123456\");\n    }\n\n    @Bean\n    public SqlSessionFactoryBean sqlSessionFactoryBean(@Autowired DataSource dataSource){\n        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();\n        bean.setDataSource(dataSource);\n        return bean;\n    }\n}\n</code></pre> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u7c7b\uff0c\u56e0\u4e3a\u8fd9\u662f\u6570\u636e\u5e93\u6700\u57fa\u672c\u7684\u4fe1\u606f\uff0c\u7136\u540e\u518d\u7ed9\u5230<code>SqlSessionFactoryBean</code>\u5b9e\u4f8b\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u76f4\u63a5\u5728\u4e00\u5f00\u59cb\u901a\u8fc7IoC\u5bb9\u5668\u914d\u7f6e\u4e86<code>SqlSessionFactory</code>\uff0c\u53ea\u9700\u8981\u4f20\u5165\u4e00\u4e2a<code>DataSource</code>\u7684\u5b9e\u73b0\u5373\u53ef\u3002</p> <p>\u5220\u9664\u914d\u7f6e\u6587\u4ef6\uff0c\u91cd\u65b0\u518d\u6765\u8fd0\u884c\uff0c\u540c\u6837\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528Mapper\u3002\u4ece\u8fd9\u91cc\u5f00\u59cb\uff0c\u901a\u8fc7IoC\u5bb9\u5668\uff0cMybatis\u5df2\u7ecf\u4e0d\u518d\u9700\u8981\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u4e86\uff0c\u4e4b\u540e\u57fa\u4e8eSpring\u7684\u5f00\u53d1\u5c06\u4e0d\u4f1a\u518d\u51fa\u73b0Mybatis\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#hikaricp","title":"\u4f7f\u7528HikariCP\u8fde\u63a5\u6c60","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\u4e86\u6570\u636e\u6e90\u8fd8\u6709\u5176\u4ed6\u5b9e\u73b0\uff0c\u6bd4\u5982C3P0\u3001Druid\u7b49\uff0c\u5b83\u4eec\u90fd\u662f\u975e\u5e38\u4f18\u79c0\u7684\u6570\u636e\u6e90\u5b9e\u73b0\uff08\u53ef\u4ee5\u81ea\u884c\u4e86\u89e3\uff09\uff0c\u4e0d\u8fc7\u6211\u4eec\u8fd9\u91cc\u8981\u4ecb\u7ecd\u7684\uff0c\u662f\u4e4b\u540e\u5728SpringBoot\u4e2d\u8fd8\u4f1a\u9047\u5230\u7684HikariCP\u8fde\u63a5\u6c60\u3002</p> <p>HikariCP\u662f\u7531\u65e5\u672c\u7a0b\u5e8f\u5458\u5f00\u6e90\u7684\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7ec4\u4ef6\uff0c\u4ee3\u7801\u975e\u5e38\u8f7b\u91cf\uff0c\u5e76\u4e14\u901f\u5ea6\u975e\u5e38\u7684\u5feb\u3002\u6839\u636e\u5b98\u65b9\u63d0\u4f9b\u7684\u6570\u636e\uff0c\u5728\u9177\u777fi7\u5f00\u542f32\u4e2a\u7ebf\u7a0b32\u4e2a\u8fde\u63a5\u7684\u60c5\u51b5\u4e0b\uff0c\u8fdb\u884c\u968f\u673a\u6570\u636e\u5e93\u8bfb\u5199\u64cd\u4f5c\uff0cHikariCP\u7684\u901f\u5ea6\u662f\u73b0\u5728\u5e38\u7528\u7684C3P0\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u6570\u767e\u500d\u3002\u5728SpringBoot2.0\u4e2d\uff0c\u5b98\u65b9\u4e5f\u662f\u63a8\u8350\u4f7f\u7528HikariCP\u3002</p> <p></p> <p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5bfc\u5165\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;\n    &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;\n    &lt;version&gt;3.4.5&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u63a5\u7740\u4fee\u6539\u4e00\u4e0bBean\u7684\u5b9a\u4e49\uff1a</p> <pre><code>@Bean\npublic DataSource dataSource() throws SQLException {\n    HikariDataSource dataSource = new HikariDataSource();\n    dataSource.setJdbcUrl(\"jdbc:mysql://localhost:3306/study\");\n    dataSource.setDriverClassName(\"com.mysql.cj.jdbc.Driver\");\n    dataSource.setUsername(\"root\");\n    dataSource.setPassword(\"123456\");\n    return dataSource;\n}\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u540c\u6837\u53ef\u4ee5\u5f97\u5230\u8f93\u51fa\u7ed3\u679c\uff0c\u4f46\u662f\u51fa\u73b0\u4e86\u4e00\u4e2a\u62a5\u9519\uff1a</p> <pre><code>SLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\n</code></pre> <p>\u6b64\u6570\u636e\u6e90\u5b9e\u9645\u4e0a\u662f\u91c7\u7528\u4e86SLF4J\u65e5\u5fd7\u6846\u67b6\u6253\u5370\u65e5\u5fd7\u4fe1\u606f\uff0c\u4f46\u662f\u73b0\u5728\u6ca1\u6709\u4efb\u4f55\u7684\u65e5\u5fd7\u5b9e\u73b0\uff08slf4j\u53ea\u662f\u4e00\u4e2aAPI\u6807\u51c6\uff0c\u5b83\u89c4\u8303\u4e86\u591a\u79cd\u65e5\u5fd7\u6846\u67b6\u7684\u64cd\u4f5c\uff0c\u7edf\u4e00\u4f7f\u7528SLF4J\u5b9a\u4e49\u7684\u65b9\u6cd5\u6765\u64cd\u4f5c\u4e0d\u540c\u7684\u65e5\u5fd7\u6846\u67b6\uff09\u6211\u4eec\u8fd9\u91cc\u5c31\u4f7f\u7528JUL\u4f5c\u4e3a\u65e5\u5fd7\u5b9e\u73b0\uff0c\u6211\u4eec\u9700\u8981\u5bfc\u5165\u53e6\u4e00\u4e2a\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n    &lt;artifactId&gt;slf4j-jdk14&lt;/artifactId&gt;\n    &lt;version&gt;1.7.25&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u6ce8\u610f\u7248\u672c\u4e00\u5b9a\u8981\u548c<code>slf4j-api</code>\u4fdd\u6301\u4e00\u81f4\uff01</p> <p>\u8fd9\u6837\u5c31\u80fd\u5f97\u5230\u6211\u4eec\u7684\u65e5\u5fd7\u4fe1\u606f\u4e86\uff1a</p> <pre><code>\u5341\u4e8c\u6708 07, 2021 8:46:41 \u4e0b\u5348 com.zaxxer.hikari.HikariDataSource getConnection\n\u4fe1\u606f: HikariPool-1 - Starting...\n\u5341\u4e8c\u6708 07, 2021 8:46:41 \u4e0b\u5348 com.zaxxer.hikari.HikariDataSource getConnection\n\u4fe1\u606f: HikariPool-1 - Start completed.\nStudent(sid=1, name=\u5c0f\u660e, sex=\u7537)\n</code></pre> <p>\u5728SpringBoot\u9636\u6bb5\uff0c\u6211\u4eec\u8fd8\u4f1a\u9047\u5230<code>HikariPool-1 - Starting...</code>\u548c<code>HikariPool-1 - Start completed.</code>\u540c\u6b3e\u65e5\u5fd7\u4fe1\u606f\u3002</p> <p>\u5f53\u7136\uff0cLombok\u80af\u5b9a\u4e5f\u662f\u652f\u6301\u8fd9\u4e2a\u65e5\u5fd7\u6846\u67b6\u5feb\u901f\u6ce8\u89e3\u7684\uff1a</p> <pre><code>@Slf4j\npublic class Main {\n    public static void main(String[] args) {\n        log.info(\"\u9879\u76ee\u6b63\u5728\u542f\u52a8...\");\n        ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n        TestMapper mapper = context.getBean(TestMapper.class);\n        System.out.println(mapper.getStudent());\n    }\n}\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#mybatis_3","title":"Mybatis\u4e8b\u52a1\u7ba1\u7406","text":"<p>\u6211\u4eec\u524d\u9762\u5df2\u7ecf\u8bb2\u89e3\u4e86\u5982\u4f55\u8ba9Mybatis\u4e0eSpring\u66f4\u597d\u5730\u878d\u5408\u5728\u4e00\u8d77\uff0c\u901a\u8fc7\u5c06\u5bf9\u5e94\u7684Bean\u7c7b\u578b\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\uff0c\u5c31\u80fd\u66f4\u52a0\u65b9\u4fbf\u7684\u53bb\u4f7f\u7528Mapper\uff0c\u90a3\u4e48\u73b0\u5728\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770bSpring\u7684\u4e8b\u52a1\u63a7\u5236\u3002</p> <p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u662f\u56de\u987e\u4e00\u4e0b\u4e8b\u52a1\u673a\u5236\u3002\u9996\u5148\u4e8b\u52a1\u9075\u5faa\u4e00\u4e2aACID\u539f\u5219\uff1a</p> <ul> <li>\u539f\u5b50\u6027\uff08Atomicity\uff09\uff1a\u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0c\u7531\u4e00\u7cfb\u5217\u52a8\u4f5c\u7ec4\u6210\u3002\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u786e\u4fdd\u52a8\u4f5c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5b8c\u5168\u4e0d\u8d77\u4f5c\u7528\u3002</li> <li>\u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u4e00\u65e6\u4e8b\u52a1\u5b8c\u6210\uff08\u4e0d\u7ba1\u6210\u529f\u8fd8\u662f\u5931\u8d25\uff09\uff0c\u7cfb\u7edf\u5fc5\u987b\u786e\u4fdd\u5b83\u6240\u5efa\u6a21\u7684\u4e1a\u52a1\u5904\u4e8e\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u800c\u4e0d\u4f1a\u662f\u90e8\u5206\u5b8c\u6210\u90e8\u5206\u5931\u8d25\u3002\u5728\u73b0\u5b9e\u4e2d\u7684\u6570\u636e\u4e0d\u5e94\u8be5\u88ab\u7834\u574f\u3002</li> <li>\u9694\u79bb\u6027\uff08Isolation\uff09\uff1a\u53ef\u80fd\u6709\u8bb8\u591a\u4e8b\u52a1\u4f1a\u540c\u65f6\u5904\u7406\u76f8\u540c\u7684\u6570\u636e\uff0c\u56e0\u6b64\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u5e94\u8be5\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\u5f00\u6765\uff0c\u9632\u6b62\u6570\u636e\u635f\u574f\u3002</li> <li>\u6301\u4e45\u6027\uff08Durability\uff09\uff1a\u4e00\u65e6\u4e8b\u52a1\u5b8c\u6210\uff0c\u65e0\u8bba\u53d1\u751f\u4ec0\u4e48\u7cfb\u7edf\u9519\u8bef\uff0c\u5b83\u7684\u7ed3\u679c\u90fd\u4e0d\u5e94\u8be5\u53d7\u5230\u5f71\u54cd\uff0c\u8fd9\u6837\u5c31\u80fd\u4ece\u4efb\u4f55\u7cfb\u7edf\u5d29\u6e83\u4e2d\u6062\u590d\u8fc7\u6765\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u7684\u7ed3\u679c\u88ab\u5199\u5230\u6301\u4e45\u5316\u5b58\u50a8\u5668\u4e2d\u3002</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u4e8b\u52a1\u5c31\u662f\u8981\u4e48\u5b8c\u6210\uff0c\u8981\u4e48\u5c31\u5565\u90fd\u522b\u505a\uff01\u5e76\u4e14\u4e0d\u540c\u7684\u4e8b\u52a1\u76f4\u63a5\u76f8\u4e92\u9694\u79bb\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u6df1\u5165\u4e86\u89e3\u4e00\u4e0b\u4e8b\u52a1\u7684\u9694\u79bb\u673a\u5236\uff08\u5728\u4e4b\u524d\u6570\u636e\u5e93\u5165\u95e8\u9636\u6bb5\u5e76\u6ca1\u6709\u63d0\u5230\uff09\u6211\u4eec\u8bf4\u4e86\uff0c\u4e8b\u52a1\u4e4b\u95f4\u662f\u76f8\u4e92\u9694\u79bb\u4e92\u4e0d\u5e72\u6270\u7684\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0\u4e86\u4e0b\u9762\u7684\u60c5\u51b5\uff0c\u4f1a\u600e\u4e48\u6837\u5462\uff1a</p> <p>\u5f53\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u6267\u884c\uff0c\u5e76\u4e14\u540c\u65f6\u5728\u64cd\u4f5c\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u8fd9\u6837\u5f88\u5bb9\u6613\u51fa\u73b0\u5e76\u53d1\u76f8\u5173\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u4e00\u4e2a\u4e8b\u52a1\u5148\u8bfb\u53d6\u4e86\u67d0\u6761\u6570\u636e\uff0c\u800c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u6b64\u65f6\u4fee\u6539\u4e86\u6b64\u6570\u636e\uff0c\u5f53\u524d\u4e00\u4e2a\u4e8b\u52a1\u7d27\u63a5\u7740\u518d\u6b21\u8bfb\u53d6\u65f6\uff0c\u4f1a\u5bfc\u81f4\u548c\u524d\u4e00\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u8fd9\u5c31\u662f\u4e00\u79cd\u5178\u578b\u7684\u6570\u636e\u865a\u8bfb\u73b0\u8c61\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u4e8b\u52a1\u4e4b\u95f4\u5b9e\u9645\u4e0a\u662f\u5b58\u5728\u4e00\u4e9b\u9694\u79bb\u7ea7\u522b\u7684\uff1a</p> <ul> <li>ISOLATION_READ_UNCOMMITTED\uff08\u8bfb\u672a\u63d0\u4ea4\uff09\uff1a\u5176\u4ed6\u4e8b\u52a1\u4f1a\u8bfb\u53d6\u5f53\u524d\u4e8b\u52a1\u5c1a\u672a\u66f4\u6539\u7684\u63d0\u4ea4\uff08\u76f8\u5f53\u4e8e\u8bfb\u53d6\u7684\u662f\u8fd9\u4e2a\u4e8b\u52a1\u6682\u65f6\u7f13\u5b58\u7684\u5185\u5bb9\uff0c\u5e76\u4e0d\u662f\u6570\u636e\u5e93\u4e2d\u7684\u5185\u5bb9\uff09</li> <li>ISOLATION_READ_COMMITTED\uff08\u8bfb\u5df2\u63d0\u4ea4\uff09\uff1a\u5176\u4ed6\u4e8b\u52a1\u4f1a\u8bfb\u53d6\u5f53\u524d\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u7684\u6570\u636e\uff08\u4e5f\u5c31\u662f\u76f4\u63a5\u8bfb\u53d6\u6570\u636e\u5e93\u4e2d\u5df2\u7ecf\u53d1\u751f\u66f4\u6539\u7684\u5185\u5bb9\uff09</li> <li>ISOLATION_REPEATABLE_READ\uff08\u53ef\u91cd\u590d\u8bfb\uff09\uff1a\u5176\u4ed6\u4e8b\u52a1\u4f1a\u8bfb\u53d6\u5f53\u524d\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u7684\u6570\u636e\u5e76\u4e14\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u5141\u8bb8\u518d\u8fdb\u884c\u6570\u636e\u4fee\u6539\uff08\u6ce8\u610f\u8fd9\u91cc\u4ec5\u4ec5\u662f\u4e0d\u5141\u8bb8\u4fee\u6539\u6570\u636e\uff09</li> <li>ISOLATION_SERIALIZABLE\uff08\u4e32\u884c\u5316\uff09\uff1a\u5b83\u5b8c\u5168\u670d\u4eceACID\u539f\u5219\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5fc5\u987b\u7b49\u5f85\u5176\u4ed6\u4e8b\u52a1\u7ed3\u675f\u4e4b\u540e\u624d\u80fd\u5f00\u59cb\u6267\u884c\uff0c\u76f8\u5f53\u4e8e\u6328\u4e2a\u6267\u884c\uff0c\u6548\u7387\u5f88\u4f4e</li> </ul> <p>\u6211\u4eec\u4f9d\u6b21\u6765\u770b\u770b\uff0c\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898\u3002\u9996\u5148\u662f<code>\u8bfb\u672a\u63d0\u4ea4</code>\u7ea7\u522b\uff0c\u6b64\u7ea7\u522b\u5c5e\u4e8e\u6700\u4f4e\u7ea7\u522b\uff0c\u76f8\u5f53\u4e8e\u5404\u4e2a\u4e8b\u52a1\u5171\u4eab\u4e00\u4e2a\u7f13\u5b58\u533a\u57df\uff0c\u4efb\u4f55\u4e8b\u52a1\u7684\u64cd\u4f5c\u90fd\u5728\u8fd9\u91cc\u8fdb\u884c\u3002\u90a3\u4e48\u5b83\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e8b\u52a1A\u6700\u540e\u5f97\u5230\u7684\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6beb\u65e0\u610f\u4e49\u7684\u6570\u636e\uff08\u4e8b\u52a1B\u5df2\u7ecf\u56de\u6eda\u4e86\uff09\u6211\u4eec\u79f0\u6b64\u6570\u636e\u4e3a\"\u810f\u6570\u636e\"\uff0c\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a\u810f\u8bfb</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b<code>\u8bfb\u5df2\u63d0\u4ea4</code>\u7ea7\u522b\uff0c\u4e8b\u52a1\u53ea\u80fd\u8bfb\u53d6\u5176\u4ed6\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u7684\u5185\u5bb9\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u4ece\u6570\u636e\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u810f\u8bfb\u95ee\u9898\u4e86\uff0c\u4f46\u662f\u5b83\u8fd8\u662f\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <p></p> <p>\u8fd9\u6b63\u662f\u6211\u4eec\u524d\u9762\u4f8b\u5b50\u4e2d\u63d0\u5230\u7684\u95ee\u9898\uff0c\u867d\u7136\u5b83\u907f\u514d\u4e86\u810f\u8bfb\u95ee\u9898\uff0c\u4f46\u662f\u5982\u679c\u4e8b\u4ef6B\u4fee\u6539\u5e76\u63d0\u4ea4\u4e86\u6570\u636e\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u4e8b\u52a1A\u4e4b\u524d\u8bfb\u53d6\u5230\u7684\u6570\u636e\u4f9d\u7136\u4e0d\u662f\u6700\u65b0\u7684\u6570\u636e\uff0c\u76f4\u63a5\u5bfc\u81f4\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a\u865a\u8bfb\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u4e0d\u53ef\u91cd\u590d\u8bfb</p> <p>\u56e0\u6b64\uff0c\u4e0b\u4e00\u4e2a\u9694\u79bb\u7ea7\u522b<code>\u53ef\u91cd\u590d\u8bfb</code>\u5c31\u80fd\u591f\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\uff08MySQL\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\uff0c\u5b83\u89c4\u5b9a\u5728\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u65f6\uff0c\u4e0d\u5141\u8bb8\u4fee\u6539\u6570\u636e\uff0c\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u6709\u6548\u5730\u907f\u514d\u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u6837\u5c31\u4e00\u5b9a\u5b89\u5168\u4e86\u5417\uff1f\u8fd9\u91cc\u4ec5\u4ec5\u662f\u7981\u6b62\u4e86\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684UPDATE\u64cd\u4f5c\uff0c\u4f46\u662f\u5b83\u5e76\u6ca1\u6709\u7981\u6b62INSERT\u8fd9\u7c7b\u64cd\u4f5c\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4e8b\u52a1A\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e8b\u52a1B\u63d2\u5165\u4e86\u65b0\u7684\u6570\u636e\uff0c\u90a3\u4e48A\u8fd9\u65f6\u662f\u6beb\u4e0d\u77e5\u60c5\u7684\uff0c\u6bd4\u5982\uff1a</p> <p></p> <p>\u4e24\u4e2a\u4eba\u540c\u65f6\u62a5\u540d\u4e00\u4e2a\u6d3b\u52a8\uff0c\u4e24\u4e2a\u62a5\u540d\u7684\u4e8b\u52a1\u540c\u65f6\u5728\u8fdb\u884c\uff0c\u4f46\u662f\u4ed6\u4eec\u4e00\u5f00\u59cb\u8bfb\u53d6\u5230\u7684\u4eba\u6570\u90fd\u662f5\uff0c\u800c\u8fd9\u65f6\uff0c\u5b83\u4eec\u90fd\u4f1a\u8ba4\u4e3a\u62a5\u540d\u6210\u529f\u540e\u4eba\u6570\u5e94\u8be5\u53d8\u62106\uff0c\u800c\u6b63\u5e38\u60c5\u51b5\u4e0b\u5e94\u8be5\u662f7\uff0c\u56e0\u6b64\u8fd9\u4e2a\u65f6\u5019\u5c31\u53d1\u751f\u4e86\u6570\u636e\u7684\u5e7b\u8bfb\u73b0\u8c61\u3002</p> <p>\u56e0\u6b64\uff0c\u8981\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\uff0c\u53ea\u80fd\u4f7f\u7528\u6700\u540e\u4e00\u79cd\u9694\u79bb\u7ea7\u522b<code>\u4e32\u884c\u5316</code>\u6765\u5b9e\u73b0\u4e86\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u4e0d\u80fd\u540c\u65f6\u8fdb\u884c\uff0c\u76f4\u63a5\u907f\u514d\u6240\u6709\u5e76\u53d1\u95ee\u9898\uff0c\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u662f\u6548\u7387\u7206\u51cf\uff0c\u5e76\u4e0d\u63a8\u8350\u3002</p> <p>\u6700\u540e\u603b\u7ed3\u4e09\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u810f\u8bfb\uff1a\u8bfb\u53d6\u5230\u4e86\u88ab\u56de\u6eda\u7684\u6570\u636e\uff0c\u5b83\u6beb\u65e0\u610f\u4e49\u3002</li> <li>\u865a\u8bfb\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\uff1a\u7531\u4e8e\u5176\u4ed6\u4e8b\u52a1\u66f4\u65b0\u6570\u636e\uff0c\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002</li> <li>\u5e7b\u8bfb\uff1a\u7531\u4e8e\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u63d2\u5165\u5220\u9664\u64cd\u4f5c\uff0c\u800c\u53c8\u65e0\u6cd5\u611f\u77e5\u5230\u8868\u4e2d\u8bb0\u5f55\u6761\u6570\u53d1\u751f\u53d8\u5316\uff0c\u5f53\u4e0b\u6b21\u518d\u8bfb\u53d6\u65f6\u4f1a\u83ab\u540d\u5176\u5999\u591a\u51fa\u6216\u7f3a\u5931\u6570\u636e\uff0c\u5c31\u50cf\u4ea7\u751f\u5e7b\u89c9\u4e00\u6837\u3002</li> </ul> <p>\uff08\u5bf9\u4e8e\u865a\u8bfb\u548c\u5e7b\u8bfb\u7684\u533a\u5206\uff1a\u865a\u8bfb\u662f\u67d0\u4e2a\u6570\u636e\u524d\u540e\u8bfb\u53d6\u4e0d\u4e00\u81f4\uff0c\u5e7b\u8bfb\u662f\u6574\u4e2a\u8868\u7684\u8bb0\u5f55\u6570\u91cf\u524d\u540e\u8bfb\u53d6\u4e0d\u4e00\u81f4\uff09</p> <p>\u6700\u540e\u8fd9\u5f20\u56fe\uff0c\u8bf7\u52a1\u5fc5\u8bb0\u5728\u4f60\u7684\u8111\u6d77\uff0c\u8bb0\u5728\u4f60\u7684\u5fc3\u4e2d\uff0c\u8bb0\u5728\u4f60\u7684\u5168\u4e16\u754c\uff1a</p> <p></p> <p>Mybatis\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u7ba1\u7406\uff0c\u4e5f\u6709\u7740\u76f8\u5e94\u7684\u5c01\u88c5\u3002\u4e00\u4e2a\u4e8b\u52a1\u65e0\u975e\u5c31\u662f\u521b\u5efa\u3001\u63d0\u4ea4\u3001\u56de\u6eda\u3001\u5173\u95ed\uff0c\u56e0\u6b64\u8fd9\u4e9b\u64cd\u4f5c\u88abMybatis\u62bd\u8c61\u4e3a\u4e00\u4e2a\u63a5\u53e3\uff1a</p> <pre><code>public interface Transaction {\n    Connection getConnection() throws SQLException;\n\n    void commit() throws SQLException;\n\n    void rollback() throws SQLException;\n\n    void close() throws SQLException;\n\n    Integer getTimeout() throws SQLException;\n}\n</code></pre> <p>\u5bf9\u4e8e\u6b64\u63a5\u53e3\u7684\u5b9e\u73b0\uff0cMyBatis\u7684\u4e8b\u52a1\u7ba1\u7406\u5206\u4e3a\u4e24\u79cd\u5f62\u5f0f\uff1a</p> <ol> <li>\u4f7f\u7528JDBC\u7684\u4e8b\u52a1\u7ba1\u7406\u673a\u5236\uff1a\u5373\u5229\u7528\u5bf9\u5e94\u6570\u636e\u5e93\u7684\u9a71\u52a8\u751f\u6210\u7684<code>Connection</code>\u5bf9\u8c61\u5b8c\u6210\u5bf9\u4e8b\u52a1\u7684\u63d0\u4ea4\uff08commit()\uff09\u3001\u56de\u6eda\uff08rollback()\uff09\u3001\u5173\u95ed\uff08close()\uff09\u7b49\uff0c\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\u4e3a<code>JdbcTransaction</code></li> <li>\u4f7f\u7528MANAGED\u7684\u4e8b\u52a1\u7ba1\u7406\u673a\u5236\uff1a\u8fd9\u79cd\u673a\u5236MyBatis\u81ea\u8eab\u4e0d\u4f1a\u53bb\u5b9e\u73b0\u4e8b\u52a1\u7ba1\u7406\uff0c\u800c\u662f\u8ba9\u7a0b\u5e8f\u7684\u5bb9\u5668\uff08\u6bd4\u5982Spring\uff09\u6765\u5b9e\u73b0\u5bf9\u4e8b\u52a1\u7684\u7ba1\u7406\uff0c\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\u4e3a<code>ManagedTransaction</code></li> </ol> <p>\u800c\u6211\u4eec\u4e4b\u524d\u4e00\u76f4\u4f7f\u7528\u7684\u5176\u5b9e\u5c31\u662fJDBC\u7684\u4e8b\u52a1\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u4f7f\u7528<code>Connection</code>\u5bf9\u8c61\uff08\u4e4b\u524dJavaWeb\u9636\u6bb5\u5df2\u7ecf\u8bb2\u89e3\u8fc7\u4e86\uff09\u5728\u8fdb\u884c\u4e8b\u52a1\u64cd\u4f5c\uff0c\u5e76\u6ca1\u6709\u989d\u5916\u7684\u7ba1\u7406\u673a\u5236\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u4e3a\uff1a</p> <pre><code>&lt;transactionManager type=\"JDBC\"/&gt;\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b<code>JdbcTransaction</code>\u662f\u4e0d\u662f\u50cf\u6211\u4eec\u4e0a\u9762\u6240\u8bf4\u7684\u90a3\u6837\u7ba1\u7406\u4e8b\u52a1\u7684\uff0c\u76f4\u63a5\u4e0a\u6e90\u7801\uff1a</p> <pre><code>public class JdbcTransaction implements Transaction {\n    private static final Log log = LogFactory.getLog(JdbcTransaction.class);\n    protected Connection connection;\n    protected DataSource dataSource;\n    protected TransactionIsolationLevel level;\n    protected boolean autoCommit;\n\n    public JdbcTransaction(DataSource ds, TransactionIsolationLevel desiredLevel, boolean desiredAutoCommit) {\n        //\u6570\u636e\u6e90\n        this.dataSource = ds;\n        //\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0c\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e86\n        this.level = desiredLevel;\n        //\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\n        this.autoCommit = desiredAutoCommit;\n    }\n\n  //\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7ed9\u4e2aConnection\u5bf9\u8c61\n   public JdbcTransaction(Connection connection) {\n        this.connection = connection;\n    }\n\n    public Connection getConnection() throws SQLException {\n        //\u6ca1\u6709\u5c31\u901a\u8fc7\u6570\u636e\u6e90\u65b0\u5f00\u4e00\u4e2aConnection\n        if (this.connection == null) {\n            this.openConnection();\n        }\n\n        return this.connection;\n    }\n\n    public void commit() throws SQLException {\n        //\u8fde\u63a5\u5df2\u7ecf\u521b\u5efa\u5e76\u4e14\u6ca1\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4\u624d\u53ef\u4ee5\u4f7f\u7528\n        if (this.connection != null &amp;&amp; !this.connection.getAutoCommit()) {\n            if (log.isDebugEnabled()) {\n                log.debug(\"Committing JDBC Connection [\" + this.connection + \"]\");\n            }\n                        //\u5b9e\u9645\u4e0a\u4f7f\u7528\u7684\u662f\u6570\u636e\u5e93\u9a71\u52a8\u63d0\u4f9b\u7684Connection\u5bf9\u8c61\u8fdb\u884c\u4e8b\u52a1\u64cd\u4f5c\n            this.connection.commit();\n        }\n\n    }\n</code></pre> <p>\u76f8\u5f53\u4e8e<code>JdbcTransaction</code>\u53ea\u662f\u4e3a\u6570\u636e\u5e93\u9a71\u52a8\u63d0\u4f9b\u7684<code>Connection</code>\u5bf9\u8c61\u5957\u4e86\u5c42\u58f3\uff0c\u6240\u6709\u7684\u4e8b\u52a1\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u8c03\u7528<code>Connection</code>\u5bf9\u8c61\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770b<code>ManagedTransaction</code>\u7684\u6e90\u7801\uff1a</p> <pre><code>public class ManagedTransaction implements Transaction {\n    ...\n\n    public void commit() throws SQLException {\n    }\n\n    public void rollback() throws SQLException {\n    }\n\n    ...\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5927\u4f53\u5185\u5bb9\u548c<code>JdbcTransaction</code>\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u5b83\u5e76\u6ca1\u6709\u5b9e\u73b0\u4efb\u4f55\u7684\u4e8b\u52a1\u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u5e0c\u671b\u5c06\u5b9e\u73b0\u4ea4\u7ed9\u5176\u4ed6\u7684\u7ba1\u7406\u6846\u67b6\u6765\u5b8c\u6210\uff0c\u800cSpring\u5c31\u4e3aMybatis\u63d0\u4f9b\u4e86\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u4e8b\u52a1\u7ba1\u7406\u5b9e\u73b0\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#spring_2","title":"\u4f7f\u7528Spring\u4e8b\u52a1\u7ba1\u7406","text":"<p>\u73b0\u5728\u6211\u4eec\u6765\u5b66\u4e60\u4e00\u4e0bSpring\u63d0\u4f9b\u7684\u4e8b\u52a1\u7ba1\u7406\uff08Spring\u4e8b\u52a1\u7ba1\u7406\u5206\u4e3a\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u548c\u58f0\u660e\u5f0f\u4e8b\u52a1\uff0c\u4f46\u662f\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u8fc7\u4e8e\u590d\u6742\u5e76\u4e14\u5177\u6709\u9ad8\u5ea6\u8026\u5408\u6027\uff0c\u8fdd\u80cc\u4e86Spring\u6846\u67b6\u7684\u8bbe\u8ba1\u521d\u8877\uff0c\u56e0\u6b64\u8fd9\u91cc\u53ea\u8bb2\u89e3\u58f0\u660e\u5f0f\u4e8b\u52a1\uff09\u58f0\u660e\u5f0f\u4e8b\u52a1\u662f\u57fa\u4e8eAOP\u5b9e\u73b0\u7684\u3002</p> <p>\u4f7f\u7528\u58f0\u660e\u5f0f\u4e8b\u52a1\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u914d\u7f6e\u7c7b\u6dfb\u52a0<code>@EnableTransactionManagement</code>\u6ce8\u89e3\u5373\u53ef\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f00\u542fSpring\u7684\u4e8b\u52a1\u652f\u6301\u4e86\u3002\u63a5\u7740\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a\u4e00\u4e2a\u4e8b\u52a1\u8981\u505a\u7684\u6240\u6709\u4e8b\u60c5\u5c01\u88c5\u5230Service\u5c42\u7684\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u5373\u53ef\uff0c\u9996\u5148\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6ce8\u518c\u4e00\u4e2a\u65b0\u7684Bean\uff0c\u4e8b\u52a1\u9700\u8981\u6267\u884c\u5fc5\u987b\u6709\u4e00\u4e2a\u4e8b\u52a1\u7ba1\u7406\u5668\uff1a</p> <pre><code>@Bean\npublic TransactionManager transactionManager(@Autowired DataSource dataSource){\n    return new DataSourceTransactionManager(dataSource);\n}\n</code></pre> <p>\u63a5\u7740\u7f16\u5199Mapper\u64cd\u4f5c\uff1a</p> <pre><code>@Mapper\npublic interface TestMapper {\n\n    @Insert(\"insert into student(name, sex) values('\u6d4b\u8bd5', '\u7537')\")\n    void insertStudent();\n}\n</code></pre> <p>\u8fd9\u6837\u4f1a\u5411\u6570\u636e\u5e93\u4e2d\u63d2\u5165\u4e00\u6761\u65b0\u7684\u5b66\u751f\u4fe1\u606f\uff0c\u63a5\u7740\uff0c\u5047\u8bbe\u6211\u4eec\u8fd9\u91cc\u6709\u4e00\u4e2a\u4e1a\u52a1\u9700\u8981\u8fde\u7eed\u63d2\u5165\u4e24\u6761\u5b66\u751f\u4fe1\u606f\uff0c\u9996\u5148\u7f16\u5199\u4e1a\u52a1\u5c42\u7684\u63a5\u53e3\uff1a</p> <pre><code>public interface TestService {\n\n    void test();\n}\n</code></pre> <p>\u63a5\u7740\uff0c\u6211\u4eec\u518d\u6765\u7f16\u5199\u4e1a\u52a1\u5c42\u7684\u5b9e\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u5176\u6ce8\u518c\u4e3aBean\uff0c\u4ea4\u7ed9Spring\u6765\u8fdb\u884c\u7ba1\u7406\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u81ea\u52a8\u5c06Mapper\u6ce8\u5165\u5230\u7c7b\u4e2d\u4e86\uff0c\u5e76\u4e14\u53ef\u4ee5\u652f\u6301\u4e8b\u52a1\uff1a</p> <pre><code>@Component\npublic class TestServiceImpl implements TestService{\n\n    @Resource\n    TestMapper mapper;\n\n    @Transactional\n    @Override\n    public void test() {\n        mapper.insertStudent();\n        if(true) throw new RuntimeException(\"\u6211\u662f\u6d4b\u8bd5\u5f02\u5e38\uff01\");\n        mapper.insertStudent();\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53ea\u9700\u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0<code>@Transactional</code>\u6ce8\u89e3\uff0c\u5373\u53ef\u8868\u793a\u6b64\u65b9\u6cd5\u6267\u884c\u7684\u662f\u4e00\u4e2a\u4e8b\u52a1\u64cd\u4f5c\uff0c\u5728\u8c03\u7528\u6b64\u65b9\u6cd5\u65f6\uff0cSpring\u4f1a\u901a\u8fc7AOP\u673a\u5236\u4e3a\u5176\u8fdb\u884c\u589e\u5f3a\uff0c\u4e00\u65e6\u53d1\u73b0\u5f02\u5e38\uff0c\u4e8b\u52a1\u4f1a\u81ea\u52a8\u56de\u6eda\u3002\u6700\u540e\u6211\u4eec\u6765\u8c03\u7528\u4e00\u4e0b\u6b64\u65b9\u6cd5\uff1a</p> <pre><code>@Slf4j\npublic class Main {\n    public static void main(String[] args) {\n        log.info(\"\u9879\u76ee\u6b63\u5728\u542f\u52a8...\");\n        ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n        TestService service = context.getBean(TestService.class);\n        service.test();\n    }\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u662f\u51fa\u73b0\u9519\u8bef\uff1a</p> <pre><code>\u5341\u4e8c\u6708 08, 2021 3:09:29 \u4e0b\u5348 com.test.Main main\n\u4fe1\u606f: \u9879\u76ee\u6b63\u5728\u542f\u52a8...\n\u5341\u4e8c\u6708 08, 2021 3:09:29 \u4e0b\u5348 com.zaxxer.hikari.HikariDataSource getConnection\n\u4fe1\u606f: HikariPool-1 - Starting...\n\u5341\u4e8c\u6708 08, 2021 3:09:29 \u4e0b\u5348 com.zaxxer.hikari.HikariDataSource getConnection\n\u4fe1\u606f: HikariPool-1 - Start completed.\nException in thread \"main\" java.lang.RuntimeException: \u6211\u662f\u6d4b\u8bd5\u5f02\u5e38\uff01\n    at com.test.service.TestServiceImpl.test(TestServiceImpl.java:22)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)\n    at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:388)\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:215)\n    at com.sun.proxy.$Proxy30.test(Unknown Source)\n    at com.test.Main.main(Main.java:17)\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u6574\u4e2a\u6808\u8ffd\u8e2a\u4fe1\u606f\u4e2d\u5305\u542b\u4e86\u5927\u91cfaop\u5305\u4e0b\u7684\u76f8\u5173\u5185\u5bb9\uff0c\u4e5f\u5c31\u5370\u8bc1\u4e86\uff0c\u5b83\u786e\u5b9e\u662f\u901a\u8fc7AOP\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770b\u4e00\u4e0b\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f\u5426\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff08\u51fa\u73b0\u5f02\u5e38\u56de\u6eda\u4e86\uff09</p> <p>\u7ed3\u679c\u663e\u800c\u6613\u89c1\uff0c\u786e\u5b9e\u88ab\u56de\u6eda\u4e86\uff0c\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u4efb\u4f55\u7684\u5185\u5bb9\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u7814\u7a76\u4e00\u4e0b<code>@Transactional</code>\u6ce8\u89e3\u7684\u4e00\u4e9b\u53c2\u6570\uff1a</p> <pre><code>@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(RetentionPolicy.RUNTIME)\n@Inherited\n@Documented\npublic @interface Transactional {\n    @AliasFor(\"transactionManager\")\n    String value() default \"\";\n\n    @AliasFor(\"value\")\n    String transactionManager() default \"\";\n\n    String[] label() default {};\n\n    Propagation propagation() default Propagation.REQUIRED;\n\n    Isolation isolation() default Isolation.DEFAULT;\n\n    int timeout() default -1;\n\n    String timeoutString() default \"\";\n\n    boolean readOnly() default false;\n\n    Class&lt;? extends Throwable&gt;[] rollbackFor() default {};\n\n    String[] rollbackForClassName() default {};\n\n    Class&lt;? extends Throwable&gt;[] noRollbackFor() default {};\n\n    String[] noRollbackForClassName() default {};\n}\n</code></pre> <p>\u6211\u4eec\u6765\u8bb2\u89e3\u51e0\u4e2a\u6bd4\u8f83\u5173\u952e\u7684\u4fe1\u606f\uff1a</p> <ul> <li>transactionManager\uff1a\u6307\u5b9a\u4e8b\u52a1\u7ba1\u7406\u5668</li> <li>propagation\uff1a\u4e8b\u52a1\u4f20\u64ad\u89c4\u5219\uff0c\u4e00\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u5305\u62ecN\u4e2a\u5b50\u4e8b\u52a1</li> <li>isolation\uff1a\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0c\u4e0d\u591a\u8bf4\u4e86</li> <li>timeout\uff1a\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4</li> <li>readOnly\uff1a\u662f\u5426\u4e3a\u53ea\u8bfb\u4e8b\u52a1\uff0c\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4f1a\u6839\u636e\u53ea\u8bfb\u5c5e\u6027\u8fdb\u884c\u4f18\u5316\uff0c\u6bd4\u5982MySQL\u4e00\u65e6\u58f0\u660e\u4e8b\u52a1\u4e3a\u53ea\u8bfb\uff0c\u90a3\u4e48\u4e45\u4e0d\u5141\u8bb8\u589e\u5220\u6539\u64cd\u4f5c\u4e86\u3002</li> <li>rollbackFor\u548cnoRollbackFor\uff1a\u53d1\u751f\u6307\u5b9a\u5f02\u5e38\u65f6\u56de\u6eda\u6216\u662f\u4e0d\u56de\u6eda\uff0c\u9ed8\u8ba4\u53d1\u751f\u4efb\u4f55\u5f02\u5e38\u90fd\u56de\u6eda</li> </ul> <p>\u9664\u4e86\u4e8b\u52a1\u7684\u4f20\u64ad\u89c4\u5219\uff0c\u5176\u4ed6\u7684\u5185\u5bb9\u5176\u5b9e\u5df2\u7ecf\u7ed9\u5927\u5bb6\u8bb2\u89e3\u8fc7\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u770b\u770b\u4e8b\u52a1\u7684\u4f20\u64ad\u3002\u4e8b\u52a1\u4f20\u64ad\u4e00\u5171\u6709\u4e03\u79cd\u7ea7\u522b\uff1a</p> <p></p> <p>Spring\u9ed8\u8ba4\u7684\u4f20\u64ad\u7ea7\u522b\u662f<code>PROPAGATION_REQUIRED</code>\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b\uff0c\u5b83\u662f\u5982\u4f55\u4f20\u64ad\u7684\uff0c\u73b0\u5728\u6211\u4eec\u7684<code>Service</code>\u7c7b\u4e2d\u4e00\u5171\u5b58\u5728\u4e24\u4e2a\u4e8b\u52a1\uff0c\u800c\u4e00\u4e2a\u4e8b\u52a1\u65b9\u6cd5\u5305\u542b\u4e86\u53e6\u4e00\u4e2a\u4e8b\u52a1\u65b9\u6cd5\uff1a</p> <pre><code>@Transactional\npublic void test() {\n    test2();\n    if(true) throw new RuntimeException(\"\u6211\u662f\u6d4b\u8bd5\u5f02\u5e38\uff01\");  //\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u4f1a\u56de\u6eda\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5417\uff1f\n}\n\n@Transactional\npublic void test2() {\n    mapper.insertStudent();\n}\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u5f97\u5230\u7ed3\u679c\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u88ab\u56de\u6eda\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u76f8\u5f53\u4e8e\u53e6\u4e00\u4e2a\u4e8b\u52a1\u76f4\u63a5\u52a0\u5165\u5230\u6b64\u4e8b\u52a1\u4e2d\u4e86\uff0c\u4e5f\u5c31\u662f\u8868\u4e2d\u6240\u63cf\u8ff0\u7684\u90a3\u6837\u3002</p> <p>\u5982\u679c\u5355\u72ec\u6267\u884c<code>test2()</code>\u5219\u4f1a\u5f00\u542f\u4e00\u4e2a\u65b0\u7684\u4e8b\u52a1\uff0c\u800c\u6267\u884c<code>test()</code>\u5219\u4f1a\u76f4\u63a5\u8ba9\u5185\u90e8\u7684<code>test2()</code>\u52a0\u5165\u5230\u5f53\u524d\u4e8b\u52a1\u4e2d\u3002</p> <pre><code>@Transactional\npublic void test() {\n    test2();\n}\n\n@Transactional(propagation = Propagation.SUPPORTS)\npublic void test2() {\n    mapper.insertStudent();\n    if(true) throw new RuntimeException(\"\u6211\u662f\u6d4b\u8bd5\u5f02\u5e38\uff01\");\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5c06<code>test2()</code>\u7684\u4f20\u64ad\u7ea7\u522b\u8bbe\u5b9a\u4e3a<code>SUPPORTS</code>\uff0c\u90a3\u4e48\u8fd9\u65f6\u5982\u679c\u5355\u72ec\u8c03\u7528<code>test2()</code>\u65b9\u6cd5\uff0c\u5e76\u4e0d\u4f1a\u4ee5\u4e8b\u52a1\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u5f53\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u867d\u7136\u4f9d\u7136\u5b58\u5728AOP\u589e\u5f3a\uff0c\u4f46\u662f\u4e0d\u4f1a\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\uff0c\u800c\u73b0\u5728\u518d\u8c03\u7528<code>test()</code>\u65b9\u6cd5\uff0c\u624d\u4f1a\u4ee5\u4e8b\u52a1\u7684\u65b9\u5f0f\u6267\u884c\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b<code>MANDATORY</code>\uff0c\u5b83\u975e\u5e38\u4e25\u683c\uff0c\u5982\u679c\u5f53\u524d\u65b9\u6cd5\u5e76\u6ca1\u6709\u5728\u4efb\u4f55\u4e8b\u52a1\u4e2d\u8fdb\u884c\uff0c\u4f1a\u76f4\u63a5\u51fa\u73b0\u5f02\u5e38\uff1a</p> <pre><code>@Transactional\npublic void test() {\n    test2();\n}\n\n@Transactional(propagation = Propagation.MANDATORY)\npublic void test2() {\n    mapper.insertStudent();\n    if(true) throw new RuntimeException(\"\u6211\u662f\u6d4b\u8bd5\u5f02\u5e38\uff01\");\n}\n</code></pre> <p>\u76f4\u63a5\u8fd0\u884c<code>test2()</code>\u65b9\u6cd5\uff0c\u62a5\u9519\u5982\u4e0b\uff1a</p> <pre><code>Exception in thread \"main\" org.springframework.transaction.IllegalTransactionStateException: No existing transaction found for transaction marked with propagation 'mandatory'\n    at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:362)\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:595)\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:382)\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:215)\n    at com.sun.proxy.$Proxy29.test2(Unknown Source)\n    at com.test.Main.main(Main.java:17)\n</code></pre> <p><code>NESTED</code>\u7ea7\u522b\u8868\u793a\u5982\u679c\u5b58\u5728\u5916\u5c42\u4e8b\u52a1\uff0c\u5219\u6b64\u65b9\u6cd5\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u5b50\u4e8b\u52a1\uff0c\u56de\u6eda\u53ea\u4f1a\u5f71\u54cd\u5230\u6b64\u5b50\u4e8b\u52a1\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5229\u7528\u521b\u5efaSavepoint\uff0c\u7136\u540e\u56de\u6eda\u5230\u6b64\u4fdd\u5b58\u70b9\u5b9e\u73b0\u7684\u3002<code>NEVER</code>\u7ea7\u522b\u8868\u793a\u6b64\u65b9\u6cd5\u4e0d\u5e94\u8be5\u52a0\u5165\u5230\u4efb\u4f55\u4e8b\u52a1\u4e2d\uff0c\u5176\u4f59\u7c7b\u578b\u9002\u7528\u4e8e\u540c\u65f6\u64cd\u4f5c\u591a\u6570\u636e\u6e90\u60c5\u51b5\u4e0b\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7ba1\u7406\uff0c\u8fd9\u91cc\u6682\u65f6\u4e0d\u505a\u4ecb\u7ecd\u3002</p> <p>\u81f3\u6b64\uff0c\u6709\u5173Spring\u7684\u6838\u5fc3\u5185\u5bb9\u5c31\u8bb2\u89e3\u5b8c\u6bd5\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#junit","title":"\u96c6\u6210JUnit\u6d4b\u8bd5","text":"<p>\u65e2\u7136\u4f7f\u7528\u4e86Spring\uff0c\u90a3\u4e48\u600e\u4e48\u96c6\u6210\u5230JUnit\u4e2d\u8fdb\u884c\u6d4b\u8bd5\u5462\uff0c\u9996\u5148\u5927\u5bb6\u80fd\u591f\u60f3\u5230\u7684\u80af\u5b9a\u662f\uff1a</p> <pre><code>public class TestMain {\n\n    @Test\n    public void test(){\n        ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n        TestService service = context.getBean(TestService.class);\n        service.test();\n    }\n}\n</code></pre> <p>\u76f4\u63a5\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u5373\u53ef\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u6211\u4eec\u6709\u5f88\u591a\u4e2a\u6d4b\u8bd5\u7528\u4f8b\uff0c\u90a3\u4e48\u6211\u4eec\u4e0d\u53ef\u80fd\u6bcf\u6b21\u6d4b\u8bd5\u90fd\u53bb\u521b\u5efaApplicationContext\u5427\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>@Before</code>\u6dfb\u52a0\u4e00\u4e2a\u6d4b\u8bd5\u524d\u52a8\u4f5c\u6765\u63d0\u524d\u914d\u7f6eApplicationContext\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u8fd8\u662f\u4e0d\u591f\u7b80\u4fbf\uff0c\u80fd\u4e0d\u80fd\u6709\u66f4\u5feb\u901f\u9ad8\u6548\u7684\u65b9\u6cd5\u5462\uff1f</p> <p>Spring\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2aTest\u6a21\u5757\uff0c\u5b83\u4f1a\u81ea\u52a8\u96c6\u6210Junit\u8fdb\u884c\u6d4b\u8bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5bfc\u5165\u4e00\u4e0b\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n    &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;\n    &lt;version&gt;5.8.1&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;\n    &lt;version&gt;5.3.12&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u8fd9\u91cc\u5bfc\u5165\u7684\u662fJUnit5\u548cSpringTest\u6a21\u5757\u4f9d\u8d56\uff0c\u7136\u540e\u76f4\u63a5\u5728\u6211\u4eec\u7684\u6d4b\u8bd5\u7c7b\u4e0a\u6dfb\u52a0\u4e24\u4e2a\u6ce8\u89e3\u5c31\u53ef\u4ee5\u641e\u5b9a\uff1a</p> <pre><code>@ExtendWith(SpringExtension.class)\n@ContextConfiguration(classes = TestConfiguration.class)\npublic class TestMain {\n\n    @Autowired\n    TestService service;\n\n    @Test\n    public void test(){\n        service.test();\n    }\n}\n</code></pre> <p><code>@ExtendWith</code>\u662f\u7531JUnit\u63d0\u4f9b\u7684\u6ce8\u89e3\uff0c\u7b49\u540c\u4e8e\u65e7\u7248\u672c\u7684<code>@RunWith</code>\u6ce8\u89e3\uff0c\u7136\u540e\u4f7f\u7528SpringTest\u6a21\u5757\u63d0\u4f9b\u7684<code>@ContextConfiguration</code>\u6ce8\u89e3\u6765\u8868\u793a\u8981\u52a0\u8f7d\u54ea\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u662fXML\u6587\u4ef6\u4e5f\u53ef\u4ee5\u662f\u7c7b\uff0c\u6211\u4eec\u8fd9\u91cc\u5c31\u76f4\u63a5\u4f7f\u7528\u7c7b\u8fdb\u884c\u52a0\u8f7d\u3002</p> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>@Autowired</code>\u6765\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\uff0c\u5e76\u4e14\u76f4\u63a5\u5728\u6d4b\u8bd5\u65b9\u6cd5\u4e2d\u4f7f\u7528\u6ce8\u5165\u7684Bean\uff0c\u73b0\u5728\u5c31\u975e\u5e38\u65b9\u4fbf\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#spring_3","title":"\u63a2\u7a76Spring\u539f\u7406","text":"<p>\u6ce8\u610f\uff1a\u672c\u7248\u5757\u96be\u5ea6\u5f88\u5927\uff0c\u4f5c\u4e3a\u9009\u5b66\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u5b66\u4e60Spring\u57fa\u672c\u5185\u5bb9\u5bf9\u4f60\u6765\u8bf4\u5df2\u7ecf\u975e\u5e38\u56f0\u96be\u4e86\uff0c\u5efa\u8bae\u8df3\u8fc7\u6b64\u5c0f\u8282\uff0c\u76f4\u63a5\u8fdb\u5165MVC\u9636\u6bb5\u7684\u5b66\u4e60\uff0c\u6b64\u5c0f\u8282\u4f1a\u4ece\u6e90\u7801\u89d2\u5ea6\u89e3\u91caSpring\u7684\u6574\u4e2a\u8fd0\u884c\u539f\u7406\uff0c\u5bf9\u521d\u5b66\u8005\u6765\u8bf4\u7b49\u540c\u4e8e\u5c0f\u5b66\u8de8\u8d8a\u5230\u9ad8\u4e2d\uff0c\u5b83\u5e76\u4e0d\u662f\u5fc5\u5b66\u5185\u5bb9\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e2a\u4eba\u5f00\u53d1\u80fd\u529b\u7684\u63d0\u5347\u6781\u4e3a\u91cd\u8981\uff08\u63a8\u8350\u5b8c\u6210\u6574\u4e2aSSM\u9636\u6bb5\u7684\u5b66\u4e60\u5e76\u4e14\u52a0\u4ee5\u5b9e\u6218\u4e4b\u540e\u518d\u6765\u770b\u6b64\u90e8\u5206\uff09\uff0c\u5982\u679c\u4f60\u8fd8\u662f\u89c9\u5f97\u81ea\u5df1\u80fd\u591f\u8ddf\u4e0a\u8282\u594f\u7ee7\u7eed\u6df1\u5165\u94bb\u7814\u5e95\u5c42\u539f\u7406\uff0c\u90a3\u4e48\u73b0\u5728\u5c31\u5f00\u59cb\u5427\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#ioc_2","title":"\u63a2\u7a76IoC\u539f\u7406","text":"<p>\u9996\u5148\u6211\u4eec\u5927\u81f4\u4e86\u89e3\u4e00\u4e0bApplicationContext\u7684\u52a0\u8f7d\u6d41\u7a0b\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u8fc7\u7a0b\u6781\u4e3a\u590d\u6742\uff0c\u4e00\u53e5\u8bdd\u80af\u5b9a\u662f\u65e0\u6cd5\u89e3\u91ca\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u4ece<code>ApplicationContext</code>\u8bf4\u8d77\u5427\u3002</p> <p>\u7531\u4e8eSpring\u7684\u6e90\u7801\u6781\u4e3a\u590d\u6742\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u53ef\u80fd\u518d\u50cf\u4e86\u89e3\u5176\u4ed6\u6846\u67b6\u90a3\u6837\u76f4\u63a5\u81ea\u5e95\u5411\u4e0a\u9010\u884c\u5e72\u6e90\u7801\u4e86\uff08\u53ef\u4ee5\u81ea\u5df1\u70b9\u5f00\u770b\u770b\uff0c\u4ee3\u7801\u91cf\u975e\u5e38\u4e4b\u591a\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4ece\u4e00\u4e9b\u6700\u57fa\u672c\u7684\u63a5\u53e3\u5b9a\u4e49\u5f00\u59cb\u8bb2\u8d77\uff0c\u81ea\u9876\u5411\u4e0b\u9010\u6b65\u74e6\u89e3\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b<code>ApplicationContext</code>\u6700\u9876\u5c42\u63a5\u53e3\u662f\u4ec0\u4e48\uff0c\u4e00\u76f4\u5f80\u4e0a\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u6709\u4e00\u4e2a<code>AbstractApplicationContext</code>\u7c7b\uff0c\u6211\u4eec\u76f4\u63a5\u53f3\u952e\u751f\u6210\u4e00\u4e2aUML\u7c7b\u56fe\u67e5\u770b\uff1a</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u6700\u9876\u5c42\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aBeanFactory\u63a5\u53e3\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4ece\u8fd9\u4e2a\u63a5\u53e3\u5f00\u59cb\u7814\u7a76\u8d77\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u63a5\u53e3\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u7684\u884c\u4e3a\uff1a</p> <pre><code>public interface BeanFactory {\n    String FACTORY_BEAN_PREFIX = \"&amp;\";\n\n    Object getBean(String var1) throws BeansException;\n\n    &lt;T&gt; T getBean(String var1, Class&lt;T&gt; var2) throws BeansException;\n\n    Object getBean(String var1, Object... var2) throws BeansException;\n\n    &lt;T&gt; T getBean(Class&lt;T&gt; var1) throws BeansException;\n\n    &lt;T&gt; T getBean(Class&lt;T&gt; var1, Object... var2) throws BeansException;\n\n    &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(Class&lt;T&gt; var1);\n\n    &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(ResolvableType var1);\n\n    boolean containsBean(String var1);\n\n    boolean isSingleton(String var1) throws NoSuchBeanDefinitionException;\n\n    boolean isPrototype(String var1) throws NoSuchBeanDefinitionException;\n\n    boolean isTypeMatch(String var1, ResolvableType var2) throws NoSuchBeanDefinitionException;\n\n    boolean isTypeMatch(String var1, Class&lt;?&gt; var2) throws NoSuchBeanDefinitionException;\n\n    @Nullable\n    Class&lt;?&gt; getType(String var1) throws NoSuchBeanDefinitionException;\n\n    @Nullable\n    Class&lt;?&gt; getType(String var1, boolean var2) throws NoSuchBeanDefinitionException;\n\n    String[] getAliases(String var1);\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5176\u4e2d\u6700\u773c\u719f\u7684\u5c31\u662f<code>getBean()</code>\u65b9\u6cd5\u4e86\uff0c\u6b64\u65b9\u6cd5\u88ab\u91cd\u8f7d\u4e86\u5f88\u591a\u6b21\uff0c\u53ef\u4ee5\u63a5\u53d7\u591a\u79cd\u53c2\u6570\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u65ad\u5b9a\uff0c\u4e00\u4e2aIoC\u5bb9\u5668\u6700\u57fa\u672c\u7684\u884c\u4e3a\u5728\u6b64\u63a5\u53e3\u4e2d\u5df2\u7ecf\u88ab\u5b9a\u4e49\u597d\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u7684BeanFactory\u5b9e\u73b0\u7c7b\u90fd\u5e94\u8be5\u5177\u5907\u5bb9\u5668\u7ba1\u7406Bean\u7684\u57fa\u672c\u80fd\u529b\uff0c\u5c31\u50cf\u5b83\u7684\u540d\u5b57\u4e00\u6837\uff0c\u5b83\u5c31\u662f\u4e00\u4e2aBean\u5de5\u5382\uff0c\u5de5\u5382\u5c31\u662f\u7528\u6765\u751f\u4ea7Bean\u5b9e\u4f8b\u5bf9\u8c61\u7684\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u627e\u5230\u6b64\u63a5\u53e3\u7684\u4e00\u4e2a\u62bd\u8c61\u5b9e\u73b0<code>AbstractBeanFactory</code>\u7c7b\uff0c\u5b83\u5b9e\u73b0\u4e86<code>getBean()</code>\u65b9\u6cd5\uff1a</p> <pre><code>public Object getBean(String name) throws BeansException {\n    return this.doGetBean(name, (Class)null, (Object[])null, false);\n}\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec<code>doGetBean()</code>\u63a5\u7740\u6765\u770b\u65b9\u6cd5\u91cc\u9762\u5e72\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>protected &lt;T&gt; T doGetBean(String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, boolean typeCheckOnly) throws BeansException {\n    String beanName = this.transformedBeanName(name);\n    Object sharedInstance = this.getSingleton(beanName);\n    Object beanInstance;\n    if (sharedInstance != null &amp;&amp; args == null) {\n      ...\n</code></pre> <p>\u56e0\u4e3a\u6240\u6709\u7684Bean\u9ed8\u8ba4\u90fd\u662f\u5355\u4f8b\u6a21\u5f0f\uff0c\u5bf9\u8c61\u53ea\u4f1a\u5b58\u5728\u4e00\u4e2a\uff0c\u56e0\u6b64\u5b83\u4f1a\u5148\u8c03\u7528\u7236\u7c7b\u7684<code>getSingleton()</code>\u65b9\u6cd5\u6765\u76f4\u63a5\u83b7\u53d6\u5355\u4f8b\u5bf9\u8c61\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u62ff\u5230Bean\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u6ca1\u6709\u4f1a\u8fdb\u5165else\u4ee3\u7801\u5757\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u9996\u5148\u4f1a\u8fdb\u884c\u4e00\u4e2a\u5224\u65ad\uff1a</p> <pre><code>if (this.isPrototypeCurrentlyInCreation(beanName)) {\n    throw new BeanCurrentlyInCreationException(beanName);\n}\n</code></pre> <p>\u8fd9\u662f\u4e3a\u4e86\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u8fdb\u884c\u7684\u5904\u7406\uff0c\u6bd4\u5982A\u548cB\u90fd\u662f\u4ee5\u539f\u578b\u6a21\u5f0f\u8fdb\u884c\u521b\u5efa\uff0c\u800cA\u4e2d\u9700\u8981\u6ce8\u5165B\uff0cB\u4e2d\u9700\u8981\u6ce8\u5165A\uff0c\u8fd9\u65f6\u5c31\u4f1a\u51fa\u73b0A\u8fd8\u672a\u521b\u5efa\u5b8c\u6210\uff0c\u5c31\u9700\u8981B\uff0c\u800cB\u8fd9\u65f6\u4e5f\u6ca1\u521b\u5efa\u5b8c\u6210\uff0c\u56e0\u4e3aB\u9700\u8981A\uff0c\u800cA\u7b49\u7740B\uff0c\u8fd9\u6837\u5c31\u53ea\u80fd\u65e0\u9650\u5faa\u73af\u4e0b\u53bb\u4e86\uff0c\u6240\u4ee5\u5c31\u51fa\u73b0\u4e86\u5faa\u73af\u4f9d\u8d56\u7684\u95ee\u9898\uff08\u540c\u7406\uff0c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u591a\u4e2a\u5bf9\u8c61\u4e5f\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff09\u4f46\u662f\u5728\u5355\u4f8b\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u6bcf\u4e2aBean\u53ea\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\uff0cSpring\u5b8c\u5168\u6709\u673a\u4f1a\u5904\u7406\u597d\u5faa\u73af\u4f9d\u8d56\u7684\u95ee\u9898\uff0c\u53ea\u9700\u8981\u4e00\u4e2a\u6b63\u786e\u7684\u8d4b\u503c\u64cd\u4f5c\u5b9e\u73b0\u5faa\u73af\u5373\u53ef\u3002\u90a3\u4e48\u5355\u4f8b\u6a21\u5f0f\u4e0b\u662f\u5982\u4f55\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u95ee\u9898\u7684\u5462\uff1f</p> <p></p> <p>\u6211\u4eec\u56de\u5230<code>getSingleton()</code>\u65b9\u6cd5\u4e2d\uff0c\u5355\u4f8b\u6a21\u5f0f\u662f\u53ef\u4ee5\u81ea\u52a8\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u95ee\u9898\u7684\uff1a</p> <pre><code>@Nullable\nprotected Object getSingleton(String beanName, boolean allowEarlyReference) {\n    Object singletonObject = this.singletonObjects.get(beanName);\n    //\u5148\u4ece\u7b2c\u4e00\u5c42\u5217\u8868\u4e2d\u62ffBean\u5b9e\u4f8b\uff0c\u62ff\u5230\u76f4\u63a5\u8fd4\u56de\n    if (singletonObject == null &amp;&amp; this.isSingletonCurrentlyInCreation(beanName)) {\n        //\u7b2c\u4e00\u5c42\u62ff\u4e0d\u5230\uff0c\u5e76\u4e14\u5df2\u7ecf\u8ba4\u5b9a\u4e3a\u5904\u4e8e\u5faa\u73af\u72b6\u6001\uff0c\u770b\u770b\u7b2c\u4e8c\u5c42\u6709\u6ca1\u6709\n        singletonObject = this.earlySingletonObjects.get(beanName);\n        if (singletonObject == null &amp;&amp; allowEarlyReference) {\n            synchronized(this.singletonObjects) {\n                //\u52a0\u9501\u518d\u6267\u884c\u4e00\u6b21\u4e0a\u8ff0\u6d41\u7a0b\n                singletonObject = this.singletonObjects.get(beanName);\n                if (singletonObject == null) {\n                    singletonObject = this.earlySingletonObjects.get(beanName);\n                    if (singletonObject == null) {\n                        //\u4ecd\u7136\u6ca1\u6709\u83b7\u53d6\u5230\u5b9e\u4f8b\uff0c\u53ea\u80fd\u4ecesingletonFactory\u4e2d\u83b7\u53d6\u4e86\n                        ObjectFactory&lt;?&gt; singletonFactory = (ObjectFactory)this.singletonFactories.get(beanName);\n                        if (singletonFactory != null) {\n                            singletonObject = singletonFactory.getObject();\n                            //\u4e22\u8fdbearlySingletonObjects\u4e2d\uff0c\u4e0b\u6b21\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u7b2c\u4e8c\u5c42\u62ff\u5230\u4e86\n                            this.earlySingletonObjects.put(beanName, singletonObject);\n                            this.singletonFactories.remove(beanName);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    return singletonObject;\n}\n</code></pre> <p>\u770b\u8d77\u6765\u5f88\u590d\u6742\uff0c\u5b9e\u9645\u4e0a\u5b83\u4f7f\u7528\u4e86\u4e09\u5c42\u5217\u8868\u7684\u65b9\u5f0f\u6765\u5904\u7406\u5faa\u73af\u4f9d\u8d56\u7684\u95ee\u9898\u3002\u5305\u62ec\uff1a</p> <ul> <li>singletonObjects</li> <li>earlySingletonObjects</li> <li>singletonFactories</li> </ul> <p>\u5f53\u7b2c\u4e00\u5c42\u62ff\u4e0d\u5230\u65f6\uff0c\u4f1a\u63a5\u7740\u5224\u65ad\u8fd9\u4e2aBean\u662f\u5426\u5904\u4e8e\u521b\u5efa\u72b6\u6001<code>isSingletonCurrentlyInCreation()</code>\uff0c\u5b83\u4f1a\u4ece\u4e00\u4e2aSet\u96c6\u5408\u4e2d\u67e5\u8be2\uff0c\u8fd9\u4e2a\u96c6\u5408\u4e2d\u5b58\u50a8\u4e86\u5df2\u7ecf\u521b\u5efa\u4f46\u8fd8\u672a\u6ce8\u5165\u5c5e\u6027\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\u5904\u4e8e\u6b63\u5728\u521b\u5efa\u72b6\u6001\uff0c\u5982\u679c\u8bf4\u53d1\u73b0\u6b64Bean\u5904\u4e8e\u6b63\u5728\u521b\u5efa\u72b6\u6001\uff08\u4e00\u5b9a\u662f\u56e0\u4e3a\u67d0\u4e2aBean\u9700\u8981\u6ce8\u5165\u8fd9\u4e2aBean\u7684\u5b9e\u4f8b\uff09\uff0c\u5c31\u53ef\u4ee5\u65ad\u5b9a\u5b83\u5e94\u8be5\u662f\u51fa\u73b0\u4e86\u5faa\u73af\u4f9d\u8d56\u7684\u60c5\u51b5\u3002</p> <p>earlySingletonObjects\u76f8\u5f53\u4e8e\u662f\u4e13\u95e8\u5904\u7406\u5faa\u73af\u4f9d\u8d56\u7684\u8868\uff0c\u4e00\u822c\u5305\u542bsingletonObjects\u4e2d\u7684\u5168\u90e8\u5b9e\u4f8b\uff0c\u5982\u679c\u8fd9\u4e2a\u91cc\u9762\u8fd8\u662f\u6ca1\u6709\uff0c\u63a5\u7740\u5f80\u4e0b\u8d70\uff0c\u8fd9\u65f6\u4f1a\u4ecesingletonFactories\u4e2d\u83b7\u53d6\uff08\u6240\u6709\u7684Bean\u521d\u59cb\u5316\u5b8c\u6210\u4e4b\u540e\u90fd\u4f1a\u88ab\u4e22\u8fdbsingletonFactories\uff0c\u4e5f\u5c31\u662f\u53ea\u521b\u5efa\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\u7684\u65f6\u5019\uff09\u5728\u83b7\u53d6\u5230\u540e\uff0c\u5411earlySingletonObjects\u4e2d\u4e22\u5165\u6b64Bean\u7684\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5b9e\u4f8b\u4ecesingletonFactories\u4e2d\u79fb\u9664\u3002</p> <p>\u6211\u4eec\u6700\u540e\u518d\u6765\u68b3\u7406\u4e00\u4e0b\u6d41\u7a0b\uff0c\u8fd8\u662f\u7528\u6211\u4eec\u521a\u624d\u7684\u4f8b\u5b50\uff0cA\u4f9d\u8d56\u4e8eB\uff0cB\u4f9d\u8d56\u4e8eA\uff1a</p> <ol> <li>\u5047\u5982A\u5148\u8f7d\u5165\uff0c\u90a3\u4e48A\u9996\u5148\u8fdb\u5165\u4e86singletonFactories\u4e2d\uff0c\u6ce8\u610f\u8fd9\u65f6\u8fd8\u6ca1\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\uff0cA\u4e2d\u7684B\u8fd8\u662fnull</li> <li>singletonFactories\uff1aA</li> <li>earlySingletonObjects\uff1a</li> <li>singletonObjects\uff1a</li> <li>\u63a5\u7740\u80af\u5b9a\u662f\u6ce8\u5165A\u7684\u4f9d\u8d56B\u4e86\uff0c\u4f46\u662fB\u8fd8\u6ca1\u521d\u59cb\u5316\uff0c\u56e0\u6b64\u73b0\u5728\u5148\u628aB\u7ed9\u8f7d\u5165\u4e86\uff0cB\u6784\u9020\u5b8c\u6210\u540e\u4e5f\u8fdb\u4e86singletonFactories</li> <li>singletonFactories\uff1aA\uff0cB</li> <li>earlySingletonObjects\uff1a</li> <li>singletonObjects\uff1a</li> <li>\u5f00\u59cb\u4e3aB\u6ce8\u5165\u4f9d\u8d56\uff0c\u53d1\u73b0B\u4f9d\u8d56\u4e8eA\uff0c\u8fd9\u65f6\u53c8\u5f97\u53bb\u83b7\u53d6A\u7684\u5b9e\u4f8b\uff0c\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u8fd9\u65f6\u5019A\u8fd8\u5728singletonFactories\u4e2d\uff0c\u90a3\u4e48\u5b83\u4f1a\u88ab\u4e22\u8fdbearlySingletonObjects\uff0c\u7136\u540e\u4ecesingletonFactories\u4e2d\u79fb\u9664\uff0c\u7136\u540e\u8fd4\u56deA\u7684\u5b9e\u4f8b\uff08\u6ce8\u610f\u6b64\u65f6A\u4e2d\u7684B\u4f9d\u8d56\u8fd8\u662fnull\uff09</li> <li>singletonFactories\uff1aB</li> <li>earlySingletonObjects\uff1aA</li> <li>singletonObjects\uff1a</li> <li>\u8fd9\u65f6B\u5df2\u7ecf\u5b8c\u6210\u4f9d\u8d56\u6ce8\u5165\u4e86\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u4e22\u8fdbsingletonObjects\u4e2d</li> <li>singletonFactories\uff1a</li> <li>earlySingletonObjects\uff1aA</li> <li>singletonObjects\uff1aB</li> <li>\u7136\u540e\u518d\u5c06B\u6ce8\u5165\u5230A\u4e2d\uff0c\u5b8c\u6210A\u7684\u4f9d\u8d56\u6ce8\u5165\uff0cA\u4e5f\u88ab\u4e22\u8fdbsingletonObjects\u4e2d\uff0c\u81f3\u6b64\u5faa\u73af\u4f9d\u8d56\u5b8c\u6210\uff0cA\u548cB\u5b8c\u6210\u5b9e\u4f8b\u521b\u5efa</li> <li>singletonFactories\uff1a</li> <li>earlySingletonObjects\uff1a</li> <li>singletonObjects\uff1aA\uff0cB</li> </ol> <p>\u7ecf\u8fc7\u6574\u4f53\u8fc7\u7a0b\u68b3\u7406\uff0c\u5173\u4e8eSpring\u5982\u4f55\u89e3\u51b3\u5355\u4f8b\u6a21\u5f0f\u7684\u5faa\u73af\u4f9d\u8d56\u7406\u89e3\u8d77\u6765\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002</p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u56de\u5230\u4e4b\u524d\u7684\u5730\u65b9\uff0c\u539f\u578b\u6a21\u5f0f\u4e0b\u5982\u679c\u51fa\u73b0\u5faa\u73af\u4f9d\u8d56\u4f1a\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u4f1a\u63a5\u7740\u5411\u4e0b\uff1a</p> <pre><code>//BeanFactory\u5b58\u5728\u7236\u5b50\u5173\u7cfb\nBeanFactory parentBeanFactory = this.getParentBeanFactory();\n//\u5982\u679c\u5b58\u5728\u7236BeanFactory\uff0c\u540c\u65f6\u5f53\u524dBeanFactory\u6ca1\u6709\u8fd9\u4e2aBean\u7684\u5b9a\u4e49\nif (parentBeanFactory != null &amp;&amp; !this.containsBeanDefinition(beanName)) {\n    //\u8fd9\u91cc\u662f\u56e0\u4e3aBean\u53ef\u80fd\u6709\u522b\u540d\uff0c\u627e\u6700\u539f\u59cb\u7684\u90a3\u4e2a\u540d\u79f0\n    String nameToLookup = this.originalBeanName(name);\n    if (parentBeanFactory instanceof AbstractBeanFactory) {\n        //\u5411\u7236BeanFactory\u9012\u5f52\u67e5\u627e\n        return ((AbstractBeanFactory)parentBeanFactory).doGetBean(nameToLookup, requiredType, args, typeCheckOnly);\n    }\n\n    if (args != null) {\n        //\u6839\u636e\u53c2\u6570\u67e5\u627e\n        return parentBeanFactory.getBean(nameToLookup, args);\n    }\n\n    if (requiredType != null) {\n        //\u6839\u636e\u7c7b\u578b\u67e5\u627e\n        return parentBeanFactory.getBean(nameToLookup, requiredType);\n    }\n\n    //\u5404\u79cd\u627e\n    return parentBeanFactory.getBean(nameToLookup);\n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cBeanFactory\u4f1a\u5148\u770b\u5f53\u524d\u662f\u5426\u5b58\u5728Bean\u7684\u5b9a\u4e49\uff0c\u5982\u679c\u6ca1\u6709\u4f1a\u76f4\u63a5\u7528\u7236BeanFactory\u5404\u79cd\u627e\u3002\u8fd9\u91cc\u51fa\u73b0\u4e86\u4e00\u4e2a\u65b0\u7684\u63a5\u53e3<code>BeanDefinition</code>\uff0c\u65e2\u7136\u5de5\u5382\u9700\u8981\u751f\u4ea7\u5546\u54c1\uff0c\u90a3\u4e48\u80af\u5b9a\u9700\u8981\u62ff\u5230\u5546\u54c1\u7684\u539f\u6750\u6599\u4ee5\u53ca\u5236\u4f5c\u914d\u65b9\uff0c\u6211\u4eec\u7684Bean\u4e5f\u662f\u8fd9\u6837\uff0cBean\u5de5\u5382\u9700\u8981\u62ff\u5230Bean\u7684\u4fe1\u606f\u624d\u53ef\u4ee5\u53bb\u751f\u6210\u8fd9\u4e2aBean\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u800c<code>BeanDefinition</code>\u5c31\u662f\u7528\u4e8e\u5b58\u653eBean\u7684\u4fe1\u606f\u7684\uff0c\u6240\u6709\u7684Bean\u4fe1\u606f\u6b63\u662f\u4eceXML\u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6\u6216\u662f\u6ce8\u89e3\u626b\u63cf\u540e\u5f97\u5230\u7684\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u5982\u679c\u6b64BeanFactory\u4e0d\u5b58\u5728\u7236BeanFactory\u6216\u662f\u5305\u542b\u4e86Bean\u7684\u5b9a\u4e49\uff0c\u90a3\u4e48\u4f1a\u63a5\u7740\u5f80\u4e0b\u8d70\uff0c\u8fd9\u65f6\u53ea\u80fd\u81ea\u5df1\u521b\u5efaBean\u4e86\uff0c\u9996\u5148\u4f1a\u62ff\u5230\u4e00\u4e2a<code>RootBeanDefinition</code>\u5bf9\u8c61\uff1a</p> <pre><code>try {\n    if (requiredType != null) {\n        beanCreation.tag(\"beanType\", requiredType::toString);\n    }\n\n    RootBeanDefinition mbd = this.getMergedLocalBeanDefinition(beanName);\n</code></pre> <p>\u4e0b\u9762\u7684\u5185\u5bb9\u5c31\u975e\u5e38\u590d\u6742\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5b83\u4e00\u5b9a\u662f\u6839\u636e\u5bf9\u5e94\u7684\u7c7b\u578b\uff08\u5355\u4f8b\u3001\u539f\u578b\uff09\u8fdb\u884c\u4e86\u5bf9\u5e94\u7684\u5904\u7406\uff0c\u6700\u540e\u81ea\u884c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u8fd4\u56de\u3002\u4e00\u4e2aBean\u7684\u52a0\u8f7d\u6d41\u7a0b\u4e3a\uff1a</p> <p>\u9996\u5148\u62ff\u5230<code>BeanDefinition</code>\u5b9a\u4e49\uff0c\u9009\u62e9\u5bf9\u5e94\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u901a\u8fc7\u53cd\u5c04\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u7136\u540e\u8fdb\u884c\u5c5e\u6027\u586b\u5145\uff08\u4f9d\u8d56\u6ce8\u5165\uff09\uff0c\u5b8c\u6210\u4e4b\u540e\u518d\u8c03\u7528\u521d\u59cb\u5316\u65b9\u6cd5\uff08init-method\uff09\uff0c\u6700\u540e\u5982\u679c\u5b58\u5728AOP\uff0c\u5219\u4f1a\u751f\u6210\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u6700\u540e\u8fd4\u56de\u7684\u624d\u662f\u6211\u4eec\u771f\u6b63\u5f97\u5230\u7684Bean\u5bf9\u8c61\u3002</p> <p>\u6700\u540e\u8ba9\u6211\u4eec\u56de\u5230<code>ApplicationContext</code>\u4e2d\uff0c\u5b9e\u9645\u4e0a\uff0c\u5b83\u5c31\u662f\u4e00\u4e2a\u5f3a\u5316\u7248\u7684<code>BeanFactory</code>\uff0c\u5728\u6700\u57fa\u672c\u7684Bean\u7ba1\u7406\u57fa\u7840\u4e0a\uff0c\u8fd8\u6dfb\u52a0\u4e86\uff1a</p> <ul> <li>\u56fd\u9645\u5316\uff08MessageSource\uff09</li> <li>\u8bbf\u95ee\u8d44\u6e90\uff0c\u5982URL\u548c\u6587\u4ef6\uff08ResourceLoader\uff09</li> <li>\u8f7d\u5165\u591a\u4e2a\uff08\u6709\u7ee7\u627f\u5173\u7cfb\uff09\u4e0a\u4e0b\u6587 </li> <li>\u6d88\u606f\u53d1\u9001\u3001\u54cd\u5e94\u673a\u5236\uff08ApplicationEventPublisher\uff09</li> <li>AOP\u673a\u5236</li> </ul> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u65e0\u8bba\u662f\u8fd8\u662f\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u90fd\u4f1a\u8c03\u7528<code>refresh()</code>\u65b9\u6cd5\u6765\u5237\u65b0\u5e94\u7528\u7a0b\u5e8f\u4e0a\u4e0b\u6587\uff1a</p> <pre><code>public AnnotationConfigApplicationContext(Class&lt;?&gt;... componentClasses) {\n    this();\n    this.register(componentClasses);\n    this.refresh();\n}\n</code></pre> <p>\u6b64\u65b9\u6cd5\u5728\u8bb2\u89e3\u5b8cAOP\u539f\u7406\u4e4b\u540e\uff0c\u518d\u8fdb\u884c\u8bb2\u89e3\u3002\u7efc\u4e0a\uff0c\u6709\u5173IoC\u5bb9\u5668\u7684\u5927\u90e8\u5206\u539f\u7406\u5c31\u8bb2\u89e3\u5b8c\u6bd5\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#aop_3","title":"\u63a2\u7a76AOP\u539f\u7406","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\u4e86<code>PostProcessor</code>\uff0c\u5b83\u5176\u5b9e\u662fSpring\u63d0\u4f9b\u7684\u4e00\u79cd\u540e\u7f6e\u5904\u7406\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u8ba9\u6211\u4eec\u80fd\u591f\u63d2\u624bBean\u3001BeanFactory\u3001BeanDefinition\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u76f8\u5f53\u4e8e\u8fdb\u884c\u4e00\u4e2a\u6700\u7ec8\u7684\u5904\u7406\uff0c\u800c\u6700\u540e\u5f97\u5230\u7684\u7ed3\u679c\uff08\u6bd4\u5982Bean\u5b9e\u4f8b\u3001Bean\u5b9a\u4e49\u7b49\uff09\u5c31\u662f\u7ecf\u8fc7\u540e\u7f6e\u5904\u7406\u5668\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u5b83\u662f\u6574\u4e2a\u52a0\u8f7d\u8fc7\u7a0b\u7684\u6700\u540e\u4e00\u6b65\u3002</p> <p>\u800cAOP\u673a\u5236\u6b63\u662f\u901a\u8fc7\u5b83\u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u9996\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0b\u7b2c\u4e00\u4e2a\u63a5\u53e3<code>BeanPostProcessor</code>\uff0c\u5b83\u76f8\u5f53\u4e8eBean\u521d\u59cb\u5316\u7684\u4e00\u4e2a\u540e\u7f6e\u52a8\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5b9e\u73b0\u6b64\u63a5\u53e3\uff1a</p> <pre><code>//\u6ce8\u610f\u5b83\u540e\u7f6e\u5904\u7406\u5668\u4e5f\u8981\u8fdb\u884c\u6ce8\u518c\n@Component\npublic class TestBeanProcessor implements BeanPostProcessor {\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        System.out.println(beanName);  //\u6253\u5370bean\u7684\u540d\u79f0\n        return bean;\n    }\n\n    @Override\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        return BeanPostProcessor.super.postProcessBeforeInitialization(bean, beanName);\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u6b64\u63a5\u53e3\u4e2d\u5305\u62ec\u4e24\u4e2a\u65b9\u6cd5\uff0c\u4e00\u4e2a\u662f<code>postProcessAfterInitialization</code>\u7528\u4e8e\u5728Bean\u521d\u59cb\u5316\u4e4b\u540e\u8fdb\u884c\u5904\u7406\uff0c\u8fd8\u6709\u4e00\u4e2a<code>postProcessBeforeInitialization</code>\u7528\u4e8e\u5728Bean\u521d\u59cb\u5316\u4e4b\u524d\u8fdb\u884c\u5904\u7406\uff0c\u6ce8\u610f\u8fd9\u91cc\u7684\u521d\u59cb\u5316\u4e0d\u662f\u521b\u5efa\u5bf9\u8c61\uff0c\u800c\u662f\u8c03\u7528\u7c7b\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@Component\npublic class TestBeanProcessor implements BeanPostProcessor {\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        System.out.println(\"\u6211\u662f\u4e4b\u540e\uff1a\"+beanName);\n        return bean;   //\u8fd9\u91cc\u8fd4\u56de\u7684Bean\u76f8\u5f53\u4e8e\u6700\u7ec8\u7684\u7ed3\u679c\u4e86\uff0c\u6211\u4eec\u4f9d\u7136\u80fd\u591f\u63d2\u624b\u4fee\u6539\uff0c\u8fd9\u91cc\u8fd4\u56de\u4e4b\u540e\u662f\u4ec0\u4e48\u5c31\u662f\u4ec0\u4e48\u4e86\n    }\n\n    @Override\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        System.out.println(\"\u6211\u662f\u4e4b\u524d\uff1a\"+beanName);\n        return bean;   //\u8fd9\u91cc\u8fd4\u56de\u7684Bean\u4f1a\u4ea4\u7ed9\u4e0b\u4e00\u4e2a\u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u521d\u59cb\u5316\u65b9\u6cd5\n    }\n}\n</code></pre> <pre><code>@Component\npublic class TestServiceImpl implements TestService{\n\n    public TestServiceImpl(){\n        System.out.println(\"\u6211\u662f\u6784\u9020\u65b9\u6cd5\");\n    }\n\n    @PostConstruct\n    public void init(){\n        System.out.println(\"\u6211\u662f\u521d\u59cb\u5316\u65b9\u6cd5\");\n    }\n\n    TestMapper mapper;\n\n    @Autowired\n    public void setMapper(TestMapper mapper) {\n        System.out.println(\"\u6211\u662f\u4f9d\u8d56\u6ce8\u5165\");\n        this.mapper = mapper;\n    }\n\n    ...\n</code></pre> <p>\u800cTestServiceImpl\u7684\u52a0\u8f7d\u987a\u5e8f\u4e3a\uff1a</p> <pre><code>\u6211\u662f\u6784\u9020\u65b9\u6cd5\n\u6211\u662f\u4f9d\u8d56\u6ce8\u5165\n\u6211\u662f\u4e4b\u524d\uff1atestServiceImpl\n\u6211\u662f\u521d\u59cb\u5316\u65b9\u6cd5\n\u6211\u662f\u4e4b\u540e\uff1atestServiceImpl\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u518d\u6765\u603b\u7ed3\u4e00\u4e0b\u4e00\u4e2aBean\u7684\u52a0\u8f7d\u6d41\u7a0b\uff1a</p> <p>[Bean\u5b9a\u4e49]\u9996\u5148\u626b\u63cfBean\uff0c\u52a0\u8f7dBean\u5b9a\u4e49 -&gt; [\u4f9d\u8d56\u6ce8\u5165]\u6839\u636eBean\u5b9a\u4e49\u901a\u8fc7\u53cd\u5c04\u521b\u5efaBean\u5b9e\u4f8b -&gt; [\u4f9d\u8d56\u6ce8\u5165]\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\uff08\u987a\u4fbf\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u95ee\u9898\uff09-&gt; [\u521d\u59cb\u5316Bean]BeanPostProcessor\u7684\u521d\u59cb\u5316\u4e4b\u524d\u65b9\u6cd5 -&gt; [\u521d\u59cb\u5316Bean]Bean\u521d\u59cb\u5316\u65b9\u6cd5 -&gt; [\u521d\u59cb\u5316Bean]BeanPostProcessor\u7684\u521d\u59cb\u5316\u4e4b\u524d\u540e\u65b9\u6cd5 -&gt; [\u5b8c\u6210]\u6700\u7ec8\u5f97\u5230\u7684Bean\u52a0\u8f7d\u5b8c\u6210\u7684\u5b9e\u4f8b</p> <p>\u5229\u7528\u8fd9\u79cd\u673a\u5236\uff0c\u7406\u89e3Aop\u7684\u5b9e\u73b0\u8fc7\u7a0b\u5c31\u975e\u5e38\u7b80\u5355\u4e86\uff0cAOP\u5b9e\u9645\u4e0a\u4e5f\u662f\u901a\u8fc7\u8fd9\u79cd\u673a\u5236\u5b9e\u73b0\u7684\uff0c\u5b83\u7684\u5b9e\u73b0\u7c7b\u662f<code>AnnotationAwareAspectJAutoProxyCreator</code>\uff0c\u800c\u5b83\u5c31\u662f\u5728\u6700\u540e\u5bf9Bean\u8fdb\u884c\u4e86\u4ee3\u7406\uff0c\u56e0\u6b64\u6700\u540e\u6211\u4eec\u5f97\u5230\u7684\u7ed3\u679c\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u52a8\u6001\u4ee3\u7406\u7684\u5bf9\u8c61\uff08\u6709\u5173\u8be6\u7ec6\u5b9e\u73b0\u8fc7\u7a0b\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8fdb\u884c\u5217\u4e3e\u4e86\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u7ee7\u7eed\u6df1\u5165\uff09</p> <p>\u90a3\u4e48\u80af\u5b9a\u6709\u4eba\u6709\u7591\u95ee\u4e86\uff0c\u8fd9\u4e2a\u7c7b\u6ca1\u6709\u88ab\u6ce8\u518c\u554a\uff0c\u90a3\u6309\u7406\u8bf4\u5b83\u4e0d\u5e94\u8be5\u53c2\u4e0e\u5230Bean\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u4e2d\u7684\uff0c\u4e3a\u4ec0\u4e48\u5b83\u76f4\u63a5\u5c31\u88ab\u52a0\u8f7d\u4e86\u5462\uff1f</p> <p>\u8fd8\u8bb0\u5f97<code>@EnableAspectJAutoProxy</code>\u5417\uff1f\u6211\u4eec\u6765\u770b\u770b\u5b83\u662f\u5982\u4f55\u5b9a\u4e49\u5c31\u77e5\u9053\u4e86\uff1a</p> <pre><code>@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Import({AspectJAutoProxyRegistrar.class})\npublic @interface EnableAspectJAutoProxy {\n    boolean proxyTargetClass() default false;\n\n    boolean exposeProxy() default false;\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u5b83\u4f7f\u7528\u4e86<code>@Import</code>\u6765\u6ce8\u518c<code>AspectJAutoProxyRegistrar</code>\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7c7b\u53c8\u662f\u4ec0\u4e48\u5462\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\uff1a</p> <pre><code>class AspectJAutoProxyRegistrar implements ImportBeanDefinitionRegistrar {\n    AspectJAutoProxyRegistrar() {\n    }\n\n    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n        //\u6ce8\u518cAnnotationAwareAspectJAutoProxyCreator\u5230\u5bb9\u5668\u4e2d\n        AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);\n        AnnotationAttributes enableAspectJAutoProxy = AnnotationConfigUtils.attributesFor(importingClassMetadata, EnableAspectJAutoProxy.class);\n        if (enableAspectJAutoProxy != null) {\n            if (enableAspectJAutoProxy.getBoolean(\"proxyTargetClass\")) {\n                AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);\n            }\n\n            if (enableAspectJAutoProxy.getBoolean(\"exposeProxy\")) {\n                AopConfigUtils.forceAutoProxyCreatorToExposeProxy(registry);\n            }\n        }\n\n    }\n}\n</code></pre> <p>\u5b83\u5b9e\u73b0\u4e86\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u4e5f\u662fSpring\u63d0\u4f9b\u7684\u4e00\u79cdBean\u52a0\u8f7d\u673a\u5236\uff0c\u5b83\u652f\u6301\u76f4\u63a5\u5411\u5bb9\u5668\u4e2d\u6dfb\u52a0Bean\u5b9a\u4e49\uff0c\u5bb9\u5668\u4e5f\u4f1a\u52a0\u8f7d\u8fd9\u4e2aBean\uff1a</p> <ul> <li>ImportBeanDefinitionRegistrar\u7c7b\u53ea\u80fd\u901a\u8fc7\u5176\u4ed6\u7c7b@Import\u7684\u65b9\u5f0f\u6765\u52a0\u8f7d\uff0c\u901a\u5e38\u662f\u542f\u52a8\u7c7b\u6216\u914d\u7f6e\u7c7b\u3002</li> <li>\u4f7f\u7528@Import\uff0c\u5982\u679c\u62ec\u53f7\u4e2d\u7684\u7c7b\u662fImportBeanDefinitionRegistrar\u7684\u5b9e\u73b0\u7c7b\uff0c\u5219\u4f1a\u8c03\u7528\u63a5\u53e3\u4e2d\u65b9\u6cd5\uff08\u4e00\u822c\u7528\u4e8e\u6ce8\u518cBean\uff09</li> <li>\u5b9e\u73b0\u8be5\u63a5\u53e3\u7684\u7c7b\u62e5\u6709\u6ce8\u518cbean\u7684\u80fd\u529b\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u63a5\u53e3\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>BeanDefinitionRegistry</code>\u6b63\u662f\u7528\u4e8e\u6ce8\u518cBean\u7684\u5b9a\u4e49\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u6253\u4e0a\u4e86<code>@EnableAspectJAutoProxy</code>\u6ce8\u89e3\u4e4b\u540e\uff0c\u9996\u5148\u4f1a\u901a\u8fc7<code>@Import</code>\u52a0\u8f7dAspectJAutoProxyRegistrar\uff0c\u7136\u540e\u8c03\u7528\u5176<code>registerBeanDefinitions</code>\u65b9\u6cd5\uff0c\u7136\u540e\u4f7f\u7528\u5de5\u5177\u7c7b\u6ce8\u518cAnnotationAwareAspectJAutoProxyCreator\u5230\u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837\u5728\u6bcf\u4e2aBean\u521b\u5efa\u4e4b\u540e\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528AOP\uff0c\u90a3\u4e48\u5c31\u4f1a\u901a\u8fc7AOP\u7684\u540e\u7f6e\u5904\u7406\u5668\u8fdb\u884c\u5904\u7406\uff0c\u6700\u540e\u8fd4\u56de\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u7f16\u5199\u4e00\u4e2a\u81ea\u5df1\u7684ImportBeanDefinitionRegistrar\u5b9e\u73b0\uff0c\u9996\u5148\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5Bean\uff1a</p> <pre><code>public class TestBean {\n\n    @PostConstruct\n    void init(){\n        System.out.println(\"\u6211\u88ab\u521d\u59cb\u5316\u4e86\uff01\");\n    }\n}\n</code></pre> <pre><code>public class TestBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar {\n\n    @Override\n    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n        BeanDefinition definition = BeanDefinitionBuilder.rootBeanDefinition(Student.class).getBeanDefinition();\n        registry.registerBeanDefinition(\"lbwnb\", definition);\n    }\n}\n</code></pre> <p>\u89c2\u5bdf\u63a7\u5236\u53f0\u8f93\u51fa\uff0c\u6210\u529f\u52a0\u8f7dBean\u5b9e\u4f8b\u3002</p> <p>\u4e0e<code>BeanPostProcessor</code>\u5dee\u4e0d\u591a\u7684\u8fd8\u6709<code>BeanFactoryPostProcessor</code>\uff0c\u5b83\u548c\u524d\u8005\u4e00\u6837\uff0c\u4e5f\u662f\u7528\u4e8e\u6211\u4eec\u81ea\u5df1\u5904\u7406\u540e\u7f6e\u52a8\u4f5c\u7684\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u662f\u7528\u4e8e\u5904\u7406BeanFactory\u52a0\u8f7d\u7684\u540e\u7f6e\u52a8\u4f5c\uff0c<code>BeanDefinitionRegistryPostProcessor</code>\u76f4\u63a5\u7ee7\u627f\u81ea<code>BeanFactoryPostProcessor</code>\uff0c\u5e76\u4e14\u8fd8\u6dfb\u52a0\u4e86\u65b0\u7684\u52a8\u4f5c<code>postProcessBeanDefinitionRegistry</code>\uff0c\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u52a8\u6001\u6dfb\u52a0Bean\u5b9a\u4e49\u6216\u662f\u4fee\u6539\u5df2\u7ecf\u5b58\u5728\u7684Bean\u5b9a\u4e49\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u76f4\u63a5\u6f14\u793a<code>BeanDefinitionRegistryPostProcessor</code>\u7684\u5b9e\u73b0\uff1a</p> <pre><code>@Component\npublic class TestDefinitionProcessor implements BeanDefinitionRegistryPostProcessor {\n    @Override\n    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {\n        System.out.println(\"\u6211\u662fBean\u5b9a\u4e49\u540e\u7f6e\u5904\u7406\uff01\");\n        BeanDefinition definition = BeanDefinitionBuilder.rootBeanDefinition(TestBean.class).getBeanDefinition();\n        registry.registerBeanDefinition(\"lbwnb\", definition);\n    }\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {\n        System.out.println(\"\u6211\u662fBean\u5de5\u5382\u540e\u7f6e\u5904\u7406\uff01\");\n    }\n}\n</code></pre> <p>\u5728\u8fd9\u91cc\u6ce8\u518cBean\u5b9a\u4e49\u5176\u5b9e\u548c\u4e4b\u524d\u90a3\u79cd\u65b9\u6cd5\u6548\u679c\u4e00\u6837\u3002</p> <p>\u6700\u540e\uff0c\u6211\u4eec\u518d\u5b8c\u5584\u4e00\u4e0bBean\u52a0\u8f7d\u6d41\u7a0b\uff08\u52a0\u7c97\u90e8\u5206\u662f\u65b0\u589e\u7684\uff09\uff1a</p> <p>[Bean\u5b9a\u4e49]\u9996\u5148\u626b\u63cfBean\uff0c\u52a0\u8f7dBean\u5b9a\u4e49 -&gt; [Bean\u5b9a\u4e49]Bean\u5b9a\u4e49\u548cBean\u5de5\u5382\u540e\u7f6e\u5904\u7406 -&gt; [\u4f9d\u8d56\u6ce8\u5165]\u6839\u636eBean\u5b9a\u4e49\u901a\u8fc7\u53cd\u5c04\u521b\u5efaBean\u5b9e\u4f8b -&gt; [\u4f9d\u8d56\u6ce8\u5165]\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\uff08\u987a\u4fbf\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u95ee\u9898\uff09-&gt; [\u521d\u59cb\u5316Bean]BeanPostProcessor\u7684\u521d\u59cb\u5316\u4e4b\u524d\u65b9\u6cd5 -&gt; [\u521d\u59cb\u5316Bean]Bean\u521d\u59cb\u5316\u65b9\u6cd5 -&gt; [\u521d\u59cb\u5316Bean]BeanPostProcessor\u7684\u521d\u59cb\u5316\u4e4b\u524d\u540e\u65b9\u6cd5 -&gt; [\u5b8c\u6210]\u6700\u7ec8\u5f97\u5230\u7684Bean\u52a0\u8f7d\u5b8c\u6210\u7684\u5b9e\u4f8b</p> <p>\u6700\u540e\u6211\u4eec\u518d\u6765\u7814\u7a76\u4e00\u4e0bApplicationContext\u4e2d\u7684<code>refresh()</code>\u65b9\u6cd5\uff1a</p> <pre><code>public void refresh() throws BeansException, IllegalStateException {\n    synchronized(this.startupShutdownMonitor) {\n        StartupStep contextRefresh = this.applicationStartup.start(\"spring.context.refresh\");\n        this.prepareRefresh();\n        ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();\n        //\u521d\u59cb\u5316Bean\u5de5\u5382\n        this.prepareBeanFactory(beanFactory);\n\n        try {\n            this.postProcessBeanFactory(beanFactory);\n            StartupStep beanPostProcess = this.applicationStartup.start(\"spring.context.beans.post-process\");\n            //\u8c03\u7528\u6240\u6709\u7684Bean\u5de5\u5382\u3001Bean\u6ce8\u518c\u540e\u7f6e\u5904\u7406\u5668\n            this.invokeBeanFactoryPostProcessors(beanFactory);\n            //\u6ce8\u518cBean\u540e\u7f6e\u5904\u7406\u5668\uff08\u5305\u62ecSpring\u5185\u90e8\u7684\uff09\n            this.registerBeanPostProcessors(beanFactory);\n            beanPostProcess.end();\n            //\u56fd\u9645\u5316\u652f\u6301\n            this.initMessageSource();\n            //\u76d1\u542c\u548c\u4e8b\u4ef6\u5e7f\u64ad\n            this.initApplicationEventMulticaster();\n            this.onRefresh();\n            this.registerListeners();\n            //\u5b9e\u4f8b\u5316\u6240\u6709\u7684Bean\n            this.finishBeanFactoryInitialization(beanFactory);\n            this.finishRefresh();\n        } catch (BeansException var10) {\n            if (this.logger.isWarnEnabled()) {\n                this.logger.warn(\"Exception encountered during context initialization - cancelling refresh attempt: \" + var10);\n            }\n\n            this.destroyBeans();\n            this.cancelRefresh(var10);\n            throw var10;\n        } finally {\n            this.resetCommonCaches();\n            contextRefresh.end();\n        }\n\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u7ed9\u8fd9\u4e9b\u90e8\u5206\u5206\u522b\u6253\u4e0a\u65ad\u70b9\u6765\u89c2\u5bdf\u4e00\u4e0b\u6b64\u65b9\u6cd5\u7684\u6574\u4f53\u52a0\u8f7d\u6d41\u7a0b\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/#mybatis_4","title":"Mybatis\u6574\u5408\u539f\u7406","text":"<p>\u901a\u8fc7\u4e4b\u524d\u7684\u4e86\u89e3\uff0c\u6211\u4eec\u518d\u6765\u770bMybatis\u7684<code>@MapperScan</code>\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u73b0\u5728\u7406\u89e3\u8d77\u6765\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6253\u5f00\u67e5\u770b\uff1a</p> <pre><code>@Retention(RetentionPolicy.RUNTIME)\n@Target({ElementType.TYPE})\n@Documented\n@Import({MapperScannerRegistrar.class})\n@Repeatable(MapperScans.class)\npublic @interface MapperScan {\n    String[] value() default {};\n\n    String[] basePackages() default {};\n    ...\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u548cAop\u4e00\u6837\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7Registrar\u673a\u5236\uff0c\u901a\u8fc7<code>@Import</code>\u6765\u8fdb\u884cBean\u7684\u6ce8\u518c\uff0c\u6211\u4eec\u6765\u770b\u770b<code>MapperScannerRegistrar</code>\u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff0c\u5173\u952e\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>void registerBeanDefinitions(AnnotationMetadata annoMeta, AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry, String beanName) {\n    BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);\n    builder.addPropertyValue(\"processPropertyPlaceHolders\", true);\n    Class&lt;? extends Annotation&gt; annotationClass = annoAttrs.getClass(\"annotationClass\");\n    if (!Annotation.class.equals(annotationClass)) {\n        builder.addPropertyValue(\"annotationClass\", annotationClass);\n    }\n\n    Class&lt;?&gt; markerInterface = annoAttrs.getClass(\"markerInterface\");\n    if (!Class.class.equals(markerInterface)) {\n        builder.addPropertyValue(\"markerInterface\", markerInterface);\n    }\n\n    Class&lt;? extends BeanNameGenerator&gt; generatorClass = annoAttrs.getClass(\"nameGenerator\");\n    if (!BeanNameGenerator.class.equals(generatorClass)) {\n        builder.addPropertyValue(\"nameGenerator\", BeanUtils.instantiateClass(generatorClass));\n    }\n\n    Class&lt;? extends MapperFactoryBean&gt; mapperFactoryBeanClass = annoAttrs.getClass(\"factoryBean\");\n    if (!MapperFactoryBean.class.equals(mapperFactoryBeanClass)) {\n        builder.addPropertyValue(\"mapperFactoryBeanClass\", mapperFactoryBeanClass);\n    }\n\n    String sqlSessionTemplateRef = annoAttrs.getString(\"sqlSessionTemplateRef\");\n    if (StringUtils.hasText(sqlSessionTemplateRef)) {\n        builder.addPropertyValue(\"sqlSessionTemplateBeanName\", annoAttrs.getString(\"sqlSessionTemplateRef\"));\n    }\n\n    String sqlSessionFactoryRef = annoAttrs.getString(\"sqlSessionFactoryRef\");\n    if (StringUtils.hasText(sqlSessionFactoryRef)) {\n        builder.addPropertyValue(\"sqlSessionFactoryBeanName\", annoAttrs.getString(\"sqlSessionFactoryRef\"));\n    }\n\n    List&lt;String&gt; basePackages = new ArrayList();\n    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getStringArray(\"value\")).filter(StringUtils::hasText).collect(Collectors.toList()));\n    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getStringArray(\"basePackages\")).filter(StringUtils::hasText).collect(Collectors.toList()));\n    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getClassArray(\"basePackageClasses\")).map(ClassUtils::getPackageName).collect(Collectors.toList()));\n    if (basePackages.isEmpty()) {\n        basePackages.add(getDefaultBasePackage(annoMeta));\n    }\n\n    String lazyInitialization = annoAttrs.getString(\"lazyInitialization\");\n    if (StringUtils.hasText(lazyInitialization)) {\n        builder.addPropertyValue(\"lazyInitialization\", lazyInitialization);\n    }\n\n    String defaultScope = annoAttrs.getString(\"defaultScope\");\n    if (!\"\".equals(defaultScope)) {\n        builder.addPropertyValue(\"defaultScope\", defaultScope);\n    }\n\n    builder.addPropertyValue(\"basePackage\", StringUtils.collectionToCommaDelimitedString(basePackages));\n    registry.registerBeanDefinition(beanName, builder.getBeanDefinition());\n}\n</code></pre> <p>\u867d\u7136\u5f88\u957f\u5f88\u591a\uff0c\u4f46\u662f\u8fd9\u4e9b\u4ee3\u7801\u90fd\u662f\u5728\u6dfb\u52a0\u4e00\u4e9bBean\u5b9a\u4e49\u7684\u5c5e\u6027\uff0c\u800c\u6700\u5173\u952e\u7684\u5219\u662f\u6700\u4e0a\u65b9\u7684<code>MapperScannerConfigurer</code>\uff0cMybatis\u5c06\u5176Bean\u4fe1\u606f\u6ce8\u518c\u5230\u4e86\u5bb9\u5668\u4e2d\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7c7b\u53c8\u662f\u5e72\u561b\u7684\u5462\uff1f</p> <pre><code>public class MapperScannerConfigurer implements BeanDefinitionRegistryPostProcessor, InitializingBean, ApplicationContextAware, BeanNameAware {\n    private String basePackage;\n</code></pre> <p>\u5b83\u5b9e\u73b0\u4e86BeanDefinitionRegistryPostProcessor\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u4e3aBean\u4fe1\u606f\u52a0\u8f7d\u63d0\u4f9b\u4e86\u540e\u7f6e\u5904\u7406\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\u770b\u5b83\u5728Bean\u4fe1\u606f\u540e\u7f6e\u5904\u7406\u4e2d\u505a\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) {\n    if (this.processPropertyPlaceHolders) {\n        this.processPropertyPlaceHolders();\n    }\n\n    //\u521d\u59cb\u5316\u7c7b\u8def\u5f84Mapper\u626b\u63cf\u5668\uff0c\u5b83\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u53ef\u4ee5\u5feb\u901f\u626b\u63cf\u51fa\u6574\u4e2a\u5305\u4e0b\u7684\u7c7b\u5b9a\u4e49\u4fe1\u606f\n    //ClassPathMapperScanner\u662fMybatis\u81ea\u5df1\u5b9e\u73b0\u7684\u4e00\u4e2a\u626b\u63cf\u5668\uff0c\u4fee\u6539\u4e86\u4e00\u4e9b\u626b\u63cf\u89c4\u5219\n    ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry);\n    scanner.setAddToConfig(this.addToConfig);\n    scanner.setAnnotationClass(this.annotationClass);\n    scanner.setMarkerInterface(this.markerInterface);\n    scanner.setSqlSessionFactory(this.sqlSessionFactory);\n    scanner.setSqlSessionTemplate(this.sqlSessionTemplate);\n    scanner.setSqlSessionFactoryBeanName(this.sqlSessionFactoryBeanName);\n    scanner.setSqlSessionTemplateBeanName(this.sqlSessionTemplateBeanName);\n    scanner.setResourceLoader(this.applicationContext);\n    scanner.setBeanNameGenerator(this.nameGenerator);\n    scanner.setMapperFactoryBeanClass(this.mapperFactoryBeanClass);\n    if (StringUtils.hasText(this.lazyInitialization)) {\n        scanner.setLazyInitialization(Boolean.valueOf(this.lazyInitialization));\n    }\n\n    if (StringUtils.hasText(this.defaultScope)) {\n        scanner.setDefaultScope(this.defaultScope);\n    }\n\n    //\u6dfb\u52a0\u8fc7\u6ee4\u5668\uff0c\u8fd9\u91cc\u4f1a\u914d\u7f6e\u4e3a\u6240\u6709\u7684\u63a5\u53e3\u90fd\u80fd\u88ab\u626b\u63cf\uff08\u56e0\u6b64\u5373\u4f7f\u4f60\u4e0d\u6dfb\u52a0@Mapper\u6ce8\u89e3\u90fd\u80fd\u591f\u88ab\u626b\u63cf\u5e76\u52a0\u8f7d\uff09\n    scanner.registerFilters();\n    //\u5f00\u59cb\u626b\u63cf\n    scanner.scan(StringUtils.tokenizeToStringArray(this.basePackage, \",; \\t\\n\"));\n}\n</code></pre> <p>\u5f00\u59cb\u626b\u63cf\u540e\uff0c\u4f1a\u8c03\u7528<code>doScan()</code>\u65b9\u6cd5\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\uff08\u8fd9\u662f<code>ClassPathMapperScanner</code>\u4e2d\u7684\u626b\u63cf\u65b9\u6cd5\uff09\uff1a</p> <pre><code>public Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {\n    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages);\n    //\u9996\u5148\u4ece\u5305\u4e2d\u626b\u63cf\u6240\u6709\u7684Bean\u5b9a\u4e49\n    if (beanDefinitions.isEmpty()) {\n        LOGGER.warn(() -&gt; {\n            return \"No MyBatis mapper was found in '\" + Arrays.toString(basePackages) + \"' package. Please check your configuration.\";\n        });\n    } else {\n        //\u5904\u7406\u6240\u6709\u7684Bean\u5b9a\u4e49\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u751f\u6210\u5bf9\u5e94Mapper\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u5e76\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\n        this.processBeanDefinitions(beanDefinitions);\n    }\n\n    //\u6700\u540e\u8fd4\u56de\u6240\u6709\u7684Bean\u5b9a\u4e49\u96c6\u5408\n    return beanDefinitions;\n}\n</code></pre> <p>\u901a\u8fc7\u65ad\u70b9\u6211\u4eec\u53d1\u73b0\uff0c\u6700\u540e\u5904\u7406\u5f97\u5230\u7684Bean\u5b9a\u4e49\u53d1\u73b0\u6b64Bean\u662f\u4e00\u4e2aMapperFactoryBean\uff0c\u5b83\u4e0d\u540c\u4e8e\u666e\u901a\u7684Bean\uff0cFactoryBean\u76f8\u5f53\u4e8e\u4e3a\u666e\u901a\u7684Bean\u6dfb\u52a0\u4e86\u4e00\u5c42\u5916\u58f3\uff0c\u5b83\u5e76\u4e0d\u662f\u4f9d\u9760Spring\u76f4\u63a5\u901a\u8fc7\u53cd\u5c04\u521b\u5efa\uff0c\u800c\u662f\u4f7f\u7528\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff1a</p> <pre><code>public interface FactoryBean&lt;T&gt; {\n    String OBJECT_TYPE_ATTRIBUTE = \"factoryBeanObjectType\";\n\n    @Nullable\n    T getObject() throws Exception;\n\n    @Nullable\n    Class&lt;?&gt; getObjectType();\n\n    default boolean isSingleton() {\n        return true;\n    }\n}\n</code></pre> <p>\u901a\u8fc7<code>getObject()</code>\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230Bean\u7684\u5b9e\u4f8b\u4e86\u3002</p> <p>\u6ce8\u610f\u8fd9\u91cc\u4e00\u5b9a\u8981\u533a\u5206FactoryBean\u548cBeanFactory\u7684\u6982\u5ff5\uff1a</p> <ul> <li>BeanFactory\u662f\u4e2aFactory\uff0c\u4e5f\u5c31\u662f IOC \u5bb9\u5668\u6216\u5bf9\u8c61\u5de5\u5382\uff0c\u6240\u6709\u7684 Bean \u90fd\u662f\u7531 BeanFactory( \u4e5f\u5c31\u662f IOC \u5bb9\u5668 ) \u6765\u8fdb\u884c\u7ba1\u7406\u3002</li> <li>FactoryBean\u662f\u4e00\u4e2a\u80fd\u751f\u4ea7\u6216\u8005\u4fee\u9970\u751f\u6210\u5bf9\u8c61\u7684\u5de5\u5382Bean(\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2aBean)\uff0c\u53ef\u4ee5\u5728BeanFactory\uff08IOC\u5bb9\u5668\uff09\u4e2d\u88ab\u7ba1\u7406\uff0c\u6240\u4ee5\u5b83\u5e76\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u7684Bean\u3002\u5f53\u4f7f\u7528\u5bb9\u5668\u4e2dfactory bean\u7684\u65f6\u5019\uff0c\u8be5\u5bb9\u5668\u4e0d\u4f1a\u8fd4\u56defactory bean\u672c\u8eab\uff0c\u800c\u662f\u8fd4\u56de\u5176\u751f\u6210\u7684\u5bf9\u8c61\u3002\u8981\u60f3\u83b7\u53d6FactoryBean\u7684\u5b9e\u73b0\u7c7b\u672c\u8eab\uff0c\u5f97\u5728getBean(String BeanName)\u4e2d\u7684BeanName\u4e4b\u524d\u52a0\u4e0a&amp;,\u5199\u6210getBean(String &amp;BeanName)\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u7f16\u5199\u4e00\u4e2a\u5b9e\u73b0\uff1a</p> <pre><code>@Component(\"test\")\npublic class TestFb implements FactoryBean&lt;Student&gt; {\n    @Override\n    public Student getObject() throws Exception {\n        System.out.println(\"\u83b7\u53d6\u4e86\u5b66\u751f\");\n        return new Student();\n    }\n\n    @Override\n    public Class&lt;?&gt; getObjectType() {\n        return Student.class;\n    }\n}\n</code></pre> <pre><code>public static void main(String[] args) {\n    log.info(\"\u9879\u76ee\u6b63\u5728\u542f\u52a8...\");\n    ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);\n    System.out.println(context.getBean(\"&amp;test\"));   //\u5f97\u5230FactoryBean\u672c\u8eab\uff08\u5f97\u52a0\u4e2a&amp;\u641e\u5f97\u50cfC\u8bed\u8a00\u6307\u9488\u4e00\u6837\uff09\n    System.out.println(context.getBean(\"test\"));   //\u5f97\u5230FactoryBean\u8c03\u7528getObject()\u4e4b\u540e\u7684\u7ed3\u679c\n}\n</code></pre> <p>\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u7684Mapper\u6700\u7ec8\u5c31\u4ee5FactoryBean\u7684\u5f62\u5f0f\uff0c\u88ab\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\u8fdb\u884c\u52a0\u8f7d\u4e86\uff1a</p> <pre><code>public T getObject() throws Exception {\n    return this.getSqlSession().getMapper(this.mapperInterface);\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6574\u4e2aMybatis\u7684<code>@MapperScan</code>\u7684\u539f\u7406\u5c31\u5168\u90e8\u89e3\u91ca\u5b8c\u6bd5\u4e86\u3002</p> <p>\u5728\u4e86\u89e3\u5b8c\u4e86Spring\u7684\u5e95\u5c42\u539f\u7406\u4e4b\u540e\uff0c\u6211\u4eec\u5176\u5b9e\u5df2\u7ecf\u5b8c\u5168\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u5b9e\u73b0\u539f\u7406\u6765\u624b\u5199\u4e00\u4e2aSpring\u6846\u67b6\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/","title":"MySQL\u9ad8\u7ea7","text":"<p>\u5728JavaWeb\u9636\u6bb5\uff0c\u6211\u4eec\u521d\u6b65\u8ba4\u8bc6\u4e86MySQL\u6570\u636e\u5e93\uff0c\u5305\u62ec\u4e00\u4e9b\u57fa\u672c\u64cd\u4f5c\uff0c\u6bd4\u5982\u521b\u5efa\u6570\u636e\u5e93\u3001\u8868\u3001\u89e6\u53d1\u5668\uff0c\u4ee5\u53ca\u6700\u57fa\u672c\u7684\u589e\u5220\u6539\u67e5\u3001\u4e8b\u52a1\u7b49\u64cd\u4f5c\u3002\u800c\u5728\u6b64\u9636\u6bb5\uff0c\u6211\u4eec\u5c06\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60MySQL\uff0c\u4e86\u89e3\u5b83\u7684\u66f4\u591a\u9ad8\u7ea7\u73a9\u6cd5\uff0c\u4e5f\u76f8\u5f53\u4e8e\u8fdb\u884c\u590d\u4e60\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_1","title":"\u51fd\u6570","text":"<p>\u5176\u5b9e\u51fd\u6570\u6211\u4eec\u5728\u4e4b\u524d\u5df2\u7ecf\u63a5\u89e6\u5230\u4e00\u90e8\u5206\u4e86\uff0c\u5728JavaWeb\u9636\u6bb5\uff0c\u6211\u4eec\u4e86\u89e3\u4e86\u805a\u96c6\u51fd\u6570\uff0c\u805a\u96c6\u51fd\u6570\u4e00\u822c\u7528\u4f5c\u7edf\u8ba1\uff0c\u5305\u62ec\uff1a</p> <ul> <li>count([distinct]*)    \u7edf\u8ba1\u6240\u6709\u7684\u884c\u6570\uff08distinct\u8868\u793a\u53bb\u91cd\u518d\u7edf\u8ba1\uff0c\u4e0b\u540c\uff09</li> <li>count([distinct]\u5217\u540d)    \u7edf\u8ba1\u67d0\u5217\u7684\u503c\u603b\u548c</li> <li>sum([distinct]\u5217\u540d)    \u6c42\u4e00\u5217\u7684\u548c\uff08\u6ce8\u610f\u5fc5\u987b\u662f\u6570\u5b57\u7c7b\u578b\u7684\uff09</li> <li>avg([distinct]\u5217\u540d)    \u6c42\u4e00\u5217\u7684\u5e73\u5747\u503c\uff08\u6ce8\u610f\u5fc5\u987b\u662f\u6570\u5b57\u7c7b\u578b\uff09</li> <li>max([distinct]\u5217\u540d)    \u6c42\u4e00\u5217\u7684\u6700\u5927\u503c</li> <li>min([distinct]\u5217\u540d)    \u6c42\u4e00\u5217\u7684\u6700\u5c0f\u503c</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u67d0\u4e2a\u8868\u4e00\u5171\u6709\u591a\u5c11\u884c\uff1a</p> <pre><code>SELECT COUNT(*) FROM student\n</code></pre> <p>\u901a\u8fc7\u4f7f\u7528COUNT\u805a\u96c6\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u7edf\u8ba1\u5e76\u5f97\u5230\u7ed3\u679c\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u8ba1\u7b97\u67d0\u4e00\u5217\u4e0a\u6240\u6709\u6570\u5b57\u7684\u548c\uff1a</p> <pre><code>SELECT SUM(sid) FROM student\n</code></pre> <p>\u901a\u8fc7SUM\u805a\u96c6\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\u6bcf\u4e00\u5217\u7684\u548c\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e9b\u51fd\u6570\u90fd\u662f\u7531\u7cfb\u7edf\u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002</p> <p>\u672c\u7248\u5757\u6211\u4eec\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u5404\u7c7b\u7cfb\u7edf\u51fd\u6570\u4ee5\u53ca\u5982\u4f55\u7f16\u5199\u81ea\u5b9a\u4e49\u51fd\u6570\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_2","title":"\u7cfb\u7edf\u51fd\u6570","text":"<p>\u7cfb\u7edf\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u51fd\u6570\u4e5f\u662f\u975e\u5e38\u5b9e\u7528\u7684\uff0c\u6211\u4eec\u5c06\u4f1a\u5206\u4e3a\u51e0\u4e2a\u7c7b\u578b\u8fdb\u884c\u8bb2\u89e3\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_3","title":"\u5b57\u7b26\u4e32\u51fd\u6570","text":"<p>\u5904\u7406\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u51fd\u6570\u6765\u5e2e\u52a9\u6211\u4eec\u5feb\u901f\u5904\u7406\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d\u5e38\u7528\u6bd4\u5982\u7528\u4e8e\u5b57\u7b26\u4e32\u5206\u5272\u7684\u51fd\u6570\u6709\uff1a</p> <ul> <li>substring(\u5b57\u7b26\u4e32, \u8d77\u59cb\u4f4d\u7f6e, \u7ed3\u675f\u4f4d\u7f6e)     \u540cJava\u4e2dString\u7c7b\u7684substring\u4e00\u81f4\uff0c\u4f46\u662f\u6ce8\u610f\u4e0b\u6807\u662f\u4ece1\u5f00\u59cb\uff0c\u4e0b\u540c</li> <li>left(\u5b57\u7b26\u4e32, \u957f\u5ea6)     \u4ece\u6700\u5de6\u8fb9\u5411\u53f3\u622a\u53d6\u5b57\u7b26\u4e32</li> <li>right(\u5b57\u7b26\u4e32, \u957f\u5ea6)     \u4ece\u6700\u53f3\u8fb9\u5411\u5de6\u622a\u53d6\u5b57\u7b26\u4e32</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u53ea\u60f3\u83b7\u53d6\u6240\u6709\u5b66\u751f\u59d3\u540d\u7684\u7b2c\u4e8c\u4e2a\u5b57\uff0c\u90a3\u4e48\u53ef\u4ee5\u50cf\u8fd9\u6837\u5199\uff1a</p> <pre><code>SELECT SUBSTRING(name, 2, 2) FROM student\n</code></pre> <p>\u6bd4\u5982\u6211\u4eec\u60f3\u83b7\u53d6\u6240\u6709\u5b66\u751f\u59d3\u540d\u7684\u7b2c\u4e00\u4e2a\u5b57\uff0c\u53ef\u4ee5\u50cf\u8fd9\u6837\u5199\uff1a</p> <pre><code>SELECT LEFT(name, 1) FROM student\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5229\u7528\u5b57\u7b26\u4e32\u51fd\u6570\u6765\u5feb\u901f\u5c06\u6240\u6709\u7684\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u6bcd\u6216\u662f\u5feb\u901f\u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u6bcd\uff1a</p> <ul> <li>upper(\u5b57\u7b26\u4e32)     \u5b57\u7b26\u4e32\u4e2d\u7684\u6240\u6709\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u6bcd</li> <li>lower(\u5b57\u7b26\u4e32)     \u5b57\u7b26\u4e32\u4e2d\u7684\u6240\u6709\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u6bcd</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u6240\u6709\u5b57\u7b26\u4e13\u4e3a\u5927\u5199\uff1a</p> <pre><code>SELECT UPPER('abcdefg')\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u50cfJava\u4e2d\u90a3\u6837\u76f4\u63a5\u5bf9\u5b57\u7b26\u4e32\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u66ff\u6362\uff1a</p> <ul> <li>replace(\u5b57\u7b26\u4e32, \u539f\u6587, \u66ff\u6362\u6587)      \u540cJava\u4e2dString\u7684replace\u6548\u679c</li> </ul> <p>\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u5e0c\u671b\u5c06\u67e5\u8be2\u5230\u7684\u6240\u6709\u540c\u5b66\u7684\u540d\u79f0\u4e2d\u7684<code>\u5c0f</code>\u5168\u90e8\u66ff\u6362<code>\u5927</code>\uff1a</p> <pre><code>SELECT REPLACE(`name`, '\u5c0f', '\u5927') FROM student\n</code></pre> <p>\u5b57\u7b26\u4e32\u4e5f\u652f\u6301\u8fdb\u884c\u62fc\u63a5\uff0c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u5b57\u7b26\u4e32\u7684\u62fc\u63a5\u51fd\u6570\uff1a</p> <ul> <li>concat(\u5b57\u7b26\u4e321, \u5b57\u7b26\u4e322)   \u8fde\u63a5\u4e24\u4e2a\u5b57\u7b26\u4e32</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u5c06\u67e5\u8be2\u5230\u7684\u6240\u6709\u540c\u5b66\u7684\u540d\u79f0\u6700\u540e\u90fd\u6dfb\u52a0\u4e00\u4e2a<code>\u5b50</code>\u5b57\uff1a</p> <pre><code>SELECT concat(name, '\u5b50') FROM student\n</code></pre> <p>\u6700\u540e\u5c31\u662f\u8ba1\u7b97\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff1a</p> <ul> <li>length(\u5b57\u7b26\u4e32)    \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\uff08\u6ce8\u610f\u5982\u679c\u4f7f\u7528\u7684\u662fUTF-8\u7f16\u7801\u683c\u5f0f\uff0c\u90a3\u4e48\u4e00\u4e2a\u6c49\u5b57\u53603\u5b57\u8282\uff0c\u6570\u5b57\u548c\u5b57\u6bcd\u5360\u4e00\u4e2a\u5b57\u8282\uff09</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u8981\u83b7\u53d6\u6240\u6709\u4eba\u540d\u5b57\u7684\u957f\u5ea6\uff1a</p> <pre><code>SELECT LENGTH(`name`) FROM student\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_4","title":"\u65e5\u671f\u51fd\u6570","text":"<p>MySQL\u63d0\u4f9b\u7684\u65e5\u671f\u51fd\u6570\u4e5f\u975e\u5e38\u5b9e\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u5bf9\u65e5\u671f\u8fdb\u884c\u64cd\u4f5c\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u8981\u5feb\u901f\u5c06\u65e5\u671f\u6dfb\u52a0N\u5929\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <ul> <li>date_add(\u65e5\u671f, interval \u589e\u91cf \u5355\u4f4d)</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u8ba92022-1-1\u5411\u540e5\u5929\uff1a</p> <pre><code>SELECT DATE_ADD('2022-1-1',INTERVAL 5 day)\n</code></pre> <p>\u540c\u7406\uff0c\u5411\u524d1\u5e74\uff1a</p> <pre><code>SELECT DATE_ADD('2022-1-1',INTERVAL -1 year)\n</code></pre> <p>\u5355\u4f4d\u6709\uff1ayear\uff08\u5e74\uff09\u3001month\uff08\u6708\uff09\u3001day\uff08\u65e5\uff09\u3001hour\uff08\u5c0f\u65f6\uff09\u3001minute\uff08\u5206\u949f\uff09\u3001second\uff08\u79d2\uff09</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\u65e5\u671f\u7684\u95f4\u9694\u5929\u6570\uff1a</p> <ul> <li>datediff(\u65e5\u671f1, \u65e5\u671f2)</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u60f3\u8ba1\u7b972022\u5e74\u76842\u6708\u6709\u591a\u5c11\u5929\uff1a</p> <pre><code>SELECT DATEDIFF('2022-3-1','2022-2-1')\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u60f3\u5feb\u901f\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\uff1a</p> <ul> <li>curdate()     \u5f53\u524d\u7684\u65e5\u671f</li> <li>curtime()     \u5f53\u524d\u7684\u65f6\u95f4</li> <li>now()    \u5f53\u524d\u7684\u65e5\u671f+\u65f6\u95f4</li> </ul> <p>\u6b64\u51fd\u6570\u4e4b\u524d\u6211\u4eec\u5728\u7f16\u5199\u5b9e\u6218\u9879\u76ee\u7684\u65f6\u5019\u5df2\u7ecf\u4f7f\u7528\u8fc7\u4e86\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6f14\u793a\u4e86\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u5355\u72ec\u83b7\u53d6\u65f6\u95f4\u4e2d\u7684\u67d0\u4e2a\u503c\uff1a</p> <ul> <li>day(\u65e5\u671f)    \u83b7\u53d6\u65e5\u671f\u662f\u51e0\u53f7</li> <li>month(\u65e5\u671f)   \u83b7\u53d6\u65e5\u671f\u662f\u51e0\u6708</li> <li>year(\u65e5\u671f)      \u83b7\u53d6\u65e5\u671f\u662f\u54ea\u4e00\u5e74</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u60f3\u83b7\u53d6\u4eca\u5929\u662f\u51e0\u53f7\uff1a</p> <pre><code>SELECT DAY(NOW())\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_5","title":"\u6570\u5b66\u51fd\u6570","text":"<p>\u6570\u5b66\u51fd\u6570\u6bd4\u8f83\u5e38\u89c4\uff0c\u57fa\u672c\u4e0eJava\u7684Math\u5de5\u5177\u7c7b\u4e00\u81f4\uff0c\u8fd9\u91cc\u5217\u51fa\u5373\u53ef\uff0c\u5404\u4f4d\u53ef\u4ee5\u81ea\u884c\u5c1d\u8bd5\uff1a</p> <ul> <li>abs(x)   \u6c42x\u7684\u7edd\u5bf9\u503c</li> <li>ceiling(x)   x\u5411\u4e0a\u53d6\u6574</li> <li>floor(x)  x\u5411\u4e0b\u53d6\u6574</li> <li>round(x, \u7cbe\u5ea6)  x\u53d6\u56db\u820d\u4e94\u5165\uff0c\u9075\u5faa\u5c0f\u6570\u70b9\u7cbe\u5ea6 </li> <li>exp(x)   e\u7684x\u6b21\u65b9</li> <li>rand()   0-1\u4e4b\u95f4\u7684\u968f\u673a\u6570</li> <li>log(x)    x\u7684\u5bf9\u6570</li> <li>pi()     \u03c0</li> <li>power(x, n)    x\u7684n\u6b21\u65b9</li> <li>sqrt(x)     x\u7684\u5e73\u65b9\u6839</li> <li>sin(x)  cos(x)   tan(x)     \u4e09\u89d2\u51fd\u6570\uff08\u8c8c\u4f3c\u6ca1\u6709arctan\u8fd9\u7c7b\u53cd\u51fd\u6570\uff1f\uff09</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_6","title":"\u7c7b\u578b\u8f6c\u6362\u51fd\u6570","text":"<p>MySQL\u7684\u7c7b\u578b\u8f6c\u6362\u4e5f\u5206\u4e3a\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u548c\u663e\u793a\u7c7b\u578b\u8f6c\u6362\uff0c\u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff1a</p> <pre><code>SELECT 1+'2'\n</code></pre> <p>\u867d\u7136\u8fd9\u53e5\u4e2d\u65e2\u5305\u542b\u4e86\u6570\u5b57\u548c\u5b57\u7b26\uff0c\u4f46\u662f\u5b57\u7b26\u4e32\u4f1a\u88ab\u8fdb\u884c\u9690\u5f0f\u8f6c\u6362\uff08\u6ce8\u610f\u8fd9\u91cc\u5e76\u4e0d\u662f\u6309\u7167\u5b57\u7b26\u7684ASCII\u7801\u8f6c\u6362\uff0c\u800c\u662f\u5199\u7684\u591a\u5c11\u8868\u793a\u591a\u5c11\uff09\u6240\u4ee5\u6700\u540e\u5f97\u5230\u7684\u5c31\u662f1+2\u7684\u7ed3\u679c\u4e3a3</p> <pre><code>SELECT CONCAT(1, '2')\n</code></pre> <p>\u8fd9\u91cc\u56e0\u4e3a\u9700\u8981\u4f20\u5165\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f46\u662f\u6211\u4eec\u7ed9\u7684\u662f1\u8fd9\u4e2a\u6570\u5b57\uff0c\u56e0\u6b64\u8fd9\u91cc\u4e5f\u4f1a\u53d1\u751f\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c1\u4f1a\u88ab\u76f4\u63a5\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u7684'1'\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f97\u5230\u7684\u7ed3\u679c\u662f'12'</p> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u6765\u5c06\u5f97\u5230\u7684\u6570\u636e\u8f6c\u6362\u6210\u6211\u4eec\u9700\u8981\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u7528\u5230\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\u4e86\uff0cMySQL\u63d0\u4f9b\u4e86\uff1a</p> <ul> <li>cast(\u6570\u636e   as \u6570\u636e\u7c7b\u578b)</li> </ul> <p>\u6570\u636e\u7c7b\u578b\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>BINARY[(N)] \uff1a\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u8f6c\u6362\u540e\u957f\u5ea6\u5c0f\u4e8eN\u4e2a\u5b57\u8282</li> <li>CHAR[(N)] \uff1a\u5b57\u7b26\u4e32\uff0c\u8f6c\u6362\u540e\u957f\u5ea6\u5c0f\u4e8eN\u4e2a\u5b57\u7b26</li> <li>DATE \uff1a\u65e5\u671f</li> <li>DATETIME \uff1a\u65e5\u671f\u65f6\u95f4</li> <li>DECIMAL[(M[,N])] \uff1a\u6d6e\u70b9\u6570\uff0cM\u4e3a\u6570\u5b57\u603b\u4f4d\u6570(\u5305\u62ec\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206)\uff0cN\u4e3a\u5c0f\u6570\u70b9\u540e\u7684\u4f4d\u6570</li> <li>SIGNED [INTEGER] \uff1a\u6709\u7b26\u53f7\u6574\u6570</li> <li>TIME \uff1a\u65f6\u95f4</li> <li>UNSIGNED [INTEGER] \uff1a\u65e0\u7b26\u53f7\u6574\u6570</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u9700\u8981\u5c06\u4e00\u4e2a\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6574\u6570\uff1a</p> <pre><code>SELECT CAST(pi() AS SIGNED)\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c\u626b\u63cf\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u4e00\u65e6\u9047\u5230\u975e\u6570\u5b57\u7684\u5b57\u7b26\uff0c\u4f1a\u505c\u6b62\u626b\u63cf\uff1a</p> <pre><code>SELECT CAST('123abc456' as SIGNED)\n</code></pre> <p>\u9664\u4e86cast\u4ee5\u5916\u8fd8\u6709convert\u51fd\u6570\uff0c\u529f\u80fd\u6bd4\u8f83\u76f8\u4f3c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u8bb2\u89e3\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_7","title":"\u6d41\u7a0b\u63a7\u5236\u51fd\u6570","text":"<p>MySQL\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5f88\u591a\u7684\u903b\u8f91\u5224\u65ad\u51fd\u6570\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>if(\u6761\u4ef6\u8868\u8fbe\u5f0f, \u7ed3\u679c1, \u7ed3\u679c2)    \u4e0eJava\u4e2d\u7684\u4e09\u76ee\u8fd0\u7b97\u7b26\u4e00\u81f4 a &gt; b ? \"AAA\" : \"BBB\"</li> <li>ifnull(\u503c1, \u503c2)     \u5982\u679c\u503c1\u4e3aNULL\u5219\u8fd4\u56de\u503c2\uff0c\u5426\u5219\u8fd4\u56de\u503c1</li> <li>nullif(\u503c1, \u503c2)     \u5982\u679c\u503c1\u4e0e\u503c2\u76f8\u7b49\uff0c\u90a3\u4e48\u8fd4\u56deNULL</li> <li>isnull(\u503c)      \u5224\u65ad\u503c\u662f\u5426\u4e3aNULL</li> </ul> <p>\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u60f3\u5224\u65ad\uff1a</p> <pre><code>SELECT IF(1 &lt; 0,'lbwnb','yyds')\n</code></pre> <p>\u901a\u8fc7\u5224\u65ad\u51fd\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8fdb\u884c\u4e00\u4e9b\u6761\u4ef6\u5224\u65ad\u64cd\u4f5c\u3002</p> <p>\u9664\u4e86IF\u6761\u4ef6\u5224\u65ad\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3cSwitch\u4e00\u6837\u7684\u8bed\u53e5\u5b8c\u6210\u591a\u5206\u652f\u7ed3\u6784\uff1a</p> <pre><code>SELECT \nCASE 2\n    WHEN 1 THEN\n        10\n    ELSE\n        5\nEND;\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u81ea\u5b9a\u4e49\u7684\u5224\u65ad\u6761\u4ef6\u653e\u5165When\u4e4b\u540e\uff0c\u5b83\u7c7b\u4f3c\u4e8eelse-if\uff1a</p> <pre><code>SELECT \nCASE\n    WHEN 3&gt;5 THEN\n        10\n    WHEN 0&lt;1 THEN\n        11\n    ELSE\n        5\nEND;\n</code></pre> <p>\u8fd8\u6709\u4e00\u4e2a\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684Thread.sleep\u7684\u51fd\u6570\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff1a</p> <pre><code>SELECT sleep(10);\n</code></pre> <p>\u6709\u5173MySQL8.0\u65b0\u589e\u7684\u7a97\u53e3\u51fd\u6570\u8fd9\u91cc\u6682\u65f6\u4e0d\u505a\u4ecb\u7ecd\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_8","title":"\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p>\u9664\u4e86\u4f7f\u7528\u7cfb\u7edf\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u51fd\u6570\u4ee5\u5916\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u5e76\u4f7f\u7528\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u8fdb\u884c\u6570\u636e\u5904\u7406\uff0c\u552f\u4e00\u6bd4\u8f83\u9ebb\u70e6\u7684\u5c31\u662f\u51fd\u6570\u5b9a\u4e49\u540e\u4e0d\u80fd\u4fee\u6539\uff0c\u53ea\u80fd\u5220\u4e86\u91cd\u65b0\u5199\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_9","title":"\u57fa\u672c\u8bed\u6cd5","text":"<p>MySQL\u7684\u51fd\u6570\u4e0eJava\u4e2d\u7684\u65b9\u6cd5\u7c7b\u4f3c\uff0c\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u53c2\u6570\u548c\u8fd4\u56de\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7<code>CREATE FUNCTION</code>\u521b\u5efa\u51fd\u6570\uff1a</p> <pre><code>CREATE FUNCTION test() RETURNS INT\nBEGIN\nRETURN 666;\nEND\n</code></pre> <p>\u5b9a\u4e49\u51fd\u6570\u7684\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>create function \u51fd\u6570\u540d\u79f0([\u53c2\u6570\u5217\u8868]) returns \u8fd4\u56de\u503c\u7c7b\u578b</li> <li>begin \u548c end \u4e4b\u95f4\u5199\u51fd\u6570\u7684\u5176\u4ed6\u903b\u8f91\uff0cbegin\u548cend\u5c31\u76f8\u5f53\u4e8eJava\u4e2d\u7684\u82b1\u62ec\u53f7<code>{  ...  }</code></li> <li>return\u540e\u7d27\u8ddf\u8fd4\u56de\u7684\u7ed3\u679c</li> </ul> <p>\u6dfb\u52a0\u53c2\u6570\u4e5f\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u51fd\u6570\u540d\u79f0\u62ec\u53f7\u4e2d\u6dfb\u52a0\u5373\u53ef\uff0c\u6ce8\u610f\u7c7b\u578b\u9700\u8981\u5199\u5728\u53c2\u6570\u540d\u79f0\u540e\u9762\uff1a</p> <pre><code>CREATE FUNCTION test(i INT) RETURNS INT\nBEGIN\nRETURN i * i;\nEND\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5728BEGIN\u548cRETURN\u4e4b\u95f4\u7f16\u5199\u4e00\u4e9b\u5176\u4ed6\u7684\u903b\u8f91\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u8981\u5b9a\u4e49\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u5e76\u4e3a\u5176\u8d4b\u503c\uff1a</p> <pre><code>BEGIN\nDECLARE a INT;\nSET a = 10;\nRETURN i * i * a;\nEND\n</code></pre> <p>\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf\u7684\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>declare \u53d8\u91cf\u540d\u79f0 \u53d8\u91cf\u7c7b\u578b [, ...]</li> <li>declare \u53d8\u91cf\u540d\u79f0 \u53d8\u91cf\u7c7b\u578b default \u9ed8\u8ba4\u503c</li> </ul> <p>\u4e3a\u53d8\u91cf\u8d4b\u503c\u7684\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>set \u53d8\u91cf\u540d\u79f0 = \u503c</li> </ul> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728\u51fd\u6570\u5185\u90e8\u4f7f\u7528<code>select</code>\u8bed\u53e5\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u4ece\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u53ef\u4ee5\u7ed3\u5408into\u5173\u952e\u5b57\u5c06\u67e5\u8be2\u7ed3\u679c\u8d4b\u503c\u7ed9\u53d8\u91cf\uff1a</p> <pre><code>BEGIN\nDECLARE a INT;\n-- select into from \u8bed\u53e5\nSELECT COUNT(*) INTO a FROM student;\nRETURN a;\nEND\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_10","title":"\u6d41\u7a0b\u63a7\u5236","text":"<p>\u63a5\u7740\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\uff0c\u5176\u4e2d\u6700\u5173\u952e\u7684\u5c31\u662fIF\u5224\u65ad\u8bed\u53e5\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 10;\nIF a &gt; 10 THEN\n    RETURN 1;\nELSE\n    RETURN 2;\nEND IF;\nEND\n</code></pre> <p>IF\u5206\u652f\u8bed\u53e5\u7684\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>if \u5224\u65ad\u6761\u4ef6 then  ... else if \u5224\u65ad\u6761\u4ef6 then .... else ... end if;</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408<code>exists</code>\u5173\u952e\u5b57\u6765\u5224\u65ad\u662f\u5426\u4e3aNULL\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 0;\n-- IF EXISTS(SELECT * FROM student WHERE sid = 100) THEN\nIF NOT EXISTS(SELECT * FROM student WHERE sid = 100) THEN\n    SET a = 10;\nEND IF;\nRETURN a;\nEND\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u4f7f\u7528switch\u8bed\u53e5\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 10;\nCASE a\n    WHEN 10 THEN\n        RETURN 2;\n    ELSE\n        RETURN 1;\nEND CASE;\nEND\n</code></pre> <p>SWITCH\u5206\u652f\u8bed\u53e5\u7684\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>case \u53d8\u91cf when \u5177\u4f53\u503c\u6216\u662f\u5e03\u5c14\u8868\u8fbe\u5f0f then ... when * then ... else ... end case;</li> </ul> <p>\u4e0eJava\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u652f\u6301\u4f7f\u7528\u5e03\u5c14\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 10;\nCASE\n    WHEN 1 &lt; 5 THEN\n        SET a = 5;\n    ELSE\n        SET a = 10;\nEND CASE;\nRETURN a;\nEND\n</code></pre> <p>\u6211\u4eec\u4ee5\u7c7b\u4f3c\u4e8eelseif\u7684\u5f62\u5f0f\u8fdb\u884c\u5224\u65ad\uff0c\u5176\u5b9e\u548c\u4e0a\u9762\u76f4\u63a5\u4f7f\u7528\u662f\u4e00\u6837\u7684\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\u5faa\u73af\u8bed\u53e5\uff0cMySQL\u63d0\u4f9b\u4e86\u4e09\u79cd\u5faa\u73af\u8bed\u53e5\uff0c\u5176\u4e2d\u7b2c\u4e00\u79cd\u662fWHILE\u8bed\u53e5\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 10;\nWHILE a &lt; 11 DO\n    SET a = a + 1;\nEND WHILE;\nRETURN a;\nEND\n</code></pre> <p>\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>while \u5faa\u73af\u6761\u4ef6 do ...  end while;</li> </ul> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\u7b2c\u4e8c\u79cd\u5faa\u73af\u8bed\u53e5\uff0cLOOP\u5faa\u73af\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 10;\nlp1: LOOP\n  SET a = a - 1;\n    IF a = 0 THEN\n        LEAVE lp1; \n    END IF; \nEND LOOP lp1;\nRETURN a;\nEND\n</code></pre> <p>\u76f8\u6bd4while\u8bed\u53e5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>LEAVE</code>\u7cbe\u51c6\u63a7\u5236\u7ed3\u675f\u54ea\u4e2a\u5faa\u73af\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8egoto\u8bed\u53e5\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 0;\nlp1: LOOP\n  lp2: LOOP\n    SET a = a + 1;\n    IF a &gt; 5 THEN\n        LEAVE lp1; \n    END IF; \n    END LOOP lp2;\nEND LOOP lp1;\nRETURN a;\nEND\n</code></pre> <p>\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684goto\u5199\u6cd5\uff08\u5728JavaSE\u9636\u6bb5\u5df2\u7ecf\u8bb2\u89e3\u8fc7\uff09\uff1a</p> <pre><code>public static void main(String[] args) {\n    int a = 0;\n    lp1: while (true){\n        lp2: while (true){\n            a++;\n            if(a &gt; 5) break lp1;\n        }\n    }\n    System.out.println(a);\n}\n</code></pre> <p>\u5b83\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>\u5faa\u73af\u540d\u79f0 loop ...(\u53ef\u4ee5\u63d2\u5165leave\u8bed\u53e5\u7ed3\u675f) end loop \u5faa\u73af\u540d\u79f0;</li> </ul> <p>\u63a5\u7740\u6211\u4eec\u6765\u770b\u6700\u540e\u4e00\u79cd\u5faa\u73af\u8bed\u53e5\uff0crepeat\u8bed\u53e5\uff1a</p> <pre><code>BEGIN\nDECLARE a INT DEFAULT 0;\nREPEAT\n    SET a = a + 1;\nUNTIL a &gt; 0 END REPEAT;\nRETURN a;\nEND\n</code></pre> <p>\u5b83\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684do-while\u5faa\u73af\u8bed\u53e5\uff0c\u5b83\u4f1a\u5148\u53bb\u6267\u884c\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u518d\u8fdb\u884c\u5224\u65ad\uff0c\u683c\u5f0f\u4e3a\uff1a</p> <ul> <li>repeat ... until \u7ed3\u675f\u5faa\u73af\u6761\u4ef6 end repeat;</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_11","title":"\u5168\u5c40\u53d8\u91cf","text":"<p>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u4e00\u6b21\u4f1a\u8bdd\u4e2d\u76f4\u63a5\u5b9a\u4e49\u53d8\u91cf\u5e76\u4f7f\u7528\uff0c\u8fd9\u65f6\u5b83\u5e76\u4e0d\u662f\u4f4d\u4e8e\u51fd\u6570\u5185\u7684\uff0c\u8fd9\u5c31\u662f\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u65e0\u9700\u9884\u5148\u5b9a\u4e49\uff0c\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff1a</p> <pre><code>set @x = 10;\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u5168\u5c40\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u51fd\u6570\uff1a</p> <pre><code>select test(@x);\n</code></pre> <p>\u9664\u4e86\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\u5168\u90e8\u53d8\u91cf\u4ee5\u5916\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4e5f\u6709\u5f88\u591a\u7684\u53d8\u91cf\uff0c\u56e0\u6b64\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\u53d8\u91cf\u79f0\u4e3a\u7528\u6237\u53d8\u91cf\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u53d8\u91cf\u79f0\u4e3a\u7cfb\u7edf\u53d8\u91cf\u3002\u67e5\u770b\u7cfb\u7edf\u53d8\u91cf\u7684\u547d\u4ee4\u4e3a\uff1a</p> <pre><code>show GLOBAL VARIABLES\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_12","title":"\u5b58\u50a8\u8fc7\u7a0b","text":"<p>\u5b58\u50a8\u8fc7\u7a0b\u662f\u4e00\u4e2a\u5305\u62ec\u591a\u6761SQL\u8bed\u53e5\u7684\u96c6\u5408\uff0c\u4e13\u7528\u4e8e\u7279\u5b9a\u8868\u7684\u7279\u5b9a\u64cd\u4f5c\uff0c\u6bd4\u5982\u6211\u4eec\u4e4b\u524d\u5b9e\u6218\u9879\u76ee\u4e2d\u7684\u521b\u5efa\u7528\u6237\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u4e00\u6b21\u6027\u4e3a\u4e24\u5f20\u8868\u6dfb\u52a0\u6570\u636e\uff0c\u4f46\u662f\u5982\u679c\u4e0d\u4f7f\u7528Java\uff0c\u800c\u662f\u6bcf\u6b21\u90fd\u53bb\u4f7f\u7528SQL\u547d\u4ee4\u6765\u5b8c\u6210\uff0c\u5c31\u9700\u8981\u624b\u52a8\u6572\u4e24\u6b21\u547d\u4ee4\uff0c\u975e\u5e38\u9ebb\u70e6\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u5c06\u8fd9\u4e9b\u64cd\u4f5c\u5b9a\u4e49\u597d\uff0c\u9884\u7559\u51fa\u9700\u8981\u586b\u5199\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0b\u6b21\u8f93\u5165\u53c2\u6570\u76f4\u63a5\u8c03\u7528\u5373\u53ef\u3002</p> <p>\u8fd9\u91cc\u5f88\u5bb9\u6613\u4e0e\u51fd\u6570\u641e\u6df7\u6dc6\uff0c\u5b58\u50a8\u8fc7\u7a0b\u4e5f\u662f\u6267\u884c\u591a\u6761SQL\u8bed\u53e5\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u51fa\u53d1\u70b9\u4e0d\u4e00\u6837\uff0c\u51fd\u6570\u662f\u4e13\u7528\u4e8e\u8fdb\u884c\u6570\u636e\u5904\u7406\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\uff0c\u5b83\u66f4\u591a\u60c5\u51b5\u4e0b\u662f\u4e00\u6761SQL\u8bed\u53e5\u7684\u53c2\u4e0e\u8005\uff0c\u65e0\u6cd5\u76f4\u63a5\u8fd0\u884c\uff0c\u5e76\u4e14\u4e0d\u6d89\u53ca\u67d0\u4e2a\u7279\u5b9a\u8868\uff1a</p> <pre><code>select count(*) from student;\n</code></pre> <p>\u800c\u5b58\u50a8\u8fc7\u7a0b\u662f\u591a\u6761SQL\u8bed\u53e5\u7684\u6267\u884c\u8005\uff0c\u8fd9\u662f\u5b83\u4eec\u7684\u672c\u8d28\u533a\u522b\u3002</p> <p>\u5b9a\u4e49\u5b58\u50a8\u8fc7\u7a0b\u4e0e\u5b9a\u4e49\u51fd\u6570\u6781\u4e3a\u76f8\u4f3c\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5305\u542b\u53c2\u6570\uff0c\u51fd\u6570\u4e2d\u4f7f\u7528\u7684\u8bed\u53e5\u8fd9\u91cc\u4e5f\u80fd\u4f7f\u7528\uff0c\u4f46\u662f\u5b83\u6ca1\u6709\u8fd4\u56de\u503c\uff1a</p> <pre><code>CREATE PROCEDURE lbwnb(`name` VARCHAR(20), pwd VARCHAR(255))\nBEGIN\n  INSERT INTO users(username, `password`) VALUES(`name`, pwd);\nEND\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7f16\u5199\u591a\u6761SQL\u8bed\u53e5\uff0c\u4f46\u662f\u6ce8\u610f\uff0cMySQL\u7684\u5b58\u50a8\u8fc7\u7a0b\u4e0d\u5177\u6709\u539f\u5b50\u6027\uff0c\u5f53\u51fa\u73b0\u9519\u8bef\u65f6\uff0c\u5e76\u4e0d\u4f1a\u56de\u6eda\u4e4b\u524d\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u9700\u8981\u6211\u4eec\u81ea\u5df1\u6765\u7f16\u5199\u4e8b\u52a1\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\uff1a</p> <pre><code>CALL lbwnb('111', '2222')\n</code></pre> <p>\u901a\u8fc7\u4f7f\u7528<code>call</code>\u6765\u6267\u884c\u4e00\u4e2a\u5b58\u50a8\u8fc7\u7a0b\uff0c\u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u6709\u53c2\u6570\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u586b\u5199\u53c2\u6570\u3002</p> <p>\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u67e5\u8be2\u7528\u6237\u8868\uff0c\u5982\u679c\u5305\u542b\u7528\u6237<code>test</code>\u90a3\u4e48\u5c31\u5220\u9664\u7528\u6237\uff0c\u5982\u679c\u4e0d\u5305\u542b\uff0c\u5c31\u6dfb\u52a0\u7528\u6237\uff1a</p> <pre><code>CREATE PROCEDURE `lbwnb`()\nBEGIN\n    IF NOT EXISTS(SELECT * FROM users WHERE username = 'test') THEN\n        INSERT INTO users(username, `password`) VALUES('test', '123456');\n    ELSE\n        DELETE FROM users WHERE username = 'test';\n    END IF;\nEND\n</code></pre> <p>\u8fd9\u91cc\u5176\u5b9e\u53ea\u9700\u8981\u4e00\u4e2a\u7b80\u5355\u7684IF\u5224\u65ad\u5373\u53ef\u5b9e\u73b0\u3002</p> <p>\u90a3\u4e48\u5982\u679c\u6211\u4eec\u5e0c\u671b\u904d\u5386\u4e00\u4e2aSELECT\u8bed\u53e5\u67e5\u8be2\u7684\u7ed3\u679c\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6e38\u6807\u6765\u5b8c\u6210\uff1a</p> <pre><code>BEGIN\n    DECLARE id INT;\n    DECLARE `name` VARCHAR(10);\n    DECLARE sex VARCHAR(5);\n    DECLARE cur CURSOR FOR SELECT * FROM student;\n    OPEN cur;\n    WHILE TRUE DO\n        FETCH cur INTO id, `name`, sex;\n        SELECT id, `name`, sex;\n    END WHILE;\n    CLOSE cur;\nEND\n</code></pre> <p>\u6e38\u6807\u7684\u4f7f\u7528\u5206\u4e3a4\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>DECLARE \u6e38\u6807\u540d\u79f0 CURSOR FOR \u67e5\u8be2\u7ed3\u679c   -  \u5b9a\u4e49\u6e38\u6807</li> <li>OPEN cur     -   \u5f00\u542f\u6e38\u6807</li> <li>FETCH \u6e38\u6807\u540d\u79f0 INTO \u5b58\u50a8\u7ed3\u679c\u7684\u53d8\u91cf    -    \u4ece\u9876\u90e8\u5f00\u59cb\uff0c\u6bcf\u6267\u884c\u4e00\u6b21\uff0c\u5411\u4e0b\u79fb\u52a8\uff0c\u5982\u679c\u5df2\u7ecf\u5728\u6700\u5e95\u90e8\uff0c\u5219\u89e6\u53d1\u5f02\u5e38</li> <li>CLOSE cur    -   \u5173\u95ed\u6e38\u6807</li> </ul> <p>\u6211\u4eec\u8fd9\u91cc\u5229\u7528\u4e86\u4e00\u4e2awhile\u5faa\u73af\u6765\u591a\u6b21\u901a\u8fc7\u6e38\u6807\u83b7\u53d6\u67e5\u8be2\u7ed3\u679c\uff0c\u4f46\u662f\u6700\u540e\u662f\u56e0\u4e3a\u51fa\u73b0\u5f02\u5e38\u624d\u9000\u51fa\u7684\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u4e4b\u540e\u7684\u4ee3\u7801\u5c31\u65e0\u6cd5\u7ee7\u7eed\u6b63\u5e38\u8fd0\u884c\u4e86\u3002</p> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\u5982\u4f55\u5904\u7406\u5f02\u5e38\uff1a</p> <pre><code>BEGIN\n    DECLARE id INT;\n    DECLARE `name` VARCHAR(10);\n    DECLARE sex VARCHAR(5);\n    DECLARE score INT;\n    DECLARE a INT DEFAULT 0;\n    DECLARE cur CURSOR FOR SELECT * FROM student;\n    -- \u5fc5\u987b\u5728\u6e38\u6807\u5b9a\u4e49\u4e4b\u540e\u7f16\u5199\n    DECLARE CONTINUE HANDLER FOR 1329 SET a = 1;\n    OPEN cur;\n    WHILE a = 0 DO\n        FETCH cur INTO id, `name`, sex, score;\n        SELECT id, `name`, sex, score;\n    END WHILE;\n    CLOSE cur;\n    SELECT 1;\nEND\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2a\u5f02\u5e38\u5904\u7406\u5668\uff08\u53e5\u67c4\uff09\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>declear (continue/exit) handler for \u5f02\u5e38\u540d\u79f0(ID) \u505a\u70b9\u4ec0\u4e48</li> </ul> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u9650\u5b9a\u5b58\u50a8\u8fc7\u7a0b\u7684\u53c2\u6570\u4f20\u9012\uff0c\u6bd4\u5982\u6211\u4eec\u53ea\u5e0c\u671b\u7528\u6237\u7ed9\u6211\u4eec\u4e00\u4e2a\u53c2\u6570\u7528\u4e8e\u63a5\u6536\u6570\u636e\uff0c\u800c\u4e0d\u662f\u503c\u4f20\u9012\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u8bbe\u5b9a\u4e3aOUT\u7c7b\u578b\uff1a</p> <pre><code>CREATE PROCEDURE `lbwnb`(OUT a INT)\nBEGIN\n    SELECT a;\n    SET a = 100;\nEND\n</code></pre> <p>\u6240\u6709\u7684\u53c2\u6570\u9ed8\u8ba4\u4e3a<code>IN</code>\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u53ea\u80fd\u4f5c\u4e3a\u4f20\u5165\u53c2\u6570\uff0c\u65e0\u6cd5\u4e3a\u5176\u8d4b\u503c\uff0c\u800c\u8fd9\u91cc\u8bb2\u53c2\u6570\u8bbe\u5b9a\u4e3a<code>OUT</code>\u7c7b\u578b\uff0c\u90a3\u4e48\u53c2\u6570\u65e0\u6cd5\u5c06\u503c\u4f20\u5165\uff0c\u800c\u53ea\u80fd\u88ab\u8d4b\u503c\u3002</p> <p>\u5982\u679c\u6211\u4eec\u65e2\u5e0c\u671b\u53c2\u6570\u53ef\u4ee5\u4f20\u5165\u4e5f\u53ef\u4ee5\u88ab\u91cd\u65b0\u8d4b\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u4fee\u6539\u4e3a<code>INOUT</code>\u7c7b\u578b\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_13","title":"\u5b58\u50a8\u5f15\u64ce","text":"<p>\u5b58\u50a8\u5f15\u64ce\u5c31\u50cf\u6211\u4eec\u7535\u8111\u4e2d\u7684CPU\uff0c\u5b83\u662f\u6574\u4e2aMySQL\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5982\u4f55\u5b58\u50a8\uff0c\u6570\u636e\u5e93\u80fd\u591f\u652f\u6301\u54ea\u4e9b\u529f\u80fd\uff0c\u6211\u4eec\u7684\u589e\u5220\u6539\u67e5\u8bf7\u6c42\u5982\u4f55\u6267\u884c\uff0c\u90fd\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u6765\u51b3\u5b9a\u7684\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u4e86\u89e3\u4e00\u4e0b\u4ee5\u4e0b\u4e09\u79cd\u5b58\u50a8\u5f15\u64ce\uff1a</p> <ul> <li>MyISAM\uff1aMySQL5.5\u4e4b\u524d\u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\uff0c\u5728\u63d2\u5165\u548c\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b\u6027\u80fd\u5f88\u9ad8\uff0c\u4f46\u662f\u5b83\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u53ea\u80fd\u6dfb\u52a0\u8868\u7ea7\u9501\u3002</li> <li>InnoDB\uff1aMySQL5.5\u4e4b\u540e\u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u652f\u6301ACID\u4e8b\u52a1\u3001\u884c\u7ea7\u9501\u3001\u5916\u952e\uff0c\u4f46\u662f\u6027\u80fd\u6bd4\u4e0d\u8fc7MyISAM\uff0c\u66f4\u52a0\u6d88\u8017\u8d44\u6e90\u3002</li> <li>Memory\uff1a\u6570\u636e\u90fd\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u6570\u636e\u5e93\u91cd\u542f\u6216\u53d1\u751f\u5d29\u6e83\uff0c\u8868\u4e2d\u7684\u6570\u636e\u90fd\u5c06\u6d88\u5931\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u67e5\u770bMySQL\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce\uff1a</p> <pre><code>show engines;\n</code></pre> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e3a\u8868\u6307\u5b9a\u5176\u5b58\u50a8\u5f15\u64ce\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fee\u6539\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5728Windows 11\u7cfb\u7edf\u4e0b\uff0cMySQL\u7684\u914d\u7f6e\u6587\u4ef6\u9ed8\u8ba4\u653e\u5728<code>C:\\ProgramData\\MySQL\\MySQL Server 5.7</code>\u4e2d\uff0c\u6ce8\u610fProgramData\u662f\u4e2a\u9690\u85cf\u6587\u4ef6\u5939\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_14","title":"\u7d22\u5f15","text":"<p>\u6ce8\u610f\uff1a\u672c\u5c0f\u8282\u4f1a\u6d89\u53ca<code>\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5</code>\u76f8\u5173\u77e5\u8bc6\u3002</p> <p>\u7d22\u5f15\u5c31\u597d\u50cf\u6211\u4eec\u4e66\u7684\u76ee\u5f55\uff0c\u6bcf\u672c\u4e66\u90fd\u6709\u4e00\u4e2a\u76ee\u5f55\u7528\u4e8e\u6211\u4eec\u5feb\u901f\u5b9a\u4f4d\u6211\u4eec\u60f3\u8981\u7684\u5185\u5bb9\u5728\u54ea\u4e00\u9875\uff0c\u7d22\u5f15\u4e5f\u662f\uff0c\u901a\u8fc7\u5efa\u7acb\u7d22\u5f15\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u7d22\u5f15\u6765\u5feb\u901f\u627e\u5230\u60f3\u8981\u7684\u4e00\u6761\u8bb0\u5f55\uff0c\u5927\u5927\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u3002</p> <p>\u672c\u7248\u5757\u6211\u4eec\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u7d22\u5f15\u7684\u51e0\u79cd\u7c7b\u578b\uff0c\u4ee5\u53ca\u7d22\u5f15\u7684\u5e95\u5c42\u5b58\u50a8\u539f\u7406\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_15","title":"\u5355\u5217\u7d22\u5f15","text":"<p>\u5355\u5217\u7d22\u5f15\u53ea\u9488\u5bf9\u4e8e\u67d0\u4e00\u5217\u6570\u636e\u521b\u5efa\u7d22\u5f15\uff0c\u5355\u5217\u7d22\u5f15\u6709\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff1a</p> <ul> <li>NORMAL\uff1a\u666e\u901a\u7684\u7d22\u5f15\u7c7b\u578b\uff0c\u5b8c\u5b8c\u5168\u5168\u76f8\u5f53\u4e8e\u4e00\u672c\u4e66\u7684\u76ee\u5f55\u3002</li> <li>UNIQUE\uff1a\u552f\u4e00\u7d22\u5f15\uff0c\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u7528\u8fc7\u4e86\uff0c\u4e00\u65e6\u5efa\u7acb\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48\u6574\u4e2a\u5217\u4e2d\u5c06\u4e0d\u5141\u8bb8\u51fa\u73b0\u91cd\u590d\u6570\u636e\u3002\u6bcf\u4e2a\u8868\u7684\u4e3b\u952e\u5217\uff0c\u90fd\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u552f\u4e00\u7d22\u5f15\uff0c\u53eb\u505aPrimary Key\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u8981\u6c42\u4e0d\u5141\u8bb8\u51fa\u73b0\u91cd\u590d\uff0c\u8fd8\u8981\u6c42\u4e0d\u80fd\u4e3aNULL\uff0c\u5b83\u8fd8\u53ef\u4ee5\u81ea\u52a8\u9012\u589e\u3002\u6bcf\u5f20\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u552f\u4e00\u7d22\u5f15\uff0c\u4f46\u662f\u53ea\u80fd\u6709\u4e00\u4e2aPrimary\u7d22\u5f15\u3002</li> <li>SPATIAL\uff1a\u7a7a\u95f4\u7d22\u5f15\uff0c\u7a7a\u95f4\u7d22\u5f15\u662f\u5bf9\u7a7a\u95f4\u6570\u636e\u7c7b\u578b\u7684\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\uff0cMYSQL\u4e2d\u7684\u7a7a\u95f4\u6570\u636e\u7c7b\u578b\u67094\u79cd\uff0c\u5206\u522b\u662fGEOMETRY\u3001POINT\u3001LINESTRING\u3001POLYGON\uff0c\u4e0d\u662f\u5f88\u5e38\u7528\uff0c\u8fd9\u91cc\u4e0d\u505a\u4ecb\u7ecd\u3002</li> <li>FULLTEXT\uff1a\u5168\u6587\u7d22\u5f15\uff08MySQL 5.6 \u4e4b\u540eInnoDB\u624d\u652f\u6301\uff09\uff0c\u5b83\u662f\u6a21\u7cca\u5339\u914d\u7684\u4e00\u79cd\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5b83\u7684\u6548\u7387\u8981\u6bd4\u4f7f\u7528<code>like %</code>\u66f4\u9ad8\uff0c\u5e76\u4e14\u5b83\u8fd8\u652f\u6301\u591a\u79cd\u5339\u914d\u65b9\u5f0f\uff0c\u7075\u6d3b\u6027\u4e5f\u66f4\u52a0\u5f3a\u5927\u3002\u53ea\u6709\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u4e3a char\u3001varchar\u3001text \u53ca\u5176\u7cfb\u5217\u624d\u53ef\u4ee5\u5efa\u5168\u6587\u7d22\u5f15\u3002</li> </ul> <p>\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u4f7f\u7528\u5168\u6587\u7d22\u5f15\uff0c\u9996\u5148\u521b\u5efa\u4e00\u5f20\u7528\u4e8e\u6d4b\u8bd5\u5168\u6587\u7d22\u5f15\u7684\u8868\uff1a</p> <pre><code>CREATE TABLE articles (\n  id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,\n  title VARCHAR(200),\n  body TEXT,\n  FULLTEXT (body));\n</code></pre> <pre><code>INSERT INTO articles VALUES\n    (NULL,'MySQL Tutorial', 'DBMS stands for DataBase ...'),\n    (NULL,'How To Use MySQL Efficiently', 'After you went through a ...'),\n    (NULL,'Optimising MySQL','In this tutorial we will show ...'),\n    (NULL,'1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),\n    (NULL,'MySQL vs. YourSQL', 'In the following database comparison ...'),\n    (NULL,'MySQL Security', 'When configured properly, MySQL ...');\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u4f7f\u7528\u5168\u6587\u7d22\u5f15\u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff1a</p> <pre><code>SELECT * FROM articles WHERE MATCH (body) AGAINST ('database');\n</code></pre> <p>\u6ce8\u610f\u5168\u6587\u7d22\u5f15\u5982\u4f55\u5b9a\u4e49\u5b57\u6bb5\u7684\uff0cmatch\u4e2d\u5c31\u5fc5\u987b\u662f\u54ea\u4e9b\u5b57\u6bb5\uff0cagainst\u4e2d\u5b9a\u4e49\u9700\u8981\u6a21\u7cca\u5339\u914d\u7684\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u7528\u4f5c\u67e5\u627e\u7684\u5b57\u7b26\u4e32\u5b9e\u9645\u4e0a\u662f\u88ab\u5206\u8bcd\u4e4b\u540e\u7684\u7ed3\u679c\uff0c\u5982\u679c\u8fdb\u884c\u6a21\u7cca\u5339\u914d\u7684\u4e0d\u662f\u4e00\u4e2a\u8bcd\u8bed\uff0c\u90a3\u4e48\u4f1a\u67e5\u627e\u5931\u8d25\uff0c\u4f46\u662f\u5b83\u7684\u6548\u7387\u8fdc\u9ad8\u4e8e\u4ee5\u4e0b\u8fd9\u79cd\u5199\u6cd5\uff1a</p> <pre><code>SELECT * FROM articles WHERE body like '%database%';\n</code></pre>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_16","title":"\u7ec4\u5408\u7d22\u5f15","text":"<p>\u7ec4\u5408\u7d22\u5f15\u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u591a\u884c\u6346\u7ed1\u5728\u4e00\u8d77\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u7d22\u5f15\uff0c\u5b83\u540c\u6837\u652f\u6301\u4ee5\u4e0a\u51e0\u79cd\u7d22\u5f15\u7c7b\u578b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728Navicat\u4e2d\u8fdb\u884c\u6f14\u793a\u3002</p> <p>\u6ce8\u610f\u7ec4\u5408\u7d22\u5f15\u5728\u8fdb\u884c\u5339\u914d\u65f6\uff0c\u9075\u5faa\u6700\u5de6\u539f\u5219\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>explain</code>\u8bed\u53e5\uff08\u5b83\u53ef\u4ee5\u7528\u4e8e\u5206\u6790select\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff0c\u4e5f\u5c31\u662fMySQL\u5230\u5e95\u662f\u5982\u4f55\u5728\u6267\u884c\u67d0\u6761select\u8bed\u53e5\u7684\uff09\u6765\u5206\u6790\u67e5\u8be2\u8bed\u53e5\u5230\u5e95\u6709\u6ca1\u6709\u901a\u8fc7\u7d22\u5f15\u8fdb\u884c\u5339\u914d\u3002</p> <pre><code>explain select * from student where name = '\u5c0f\u738b';\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <ul> <li>select_type\uff1a\u67e5\u8be2\u7c7b\u578b\uff0c\u4e0a\u9762\u7684\u5c31\u662f\u7b80\u5355\u67e5\u8be2\uff08SIMPLE\uff09</li> <li>table\uff1a\u67e5\u8be2\u7684\u8868</li> <li>type\uff1aMySQL\u51b3\u5b9a\u5982\u4f55\u67e5\u627e\u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u6548\u7387\u4ece\u9ad8\u5230\u4f4e\uff1asystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</li> <li>possible_keys\uff1a\u6267\u884c\u67e5\u8be2\u65f6\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u7d22\u5f15</li> <li>key\uff1a\u5b9e\u9645\u4f7f\u7528\u7684\u7d22\u5f15</li> <li>key_len\uff1aMysql\u5728\u7d22\u5f15\u91cc\u4f7f\u7528\u7684\u5b57\u8282\u6570\uff0c\u5b57\u6bb5\u7684\u6700\u5927\u53ef\u80fd\u957f\u5ea6</li> <li>rows\uff1a\u626b\u63cf\u7684\u884c\u6570</li> <li>extra\uff1a\u9644\u52a0\u8bf4\u660e</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_17","title":"\u7d22\u5f15\u5e95\u5c42\u539f\u7406","text":"<p>\u5728\u4e86\u89e3\u5b8c\u4e86\u7d22\u5f15\u7684\u7c7b\u578b\u4e4b\u540e\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\u770b\u7d22\u5f15\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002</p> <p>\u65e2\u7136\u6211\u4eec\u8981\u901a\u8fc7\u7d22\u5f15\u6765\u5feb\u901f\u67e5\u627e\u5185\u5bb9\uff0c\u90a3\u4e48\u5982\u4f55\u8bbe\u8ba1\u7d22\u5f15\u5c31\u662f\u6211\u4eec\u7684\u91cd\u70b9\u5185\u5bb9\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u7684\uff0c\u8ddf\u6211\u4eec\u4e4b\u524d\u4f7f\u7528\u7684HashMap\u4e4b\u7c7b\u7684\u4e0d\u540c\uff0c\u5b83\u4eec\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u4f46\u662f\u786c\u76d8\u7684\u8bfb\u53d6\u901f\u5ea6\u8fdc\u5c0f\u4e8e\u5185\u5b58\u7684\u901f\u5ea6\uff0c\u6bcf\u4e00\u6b21IO\u64cd\u4f5c\u90fd\u4f1a\u8017\u8d39\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u6211\u4eec\u4e5f\u4e0d\u53ef\u80fd\u628a\u6574\u4e2a\u78c1\u76d8\u4e0a\u7684\u7d22\u5f15\u5168\u90e8\u5bfc\u5165\u5185\u5b58\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8003\u8651\u5c3d\u53ef\u80fd\u591a\u7684\u51cf\u5c11IO\u6b21\u6570\uff0c\u7d22\u5f15\u7684\u5b9e\u73b0\u53ef\u4ee5\u4f9d\u9760\u4e24\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e00\u79cd\u662f\u6211\u4eec\u5728JavaSE\u9636\u6bb5\u5df2\u7ecf\u5b66\u4e60\u8fc7\u7684Hash\u8868\uff0c\u8fd8\u6709\u4e00\u79cd\u5c31\u662fB-Tree\u3002</p> <p>\u6211\u4eec\u9996\u5148\u6765\u770b\u770b\u54c8\u5e0c\u8868\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u8ba1\u7b97Hash\u503c\u6765\u5feb\u901f\u5b9a\u4f4d\uff1a</p> <p></p> <p>\u901a\u8fc7\u5bf9Key\u8fdb\u884c\u6563\u5217\u503c\u8ba1\u7b97\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u5bf9\u5e94\u6570\u636e\u7684\u5b58\u653e\u4f4d\u7f6e\uff0c\u5b83\u7684\u67e5\u8be2\u6548\u7387\u80fd\u591f\u8fbe\u5230O(1)\uff0c\u4f46\u662f\u5b83\u4e5f\u5b58\u5728\u4e00\u5b9a\u7684\u7f3a\u9677\uff1a</p> <ul> <li>Hash\u7d22\u5f15\u4ec5\u4ec5\u80fd\u6ee1\u8db3\u201c=\u201d\uff0c\u201cin\u201d\u67e5\u8be2\u6761\u4ef6\uff0c\u4e0d\u80fd\u4f7f\u7528\u8303\u56f4\u67e5\u8be2\u3002 </li> <li>Hash\u78b0\u649e\u95ee\u9898\u3002</li> <li>\u4e0d\u80fd\u7528\u90e8\u5206\u7d22\u5f15\u952e\u6765\u641c\u7d22\uff0c\u56e0\u4e3a\u7ec4\u5408\u7d22\u5f15\u5728\u8ba1\u7b97\u54c8\u5e0c\u503c\u7684\u65f6\u5019\u662f\u4e00\u8d77\u8ba1\u7b97\u7684\u3002</li> </ul> <p>\u90a3\u4e48\uff0c\u65e2\u7136\u8981\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u8fd8\u6709\u4e00\u79cd\u65b9\u6848\u5c31\u662f\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u4e8c\u53c9\u6811\u90a3\u6837\u7684\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u7d22\u5f15\uff0c\u4f46\u662f\u8fd9\u6837\u76f8\u6bd4\u4f7f\u7528Hash\u7d22\u5f15\uff0c\u4f1a\u727a\u7272\u4e00\u5b9a\u7684\u8bfb\u53d6\u901f\u5ea6\u3002</p> <p>\u4f46\u662f\u8fd9\u91cc\u5e76\u6ca1\u6709\u4f7f\u7528\u4e8c\u53c9\u6811\uff0c\u800c\u662f\u4f7f\u7528\u4e86BTree\uff0c\u5b83\u662f\u4e13\u95e8\u4e3a\u78c1\u76d8\u6570\u636e\u8bfb\u53d6\u8bbe\u8ba1\u7684\u4e00\u79cd\u5ea6\u4e3an\u7684\u67e5\u627e\u6811\uff1a</p> <ul> <li>\u6811\u4e2d\u6bcf\u4e2a\u7ed3\u70b9\u6700\u591a\u542b\u6709m\u4e2a\u5b69\u5b50\uff08m &gt;= 2\uff09</li> <li>\u9664\u6839\u7ed3\u70b9\u548c\u53f6\u5b50\u7ed3\u70b9\u5916\uff0c\u5176\u5b83\u6bcf\u4e2a\u7ed3\u70b9\u81f3\u5c11\u6709[ceil(m / 2)]\u4e2a\u5b69\u5b50\u3002</li> <li>\u82e5\u6839\u7ed3\u70b9\u4e0d\u662f\u53f6\u5b50\u7ed3\u70b9\uff0c\u5219\u81f3\u5c11\u67092\u4e2a\u5b69\u5b50\u3002</li> <li>\u6240\u6709\u53f6\u5b50\u7ed3\u70b9\u90fd\u51fa\u73b0\u5728\u540c\u4e00\u5c42\u3002</li> <li> <p>\u6bcf\u4e2a\u975e\u7ec8\u7aef\u7ed3\u70b9\u4e2d\u5305\u542b\u6709n\u4e2a\u952e\u503c\u4fe1\u606f\uff1a (P1\uff0cK1\uff0cP2\uff0cK2\uff0cP3\uff0c......\uff0cKn\uff0cPn+1)\u3002\u5176\u4e2d\uff1a </p> </li> <li> <p>Ki (i=1...n)\u4e3a\u952e\u503c\uff0c\u4e14\u952e\u503c\u6309\u987a\u5e8f\u5347\u5e8f\u6392\u5e8fK(i-1)&lt; Ki\u3002  </p> </li> <li>Pi\u4e3a\u6307\u5411\u5b50\u6811\u6839\u7684\u7ed3\u70b9\uff0c\u4e14\u6307\u9488P(i)\u6307\u5411\u7684\u5b50\u6811\u4e2d\u6240\u6709\u7ed3\u70b9\u7684\u952e\u503c\u5747\u5c0f\u4e8eKi\uff0c\u4f46\u90fd\u5927\u4e8eK(i-1)\u3002  </li> <li>\u952e\u503c\u7684\u4e2a\u6570n\u5fc5\u987b\u6ee1\u8db3\uff1a [ceil(m / 2)-1] &lt;= n &lt;= m-1\u3002</li> </ul> <p></p> <p>\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u8981\u5bf9\u952e\u503c\u4e3a10\u7684\u8bb0\u5f55\u8fdb\u884c\u67e5\u627e\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u8bfb\u53d6\u6839\u8282\u70b9\u6570\u636e\uff08\u76ee\u524d\u8fdb\u884c\u4e86\u4e00\u6b21IO\u64cd\u4f5c\uff09</li> <li>\u6839\u636e\u6839\u8282\u70b9\u6570\u636e\u8fdb\u884c\u5224\u65ad\u5f97\u523010&lt;17\uff0c\u56e0\u4e3aP1\u6307\u5411\u7684\u5b50\u6811\u4e2d\u6240\u6709\u503c\u90fd\u662f\u5c0f\u4e8e17\u7684\uff0c\u6240\u4ee5\u8fd9\u65f6\u6211\u4eec\u5c06P1\u6307\u5411\u7684\u8282\u70b9\u8bfb\u53d6\uff08\u76ee\u524d\u8fdb\u884c\u4e86\u4e24\u6b21IO\u64cd\u4f5c\uff09</li> <li>\u518d\u6b21\u8fdb\u884c\u5224\u65ad\uff0c\u5f97\u52308&lt;10&lt;12\uff0c\u56e0\u4e3aP2\u6307\u5411\u7684\u5b50\u6811\u4e2d\u6240\u6709\u7684\u503c\u90fd\u662f\u5c0f\u4e8e12\u5927\u4e8e8\u7684\uff0c\u6240\u4ee5\u8fd9\u65f6\u8bfb\u53d6P2\u6307\u5411\u7684\u8282\u70b9\uff08\u76ee\u524d\u8fdb\u884c\u4e86\u4e09\u6b21IO\u64cd\u4f5c\uff09</li> <li>\u6210\u529f\u627e\u5230\u3002</li> </ol> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u867d\u7136BTree\u80fd\u591f\u5f88\u597d\u5730\u5229\u7528\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u601d\u60f3\u5927\u5e45\u5ea6\u51cf\u5c11\u67e5\u627e\u6b21\u6570\uff0c\u4f46\u662f\u5b83\u7684\u67e5\u627e\u6548\u7387\u8fd8\u662f\u5f88\u4f4e\uff0c\u56e0\u6b64\u5b83\u7684\u4f18\u5316\u7248\u672cB+Tree\u8bde\u751f\u4e86\uff0c\u5b83\u62e5\u6709\u66f4\u7a33\u5b9a\u7684\u67e5\u8be2\u6548\u7387\u548c\u66f4\u4f4e\u7684IO\u8bfb\u53d6\u6b21\u6570\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b83\u548cBTree\u6709\u4e00\u5b9a\u7684\u533a\u522b\uff1a</p> <ul> <li>\u6709n\u68f5\u5b50\u6811\u7684\u7ed3\u70b9\u4e2d\u542b\u6709n\u4e2a\u952e\u503c\uff0cBTree\u53ea\u6709n-1\u4e2a\u3002</li> <li>\u6240\u6709\u7684\u952e\u503c\u4fe1\u606f\u53ea\u5728\u53f6\u5b50\u8282\u70b9\u4e2d\u5305\u542b\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u4ec5\u4ec5\u4fdd\u5b58\u5b50\u8282\u70b9\u7684\u6700\u5c0f\uff08\u6216\u6700\u5927\uff09\u503c\uff0c\u548c\u6307\u5411\u53f6\u5b50\u8282\u70b9\u7684\u6307\u9488\uff0c\u8fd9\u6837\u76f8\u6bd4BTree\u6bcf\u4e00\u4e2a\u8282\u70b9\u5728\u786c\u76d8\u4e2d\u5b58\u653e\u4e86\u66f4\u5c11\u7684\u5185\u5bb9\uff08\u6ca1\u6709\u952e\u503c\u4fe1\u606f\u4e86\uff09</li> <li>\u6240\u6709\u53f6\u5b50\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u6839\u636e\u5927\u5c0f\u987a\u5e8f\u6307\u5411\u4e0b\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u7684\u6307\u9488Q\uff0c\u672c\u8d28\u4e0a\u6570\u636e\u5c31\u662f\u4e00\u4e2a\u94fe\u8868\u3002</li> </ul> <p>\u8fd9\u6837\uff0c\u8bfb\u53d6IO\u7684\u65f6\u95f4\u76f8\u6bd4BTree\u5c31\u51cf\u5c11\u4e86\u5f88\u591a\uff0c\u5e76\u4e14\u67e5\u8be2\u4efb\u4f55\u952e\u503c\u4fe1\u606f\u90fd\u9700\u8981\u5b8c\u6574\u5730\u8d70\u5230\u53f6\u5b50\u8282\u70b9\uff0c\u4fdd\u8bc1\u4e86\u67e5\u8be2\u7684IO\u8bfb\u53d6\u6b21\u6570\u4e00\u81f4\u3002\u56e0\u6b64MySQL\u9ed8\u8ba4\u9009\u62e9B+Tree\u4f5c\u4e3a\u7d22\u5f15\u7684\u5b58\u50a8\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u8fd9\u662fMyISAM\u5b58\u50a8\u5f15\u64ce\u4e0b\u7684B+Tree\u5b9e\u73b0\uff1a</p> <p></p> <p>\u8fd9\u662fInnoDB\u5b58\u50a8\u5f15\u64ce\u4e0b\u7684B+Tree\u5b9e\u73b0\uff1a</p> <p></p> <p></p> <p>InnoDB\u4e0eMyISAM\u5b9e\u73b0\u7684\u4e0d\u540c\u4e4b\u5904\uff1a</p> <ul> <li>\u6570\u636e\u672c\u8eab\u5c31\u662f\u7d22\u5f15\u7684\u4e00\u90e8\u5206\uff08\u6240\u4ee5\u8fd9\u91cc\u5efa\u8bae\u4e3b\u952e\u4f7f\u7528\u81ea\u589e\uff09</li> <li>\u975e\u4e3b\u952e\u7d22\u5f15\u7684\u6570\u636e\u5b9e\u9645\u4e0a\u5b58\u50a8\u7684\u662f\u5bf9\u5e94\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\uff08\u56e0\u6b64InnoDB\u5fc5\u987b\u6709\u4e3b\u952e\uff0c\u82e5\u6ca1\u6709\u4e5f\u4f1a\u81ea\u52a8\u67e5\u627e\u66ff\u4ee3\uff09</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_18","title":"\u9501\u673a\u5236","text":"<p>\u5728JavaSE\u7684\u5b66\u4e60\u4e2d\uff0c\u6211\u4eec\u5728\u591a\u7ebf\u7a0b\u677f\u5757\u9996\u6b21\u7528\u5230\u4e86\u9501\u673a\u5236\uff0c\u5f53\u6211\u4eec\u5bf9\u67d0\u4e2a\u65b9\u6cd5\u6216\u662f\u67d0\u4e2a\u4ee3\u7801\u5757\u52a0\u9501\u540e\uff0c\u9664\u975e\u9501\u7684\u6301\u6709\u8005\u91ca\u653e\u5f53\u524d\u7684\u9501\uff0c\u5426\u5219\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u8fdb\u5165\u6b64\u65b9\u6cd5\u6216\u662f\u4ee3\u7801\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u9501\u673a\u5236\u6765\u4fdd\u8bc1\u591a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5b89\u5168\u6027\u3002</p> <p>\u5728MySQL\u4e2d\uff0c\u5c31\u5f88\u5bb9\u6613\u51fa\u73b0\u591a\u7ebf\u7a0b\u540c\u65f6\u64cd\u4f5c\u8868\u4e2d\u6570\u636e\u7684\u60c5\u51b5\uff0c\u5982\u679c\u8981\u907f\u514d\u6f5c\u5728\u7684\u5e76\u53d1\u95ee\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e4b\u524d\u8bb2\u89e3\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6765\u5904\u7406\uff0c\u800c\u4e8b\u52a1\u9694\u79bb\u4e2d\u5229\u7528\u4e86\u9501\u673a\u5236\u3002</p> <ul> <li>\u8bfb\u672a\u63d0\u4ea4(Read Uncommitted)\uff1a\u80fd\u591f\u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u4e2d\u672a\u63d0\u4ea4\u7684\u5185\u5bb9\uff0c\u5b58\u5728\u810f\u8bfb\u95ee\u9898\u3002</li> <li>\u8bfb\u5df2\u63d0\u4ea4(Read Committed RC)\uff1a\u53ea\u80fd\u8bfb\u53d6\u5176\u4ed6\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u7684\u5185\u5bb9\uff0c\u5b58\u5728\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u3002</li> <li>\u53ef\u91cd\u590d\u8bfb(Repeated Read RR)\uff1a\u5728\u8bfb\u53d6\u67d0\u884c\u540e\u4e0d\u5141\u8bb8\u5176\u4ed6\u4e8b\u52a1\u64cd\u4f5c\u6b64\u884c\uff0c\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\uff0c\u4f46\u662f\u4f9d\u7136\u5b58\u5728\u5e7b\u8bfb\u95ee\u9898\u3002</li> <li>\u4e32\u884c\u8bfb(Serializable)\uff1a\u4e00\u4e2a\u4e8b\u52a1\u7684\u5f00\u59cb\u5fc5\u987b\u7b49\u5f85\u53e6\u4e00\u4e2a\u4e8b\u52a1\u7684\u5b8c\u6210\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u5207\u6362\u9694\u79bb\u7ea7\u522b\u5206\u522b\u6f14\u793a\u4e00\u4e0b\uff1a</p> <pre><code>set session transaction isolation level read uncommitted;\n</code></pre> <p>\u5728RR\u7ea7\u522b\u4e0b\uff0cMySQL\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u4e86\u5e7b\u8bfb\u95ee\u9898\uff1a</p> <ul> <li>\u5728\u5feb\u7167\u8bfb\uff08\u4e0d\u52a0\u9501\uff09\u8bfb\u60c5\u51b5\u4e0b\uff0cmysql\u901a\u8fc7mvcc\u6765\u907f\u514d\u5e7b\u8bfb\u3002</li> <li>\u5728\u5f53\u524d\u8bfb\uff08\u52a0\u9501\uff09\u8bfb\u60c5\u51b5\u4e0b\uff0cmysql\u901a\u8fc7next-key\u6765\u907f\u514d\u5e7b\u8bfb\u3002</li> </ul> <p><code>MVCC</code>\uff0c\u5168\u79f0 <code>Multi-Version Concurrency Control</code> \uff0c\u5373\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u3002MVCC \u662f\u4e00\u79cd\u5e76\u53d1\u63a7\u5236\u7684\u65b9\u6cd5\uff0c\u4e00\u822c\u5728\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u5b9e\u73b0\u5bf9\u6570\u636e\u5e93\u7684\u5e76\u53d1\u8bbf\u95ee\uff0c\u5728\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5b9e\u73b0\u4e8b\u52a1\u5185\u5b58\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_19","title":"\u8bfb\u9501\u548c\u5199\u9501","text":"<p>\u4ece\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u7c7b\u578b\u4e0a\u6765\u8bf4\uff0c\u9501\u5206\u4e3a\u8bfb\u9501\u548c\u5199\u9501\uff1a</p> <ul> <li>\u8bfb\u9501\uff1a\u4e5f\u53eb\u5171\u4eab\u9501\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6dfb\u52a0\u4e86\u8bfb\u9501\u540e\uff0c\u5176\u4ed6\u7684\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u8bfb\u9501\u6216\u662f\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u80fd\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u53ea\u80fd\u7b49\u5230\u6240\u6709\u7684\u8bfb\u9501\u5168\u90e8\u91ca\u653e\u3002</li> <li>\u5199\u9501\uff1a\u4e5f\u53eb\u6392\u4ed6\u9501\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6dfb\u52a0\u4e86\u5199\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e0d\u80fd\u8bfb\u4e0d\u80fd\u5199\u4e5f\u4e0d\u80fd\u6dfb\u52a0\u4efb\u4f55\u9501\uff0c\u53ea\u80fd\u7b49\u5f85\u5f53\u524d\u4e8b\u52a1\u91ca\u653e\u9501\u3002</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_20","title":"\u5168\u5c40\u9501\u3001\u8868\u9501\u548c\u884c\u9501","text":"<p>\u4ece\u9501\u7684\u4f5c\u7528\u8303\u56f4\u4e0a\u5212\u5206\uff0c\u5206\u4e3a\u5168\u5c40\u9501\u3001\u8868\u9501\u548c\u884c\u9501\uff1a</p> <ul> <li>\u5168\u5c40\u9501\uff1a\u9501\u4f5c\u7528\u4e8e\u5168\u5c40\uff0c\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6240\u6709\u64cd\u4f5c\u5168\u90e8\u53d7\u5230\u9501\u9650\u5236\u3002</li> <li>\u8868\u9501\uff1a\u9501\u4f5c\u7528\u4e8e\u6574\u4e2a\u8868\uff0c\u6240\u6709\u5bf9\u8868\u7684\u64cd\u4f5c\u90fd\u4f1a\u6536\u5230\u9501\u9650\u5236\u3002</li> <li>\u884c\u9501\uff1a\u9501\u4f5c\u7528\u4e8e\u8868\u4e2d\u7684\u67d0\u4e00\u884c\uff0c\u53ea\u4f1a\u901a\u8fc7\u9501\u9650\u5236\u5bf9\u67d0\u4e00\u884c\u7684\u64cd\u4f5c\uff08\u4ec5InnoDB\u652f\u6301\uff09</li> </ul>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_21","title":"\u5168\u5c40\u9501","text":"<p>\u6211\u4eec\u9996\u5148\u6765\u770b\u5168\u5c40\u9501\uff0c\u5b83\u4f5c\u7528\u4e8e\u6574\u4e2a\u6570\u636e\u5e93\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u5f00\u542f\u8bfb\u5168\u5c40\u9501\uff1a</p> <pre><code>flush tables with read lock;\n</code></pre> <p>\u5f00\u542f\u540e\uff0c\u6574\u4e2a\u6570\u636e\u5e93\u88ab\u4e0a\u8bfb\u9501\uff0c\u6211\u4eec\u53ea\u80fd\u53bb\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u5141\u8bb8\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u5305\u62ec\u66f4\u65b0\u3001\u63d2\u5165\u3001\u5220\u9664\u7b49\uff09\u4e00\u65e6\u6267\u884c\u5199\u64cd\u4f5c\uff0c\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u89e3\u9501\uff1a</p> <pre><code>unlock tables;\n</code></pre> <p>\u9664\u4e86\u624b\u52a8\u91ca\u653e\u9501\u4e4b\u5916\uff0c\u5f53\u6211\u4eec\u7684\u4f1a\u8bdd\u7ed3\u675f\u540e\uff0c\u9501\u4e5f\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_22","title":"\u8868\u9501","text":"<p>\u8868\u9501\u4f5c\u7528\u4e8e\u67d0\u4e00\u5f20\u8868\uff0c\u4e5f\u662fMyISAM\u548cInnoDB\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u4e3a\u8868\u6dfb\u52a0\u9501\uff1a</p> <pre><code>lock table \u8868\u540d\u79f0 read/write;\n</code></pre> <p>\u5728\u6211\u4eec\u4e3a\u8868\u6dfb\u52a0\u5199\u9501\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u4ed6\u5730\u65b9\u662f\u65e0\u6cd5\u8bbf\u95ee\u6b64\u8868\u7684\uff0c\u4e00\u5f8b\u90fd\u88ab\u963b\u585e\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_23","title":"\u884c\u9501","text":"<p>\u8868\u9501\u7684\u4f5c\u7528\u8303\u56f4\u592a\u5e7f\u4e86\uff0c\u5982\u679c\u6211\u4eec\u4ec5\u4ec5\u53ea\u662f\u5bf9\u67d0\u4e00\u884c\u8fdb\u884c\u64cd\u4f5c\uff0c\u90a3\u4e48\u5927\u53ef\u4e0d\u5fc5\u5bf9\u6574\u4e2a\u8868\u8fdb\u884c\u52a0\u9501\uff0c\u56e0\u6b64<code>InnoDB</code>\u652f\u6301\u4e86\u884c\u9501\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u5bf9\u67d0\u4e00\u884c\u8fdb\u884c\u52a0\u9501\uff1a</p> <pre><code>-- \u6dfb\u52a0\u8bfb\u9501\uff08\u5171\u4eab\u9501\uff09\nselect * from ... lock in share mode;\n-- \u6dfb\u52a0\u5199\u9501\uff08\u6392\u4ed6\u9501\uff09\nselect * from ... for update;\n</code></pre> <p>\u4f7f\u7528InnoDB\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6267\u884c\u66f4\u65b0\u3001\u5220\u9664\u3001\u63d2\u5165\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u5e93\u4e5f\u4f1a\u81ea\u52a8\u4e3a\u6240\u6d89\u53ca\u7684\u884c\u6dfb\u52a0\u5199\u9501\uff08\u6392\u4ed6\u9501\uff09\uff0c\u76f4\u5230\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u624d\u4f1a\u91ca\u653e\u9501\uff0c\u6267\u884c\u666e\u901a\u7684\u67e5\u8be2\u64cd\u4f5c\u65f6\uff0c\u4e0d\u4f1a\u6dfb\u52a0\u4efb\u4f55\u9501\u3002\u4f7f\u7528MyISAM\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6267\u884c\u66f4\u65b0\u3001\u5220\u9664\u3001\u63d2\u5165\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u5bf9\u6d89\u53ca\u7684\u8868\u6dfb\u52a0\u5199\u9501\uff0c\u5728\u6267\u884c\u67e5\u8be2\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u5bf9\u6d89\u53ca\u7684\u8868\u6dfb\u52a0\u8bfb\u9501\u3002</p> <p>\u63d0\u95ee\uff1a\u5f53\u6211\u4eec\u4e0d\u4f7f\u7528id\u8fdb\u884c\u9009\u62e9\uff0c\u884c\u9501\u4f1a\u53d1\u751f\u4ec0\u4e48\u53d8\u5316\uff1f\uff08\u884c\u9501\u5347\u7ea7\uff09</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_24","title":"\u8bb0\u5f55\u9501\u3001\u95f4\u9699\u9501\u548c\u4e34\u952e\u9501","text":"<p>\u6211\u4eec\u77e5\u9053InnoDB\u652f\u6301\u4f7f\u7528\u884c\u9501\uff0c\u4f46\u662f\u884c\u9501\u6bd4\u8f83\u590d\u6742\uff0c\u5b83\u53ef\u4ee5\u7ee7\u7eed\u5206\u4e3a\u591a\u4e2a\u7c7b\u578b\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_25","title":"\u8bb0\u5f55\u9501","text":"<p>\uff08Record Locks\uff09\u8bb0\u5f55\u9501, \u4ec5\u4ec5\u9501\u4f4f\u7d22\u5f15\u8bb0\u5f55\u7684\u4e00\u884c\uff0c\u5728\u5355\u6761\u7d22\u5f15\u8bb0\u5f55\u4e0a\u52a0\u9501\u3002Record lock\u9501\u4f4f\u7684\u6c38\u8fdc\u662f\u7d22\u5f15\uff0c\u800c\u975e\u8bb0\u5f55\u672c\u8eab\uff0c\u5373\u4f7f\u8be5\u8868\u4e0a\u6ca1\u6709\u4efb\u4f55\u7d22\u5f15\uff0c\u90a3\u4e48innodb\u4f1a\u5728\u540e\u53f0\u521b\u5efa\u4e00\u4e2a\u9690\u85cf\u7684\u805a\u96c6\u4e3b\u952e\u7d22\u5f15\uff0c\u90a3\u4e48\u9501\u4f4f\u7684\u5c31\u662f\u8fd9\u4e2a\u9690\u85cf\u7684\u805a\u96c6\u4e3b\u952e\u7d22\u5f15\u3002\u6240\u4ee5\u8bf4\u5f53\u4e00\u6761sql\u6ca1\u6709\u8d70\u4efb\u4f55\u7d22\u5f15\u65f6\uff0c\u90a3\u4e48\u5c06\u4f1a\u5728\u6bcf\u4e00\u6761\u805a\u5408\u7d22\u5f15\u540e\u9762\u52a0\u5199\u9501\uff0c\u8fd9\u4e2a\u7c7b\u4f3c\u4e8e\u8868\u9501\uff0c\u4f46\u539f\u7406\u4e0a\u548c\u8868\u9501\u5e94\u8be5\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_26","title":"\u95f4\u9699\u9501","text":"<p>\uff08Gap Locks\uff09\u4ec5\u4ec5\u9501\u4f4f\u4e00\u4e2a\u7d22\u5f15\u533a\u95f4\uff08\u5f00\u533a\u95f4\uff0c\u4e0d\u5305\u62ec\u53cc\u7aef\u7aef\u70b9\uff09\u3002\u5728\u7d22\u5f15\u8bb0\u5f55\u4e4b\u95f4\u7684\u95f4\u9699\u4e2d\u52a0\u9501\uff0c\u6216\u8005\u662f\u5728\u67d0\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\u4e4b\u524d\u6216\u8005\u4e4b\u540e\u52a0\u9501\uff0c\u5e76\u4e0d\u5305\u62ec\u8be5\u7d22\u5f15\u8bb0\u5f55\u672c\u8eab\u3002\u6bd4\u5982\u5728 1\u30012\u4e2d\uff0c\u95f4\u9699\u9501\u7684\u53ef\u80fd\u503c\u6709 (-\u221e, 1)\uff0c(1, 2)\uff0c(2, +\u221e)\uff0c\u95f4\u9699\u9501\u53ef\u7528\u4e8e\u9632\u6b62\u5e7b\u8bfb\uff0c\u4fdd\u8bc1\u7d22\u5f15\u95f4\u7684\u4e0d\u4f1a\u88ab\u63d2\u5165\u6570\u636e\u3002</p>"},{"location":"notes/Java%20Spring/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/#_27","title":"\u4e34\u952e\u9501","text":"<p>\uff08Next-Key Locks\uff09Record lock + Gap lock\uff0c\u5de6\u5f00\u53f3\u95ed\u533a\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>InnoDB</code>\u6b63\u662f\u4f7f\u7528Next-key Locks\u6765\u9501\u5b9a\u8bb0\u5f55\uff08\u5982select \u2026 for update\u8bed\u53e5\uff09\u5b83\u8fd8\u4f1a\u6839\u636e\u573a\u666f\u8fdb\u884c\u7075\u6d3b\u53d8\u6362\uff1a</p> \u573a\u666f \u8f6c\u6362 \u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7cbe\u786e\u5339\u914d\uff0c\u4f46\u8868\u4e2d\u4e0d\u5b58\u5728\u8bb0\u5f55 \u81ea\u52a8\u8f6c\u6362\u4e3a Gap Locks \u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7cbe\u786e\u5339\u914d\uff0c\u4e14\u8868\u4e2d\u5b58\u5728\u8bb0\u5f55 \u81ea\u52a8\u8f6c\u6362\u4e3a Record Locks \u4f7f\u7528\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7cbe\u786e\u5339\u914d \u4e0d\u8f6c\u6362 \u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u5339\u914d \u4e0d\u8f6c\u6362\uff0c\u4f46\u662f\u53ea\u9501\u4e0a\u754c\uff0c\u4e0d\u9501\u4e0b\u754c <p>https://zhuanlan.zhihu.com/p/48269420</p>"},{"location":"notes/Java%20Spring/SSM/","title":"SSM","text":""},{"location":"notes/Java%20Spring/SSM/#spring","title":"Spring \u57fa\u7840","text":"<p>\u719f\u6089\u4e86 spring bean \u7528\u6cd5  - \u4f7f\u7528 xml \u914d\u7f6e  - \u4f7f\u7528 \u6ce8\u89e3 \u914d\u7f6e</p> <p>\u4e86\u89e3 Mybatis \u662f\u5982\u4f55\u5c01\u88c5 driver.connection \u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\u7684\u3002</p> <p>\u4e86\u89e3 Mybatis \u662f\u5982\u4f55\u4e0e Spring \u6846\u67b6\u4ea4\u4e92\u7684\u3002</p> <p>Mybatis \u4e8b\u52a1\u7ba1\u7406  - \u539f\u5b50\u6027 - \u4e00\u81f4\u6027 - \u9694\u79bb\u6027 \u8be6\u7ec6\u8ba8\u8bba - \u6301\u4e45\u6027</p> <p>\u9694\u79bb\u6027 </p> <p>\u53ef\u80fd\u6709\u8bb8\u591a\u4e8b\u52a1\u4f1a\u540c\u65f6\u5904\u7406\u76f8\u540c\u7684\u6570\u636e\uff0c\u56e0\u6b64\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u5e94\u8be5\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\u5f00\u6765\uff0c\u9632\u6b62\u6570\u636e\u635f\u574f</p> \u9694\u79bb\u7ea7\u522b \u89e3\u91ca \u51fa\u73b0\u7684\u95ee\u9898 \u8bfb\u672a\u63d0\u4ea4 \u5728\u53e6\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\u8bfb\u53d6\u6570\u636e \u810f\u8bfb \u8bfb\u5df2\u63d0\u4ea4 \u5728\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u5728\u64cd\u4f5c\u6570\u636e\u7684\u65f6\u5019\u66f4\u65b0\u6570\u636e \u865a\u8bfb \u53ef\u91cd\u590d\u8bfb \u5728\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u7981\u6b62\u5176\u4ed6\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u7684 update \u64cd\u4f5c,(\u4f46\u662f\u4e0d\u7981\u6b62 insert) \u5e7b\u8bfb \u4e32\u884c\u8bfb\u53d6 <p>\u603b\u7ed3: </p> <p>\u9996\u5148\u5728 MainConfiguration \u4e2d \u914d\u7f6e dataSoure\u3002javaBean \u6839\u636e \u53c2\u6570\u7684\u7c7b\u578b\u81ea\u52a8\u5c06 dataSoure \u6ce8\u5165\u5230 <code>transactionManager</code> \u548c <code>sqlSessionFactory</code> \u4e2d\u3002\u540e\u4e00\u4e2a\u662f\u7528\u4e8e\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u524d\u4e00\u4e2a\u7528\u4e8e\u5bf9\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u5904\u7406\u3002</p> <p>MainConfigraion \u7684\u6ce8\u89e3\u542b\u610f\u5206\u522b\u4e3a 1. <code>Configuration</code>: \u58f0\u660e\u662f\u914d\u7f6e\u6587\u4ef6 2. <code>ComponentScan</code>: \u626b\u63cf\u5176\u4ed6 <code>Component</code>, \u4e3a\u5b83\u4eec\u63d0\u4f9b\u4f9d\u8d56\u6ce8\u5165\u3002\u6bd4\u5982 Mapper 3. <code>MapperScan</code>: \u987e\u540d\u601d\u4e49 4. <code>Transactional</code>: \u5f00\u542f\u4e8b\u52a1\u529f\u80fd</p> <p>\u5728 \u4e3b\u51fd\u6570\u4e2d\u3002 \u5229\u7528 <code>AnnotationConfigApplicationContext</code> \u751f\u6210\u4e00\u4e2a <code>ApplicationContext</code> \u5bf9\u8c61\uff0c\u5229\u7528\u8fd9\u4e2a\u5bf9\u8c61\u548c JavaBean \u8fdb\u884c\u4ea4\u6d41\u3002 \u505a\u5904\u7406\u3002</p>"},{"location":"notes/Java%20Spring/SSM/#spring-mvc","title":"Spring MVC","text":"<p>DispatcherServlet --&gt; HanderMapping --&gt; HanderExecutionChain --&gt; HanderInterceptor --&gt; HanderAdaper HanderAdapter --&gt; (Model and View) ViewResolver --&gt; DispatcherServlet</p> <p>\u57fa\u672c\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u914d\u7f6e\u4e00\u4e0b webconfigruation, \u8865\u9f50 controller \u5b9e\u73b0\u5c31\u53ef\u4ee5\u3002</p> <p>\u5176\u4f59\u7684\u91cd\u70b9\uff1a \u91cd\u5b9a\u5411 \u548c \u8bf7\u6c42\u8f6c\u53d1 (\u91cd\u5b9a\u5411\u662f\u8f6c\u53d1\u5230 controller \u91cc\u914d\u7f6e\u7684\u53e6\u4e00\u4e2a url \u4e0d\u662f\u9759\u6001\u8d44\u6e90\u7684\u6587\u4ef6\u540d) Session \u4f5c\u7528\u57df  \u62e6\u622a\u5668 axios \u5f02\u6b65\u5904\u7406</p> <p>SVC \u4e09\u5c42\u6a21\u578b    - controller \u548c service \u6c9f\u901a    - service \u548c Mapper \u6c9f\u901a    - Mapper \u548c \u6570\u636e\u5e93\u6c9f\u901a</p>"},{"location":"notes/Java%20Spring/SSM/#spring-security","title":"Spring Security","text":"<p>\u914d\u7f6e\u4e00\u4e0b Security Configuration\uff0c\u7f16\u5199\u76f8\u5e94\u7684 service \u548c controller \u5373\u53ef\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a passwordencoder (\u6807\u793a\u4e3a bean) \u7528\u6765\u6307\u5b9a Spring \u5bf9\u7528\u6237\u5bc6\u7801\u7684\u52a0\u5bc6\u65b9\u5f0f\u3002</p> <p>404 \u9519\u8bef     - \u53ef\u80fd\u6ca1\u6709\u5728 controller \u914d\u7f6e\u76f8\u5e94\u7684 url     - \u5728 controller \u914d\u7f6e\u7684 url \u5728\u672b\u5c3e\u591a\u4e86\u4e00\u4e2a /</p> <p>302 \u9519\u8bef     - \u6ca1\u6709\u5728 <code>SecurityFilterChain</code> \u653e\u884c\u9759\u6001\u8d44\u6e90\u3002</p> <p>403 \u9519\u8bef     - \u6ca1\u6709\u63d0\u4ea4 csrf token</p> <p>defaultSuccessurl not working</p> <p>\u5c06 remember-me \u7684 cookie \u5b58\u653e\u5728 \u6570\u636e\u5e93\u4e2d\u51fa\u9519 </p> <pre><code>Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'filterChain' defined in com.example.config.SecurityConfiguration: Unsatisfied dependency expressed through method 'filterChain' parameter 1: Error creating bean with name 'tokenRepository' defined in com.example.config.DatabaseConfiguration: Initialization of DAO failed\n</code></pre> <p>\u5b9e\u9645\u4e0a\u6570\u636e\u5e93\u5df2\u7ecf\u521b\u5efa\u5b8c\u4e86\uff0c\u8fd9\u662f\u7b2c\u4e8c\u6b21\u521b\u5efa\uff0c\u6240\u4ee5\u62a5\u9519</p>"},{"location":"notes/Java%20Spring/SSM/#_1","title":"\u9879\u76ee\u5b9e\u6218\uff0c \u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u95ee\u9898\uff1a\u914d\u7f6e\u4e86 Spring Security \u540e \u5e76\u6ca1\u6709\u51fa\u73b0 \u767b\u5165\u754c\u9762\u3002 - <code>SecurityInitializer</code> \u6ca1\u6709\u7ee7\u627f <code>AbstractSecurityWebApplicationInitializer</code></p> <p>\u95ee\u9898\uff1a\u767b\u5165\u6210\u529f\u540e\u8fdb\u5165\u4e0d\u4e86\u4e3b\u9875 - \u9700\u8981\u5c06 \u8868\u5355\u7684 name \u4fee\u6539\u4e3a \"\u5f53\u524d\u9879\u76ee\u7684\u4e0a\u4e0b\u6587:doLogin\"</p> <p>\u95ee\u9898\uff1a\u767b\u5f55\u540e\u7f51\u9875\u91cd\u5b9a\u5411\u5931\u8d25 - \u5728\u4e24\u4e2a controller \u5bf9\u4e8e\u540c\u4e00\u4e2a\u8bf7\u6c42\u914d\u7f6e\u4e86\u4e0d\u540c\u7684\u6620\u5c04</p> <p>\u95ee\u9898\uff1a\u6dfb\u52a0\u501f\u9605\u4fe1\u606f\u7684\u65f6\u5019\uff0cpost \u8bf7\u6c42\u5931\u8d25\uff0c\u6ca1\u6709\u643a\u5e26\u53c2\u6570\u3002</p> <ul> <li>\u901a\u8fc7\u67e5\u9605\u8d44\u6599\uff0c\u53d1\u73b0 firefox \u53ef\u4ee5\u83b7\u53d6 \u6d4f\u89c8\u5668\u53d1\u9001\u7684 post \u8bf7\u6c42\u3002\u67e5\u770b\u540e\u53d1\u73b0\u6d4f\u89c8\u5668\u662f\u6709\u9644\u5e26\u6570\u636e\u7684\u3002 \u90a3\u4e3a\u4ec0\u4e48\u540e\u7aef\u6ca1\u6709\u83b7\u53d6\u5230\u5462\u3002\u539f\u6765\u662f\u56e0\u4e3a\uff0c\u540e\u7aef controller \u63a5\u53d7\u6d4f\u89c8\u5668\u53d1\u9001\u7684\u53c2\u6570\u65f6\uff0c\u53c2\u6570\u7684\u540d\u5b57\u8981\u4fdd\u6301\u4e00\u81f4\uff0c\u5b83\u4e0d\u662f\u6309\u7167\u987a\u5e8f\u6765\u7684\u3002</li> </ul> <p>\u95ee\u9898\uff1a\u67e5\u8be2\u56fe\u4e66\u4fe1\u606f\u65f6\uff0cbook_list_status(iterSet.index) \u89e3\u6790\u9519\u8bef - \u4e00\u5f00\u59cb\u7ed9 book_list_status \u4f20\u7684\u662f map.values(), \u4e0d\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u5e94\u8be5\u8f6c\u5316\u4e3a list\u3002</p> <p>\u95ee\u9898: \u589e\u52a0\u56fe\u4e66\u7684\u65f6\u5019 when I send out the post request, the server give me the following output, what might be the problem org.apache.ibatis.binding.BindingException: Parameter 'title' not found. Available parameters are [arg2, arg1, arg0,</p> <ul> <li>\u63a5\u53d7\u591a\u4e2a\u53c2\u6570\u7684\u65f6\u5019\uff0c\u9700\u8981\u4f7f\u7528 Param \u6ce8\u89e3\u6765 \u6ce8\u660e\u4f20\u9012\u7684\u53c2\u6570\u540d\u79f0</li> </ul> <p>\u95ee\u9898\uff1a\u501f\u9605\u8005\u59d3\u540d\u663e\u793a\u4e0d\u51fa\u6765\u3002 - \u6dfb\u52a0\u501f\u9605\u4fe1\u606f\u65f6\uff0c\u5c06 bid \u4e0e sid \u5199\u53cd\uff0c\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\u6765\u907f\u514d\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/","title":"Spring MVC","text":""},{"location":"notes/Java%20Spring/Spring%20MVC/#springmvc","title":"SpringMVC\u57fa\u7840","text":"<p>\u8fdb\u5165\u4e4b\u524d\uff1a\u300aSpring\u6838\u5fc3\u5185\u5bb9\u300b\u300aJavaWeb\u300b\u300aJDK9-17\u65b0\u7279\u6027\u7bc7\u300b</p> <p>\u5728\u524d\u9762\u5b66\u4e60\u5b8cSpring\u6846\u67b6\u6280\u672f\u4e4b\u540e\uff0c\u5dee\u4e0d\u591a\u4f1a\u51fa\u73b0\u4e24\u6279\u4eba\uff1a\u4e00\u6279\u662f\u542c\u5f97\u4e91\u91cc\u96fe\u91cc\uff0c\u4f9d\u7136\u4e0d\u660e\u767d\u8fd9\u4e2a\u4e1c\u897f\u662f\u5e72\u561b\u7684\uff1b\u8fd8\u6709\u4e00\u6279\u5c31\u662f\u5dee\u4e0d\u591a\u7406\u89e3\u4e86\u6838\u5fc3\u601d\u60f3\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u8fd9\u4e9b\u4e1c\u897f\u8be5\u5982\u4f55\u53bb\u53d1\u6325\u5b83\u7684\u4f5c\u7528\u3002\u4e0d\u8fc7\u6ca1\u6709\u5173\u7cfb\uff0c\u5728SpringMVC\u9636\u6bb5\uff0c\u4f60\u4e00\u5b9a\u80fd\u9010\u6e10\u591f\u4f53\u4f1a\u5230Spring\u6846\u67b6\u4e3a\u6211\u4eec\u5e26\u6765\u7684\u4fbf\u6377\u4e4b\u5904\u3002</p> <p>\u6b64\u9636\u6bb5\uff0c\u6211\u4eec\u5c06\u518d\u6b21\u56de\u5230Tomcat\u7684Web\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4e2d\uff0c\u53bb\u611f\u53d7Spring\u6846\u67b6\u4e3a\u6211\u4eec\u5e26\u6765\u7684\u5de8\u5927\u4fbf\u6377\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#mvc","title":"MVC\u7406\u8bba\u57fa\u7840","text":"<p>\u5728\u4e4b\u524d\uff0c\u6211\u4eec\u7ed9\u5927\u5bb6\u8bb2\u89e3\u4e86\u4e09\u5c42\u67b6\u6784\uff0c\u5305\u62ec\uff1a</p> <p>img</p> <p>\u6bcf\u4e00\u5c42\u90fd\u6709\u7740\u5404\u81ea\u7684\u804c\u8d23\uff0c\u5176\u4e2d\u6700\u5173\u952e\u7684\u5f53\u5c5e\u8868\u793a\u5c42\uff0c\u56e0\u4e3a\u5b83\u76f8\u5f53\u4e8e\u5c31\u662f\u76f4\u63a5\u4e0e\u7528\u6237\u7684\u6d4f\u89c8\u5668\u6253\u4ea4\u9053\u7684\u4e00\u5c42\uff0c\u5e76\u4e14\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7\u5b83\u8fdb\u884c\u89e3\u6790\uff0c\u7136\u540e\u518d\u544a\u77e5\u4e1a\u52a1\u5c42\u8fdb\u884c\u5904\u7406\uff0c\u4efb\u4f55\u9875\u9762\u7684\u8fd4\u56de\u548c\u6570\u636e\u586b\u5145\u4e5f\u5168\u9760\u8868\u793a\u5c42\u6765\u5b8c\u6210\uff0c\u56e0\u6b64\u5b83\u5b9e\u9645\u4e0a\u662f\u6574\u4e2a\u4e09\u5c42\u67b6\u6784\u4e2d\u6700\u5173\u952e\u7684\u4e00\u5c42\uff0c\u800c\u5728\u4e4b\u524d\u7684\u5b9e\u6218\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u7f16\u5199\u4e86\u5927\u91cf\u7684Servlet\uff08\u4e5f\u5c31\u662f\u8868\u793a\u5c42\u5b9e\u73b0\uff09\u6765\u5904\u7406\u6765\u81ea\u6d4f\u89c8\u5668\u7684\u5404\u79cd\u8bf7\u6c42\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u4ec5\u4ec5\u662f\u51e0\u4e2a\u5f88\u5c0f\u7684\u529f\u80fd\uff0c\u4ee5\u53ca\u51e0\u4e2a\u5f88\u57fa\u672c\u7684\u9875\u9762\uff0c\u6211\u4eec\u90fd\u8981\u7f16\u5199\u5c06\u8fd1\u5341\u4e2aServlet\uff0c\u5982\u679c\u662f\u66f4\u52a0\u5927\u578b\u7684\u7f51\u7ad9\u7cfb\u7edf\uff0c\u6bd4\u5982\u6dd8\u5b9d\u3001B\u7ad9\uff0c\u5149\u662f\u4e00\u4e2a\u9875\u9762\u4e2d\u53ef\u80fd\u5c31\u5305\u542b\u4e86\u51e0\u5341\u751a\u81f3\u4e0a\u767e\u4e2a\u529f\u80fd\uff0c\u60f3\u60f3\u90a3\u6837\u7684\u8bdd\u5199\u8d77\u6765\u5f97\u591a\u6050\u6016\u3002</p> <p>\u56e0\u6b64\uff0cSpringMVC\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\u800c\u751f\u7684\uff0c\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u4f18\u79c0\u7684\u8868\u793a\u5c42\u6846\u67b6\uff0c\u91c7\u7528MVC\u601d\u60f3\u8bbe\u8ba1\u5b9e\u73b0\u3002</p> <p>MVC\u8be6\u7ec6\u89e3\u91ca\u5982\u4e0b\uff1a</p> <ul> <li>M\u662f\u6307\u4e1a\u52a1\u6a21\u578b\uff08Model\uff09\uff1a\u901a\u4fd7\u7684\u8bb2\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u7528\u4e8e\u5c01\u88c5\u6570\u636e\u4f20\u9012\u7684\u5b9e\u4f53\u7c7b\u3002</li> <li>V\u662f\u6307\u7528\u6237\u754c\u9762\uff08View\uff09\uff1a\u4e00\u822c\u6307\u7684\u662f\u524d\u7aef\u9875\u9762\u3002</li> <li>C\u5219\u662f\u63a7\u5236\u5668\uff08Controller\uff09\uff1a\u63a7\u5236\u5668\u5c31\u76f8\u5f53\u4e8eServlet\u7684\u57fa\u672c\u529f\u80fd\uff0c\u5904\u7406\u8bf7\u6c42\uff0c\u8fd4\u56de\u54cd\u5e94\u3002</li> </ul> <p>img</p> <p>SpringMVC\u6b63\u662f\u5e0c\u671b\u8fd9\u4e09\u8005\u4e4b\u95f4\u8fdb\u884c\u89e3\u8026\uff0c\u5b9e\u73b0\u5404\u5e72\u5404\u7684\uff0c\u66f4\u52a0\u7cbe\u7ec6\u5730\u5212\u5206\u5bf9\u5e94\u7684\u804c\u8d23\u3002\u6700\u540e\u518d\u5c06View\u548cModel\u8fdb\u884c\u6e32\u67d3\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u9875\u9762\u5e76\u8fd4\u56de\u7ed9\u524d\u7aef\uff08\u5c31\u50cf\u4e4b\u524d\u4f7f\u7528Thymeleaf\u90a3\u6837\uff0c\u628a\u5b9e\u4f53\u6570\u636e\u5bf9\u8c61\u548c\u524d\u7aef\u9875\u9762\u90fd\u7ed9\u5230Thymeleaf\uff0c\u7136\u540e\u5b83\u4f1a\u5c06\u5176\u8fdb\u884c\u6574\u5408\u6e32\u67d3\u5f97\u5230\u6700\u7ec8\u6709\u6570\u636e\u7684\u9875\u9762\uff0c\u800c\u672c\u6559\u7a0b\u4e5f\u4f1a\u4f7f\u7528Thymeleaf\u4f5c\u4e3a\u89c6\u56fe\u89e3\u6790\u5668\u8fdb\u884c\u8bb2\u89e3\uff09</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_1","title":"\u914d\u7f6e\u73af\u5883\u5e76\u642d\u5efa\u9879\u76ee","text":"<p>\u8fd9\u91cc\u6211\u4eec\u7ee7\u7eed\u4f7f\u7528\u4e4b\u524d\u7684Tomcat10\u670d\u52a1\u5668\uff0cSpring6\u4e4b\u540e\u8981\u6c42\u5fc5\u987b\u4f7f\u7528Tomcat10\u6216\u66f4\u9ad8\u7248\u672c\uff0c\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u6211\u4eec\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684JakartaEE\u9879\u76ee\u3002</p> <p>image-20230219162053172</p> <p>\u521b\u5efa\u5b8c\u6210\u540e\u4f1a\u81ea\u52a8\u751f\u6210\u76f8\u5173\u6587\u4ef6\uff0c\u4f46\u662f\u8fd8\u662f\u8bf7\u6ce8\u610f\u68c0\u67e5\u8fd0\u884c\u914d\u7f6e\u4e2d\u7684URL\u548c\u5e94\u7528\u7a0b\u5e8f\u4e0a\u4e0b\u6587\u540d\u79f0\u662f\u5426\u4e00\u81f4\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#xml","title":"\u4f20\u7edfXML\u914d\u7f6e\u5f62\u5f0f","text":"<p>SpringMvc\u9879\u76ee\u4f9d\u7136\u652f\u6301\u591a\u79cd\u914d\u7f6e\u5f62\u5f0f\uff0c\u8fd9\u91cc\u6211\u4eec\u9996\u5148\u8bb2\u89e3\u6700\u4f20\u7edf\u7684XML\u914d\u7f6e\u5f62\u5f0f\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u6dfb\u52a0Mvc\u76f8\u5173\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n    &lt;version&gt;6.0.10&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e00\u4e0bweb.xml\uff0c\u5c06DispatcherServlet\u66ff\u6362\u6389Tomcat\u81ea\u5e26\u7684Servlet\uff0c\u8fd9\u91ccurl-pattern\u9700\u8981\u5199\u4e3a<code>/</code>\uff0c\u5373\u53ef\u5b8c\u6210\u66ff\u6362\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;web-app xmlns=\"https://jakarta.ee/xml/ns/jakartaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd\"\n         version=\"5.0\"&gt;\n    &lt;servlet&gt;\n        &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n    &lt;/servlet&gt;\n    &lt;servlet-mapping&gt;\n        &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;\n        &lt;url-pattern&gt;/&lt;/url-pattern&gt;\n    &lt;/servlet-mapping&gt;\n&lt;/web-app&gt;\n</code></pre> <p>\u63a5\u7740\u9700\u8981\u4e3a\u6574\u4e2aWeb\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u4e00\u4e2aSpring\u4e0a\u4e0b\u6587\u73af\u5883\uff08\u4e5f\u5c31\u662f\u5bb9\u5668\uff09\uff0c\u56e0\u4e3aSpringMVC\u662f\u57fa\u4e8eSpring\u5f00\u53d1\u7684\uff0c\u5b83\u76f4\u63a5\u5229\u7528Spring\u63d0\u4f9b\u7684\u5bb9\u5668\u6765\u5b9e\u73b0\u5404\u79cd\u529f\u80fd\uff0c\u90a3\u4e48\u7b2c\u4e00\u6b65\u4f9d\u7136\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u9700\u8981\u7f16\u5199\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n        https://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n&lt;/beans&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u4e3aDispatcherServlet\u914d\u7f6e\u4e00\u4e9b\u521d\u59cb\u5316\u53c2\u6570\u6765\u6307\u5b9a\u521a\u521a\u521b\u5efa\u7684\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>&lt;servlet&gt;\n    &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n    &lt;init-param&gt;\n          &lt;!--     \u6307\u5b9a\u6211\u4eec\u521a\u521a\u521b\u5efa\u5728\u7c7b\u8def\u5f84\u4e0b\u7684XML\u914d\u7f6e\u6587\u4ef6       --&gt;\n        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n        &lt;param-value&gt;classpath:application.xml&lt;/param-value&gt;\n    &lt;/init-param&gt;\n&lt;/servlet&gt;\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u57fa\u672c\u7684\u914d\u7f6e\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u6765\u6d4b\u8bd5\u4e00\u4e0b\u662f\u5426\u914d\u7f6e\u6b63\u786e\uff0c\u6211\u4eec\u5220\u9664\u9879\u76ee\u81ea\u5e26\u7684Servlet\u7c7b\uff0c\u521b\u5efa\u4e00\u4e2aMvc\u4e2d\u4f7f\u7528\u7684Controller\u7c7b\uff0c\u73b0\u5728\u8fd8\u6ca1\u5b66\u6ca1\u5173\u7cfb\uff0c\u8ddf\u7740\u5199\u5c31\u884c\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\uff1a</p> <pre><code>@Controller\npublic class HelloController {\n    @ResponseBody\n    @RequestMapping(\"/\")\n    public String hello(){\n        return \"HelloWorld!\";\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u5c06\u8fd9\u4e2a\u7c7b\u6ce8\u518c\u4e3aBean\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u6211\u4eec\u6765\u7f16\u5199\u4e00\u4e0bSpring\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u914d\u7f6e\u5305\u626b\u63cf\uff0cXML\u4e0b\u7684\u5305\u626b\u63cf\u9700\u8981\u8fd9\u6837\u5f00\u542f\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n        https://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n      &lt;!-- \u9700\u8981\u5148\u5f15\u5165context\u547d\u540d\u7a7a\u95f4\uff0c\u7136\u540e\u76f4\u63a5\u914d\u7f6ebase-package\u5c5e\u6027\u5c31\u53ef\u4ee5\u4e86 --&gt;\n    &lt;context:component-scan base-package=\"com.example\"/&gt;\n&lt;/beans&gt;\n</code></pre> <p>\u5982\u679c\u53ef\u4ee5\u6210\u529f\u5728\u6d4f\u89c8\u5668\u4e2d\u51fa\u73b0HelloWorld\u5219\u8bf4\u660e\u914d\u7f6e\u6210\u529f\uff1a</p> <p>image-20230219170637540</p> <p>\u806a\u660e\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u4e0a\u9762\u7f16\u5199\u7684Controller\u5c31\u662f\u8d1f\u8d23Servlet\u57fa\u672c\u529f\u80fd\u7684\uff0c\u6bd4\u5982\u8fd9\u91cc\u6211\u4eec\u8fd4\u56de\u7684\u662fHelloWorld\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\u7684\u65f6\u5019\uff0c\u7684\u5230\u7684\u5c31\u662f\u8fd9\u91cc\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u770b\u5230\u5199\u6cd5\u975e\u5e38\u7b80\u6d01\uff0c\u81f3\u4e8e\u8fd9\u662f\u600e\u4e48\u505a\u5230\u7684\u7684\uff0c\u600e\u4e48\u4f7f\u7528\uff0c\u6211\u4eec\u4f1a\u5728\u672c\u7ae0\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_2","title":"\u5168\u6ce8\u89e3\u914d\u7f6e\u5f62\u5f0f","text":"<p>\u5982\u679c\u4f60\u5e0c\u671b\u5b8c\u5b8c\u5168\u5168\u4e22\u5f03\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528\u7eaf\u6ce8\u89e3\u5f00\u53d1\uff0c\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2a\u7c7b\uff0cTomcat\u4f1a\u5728\u7c7b\u8def\u5f84\u4e2d\u67e5\u627e\u5b9e\u73b0ServletContainerInitializer \u63a5\u53e3\u7684\u7c7b\uff0c\u5982\u679c\u53d1\u73b0\u7684\u8bdd\uff0c\u5c31\u7528\u5b83\u6765\u914d\u7f6eServlet\u5bb9\u5668\uff0cSpring\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b SpringServletContainerInitializer , \u901a\u8fc7@HandlesTypes(WebApplicationInitializer.class)\u8bbe\u7f6e\uff0c\u8fd9\u4e2a\u7c7b\u53cd\u8fc7\u6765\u4f1a\u67e5\u627e\u5b9e\u73b0WebApplicationInitializer \u7684\u7c7b\uff0c\u5e76\u5c06\u914d\u7f6e\u7684\u4efb\u52a1\u4ea4\u7ed9\u4ed6\u4eec\u6765\u5b8c\u6210\uff0c\u56e0\u6b64\u76f4\u63a5\u5b9e\u73b0\u63a5\u53e3\u5373\u53ef\uff1a</p> <pre><code>public class MainInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n    @Override\n    protected Class&lt;?&gt;[] getRootConfigClasses() {\n        return new Class[]{WebConfiguration.class};   //\u57fa\u672c\u7684Spring\u914d\u7f6e\u7c7b\uff0c\u4e00\u822c\u7528\u4e8e\u4e1a\u52a1\u5c42\u914d\u7f6e\n    }\n\n    @Override\n    protected Class&lt;?&gt;[] getServletConfigClasses() {\n        return new Class[0];  //\u914d\u7f6eDispatcherServlet\u7684\u914d\u7f6e\u7c7b\u3001\u4e3b\u8981\u7528\u4e8eController\u7b49\u914d\u7f6e\uff0c\u8fd9\u91cc\u4e3a\u4e86\u6559\u5b66\u7b80\u5355\uff0c\u5c31\u4e0d\u5206\u8fd9\u4e48\u8be6\u7ec6\u4e86\uff0c\u53ea\u4f7f\u7528\u4e0a\u9762\u7684\u57fa\u672c\u914d\u7f6e\u7c7b\n    }\n\n    @Override\n    protected String[] getServletMappings() {\n        return new String[]{\"/\"};    //\u5339\u914d\u8def\u5f84\uff0c\u4e0e\u4e0a\u9762\u4e00\u81f4\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u518d\u914d\u7f6e\u7c7b\u4e2d\u6dfb\u52a0\u4e00\u4e9b\u5fc5\u8981\u7684\u6ce8\u89e3\uff1a</p> <pre><code>@Configuration\n@EnableWebMvc   //\u5feb\u901f\u914d\u7f6eSpringMvc\u6ce8\u89e3\uff0c\u5982\u679c\u4e0d\u6dfb\u52a0\u6b64\u6ce8\u89e3\u4f1a\u5bfc\u81f4\u540e\u7eed\u65e0\u6cd5\u901a\u8fc7\u5b9e\u73b0WebMvcConfigurer\u63a5\u53e3\u8fdb\u884c\u81ea\u5b9a\u4e49\u914d\u7f6e\n@ComponentScan(\"com.example.controller\")\npublic class WebConfiguration {\n}\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff1a</p> <p>image-20230219170637540</p> <p>\u4e4b\u540e\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u5c31\u7edf\u4e00\u4f7f\u7528\u5168\u6ce8\u89e3\u5f62\u5f0f\u7f16\u5199\u3002</p> <p>\u5982\u679c\u65e5\u5fd7\u79d1\u6280\u6709\u62a5\u9519\u65e0\u6cd5\u663e\u793aMvc\u76f8\u5173\u7684\u65e5\u5fd7\uff0c\u8bf7\u6dfb\u52a0\u4ee5\u4e0b\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n      &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;\n      &lt;version&gt;1.7.33&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n      &lt;artifactId&gt;slf4j-jdk14&lt;/artifactId&gt;\n      &lt;version&gt;1.7.33&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u6dfb\u52a0\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u6253\u5370\u65e5\u5fd7\u4e86\uff1a</p> <p>image-20230630162821105</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#controller","title":"Controller\u63a7\u5236\u5668","text":"<p>\u6709\u4e86SpringMVC\u4e4b\u540e\uff0c\u6211\u4eec\u4e0d\u5fc5\u518d\u50cf\u4e4b\u524d\u90a3\u6837\u4e00\u4e2a\u8bf7\u6c42\u5730\u5740\u521b\u5efa\u4e00\u4e2aServlet\u4e86\uff0c\u5b83\u4f7f\u7528<code>DispatcherServlet</code>\u66ff\u4ee3Tomcat\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u9ed8\u8ba4\u7684\u9759\u6001\u8d44\u6e90Servlet\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u73b0\u5728\u6240\u6709\u7684\u8bf7\u6c42\uff08\u9664\u4e86jsp\uff0c\u56e0\u4e3aTomcat\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2ajsp\u7684Servlet\uff09\u90fd\u4f1a\u7ecf\u8fc7<code>DispatcherServlet</code>\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u90a3\u4e48<code>DispatcherServlet</code>\u4f1a\u5e2e\u52a9\u6211\u4eec\u505a\u4ec0\u4e48\u5462\uff1f</p> <p>img</p> <p>\u6839\u636e\u56fe\u7247\u6211\u4eec\u53ef\u4ee5\u4e86\u89e3\uff0c\u6211\u4eec\u7684\u8bf7\u6c42\u5230\u8fbeTomcat\u670d\u52a1\u5668\u4e4b\u540e\uff0c\u4f1a\u4ea4\u7ed9\u5f53\u524d\u7684Web\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\uff0c\u800cSpringMVC\u4f7f\u7528<code>DispatcherServlet</code>\u6765\u5904\u7406\u6240\u6709\u7684\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u88ab\u4f5c\u4e3a\u4e00\u4e2a\u7edf\u4e00\u7684\u8bbf\u95ee\u70b9\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u5168\u90e8\u7531\u5b83\u6765\u8fdb\u884c\u8c03\u5ea6\u3002</p> <p>\u5f53\u4e00\u4e2a\u8bf7\u6c42\u7ecf\u8fc7<code>DispatcherServlet</code>\u4e4b\u540e\uff0c\u4f1a\u5148\u8d70<code>HandlerMapping</code>\uff0c\u5b83\u4f1a\u5c06\u8bf7\u6c42\u6620\u5c04\u4e3a<code>HandlerExecutionChain</code>\uff0c\u4f9d\u6b21\u7ecf\u8fc7<code>HandlerInterceptor</code>\u6709\u70b9\u7c7b\u4f3c\u4e8e\u4e4b\u524d\u6211\u4eec\u6240\u5b66\u7684\u8fc7\u6ee4\u5668\uff0c\u4e0d\u8fc7\u5728SpringMVC\u4e2d\u6211\u4eec\u4f7f\u7528\u7684\u662f\u62e6\u622a\u5668\uff0c\u7136\u540e\u518d\u4ea4\u7ed9<code>HandlerAdapter</code>\uff0c\u6839\u636e\u8bf7\u6c42\u7684\u8def\u5f84\u9009\u62e9\u5408\u9002\u7684\u63a7\u5236\u5668\u8fdb\u884c\u5904\u7406\uff0c\u63a7\u5236\u5668\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>ModelAndView</code>\u5bf9\u8c61\uff0c\u5305\u62ec\u6570\u636e\u6a21\u578b\u548c\u89c6\u56fe\uff0c\u901a\u4fd7\u7684\u8bb2\u5c31\u662f\u9875\u9762\u4e2d\u6570\u636e\u548c\u9875\u9762\u672c\u8eab\uff08\u53ea\u5305\u542b\u89c6\u56fe\u540d\u79f0\u5373\u53ef\uff09\u3002</p> <p>\u8fd4\u56de<code>ModelAndView</code>\u4e4b\u540e\uff0c\u4f1a\u4ea4\u7ed9<code>ViewResolver</code>\uff08\u89c6\u56fe\u89e3\u6790\u5668\uff09\u8fdb\u884c\u5904\u7406\uff0c\u89c6\u56fe\u89e3\u6790\u5668\u4f1a\u5bf9\u6574\u4e2a\u89c6\u56fe\u9875\u9762\u8fdb\u884c\u89e3\u6790\uff0cSpringMVC\u81ea\u5e26\u4e86\u4e00\u4e9b\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u4f46\u662f\u53ea\u9002\u7528\u4e8eJSP\u9875\u9762\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u50cf\u4e4b\u524d\u4e00\u6837\u4f7f\u7528Thymeleaf\u4f5c\u4e3a\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u7ed9\u5b9a\u7684\u89c6\u56fe\u540d\u79f0\uff0c\u76f4\u63a5\u8bfb\u53d6HTML\u7f16\u5199\u7684\u9875\u9762\uff0c\u89e3\u6790\u4e3a\u4e00\u4e2a\u771f\u6b63\u7684View\u3002</p> <p>\u89e3\u6790\u5b8c\u6210\u540e\uff0c\u5c31\u9700\u8981\u5c06\u9875\u9762\u4e2d\u7684\u6570\u636e\u5168\u90e8\u6e32\u67d3\u5230View\u4e2d\uff0c\u6700\u540e\u8fd4\u56de\u7ed9<code>DispatcherServlet</code>\u4e00\u4e2a\u5305\u542b\u6240\u6709\u6570\u636e\u7684\u6210\u5f62\u9875\u9762\uff0c\u518d\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\uff0c\u5b8c\u6210\u6574\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u6574\u4e2a\u8fc7\u7a0b\u6211\u4eec\u53ea\u9700\u8981\u7f16\u5199\u5bf9\u5e94\u8bf7\u6c42\u8def\u5f84\u7684\u7684Controller\u4ee5\u53ca\u914d\u7f6e\u597d\u6211\u4eec\u9700\u8981\u7684ViewResolver\u5373\u53ef\uff0c\u4e4b\u540e\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u8865\u5145\u6dfb\u52a0\u62e6\u622a\u5668\uff0c\u800c\u5176\u4ed6\u7684\u6d41\u7a0b\u5df2\u7ecf\u7531SpringMVC\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_3","title":"\u914d\u7f6e\u89c6\u56fe\u89e3\u6790\u5668\u548c\u63a7\u5236\u5668","text":"<p>\u9996\u5148\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u6700\u57fa\u672c\u7684\u9875\u9762\u89e3\u6790\u5e76\u8fd4\u56de\uff0c\u7b2c\u4e00\u6b65\u5c31\u662f\u914d\u7f6e\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528Thymeleaf\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u5bfc\u5165\u9700\u8981\u7684\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;\n    &lt;artifactId&gt;thymeleaf-spring6&lt;/artifactId&gt;\n    &lt;version&gt;3.1.1.RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u914d\u7f6e\u89c6\u56fe\u89e3\u6790\u5668\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5bf9\u5e94\u7684<code>ViewResolver</code>\u6ce8\u518c\u4e3aBean\u5373\u53ef\uff0c\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u5728\u914d\u7f6e\u7c7b\u4e2d\u7f16\u5199\uff1a</p> <pre><code>@Configuration\n@EnableWebMvc\n@ComponentScan(\"com.example.controller\")\npublic class WebConfiguration {\n    //\u6211\u4eec\u9700\u8981\u4f7f\u7528ThymeleafViewResolver\u4f5c\u4e3a\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u5e76\u89e3\u6790\u6211\u4eec\u7684HTML\u9875\u9762\n    @Bean\n    public ThymeleafViewResolver thymeleafViewResolver(SpringTemplateEngine springTemplateEngine){\n        ThymeleafViewResolver resolver = new ThymeleafViewResolver();\n        resolver.setOrder(1);   //\u53ef\u4ee5\u5b58\u5728\u591a\u4e2a\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e3a\u4ed6\u4eec\u8bbe\u5b9a\u89e3\u6790\u987a\u5e8f\n        resolver.setCharacterEncoding(\"UTF-8\");   //\u7f16\u7801\u683c\u5f0f\u662f\u91cd\u4e2d\u4e4b\u91cd\n        resolver.setTemplateEngine(springTemplateEngine);   //\u548c\u4e4b\u524dJavaWeb\u9636\u6bb5\u4e00\u6837\uff0c\u9700\u8981\u4f7f\u7528\u6a21\u677f\u5f15\u64ce\u8fdb\u884c\u89e3\u6790\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u9700\u8981\u8bbe\u5b9a\u4e00\u4e0b\u6a21\u677f\u5f15\u64ce\n        return resolver;\n    }\n\n    //\u914d\u7f6e\u6a21\u677f\u89e3\u6790\u5668\n    @Bean\n    public SpringResourceTemplateResolver templateResolver(){\n        SpringResourceTemplateResolver resolver = new SpringResourceTemplateResolver();\n        resolver.setSuffix(\".html\");   //\u9700\u8981\u89e3\u6790\u7684\u540e\u7f00\u540d\u79f0\n        resolver.setPrefix(\"/\");   //\u9700\u8981\u89e3\u6790\u7684HTML\u9875\u9762\u6587\u4ef6\u5b58\u653e\u7684\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u662fwebapp\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u662f\u7c7b\u8def\u5f84\u4e0b\u9700\u8981\u6dfb\u52a0classpath:\u524d\u7f00\n        return resolver;\n    }\n\n    //\u914d\u7f6e\u6a21\u677f\u5f15\u64ceBean\n    @Bean\n    public SpringTemplateEngine springTemplateEngine(ITemplateResolver resolver){\n        SpringTemplateEngine engine = new SpringTemplateEngine();\n        engine.setTemplateResolver(resolver);   //\u6a21\u677f\u89e3\u6790\u5668\uff0c\u9ed8\u8ba4\u5373\u53ef\n        return engine;\n    }\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u89c6\u56fe\u89e3\u6790\u5668\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u63a5\u7740\u6765\u521b\u5efa\u4e00\u4e2aController\uff0c\u521b\u5efaController\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u5728\u4e00\u4e2a\u7c7b\u4e0a\u6dfb\u52a0\u4e00\u4e2a<code>@Controller</code>\u6ce8\u89e3\u5373\u53ef\uff0c\u5b83\u4f1a\u88abSpring\u626b\u63cf\u5e76\u81ea\u52a8\u6ce8\u518c\u4e3aController\u7c7b\u578b\u7684Bean\uff0c\u7136\u540e\u6211\u4eec\u53ea\u9700\u8981\u5728\u7c7b\u4e2d\u7f16\u5199\u65b9\u6cd5\u7528\u4e8e\u5904\u7406\u5bf9\u5e94\u5730\u5740\u7684\u8bf7\u6c42\u5373\u53ef\uff1a</p> <pre><code>@Controller   //\u76f4\u63a5\u6dfb\u52a0\u6ce8\u89e3\u5373\u53ef\npublic class HelloController {\n\n    @RequestMapping(\"/index\")   //\u76f4\u63a5\u586b\u5199\u8bbf\u95ee\u8def\u5f84\n    public ModelAndView index(){\n        return new ModelAndView(\"index\");  //\u8fd4\u56deModelAndView\u5bf9\u8c61\uff0c\u8fd9\u91cc\u586b\u5165\u4e86\u89c6\u56fe\u7684\u540d\u79f0\n          //\u8fd4\u56de\u540e\u4f1a\u7ecf\u8fc7\u89c6\u56fe\u89e3\u6790\u5668\u8fdb\u884c\u5904\u7406\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5728\u7c7b\u8def\u5f84\u6839\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u7b80\u5355html\u6587\u4ef6\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u6d4b\u8bd5&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;p&gt;\u6b22\u8fce\u6765\u5230GayHub\u5168\u7403\u6700\u5927\u540c\u6027\u4ea4\u53cb\u7f51\u7ad9&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u6211\u4eec\u7684HTML\u9875\u9762\u4e86\uff1a</p> <p>image-20230220150905300</p> <p>\u6211\u4eec\u5728\u4e4b\u524d\uff0c\u4f7f\u7528Thymeleaf\u89e3\u6790\u540e\u7aef\u7684\u4e00\u4e9b\u6570\u636e\u65f6\uff0c\u9700\u8981\u901a\u8fc7Context\u8fdb\u884c\u4f20\u9012\uff0c\u800c\u4f7f\u7528SpringMvc\u540e\uff0c\u6570\u636e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5411Model\u6a21\u578b\u5c42\u8fdb\u884c\u63d0\u4f9b\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(){\n    ModelAndView modelAndView = new ModelAndView(\"index\");\n    modelAndView.getModel().put(\"name\", \"\u554a\u8fd9\");   //\u5c06name\u4f20\u9012\u7ed9Model\n    return modelAndView;\n}\n</code></pre> <p>\u8fd9\u6837Thymeleaf\u5c31\u80fd\u6536\u5230\u6211\u4eec\u4f20\u9012\u7684\u6570\u636e\u8fdb\u884c\u89e3\u6790\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n    &lt;script src=\"static/test.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    HelloWorld\uff01\n    &lt;div th:text=\"${name}\"&gt;&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u5f53\u7136\uff0c\u4e3a\u4e86\u7b80\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56deView\u540d\u79f0\uff0cSpringMVC\u4f1a\u5c06\u5176\u81ea\u52a8\u5305\u88c5\u4e3aModelAndView\u5bf9\u8c61\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic String index(){\n    return \"index\";\n}\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5355\u72ec\u6dfb\u52a0\u4e00\u4e2aModel\u4f5c\u4e3a\u5f62\u53c2\u8fdb\u884c\u8bbe\u7f6e\uff0cSpringMVC\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u4f1a\u81ea\u52a8\u5e2e\u52a9\u6211\u4eec\u4f20\u9012\u5b9e\u4f8b\u5bf9\u8c61\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic String index(Model model){  //\u8fd9\u91cc\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u662fModel\uff0c\u8fd8\u53ef\u4ee5\u662fMap\u3001ModelMap\n    model.addAttribute(\"name\", \"yyds\");\n    return \"index\";\n}\n</code></pre> <p>\u6709\u4e86Spring\u6846\u67b6\u7684\u52a0\u6301\uff0c\u76f8\u6bd4\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684Web\u5e94\u7528\u7a0b\u5e8f\uff0c\u7b80\u76f4\u65b9\u4fbf\u4e86\u4e00\u4e2a\u5c42\u6b21\uff0c\u4f60\u5c31\u8bf4\u4f60\u7231\u4e0d\u7231\u5427\uff0c\u4f60\u7231\u4e0d\u7231\u3002</p> <p>\u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u4fdd\u8bc1\u89c6\u56fe\u540d\u79f0\u4e0b\u9762\u51fa\u73b0\u6a2a\u7ebf\u5e76\u4e14\u6309\u4f4fCtrl\u53ef\u4ee5\u8df3\u8f6c\uff0c\u914d\u7f6e\u624d\u662f\u6b63\u786e\u7684\uff08\u6700\u65b0\u7248IDEA\uff09</p> <p>\u6211\u4eec\u7684\u9875\u9762\u4e2d\u53ef\u80fd\u8fd8\u4f1a\u5305\u542b\u4e00\u4e9b\u9759\u6001\u8d44\u6e90\uff0c\u6bd4\u5982js\u3001css\uff0c\u56e0\u6b64\u8fd9\u91cc\u6211\u4eec\u8fd8\u9700\u8981\u914d\u7f6e\u4e00\u4e0b\uff0c\u8ba9\u9759\u6001\u8d44\u6e90\u901a\u8fc7Tomcat\u63d0\u4f9b\u7684\u9ed8\u8ba4Servlet\u8fdb\u884c\u89e3\u6790\uff0c\u6211\u4eec\u9700\u8981\u8ba9\u914d\u7f6e\u7c7b\u5b9e\u73b0\u4e00\u4e0b<code>WebMvcConfigurer</code>\u63a5\u53e3\uff0c\u8fd9\u6837\u5728Web\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u4f1a\u6839\u636e\u6211\u4eec\u91cd\u5199\u65b9\u6cd5\u91cc\u9762\u7684\u5185\u5bb9\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u914d\u7f6e\uff1a</p> <pre><code>@Override\npublic void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {\n    configurer.enable();   //\u5f00\u542f\u9ed8\u8ba4\u7684Servlet\n}\n\n@Override\npublic void addResourceHandlers(ResourceHandlerRegistry registry) {\n    registry.addResourceHandler(\"/static/**\").addResourceLocations(\"/static/\");\n    //\u914d\u7f6e\u9759\u6001\u8d44\u6e90\u7684\u8bbf\u95ee\u8def\u5f84\n}\n</code></pre> <p>\u6211\u4eec\u7f16\u5199\u4e00\u4e0b\u524d\u7aef\u5185\u5bb9\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u6d4b\u8bd5&lt;/title&gt;\n    &lt;!-- \u5f15\u7528\u9759\u6001\u8d44\u6e90\uff0c\u8fd9\u91cc\u4f7f\u7528Thymeleaf\u7684\u7f51\u5740\u94fe\u63a5\u8868\u8fbe\u5f0f\uff0cThymeleaf\u4f1a\u81ea\u52a8\u6dfb\u52a0web\u5e94\u7528\u7a0b\u5e8f\u7684\u540d\u79f0\u5230\u94fe\u63a5\u524d\u9762 --&gt;\n    &lt;script th:src=\"@{/static/test.js}\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;p&gt;\u6b22\u8fce\u6765\u5230GayHub\u5168\u7403\u6700\u5927\u540c\u6027\u4ea4\u53cb\u7f51\u7ad9&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u521b\u5efa<code>test.js</code>\u5e76\u7f16\u5199\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>window.alert(\"\u6b22\u8fce\u6765\u5230GayHub\u5168\u7403\u6700\u5927\u540c\u6027\u4ea4\u53cb\u7f51\u7ad9\")\n</code></pre> <p>\u6700\u540e\u8bbf\u95ee\u9875\u9762\uff0c\u9875\u9762\u5728\u52a0\u8f7d\u65f6\u5c31\u4f1a\u663e\u793a\u4e00\u4e2a\u5f39\u7a97\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u6700\u57fa\u672c\u7684\u9875\u9762\u914d\u7f6e\u3002\u76f8\u6bd4\u4e4b\u524d\u7684\u65b9\u5f0f\uff0c\u8fd9\u6837\u5c31\u7b80\u5355\u5f88\u591a\u4e86\uff0c\u76f4\u63a5\u907f\u514d\u4e86\u7f16\u5199\u5927\u91cf\u7684Servlet\u6765\u5904\u7406\u8bf7\u6c42\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#requestmapping","title":"@RequestMapping\u8be6\u89e3","text":"<p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u63a7\u5236\u5668\u6765\u5904\u7406\u6211\u4eec\u7684\u8bf7\u6c42\uff0c\u63a5\u7740\u6211\u4eec\u53ea\u9700\u8981\u5728\u63a7\u5236\u5668\u6dfb\u52a0\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u5904\u7406\u5bf9\u5e94\u7684\u8bf7\u6c42\u5373\u53ef\uff0c\u4e4b\u524d\u6211\u4eec\u9700\u8981\u5b8c\u6574\u5730\u7f16\u5199\u4e00\u4e2aServlet\u6765\u5b9e\u73b0\uff0c\u800c\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a<code>@RequestMapping</code>\u5373\u53ef\u5b9e\u73b0\uff0c\u5176\u5b9e\u4ece\u5b83\u7684\u540d\u5b57\u6211\u4eec\u4e5f\u80fd\u5f97\u77e5\uff0c\u6b64\u6ce8\u89e3\u5c31\u662f\u5c06\u8bf7\u6c42\u548c\u5904\u7406\u8bf7\u6c42\u7684\u65b9\u6cd5\u5efa\u7acb\u4e00\u4e2a\u6620\u5c04\u5173\u7cfb\uff0c\u5f53\u6536\u5230\u8bf7\u6c42\u65f6\u5c31\u53ef\u4ee5\u6839\u636e\u6620\u5c04\u5173\u7cfb\u8c03\u7528\u5bf9\u5e94\u7684\u8bf7\u6c42\u5904\u7406\u65b9\u6cd5\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u5148\u804a\u804a<code>@RequestMapping</code>\u5427\uff0c\u6ce8\u89e3\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>@Mapping\npublic @interface RequestMapping {\n    String name() default \"\";\n\n    @AliasFor(\"path\")\n    String[] value() default {};\n\n    @AliasFor(\"value\")\n    String[] path() default {};\n\n    RequestMethod[] method() default {};\n\n    String[] params() default {};\n\n    String[] headers() default {};\n\n    String[] consumes() default {};\n\n    String[] produces() default {};\n}\n</code></pre> <p>\u5176\u4e2d\u6700\u5173\u952e\u7684\u662fpath\u5c5e\u6027\uff08\u7b49\u4ef7\u4e8evalue\uff09\uff0c\u5b83\u51b3\u5b9a\u4e86\u5f53\u524d\u65b9\u6cd5\u5904\u7406\u7684\u8bf7\u6c42\u8def\u5f84\uff0c\u6ce8\u610f\u8def\u5f84\u5fc5\u987b\u5168\u5c40\u552f\u4e00\uff0c\u4efb\u4f55\u8def\u5f84\u53ea\u80fd\u6709\u4e00\u4e2a\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u5b83\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u8bf4\u6b64\u65b9\u6cd5\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u53ea\u7528\u4e8e\u5904\u7406\u67d0\u4e00\u4e2a\u8bf7\u6c42\u8def\u5f84\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u5904\u7406\u591a\u4e2a\u8bf7\u6c42\u8def\u5f84\uff1a</p> <pre><code>@RequestMapping({\"/index\", \"/test\"})\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u8bbf\u95ee/index\u6216\u662f/test\u90fd\u4f1a\u7ecf\u8fc7\u6b64\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06<code>@RequestMapping</code>\u6dfb\u52a0\u5230\u7c7b\u540d\u4e0a\uff0c\u8868\u793a\u4e3a\u6b64\u7c7b\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\u6620\u5c04\u6dfb\u52a0\u4e00\u4e2a\u8def\u5f84\u524d\u7f00\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@Controller\n@RequestMapping(\"/yyds\")\npublic class MainController {\n\n    @RequestMapping({\"/index\", \"/test\"})\n    public ModelAndView index(){\n        return new ModelAndView(\"index\");\n    }\n}\n</code></pre> <p>\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u9700\u8981\u8bbf\u95ee<code>/yyds/index</code>\u6216\u662f<code>/yyds/test</code>\u624d\u53ef\u4ee5\u5f97\u5230\u6b64\u9875\u9762\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728IDEA\u4e0b\u65b9\u7684\u7aef\u70b9\u677f\u5757\u4e2d\u67e5\u770b\u5f53\u524dWeb\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u6240\u6709\u8bf7\u6c42\u6620\u5c04\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7IDEA\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u5185\u7f6eWeb\u5ba2\u6237\u7aef\u76f4\u63a5\u8bbf\u95ee\u67d0\u4e2a\u8def\u5f84\u3002</p> <p>\u8def\u5f84\u8fd8\u652f\u6301\u4f7f\u7528\u901a\u914d\u7b26\u8fdb\u884c\u5339\u914d\uff1a</p> <ul> <li>?\uff1a\u8868\u793a\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u6bd4\u5982<code>@RequestMapping(\"/index/x?\")</code>\u53ef\u4ee5\u5339\u914d/index/xa\u3001/index/xb\u7b49\u7b49\u3002</li> <li>*\uff1a\u8868\u793a\u4efb\u610f0-n\u4e2a\u5b57\u7b26\uff0c\u6bd4\u5982<code>@RequestMapping(\"/index/*\")</code>\u53ef\u4ee5\u5339\u914d/index/lbwnb\u3001/index/yyds\u7b49\u3002</li> <li>**\uff1a\u8868\u793a\u5f53\u524d\u76ee\u5f55\u6216\u57fa\u4e8e\u5f53\u524d\u76ee\u5f55\u7684\u591a\u7ea7\u76ee\u5f55\uff0c\u6bd4\u5982<code>@RequestMapping(\"/index/**\")</code>\u53ef\u4ee5\u5339\u914d/index\u3001/index/xxx\u7b49\u3002</li> </ul> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\u4e0b\u4e00\u4e2amethod\u5c5e\u6027\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u5c31\u662f\u8bf7\u6c42\u7684\u65b9\u6cd5\u7c7b\u578b\uff0c\u6211\u4eec\u53ef\u4ee5\u9650\u5b9a\u8bf7\u6c42\u65b9\u5f0f\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", method = RequestMethod.POST)\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u6b64\u9875\u9762\uff0c\u4f1a\u663e\u793a405\u65b9\u6cd5\u4e0d\u652f\u6301\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u9ed8\u8ba4\u662f\u76f4\u63a5\u4f7f\u7528GET\u65b9\u6cd5\u83b7\u53d6\u9875\u9762\uff0c\u800c\u6211\u4eec\u8fd9\u91cc\u6307\u5b9a\u4e3aPOST\u65b9\u6cd5\u8bbf\u95ee\u6b64\u5730\u5740\uff0c\u6240\u4ee5\u8bbf\u95ee\u5931\u8d25\uff0c\u6211\u4eec\u73b0\u5728\u518d\u53bb\u7aef\u70b9\u4e2d\u7528POST\u65b9\u5f0f\u53bb\u8bbf\u95ee\uff0c\u6210\u529f\u5f97\u5230\u9875\u9762\u3002</p> <p>image-20230220152559862</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u884d\u751f\u6ce8\u89e3\u76f4\u63a5\u8bbe\u5b9a\u4e3a\u6307\u5b9a\u7c7b\u578b\u7684\u8bf7\u6c42\u6620\u5c04\uff1a</p> <pre><code>@PostMapping(value = \"/index\")\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u8fd9\u91cc\u4f7f\u7528\u4e86<code>@PostMapping</code>\u76f4\u63a5\u6307\u5b9a\u4e3aPOST\u8bf7\u6c42\u7c7b\u578b\u7684\u8bf7\u6c42\u6620\u5c04\uff0c\u540c\u6837\u7684\uff0c\u8fd8\u6709<code>@GetMapping</code>\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u4e3aGET\u8bf7\u6c42\u65b9\u5f0f\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>params</code>\u5c5e\u6027\u6765\u6307\u5b9a\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26\u54ea\u4e9b\u8bf7\u6c42\u53c2\u6570\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", params = {\"username\", \"password\"})\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u6bd4\u5982\u8fd9\u91cc\u6211\u4eec\u8981\u6c42\u8bf7\u6c42\u4e2d\u5fc5\u987b\u643a\u5e26<code>username</code>\u548c<code>password</code>\u5c5e\u6027\uff0c\u5426\u5219\u65e0\u6cd5\u8bbf\u95ee\u3002\u5b83\u8fd8\u652f\u6301\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7f16\u5199\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", params = {\"!username\", \"password\"})\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u5728username\u4e4b\u524d\u6dfb\u52a0\u4e00\u4e2a\u611f\u53f9\u53f7\u8868\u793a\u8bf7\u6c42\u7684\u4e0d\u5141\u8bb8\u643a\u5e26\u6b64\u53c2\u6570\uff0c\u5426\u5219\u65e0\u6cd5\u8bbf\u95ee\uff0c\u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u76f4\u63a5\u8bbe\u5b9a\u4e00\u4e2a\u56fa\u5b9a\u503c\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", params = {\"username!=test\", \"password=123\"})\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u8bf7\u6c42\u53c2\u6570username\u4e0d\u5141\u8bb8\u4e3atest\uff0c\u5e76\u4e14password\u5fc5\u987b\u4e3a123\uff0c\u5426\u5219\u65e0\u6cd5\u8bbf\u95ee\u3002</p> <p><code>header</code>\u5c5e\u6027\u7528\u6cd5\u4e0e<code>params</code>\u4e00\u81f4\uff0c\u4f46\u662f\u5b83\u8981\u6c42\u7684\u662f\u8bf7\u6c42\u5934\u4e2d\u9700\u8981\u643a\u5e26\u4ec0\u4e48\u5185\u5bb9\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", headers = \"!Connection\")\npublic ModelAndView index(){\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u90a3\u4e48\uff0c\u5982\u679c\u8bf7\u6c42\u5934\u4e2d\u643a\u5e26\u4e86<code>Connection</code>\u5c5e\u6027\uff0c\u5c06\u65e0\u6cd5\u8bbf\u95ee\u3002\u5176\u4ed6\u4e24\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li>consumes\uff1a \u6307\u5b9a\u5904\u7406\u8bf7\u6c42\u7684\u63d0\u4ea4\u5185\u5bb9\u7c7b\u578b\uff08Content-Type\uff09\uff0c\u4f8b\u5982application/json, text/html;</li> <li>produces: \u6307\u5b9a\u8fd4\u56de\u7684\u5185\u5bb9\u7c7b\u578b\uff0c\u4ec5\u5f53request\u8bf7\u6c42\u5934\u4e2d\u7684(Accept)\u7c7b\u578b\u4e2d\u5305\u542b\u8be5\u6307\u5b9a\u7c7b\u578b\u624d\u8fd4\u56de\uff1b</li> </ul> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u5982\u4f55\u83b7\u53d6\u5230\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\u3002</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u4e3a\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u5f62\u5f0f\u53c2\u6570\uff0c\u5e76\u5728\u5f62\u5f0f\u53c2\u6570\u524d\u9762\u6dfb\u52a0<code>@RequestParam</code>\u6ce8\u89e3\u5373\u53ef\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(@RequestParam(\"username\") String username){\n    System.out.println(\"\u63a5\u53d7\u5230\u8bf7\u6c42\u53c2\u6570\uff1a\"+username);\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u5728<code>@RequestParam</code>\u4e2d\u586b\u5199\u53c2\u6570\u540d\u79f0\uff0c\u53c2\u6570\u7684\u503c\u4f1a\u81ea\u52a8\u4f20\u9012\u7ed9\u5f62\u5f0f\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u4f7f\u7528\uff0c\u6ce8\u610f\uff0c\u5982\u679c\u53c2\u6570\u540d\u79f0\u4e0e\u5f62\u5f0f\u53c2\u6570\u540d\u79f0\u76f8\u540c\uff0c\u5373\u4f7f\u4e0d\u6dfb\u52a0<code>@RequestParam</code>\u4e5f\u80fd\u83b7\u53d6\u5230\u53c2\u6570\u503c\u3002</p> <p>\u4e00\u65e6\u6dfb\u52a0<code>@RequestParam</code>\uff0c\u90a3\u4e48\u6b64\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26\u6307\u5b9a\u53c2\u6570\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06require\u5c5e\u6027\u8bbe\u5b9a\u4e3afalse\u6765\u5c06\u5c5e\u6027\u8bbe\u5b9a\u4e3a\u975e\u5fc5\u987b\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(@RequestParam(value = \"username\", required = false) String username){\n    System.out.println(\"\u63a5\u53d7\u5230\u8bf7\u6c42\u53c2\u6570\uff1a\"+username);\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8bbe\u5b9a\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c\u5f53\u8bf7\u6c42\u53c2\u6570\u7f3a\u5931\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u9ed8\u8ba4\u503c\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(@RequestParam(value = \"username\", required = false, defaultValue = \"\u4f1e\u5175\u4e00\u53f7\") String username){\n    System.out.println(\"\u63a5\u53d7\u5230\u8bf7\u6c42\u53c2\u6570\uff1a\"+username);\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u5982\u679c\u9700\u8981\u4f7f\u7528Servlet\u539f\u672c\u7684\u4e00\u4e9b\u7c7b\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(HttpServletRequest request){\n    System.out.println(\"\u63a5\u53d7\u5230\u8bf7\u6c42\u53c2\u6570\uff1a\"+request.getParameterMap().keySet());\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u76f4\u63a5\u6dfb\u52a0<code>HttpServletRequest</code>\u4e3a\u5f62\u5f0f\u53c2\u6570\u5373\u53ef\uff0cSpringMVC\u4f1a\u81ea\u52a8\u4f20\u9012\u8be5\u8bf7\u6c42\u539f\u672c\u7684<code>HttpServletRequest</code>\u5bf9\u8c61\uff0c\u540c\u7406\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6dfb\u52a0<code>HttpServletResponse</code>\u4f5c\u4e3a\u5f62\u5f0f\u53c2\u6570\uff0c\u751a\u81f3\u53ef\u4ee5\u76f4\u63a5\u5c06HttpSession\u4e5f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(HttpSession session){\n    System.out.println(session.getAttribute(\"test\"));\n    session.setAttribute(\"test\", \"\u9e21\u4f60\u592a\u7f8e\");\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5c06\u8bf7\u6c42\u53c2\u6570\u4f20\u9012\u7ed9\u4e00\u4e2a\u5b9e\u4f53\u7c7b\uff1a</p> <pre><code>@Data\npublic class User {\n    String username;\n    String password;\n}\n</code></pre> <p>\u6ce8\u610f\u5fc5\u987b\u643a\u5e26set\u65b9\u6cd5\u6216\u662f\u6784\u9020\u65b9\u6cd5\u4e2d\u5305\u542b\u6240\u6709\u53c2\u6570\uff0c\u8bf7\u6c42\u53c2\u6570\u4f1a\u81ea\u52a8\u6839\u636e\u7c7b\u4e2d\u7684\u5b57\u6bb5\u540d\u79f0\u8fdb\u884c\u5339\u914d\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(User user){\n    System.out.println(\"\u83b7\u53d6\u5230cookie\u503c\u4e3a\uff1a\"+user);\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p><code>@RequestHeader</code>\u4e0e<code>@RequestParam</code>\u7528\u6cd5\u4e00\u81f4\uff0c\u4e0d\u8fc7\u5b83\u662f\u7528\u4e8e\u83b7\u53d6\u8bf7\u6c42\u5934\u53c2\u6570\u7684\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u6f14\u793a\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#cookievaluesessionattrbutie","title":"@CookieValue\u548c@SessionAttrbutie","text":"<p>\u901a\u8fc7\u4f7f\u7528<code>@CookieValue</code>\u6ce8\u89e3\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5feb\u901f\u83b7\u53d6\u8bf7\u6c42\u643a\u5e26\u7684Cookie\u4fe1\u606f\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(HttpServletResponse response,\n                          @CookieValue(value = \"test\", required = false) String test){\n    System.out.println(\"\u83b7\u53d6\u5230cookie\u503c\u4e3a\uff1a\"+test);\n    response.addCookie(new Cookie(\"test\", \"lbwnb\"));\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0cSession\u4e5f\u80fd\u4f7f\u7528\u6ce8\u89e3\u5feb\u901f\u83b7\u53d6\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic ModelAndView index(@SessionAttribute(value = \"test\", required = false) String test,\n                          HttpSession session){\n    session.setAttribute(\"test\", \"xxxx\");\n    System.out.println(test);\n    return new ModelAndView(\"index\");\n}\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u901a\u8fc7\u4f7f\u7528SpringMVC\u6846\u67b6\uff0c\u6574\u4e2aWeb\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u53d8\u5f97\u975e\u5e38\u7b80\u5355\uff0c\u5927\u90e8\u5206\u529f\u80fd\u53ea\u9700\u8981\u4e00\u4e2a\u6ce8\u89e3\u5c31\u53ef\u4ee5\u641e\u5b9a\u4e86\uff0c\u6b63\u662f\u5f97\u76ca\u4e8eSpring\u6846\u67b6\uff0cSpringMVC\u624d\u80fd\u5927\u663e\u8eab\u624b\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_4","title":"\u91cd\u5b9a\u5411\u548c\u8bf7\u6c42\u8f6c\u53d1","text":"<p>\u91cd\u5b9a\u5411\u548c\u8bf7\u6c42\u8f6c\u53d1\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u89c6\u56fe\u540d\u79f0\u524d\u9762\u6dfb\u52a0\u4e00\u4e2a\u524d\u7f00\u5373\u53ef\uff0c\u6bd4\u5982\u91cd\u5b9a\u5411\uff1a</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(){\n    return \"redirect:home\";\n}\n\n@RequestMapping(\"/home\")\npublic String home(){\n    return \"home\";\n}\n</code></pre> <p>\u901a\u8fc7\u6dfb\u52a0<code>redirect:</code>\u524d\u7f00\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b9e\u73b0\u91cd\u5b9a\u5411\uff0c\u90a3\u4e48\u8bf7\u6c42\u8f6c\u53d1\u5462\uff0c\u5176\u5b9e\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u4f7f\u7528<code>forward:</code>\u524d\u7f00\u8868\u793a\u8f6c\u53d1\u7ed9\u5176\u4ed6\u8bf7\u6c42\u6620\u5c04\uff1a</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(){\n    return \"forward:home\";\n}\n\n@RequestMapping(\"/home\")\npublic String home(){\n    return \"home\";\n}\n</code></pre> <p>\u4f7f\u7528SpringMVC\uff0c\u53ea\u9700\u8981\u4e00\u4e2a\u524d\u7f00\u5c31\u53ef\u4ee5\u5b9e\u73b0\u91cd\u5b9a\u5411\u548c\u8bf7\u6c42\u8f6c\u53d1\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#beanweb","title":"Bean\u7684Web\u4f5c\u7528\u57df","text":"<p>\u5728\u5b66\u4e60Spring\u65f6\u6211\u4eec\u8bb2\u89e3\u4e86Bean\u7684\u4f5c\u7528\u57df\uff0c\u5305\u62ec<code>singleton</code>\u548c<code>prototype</code>\uff0cBean\u5206\u522b\u4f1a\u4ee5\u5355\u4f8b\u548c\u591a\u4f8b\u6a21\u5f0f\u8fdb\u884c\u521b\u5efa\uff0c\u800c\u5728SpringMVC\u4e2d\uff0c\u5b83\u7684\u4f5c\u7528\u57df\u88ab\u7ee7\u7eed\u7ec6\u5206\uff1a</p> <ul> <li>request\uff1a\u5bf9\u4e8e\u6bcf\u6b21HTTP\u8bf7\u6c42\uff0c\u4f7f\u7528request\u4f5c\u7528\u57df\u5b9a\u4e49\u7684Bean\u90fd\u5c06\u4ea7\u751f\u4e00\u4e2a\u65b0\u5b9e\u4f8b\uff0c\u8bf7\u6c42\u7ed3\u675f\u540eBean\u4e5f\u6d88\u5931\u3002</li> <li>session\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u4f7f\u7528session\u4f5c\u7528\u57df\u5b9a\u4e49\u7684Bean\u90fd\u5c06\u4ea7\u751f\u4e00\u4e2a\u65b0\u5b9e\u4f8b\uff0c\u4f1a\u8bdd\u8fc7\u671f\u540eBean\u4e5f\u6d88\u5931\u3002</li> <li>global session\uff1a\u4e0d\u5e38\u7528\uff0c\u4e0d\u505a\u8bb2\u89e3\u3002</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u7c7b\u6765\u8bd5\u8bd5\u770b\uff1a</p> <pre><code>public class TestBean {\n\n}\n</code></pre> <p>\u63a5\u7740\u5c06\u5176\u6ce8\u518c\u4e3aBean\uff0c\u6ce8\u610f\u8fd9\u91cc\u9700\u8981\u6dfb\u52a0<code>@RequestScope</code>\u6216\u662f<code>@SessionScope</code>\u8868\u793a\u6b64Bean\u7684Web\u4f5c\u7528\u57df\uff1a</p> <pre><code>@Bean\n@RequestScope\npublic TestBean testBean(){\n    return new TestBean();\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5c06\u5176\u81ea\u52a8\u6ce8\u5165\u5230Controller\u4e2d\uff1a</p> <pre><code>@Controller\npublic class MainController {\n\n    @Resource\n    TestBean bean;\n\n    @RequestMapping(value = \"/index\")\n    public ModelAndView index(){\n        System.out.println(bean);\n        return new ModelAndView(\"index\");\n    }\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u6bcf\u6b21\u53d1\u8d77\u5f97\u5230\u7684Bean\u5b9e\u4f8b\u90fd\u4e0d\u540c\uff0c\u63a5\u7740\u6211\u4eec\u5c06\u5176\u4f5c\u7528\u57df\u4fee\u6539\u4e3a<code>@SessionScope</code>\uff0c\u8fd9\u6837\u4f5c\u7528\u57df\u5c31\u4e0a\u5347\u5230Session\uff0c\u53ea\u8981\u6e05\u7406\u6d4f\u89c8\u5668\u7684Cookie\uff0c\u90a3\u4e48\u90fd\u4f1a\u88ab\u8ba4\u4e3a\u662f\u540c\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u53ea\u8981\u662f\u540c\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u90a3\u4e48Bean\u5b9e\u4f8b\u59cb\u7ec8\u4e0d\u53d8\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7\u4ee3\u7406\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u8c03\u7528Bean\u4e2d\u7684\u65b9\u6cd5\u4f1a\u88ab\u8f6c\u53d1\u5230\u771f\u6b63\u7684Bean\u5bf9\u8c61\u53bb\u6267\u884c\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#restful","title":"RestFul\u98ce\u683c","text":"<p>\u4e2d\u6587\u91ca\u4e49\u4e3a\u201c\u8868\u73b0\u5c42\u72b6\u6001\u8f6c\u6362\u201d\uff08\u540d\u5b57\u633a\u9ad8\u5927\u4e0a\u7684\uff09\uff0c\u5b83\u4e0d\u662f\u4e00\u79cd\u6807\u51c6\uff0c\u800c\u662f\u4e00\u79cd\u8bbe\u8ba1\u98ce\u683c\u3002\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5145\u5206\u5e76\u6b63\u786e\u5229\u7528HTTP\u534f\u8bae\u7684\u7279\u6027\uff0c\u89c4\u8303\u8d44\u6e90\u83b7\u53d6\u7684URI\u8def\u5f84\u3002\u901a\u4fd7\u7684\u8bb2\uff0cRESTful\u98ce\u683c\u7684\u8bbe\u8ba1\u5141\u8bb8\u5c06\u53c2\u6570\u901a\u8fc7URL\u62fc\u63a5\u4f20\u5230\u670d\u52a1\u7aef\uff0c\u76ee\u7684\u662f\u8ba9URL\u770b\u8d77\u6765\u66f4\u7b80\u6d01\u5b9e\u7528\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u5145\u5206\u4f7f\u7528\u591a\u79cdHTTP\u8bf7\u6c42\u65b9\u5f0f\uff08POST/GET/PUT/DELETE\uff09\uff0c\u6765\u6267\u884c\u76f8\u540c\u8bf7\u6c42\u5730\u5740\u7684\u4e0d\u540c\u7c7b\u578b\u64cd\u4f5c\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u79cd\u98ce\u683c\u7684\u8fde\u63a5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u8bf7\u6c42\u8def\u5f84\u4e2d\u8bfb\u53d6\u53c2\u6570\uff0c\u6bd4\u5982\uff1a</p> <pre><code>http://localhost:8080/mvc/index/123456\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06index\u7684\u4e0b\u4e00\u7ea7\u8def\u5f84\u4f5c\u4e3a\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u7684\u8bf7\u6c42\u53c2\u6570\u5305\u542b\u5728\u4e86\u8bf7\u6c42\u8def\u5f84\u4e2d\uff1a</p> <pre><code>@RequestMapping(\"/index/{str}\")\npublic String index(@PathVariable String str) {\n    System.out.println(str);\n    return \"index\";\n}\n</code></pre> <p>\u6ce8\u610f\u8bf7\u6c42\u8def\u5f84\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u6dfb\u52a0\u7c7b\u4f3c\u5360\u4f4d\u7b26\u4e00\u6837\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u5360\u4f4d\u7b26\u4f4d\u7f6e\u7684\u6240\u6709\u5185\u5bb9\u90fd\u4f1a\u88ab\u4f5c\u4e3a\u8bf7\u6c42\u53c2\u6570\uff0c\u800c\u65b9\u6cd5\u7684\u5f62\u53c2\u5217\u8868\u4e2d\u5fc5\u987b\u5305\u62ec\u4e00\u4e2a\u4e0e\u5360\u4f4d\u7b26\u540c\u540d\u7684\u5e76\u4e14\u6dfb\u52a0\u4e86<code>@PathVariable</code>\u6ce8\u89e3\u7684\u53c2\u6570\uff0c\u6216\u662f\u7531<code>@PathVariable</code>\u6ce8\u89e3\u6307\u5b9a\u4e3a\u5360\u4f4d\u7b26\u540d\u79f0\uff1a</p> <pre><code>@RequestMapping(\"/index/{str}\")\npublic String index(@PathVariable(\"str\") String text){\n    System.out.println(text);\n    return \"index\";\n}\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u6b63\u786e\uff0c\u65b9\u6cd5\u540d\u79f0\u4e0a\u4f1a\u51fa\u73b0\u9ec4\u7ebf\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u4e0d\u540c\u529f\u80fd\u8fdb\u884c\u5212\u5206\uff1a</p> <ul> <li>POST http://localhost:8080/mvc/index - \u6dfb\u52a0\u7528\u6237\u4fe1\u606f\uff0c\u643a\u5e26\u8868\u5355\u6570\u636e</li> <li>GET http://localhost:8080/mvc/index/{id} - \u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0cid\u76f4\u63a5\u653e\u5728\u8bf7\u6c42\u8def\u5f84\u4e2d</li> <li>PUT http://localhost:8080/mvc/index - \u4fee\u6539\u7528\u6237\u4fe1\u606f\uff0c\u643a\u5e26\u8868\u5355\u6570\u636e</li> <li>DELETE http://localhost:8080/mvc/index/{id} - \u5220\u9664\u7528\u6237\u4fe1\u606f\uff0cid\u76f4\u63a5\u653e\u5728\u8bf7\u6c42\u8def\u5f84\u4e2d</li> </ul> <p>\u6211\u4eec\u5206\u522b\u7f16\u5199\u56db\u4e2a\u8bf7\u6c42\u6620\u5c04\uff1a</p> <pre><code>@Controller\npublic class MainController {\n\n    @RequestMapping(value = \"/index/{id}\", method = RequestMethod.GET)\n    public String get(@PathVariable(\"id\") String text){\n        System.out.println(\"\u83b7\u53d6\u7528\u6237\uff1a\"+text);\n        return \"index\";\n    }\n\n    @RequestMapping(value = \"/index\", method = RequestMethod.POST)\n    public String post(String username){\n        System.out.println(\"\u6dfb\u52a0\u7528\u6237\uff1a\"+username);\n        return \"index\";\n    }\n\n    @RequestMapping(value = \"/index/{id}\", method = RequestMethod.DELETE)\n    public String delete(@PathVariable(\"id\") String text){\n        System.out.println(\"\u5220\u9664\u7528\u6237\uff1a\"+text);\n        return \"index\";\n    }\n\n    @RequestMapping(value = \"/index\", method = RequestMethod.PUT)\n    public String put(String username){\n        System.out.println(\"\u4fee\u6539\u7528\u6237\uff1a\"+username);\n        return \"index\";\n    }\n}\n</code></pre> <p>\u8fd9\u53ea\u662f\u4e00\u79cd\u8bbe\u8ba1\u98ce\u683c\u800c\u5df2\uff0c\u5404\u4f4d\u5c0f\u4f19\u4f34\u4e86\u89e3\u5373\u53ef\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#interceptor","title":"Interceptor\u62e6\u622a\u5668","text":"<p>\u62e6\u622a\u5668\u662f\u6574\u4e2aSpringMVC\u7684\u4e00\u4e2a\u91cd\u8981\u5185\u5bb9\uff0c\u62e6\u622a\u5668\u4e0e\u8fc7\u6ee4\u5668\u7c7b\u4f3c\uff0c\u90fd\u662f\u7528\u4e8e\u62e6\u622a\u4e00\u4e9b\u975e\u6cd5\u8bf7\u6c42\uff0c\u4f46\u662f\u6211\u4eec\u4e4b\u524d\u8bb2\u89e3\u7684\u8fc7\u6ee4\u5668\u662f\u4f5c\u7528\u4e8eServlet\u4e4b\u524d\uff0c\u53ea\u6709\u7ecf\u8fc7\u5c42\u5c42\u7684\u8fc7\u6ee4\u5668\u624d\u53ef\u4ee5\u6210\u529f\u5230\u8fbeServlet\uff0c\u800c\u62e6\u622a\u5668\u5e76\u4e0d\u662f\u5728Servlet\u4e4b\u524d\uff0c\u5b83\u5728Servlet\u4e0eRequestMapping\u4e4b\u95f4\uff0c\u76f8\u5f53\u4e8eDispatcherServlet\u5728\u5c06\u8bf7\u6c42\u4ea4\u7ed9\u5bf9\u5e94Controller\u4e2d\u7684\u65b9\u6cd5\u4e4b\u524d\u8fdb\u884c\u62e6\u622a\u5904\u7406\uff0c\u5b83\u53ea\u4f1a\u62e6\u622a\u6240\u6709Controller\u4e2d\u5b9a\u4e49\u7684\u8bf7\u6c42\u6620\u5c04\u5bf9\u5e94\u7684\u8bf7\u6c42\uff08\u4e0d\u4f1a\u62e6\u622a\u9759\u6001\u8d44\u6e90\uff09\uff0c\u8fd9\u91cc\u4e00\u5b9a\u8981\u533a\u5206\u4e24\u8005\u7684\u4e0d\u540c\u3002</p> <p>image-20230630194651686</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_5","title":"\u521b\u5efa\u62e6\u622a\u5668","text":"<p>\u521b\u5efa\u4e00\u4e2a\u62e6\u622a\u5668\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a<code>HandlerInterceptor</code>\u63a5\u53e3\uff1a</p> <pre><code>public class MainInterceptor implements HandlerInterceptor {\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        System.out.println(\"\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\");\n        return true;   //\u53ea\u6709\u8fd4\u56detrue\u624d\u4f1a\u7ee7\u7eed\uff0c\u5426\u5219\u76f4\u63a5\u7ed3\u675f\n    }\n\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        System.out.println(\"\u6211\u662f\u5904\u7406\u4e4b\u540e\uff01\");\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n          //\u5728DispatcherServlet\u5b8c\u5168\u5904\u7406\u5b8c\u8bf7\u6c42\u540e\u88ab\u8c03\u7528\n        System.out.println(\"\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\");\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u5728\u914d\u7f6e\u7c7b\u4e2d\u8fdb\u884c\u6ce8\u518c\uff1a</p> <pre><code>@Override\npublic void addInterceptors(InterceptorRegistry registry) {\n    registry.addInterceptor(new MainInterceptor())\n      .addPathPatterns(\"/**\")    //\u6dfb\u52a0\u62e6\u622a\u5668\u7684\u5339\u914d\u8def\u5f84\uff0c\u53ea\u8981\u5339\u914d\u4e00\u5f8b\u62e6\u622a\n      .excludePathPatterns(\"/home\");   //\u62e6\u622a\u5668\u4e0d\u8fdb\u884c\u62e6\u622a\u7684\u8def\u5f84\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95eeindex\u9875\u9762\uff0c\u62e6\u622a\u5668\u5df2\u7ecf\u751f\u6548\u3002</p> <p>\u5f97\u5230\u6574\u7406\u62e6\u622a\u5668\u7684\u6267\u884c\u987a\u5e8f\uff1a</p> <pre><code>\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n\u6211\u662f\u5904\u7406\uff01\n\u6211\u662f\u5904\u7406\u4e4b\u540e\uff01\n\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5904\u7406\u524d\u548c\u5904\u7406\u540e\uff0c\u5305\u542b\u4e86\u771f\u6b63\u7684\u8bf7\u6c42\u6620\u5c04\u7684\u5904\u7406\uff0c\u5728\u6574\u4e2a\u6d41\u7a0b\u7ed3\u675f\u540e\u8fd8\u6267\u884c\u4e86\u4e00\u6b21<code>afterCompletion</code>\u65b9\u6cd5\uff0c\u5176\u5b9e\u6574\u4e2a\u8fc7\u7a0b\u4e0e\u6211\u4eec\u4e4b\u524d\u6240\u8ba4\u8bc6\u7684Filter\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u5728\u5904\u7406\u524d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fd4\u56detrue\u6216\u662ffalse\u8868\u793a\u662f\u5426\u88ab\u62e6\u622a\u5373\u53ef\uff0c\u800c\u4e0d\u662f\u518d\u53bb\u4f7f\u7528FilterChain\u8fdb\u884c\u5411\u4e0b\u4f20\u9012\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u770b\u770b\uff0c\u5982\u679c\u5904\u7406\u524d\u8fd4\u56defalse\uff0c\u4f1a\u600e\u4e48\u6837\uff1a</p> <pre><code>\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n</code></pre> <p>\u901a\u8fc7\u7ed3\u679c\u53d1\u73b0\u4e00\u65e6\u8fd4\u56defalse\uff0c\u4e4b\u540e\u7684\u6240\u6709\u6d41\u7a0b\u5168\u90e8\u53d6\u6d88\uff0c\u90a3\u4e48\u5982\u679c\u662f\u5728\u5904\u7406\u4e2d\u53d1\u751f\u5f02\u5e38\u4e86\u5462\uff1f</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(){\n    System.out.println(\"\u6211\u662f\u5904\u7406\uff01\");\n    if(true) throw new RuntimeException(\"\");\n    return \"index\";\n}\n</code></pre> <p>\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n\u6211\u662f\u5904\u7406\uff01\n\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u5982\u679c\u5904\u7406\u8fc7\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\uff0c\u90a3\u4e48\u4e45\u4e0d\u4f1a\u6267\u884c\u5904\u7406\u540e<code>postHandle</code>\u65b9\u6cd5\uff0c\u4f46\u662f\u4f1a\u6267\u884c<code>afterCompletion</code>\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6b64\u65b9\u6cd5\u4e2d\u83b7\u53d6\u5230\u629b\u51fa\u7684\u5f02\u5e38\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_6","title":"\u591a\u7ea7\u62e6\u622a\u5668","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u62e6\u622a\u5668\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u63a5\u7740\u6765\u770b\u5982\u679c\u5b58\u5728\u591a\u4e2a\u62e6\u622a\u5668\u4f1a\u5982\u4f55\u6267\u884c\uff0c\u6211\u4eec\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u521b\u5efa\u4e8c\u53f7\u62e6\u622a\u5668\uff1a</p> <pre><code>public class SubInterceptor implements HandlerInterceptor {\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        System.out.println(\"\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\");\n        return true;\n    }\n\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        System.out.println(\"\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u540e\uff01\");\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        System.out.println(\"\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\");\n    }\n}\n</code></pre> <p>\u6ce8\u518c\u4e8c\u53f7\u62e6\u622a\u5668\uff1a</p> <pre><code>@Override\npublic void addInterceptors(InterceptorRegistry registry) {\n      //\u4e00\u53f7\u62e6\u622a\u5668\n    registry.addInterceptor(new MainInterceptor()).addPathPatterns(\"/**\").excludePathPatterns(\"/home\");\n      //\u4e8c\u53f7\u62e6\u622a\u5668\n    registry.addInterceptor(new SubInterceptor()).addPathPatterns(\"/**\");\n}\n</code></pre> <p>\u6ce8\u610f\u62e6\u622a\u987a\u5e8f\u5c31\u662f\u6ce8\u518c\u7684\u987a\u5e8f\uff0c\u56e0\u6b64\u62e6\u622a\u5668\u4f1a\u6839\u636e\u6ce8\u518c\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u6253\u5f00\u6d4f\u89c8\u5668\u8fd0\u884c\u4e00\u6b21\uff1a</p> <pre><code>\u4e00\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n\u6211\u662f\u5904\u7406\uff01\n\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u540e\uff01\n\u4e00\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u540e\uff01\n\u4e8c\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\n\u4e00\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5b8c\u6210\u4e4b\u540e\uff01\n</code></pre> <p>\u548c\u591a\u7ea7Filter\u76f8\u540c\uff0c\u5728\u5904\u7406\u4e4b\u524d\uff0c\u662f\u6309\u7167\u987a\u5e8f\u4ece\u524d\u5411\u540e\u8fdb\u884c\u62e6\u622a\u7684\uff0c\u4f46\u662f\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u5c31\u6309\u7167\u5012\u5e8f\u6267\u884c\u5904\u7406\u540e\u65b9\u6cd5\uff0c\u800c\u5b8c\u6210\u540e\u662f\u5728\u6240\u6709\u7684<code>postHandle</code>\u6267\u884c\u4e4b\u540e\u518d\u540c\u6837\u7684\u4ee5\u5012\u5e8f\u65b9\u5f0f\u6267\u884c\u3002</p> <p>\u90a3\u4e48\u5982\u679c\u8fd9\u65f6\u4e00\u53f7\u62e6\u622a\u5668\u5728\u5904\u7406\u524d\u5c31\u8fd4\u56de\u4e86false\u5462\uff1f</p> <pre><code>@Override\npublic boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n    System.out.println(\"\u4e00\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\");\n    return false;\n}\n</code></pre> <p>\u5f97\u5230\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u4e00\u53f7\u62e6\u622a\u5668\uff1a\u6211\u662f\u5904\u7406\u4e4b\u524d\uff01\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u4e0e\u5355\u4e2a\u62e6\u622a\u5668\u7684\u60c5\u51b5\u4e00\u6837\uff0c\u4e00\u65e6\u62e6\u622a\u5668\u8fd4\u56defalse\uff0c\u90a3\u4e48\u4e4b\u540e\u65e0\u8bba\u6709\u65e0\u62e6\u622a\u5668\uff0c\u90fd\u4e0d\u518d\u7ee7\u7eed\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_7","title":"\u5f02\u5e38\u5904\u7406","text":"<p>\u5f53\u6211\u4eec\u7684\u8bf7\u6c42\u6620\u5c04\u65b9\u6cd5\u4e2d\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u4f1a\u76f4\u63a5\u5c55\u793a\u5728\u524d\u7aef\u9875\u9762\uff0c\u8fd9\u662f\u56e0\u4e3aSpringMVC\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u5f02\u5e38\u5904\u7406\u9875\u9762\uff0c\u5f53\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u6211\u4eec\u7684\u8bf7\u6c42\u4f1a\u88ab\u76f4\u63a5\u8f6c\u4ea4\u7ed9\u4e13\u95e8\u7528\u4e8e\u5f02\u5e38\u5904\u7406\u7684\u63a7\u5236\u5668\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5f02\u5e38\u5904\u7406\u63a7\u5236\u5668\uff0c\u4e00\u65e6\u51fa\u73b0\u6307\u5b9a\u5f02\u5e38\uff0c\u5c31\u4f1a\u8f6c\u63a5\u5230\u6b64\u63a7\u5236\u5668\u6267\u884c\uff1a</p> <pre><code>@ControllerAdvice\npublic class ErrorController {\n\n    @ExceptionHandler(Exception.class)\n    public String error(Exception e, Model model){  //\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u5f62\u53c2\u6765\u83b7\u53d6\u5f02\u5e38\n        e.printStackTrace();\n        model.addAttribute(\"e\", e);\n        return \"500\";\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u4e13\u95e8\u663e\u793a\u5f02\u5e38\u7684\u9875\u9762\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  500 - \u670d\u52a1\u5668\u51fa\u73b0\u4e86\u4e00\u4e2a\u5185\u90e8\u9519\u8befQAQ\n  &lt;div th:text=\"${e}\"&gt;&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u63a5\u7740\u4fee\u6539\uff1a</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(){\n    System.out.println(\"\u6211\u662f\u5904\u7406\uff01\");\n    if(true) throw new RuntimeException(\"\u60a8\u7684\u6c2a\u91d1\u529b\u5ea6\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8bbf\u95ee\uff01\");\n    return \"index\";\n}\n</code></pre> <p>\u8bbf\u95ee\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u63a7\u5236\u53f0\u4f1a\u8f93\u51fa\u5f02\u5e38\u4fe1\u606f\uff0c\u540c\u65f6\u9875\u9762\u4e5f\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u4e00\u4e2a\u9875\u9762\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#jsonaxios","title":"JSON\u6570\u636e\u683c\u5f0f\u4e0eAxios\u8bf7\u6c42","text":"<p>JSON (JavaScript Object Notation, JS \u5bf9\u8c61\u7b80\u8c31) \u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u63a8\u5d07\u7684\u662f\u524d\u540e\u7aef\u5206\u79bb\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u800c\u4e0d\u662f\u6240\u6709\u7684\u5185\u5bb9\u5168\u90e8\u4ea4\u7ed9\u540e\u7aef\u6e32\u67d3\u518d\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6574\u4e2aWeb\u9875\u9762\u7684\u5185\u5bb9\u5728\u4e00\u5f00\u59cb\u5c31\u7f16\u5199\u5b8c\u6210\u4e86\uff0c\u800c\u5176\u4e2d\u7684\u6570\u636e\u7531\u524d\u7aef\u6267\u884cJS\u4ee3\u7801\u6765\u5411\u670d\u52a1\u5668\u52a8\u6001\u83b7\u53d6\uff0c\u518d\u5230\u524d\u7aef\u8fdb\u884c\u6e32\u67d3\uff08\u586b\u5145\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5e45\u5ea6\u51cf\u5c11\u540e\u7aef\u7684\u538b\u529b\uff0c\u5e76\u4e14\u540e\u7aef\u53ea\u9700\u8981\u4f20\u8f93\u5173\u952e\u6570\u636e\u5373\u53ef\uff08\u5728\u5373\u5c06\u5230\u6765\u7684SpringBoot\u9636\u6bb5\uff0c\u6211\u4eec\u5c06\u5b8c\u5168\u91c7\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u5f00\u53d1\u6a21\u5f0f\uff09</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#json","title":"JSON\u6570\u636e\u683c\u5f0f","text":"<p>\u65e2\u7136\u8981\u5b9e\u73b0\u524d\u540e\u7aef\u5206\u79bb\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u5fc5\u987b\u7ea6\u5b9a\u4e00\u79cd\u66f4\u52a0\u9ad8\u6548\u7684\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\uff0c\u6765\u5411\u524d\u7aef\u9875\u9762\u4f20\u8f93\u540e\u7aef\u63d0\u4f9b\u7684\u6570\u636e\u3002\u56e0\u6b64JSON\u6a2a\u7a7a\u51fa\u4e16\uff0c\u5b83\u975e\u5e38\u5bb9\u6613\u7406\u89e3\uff0c\u5e76\u4e14\u4e0e\u524d\u7aef\u7684\u517c\u5bb9\u6027\u6781\u597d\uff0c\u56e0\u6b64\u73b0\u5728\u6bd4\u8f83\u4e3b\u6d41\u7684\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\u5219\u662f\u901a\u8fc7JSON\u683c\u5f0f\u627f\u8f7d\u7684\u3002</p> <p>\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6570\u636e\u957f\u8fd9\u6837\uff0c\u4ee5\u5b66\u751f\u5bf9\u8c61\u4e3a\u4f8b\uff1a</p> <pre><code>{\"name\": \"\u6770\u54e5\", \"age\": 18}\n</code></pre> <p>\u591a\u4e2a\u5b66\u751f\u53ef\u4ee5\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u8868\u793a\uff1a</p> <pre><code>[{\"name\": \"\u6770\u54e5\", \"age\": 18}, {\"name\": \"\u963f\u4f1f\", \"age\": 18}]\n</code></pre> <p>\u5d4c\u5957\u5173\u7cfb\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a</p> <pre><code>{\"studentList\": [{\"name\": \"\u6770\u54e5\", \"age\": 18}, {\"name\": \"\u963f\u4f1f\", \"age\": 18}], \"count\": 2}\n</code></pre> <p>\u5b83\u76f4\u63a5\u5305\u62ec\u4e86\u5c5e\u6027\u7684\u540d\u79f0\u548c\u5c5e\u6027\u7684\u503c\uff0c\u4e0eJavaScript\u7684\u5bf9\u8c61\u6781\u4e3a\u76f8\u4f3c\uff0c\u5b83\u5230\u8fbe\u524d\u7aef\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8f6c\u6362\u4e3a\u5bf9\u8c61\uff0c\u4ee5\u5bf9\u8c61\u7684\u5f62\u5f0f\u8fdb\u884c\u64cd\u4f5c\u548c\u5185\u5bb9\u7684\u8bfb\u53d6\uff0c\u76f8\u5f53\u4e8e\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8868\u793a\u4e86\u4e00\u4e2aJS\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u63a7\u5236\u53f0\u7a97\u53e3\u4e2d\u6d4b\u8bd5\uff1a</p> <pre><code>let obj = JSON.parse('{\"studentList\": [{\"name\": \"\u6770\u54e5\", \"age\": 18}, {\"name\": \"\u963f\u4f1f\", \"age\": 18}], \"count\": 2}')\n//\u5c06JSON\u683c\u5f0f\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3aJS\u5bf9\u8c61\nobj.studentList[0].name   //\u76f4\u63a5\u8bbf\u95ee\u7b2c\u4e00\u4e2a\u5b66\u751f\u7684\u540d\u79f0\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06JS\u5bf9\u8c61\u8f6c\u6362\u4e3aJSON\u5b57\u7b26\u4e32\uff1a</p> <pre><code>JSON.stringify(obj)\n</code></pre> <p>\u6211\u4eec\u540e\u7aef\u5c31\u53ef\u4ee5\u4ee5JSON\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u5411\u524d\u7aef\u8fd4\u56de\u6570\u636e\uff0c\u8fd9\u6837\u524d\u7aef\u5728\u62ff\u5230\u6570\u636e\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u83b7\u53d6\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p> <p>\u90a3\u4e48\u540e\u7aef\u5982\u4f55\u5feb\u901f\u521b\u5efa\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6570\u636e\u5462\uff1f\u6211\u4eec\u9996\u5148\u9700\u8981\u5bfc\u5165\u4ee5\u4e0b\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n      &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt;\n      &lt;artifactId&gt;fastjson2&lt;/artifactId&gt;\n      &lt;version&gt;2.0.34&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>JSON\u89e3\u6790\u6846\u67b6\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u662fJackson\u548cFastJSON\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u963f\u91cc\u5df4\u5df4\u7684FastJSON\u8fdb\u884c\u89e3\u6790\uff0c\u8fd9\u662f\u76ee\u524d\u53f7\u79f0\u6700\u5feb\u7684JSON\u89e3\u6790\u6846\u67b6\uff0c\u5e76\u4e14\u73b0\u5728\u5df2\u7ecf\u5f3a\u52bf\u63a8\u51faFastJSON 2\u7248\u672c\u3002</p> <p>\u9996\u5148\u8981\u4ecb\u7ecd\u7684\u662fJSONObject\uff0c\u5b83\u548cMap\u7684\u4f7f\u7528\u65b9\u6cd5\u4e00\u6837\uff0c\u5e76\u4e14\u662f\u6709\u5e8f\u7684\uff08\u5b9e\u73b0\u4e86LinkedHashMap\u63a5\u53e3\uff09\uff0c\u6bd4\u5982\u6211\u4eec\u5411\u5176\u4e2d\u5b58\u653e\u51e0\u4e2a\u6570\u636e\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic String index(){\n    JSONObject object = new JSONObject();\n    object.put(\"name\", \"\u6770\u54e5\");\n    object.put(\"age\", 18);\n    System.out.println(object.toJSONString());   //\u4ee5JSON\u683c\u5f0f\u8f93\u51faJSONObject\u5b57\u7b26\u4e32\n    return \"index\";\n}\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u5f97\u5230\u7684\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>{\"name\": \"\u6770\u54e5\", \"age\": 18}\n</code></pre> <p>\u5b9e\u9645\u4e0aJSONObject\u5c31\u662f\u5bf9JSON\u6570\u636e\u7684\u4e00\u79cd\u5bf9\u8c61\u8868\u793a\u3002\u540c\u6837\u7684\u8fd8\u6709JSONArray\uff0c\u5b83\u8868\u793a\u4e00\u4e2a\u6570\u7ec4\uff0c\u7528\u6cd5\u548cList\u4e00\u6837\uff0c\u6570\u7ec4\u4e2d\u53ef\u4ee5\u5d4c\u5957\u5176\u4ed6\u7684JSONObject\u6216\u662fJSONArray\uff1a</p> <pre><code>@RequestMapping(value = \"/index\")\npublic String index(){\n    JSONObject object = new JSONObject();\n    object.put(\"name\", \"\u6770\u54e5\");\n    object.put(\"age\", 18);\n    JSONArray array = new JSONArray();\n    array.add(object);\n    System.out.println(array.toJSONString());\n    return \"index\";\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>[{\"name\": \"\u6770\u54e5\", \"age\": 18}]\n</code></pre> <p>\u5f53\u51fa\u73b0\u5faa\u73af\u5f15\u7528\u65f6\uff0c\u4f1a\u6309\u7167\u4ee5\u4e0b\u8bed\u6cd5\u6765\u89e3\u6790\uff1a</p> <p>img</p> <p>\u6211\u4eec\u53ef\u4ee5\u4e5f\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f53\u7c7b\uff0c\u5c06\u5b9e\u4f53\u7c7b\u8f6c\u6362\u4e3aJSON\u683c\u5f0f\u7684\u6570\u636e\uff1a</p> <pre><code>@RequestMapping(value = \"/index\", produces = \"application/json\")\n@ResponseBody\npublic String data(){\n    Student student = new Student();\n    student.setName(\"\u6770\u54e5\");\n    student.setAge(18);\n    return JSON.toJSONString(student);\n}\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u4fee\u6539\u4e86<code>produces</code>\u7684\u503c\uff0c\u5c06\u8fd4\u56de\u7684\u5185\u5bb9\u7c7b\u578b\u8bbe\u5b9a\u4e3a<code>application/json</code>\uff0c\u8868\u793a\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u4e86\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6570\u636e\uff08\u5f53\u7136\u4e0d\u8bbe\u7f6e\u4e5f\u884c\uff0c\u4e5f\u80fd\u5c55\u793a\uff0c\u8fd9\u6837\u662f\u4e3a\u4e86\u89c4\u8303\uff09\u7136\u540e\u6211\u4eec\u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u4e00\u4e2a<code>@ResponseBody</code>\u8868\u793a\u65b9\u6cd5\u8fd4\u56de\uff08\u4e5f\u53ef\u4ee5\u5728\u7c7b\u4e0a\u6dfb\u52a0<code>@RestController</code>\u8868\u793a\u6b64Controller\u9ed8\u8ba4\u8fd4\u56de\u7684\u662f\u5b57\u7b26\u4e32\u6570\u636e\uff09\u7684\u7ed3\u679c\u4e0d\u662f\u89c6\u56fe\u540d\u79f0\u800c\u662f\u76f4\u63a5\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u9875\u9762\u6570\u636e\uff0c\u8fd9\u6837\uff0c\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\u7684\u5c31\u662f\u6211\u4eec\u76f4\u63a5\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u4f7f\u7528JSON\u5de5\u5177\u7c7b\u5c06\u5176\u8f6c\u6362\u4e3aJSON\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u5f97\u5230JSON\u683c\u5f0f\u6570\u636e\u3002</p> <p>SpringMVC\u975e\u5e38\u667a\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u7c7b\u578b\uff0c\u5b83\u4f1a\u88ab\u81ea\u52a8\u8f6c\u6362\u4e3aJSON\u5b57\u7b26\u4e32\u683c\u5f0f\uff1a</p> <pre><code>@RequestMapping(value = \"/data\", produces = \"application/json\")\n@ResponseBody\npublic Student data(){\n    Student student = new Student();\n    student.setName(\"\u6770\u54e5\");\n    student.setAge(18);\n    return student;\n}\n</code></pre> <p>\u6ce8\u610f\u9700\u8981\u5728\u914d\u7f6e\u7c7b\u4e2d\u6dfb\u52a0\u4e00\u4e0bFastJSON\u8f6c\u6362\u5668\uff0c\u8fd9\u91cc\u9700\u8981\u5148\u6dfb\u52a0\u4e00\u4e2a\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt;\n    &lt;artifactId&gt;fastjson2-extension-spring6&lt;/artifactId&gt;\n    &lt;version&gt;2.0.34&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u7136\u540e\u7f16\u5199\u914d\u7f6e\uff1a</p> <pre><code>@Override\npublic void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {\n    converters.add(new FastJsonHttpMessageConverter());\n}\n</code></pre> <p>\u518d\u6b21\u5c1d\u8bd5\uff0c\u5185\u5bb9\u5c31\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3aJSON\u683c\u5f0f\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#axios","title":"Axios\u5f02\u6b65\u8bf7\u6c42","text":"<p>\u524d\u9762\u6211\u4eec\u8bb2\u89e3\u4e86\u5982\u4f55\u5411\u6d4f\u89c8\u5668\u53d1\u9001\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6570\u636e\uff0c\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u6765\u770b\u770b\u5982\u4f55\u5411\u670d\u52a1\u5668\u8bf7\u6c42\u6570\u636e\u3002</p> <p>img</p> <p>\u8fd9\u4e00\u90e8\u5206\uff0c\u6211\u4eec\u53c8\u8981\u56de\u5230\u524d\u7aef\u76f8\u5173\u5185\u5bb9\u7684\u4ecb\u7ecd\u4e2d\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u4f9d\u7136\u662f\u4ec5\u505a\u4e86\u89e3\uff0c\u5e76\u4e0d\u9700\u8981\u8be6\u7ec6\u5b66\u4e60\u524d\u7aef\u9879\u76ee\u5f00\u53d1\u77e5\u8bc6\u3002</p> <p>\u524d\u7aef\u4e3a\u4ec0\u4e48\u9700\u8981\u7528\u5230\u5f02\u6b65\u8bf7\u6c42\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u7684\u7f51\u9875\u662f\u52a8\u6001\u7684\uff08\u8fd9\u91cc\u7684\u52a8\u6001\u4e0d\u662f\u6307\u6709\u52a8\u753b\u6548\u679c\uff0c\u800c\u662f\u80fd\u591f\u5b9e\u65f6\u66f4\u65b0\u5185\u5bb9\uff09\u6bd4\u5982\u6211\u4eec\u70b9\u51fb\u4e00\u4e2a\u6309\u94ae\u4f1a\u5f39\u51fa\u65b0\u7684\u5185\u5bb9\u3001\u6216\u662f\u8df3\u8f6c\u5230\u65b0\u7684\u9875\u9762\u3001\u66f4\u65b0\u9875\u9762\u4e2d\u7684\u6570\u636e\u7b49\u7b49\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u901a\u8fc7JS\u5b8c\u6210\u5f02\u6b65\u8bf7\u6c42\u6765\u5b9e\u73b0\u3002</p> <p>\u524d\u7aef\u5f02\u6b65\u8bf7\u6c42\u6307\u7684\u662f\u5728\u524d\u7aef\u4e2d\u53d1\u9001\u8bf7\u6c42\u81f3\u670d\u52a1\u5668\u6216\u5176\u4ed6\u8d44\u6e90\uff0c\u5e76\u4e14\u4e0d\u963b\u585e\u7528\u6237\u754c\u9762\u6216\u5176\u4ed6\u64cd\u4f5c\u3002\u5728\u4f20\u7edf\u7684\u540c\u6b65\u8bf7\u6c42\u4e2d\uff0c\u5f53\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\uff0c\u671f\u95f4\u7528\u6237\u65e0\u6cd5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\u800c\u5f02\u6b65\u8bf7\u6c42\u901a\u8fc7\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u540e\u53f0\uff0c\u5728\u7b49\u5f85\u54cd\u5e94\u7684\u540c\u65f6\uff0c\u5141\u8bb8\u7528\u6237\u7ee7\u7eed\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\u8fd9\u79cd\u673a\u5236\u80fd\u591f\u63d0\u5347\u7528\u6237\u4f53\u9a8c\uff0c\u5e76\u4e14\u5141\u8bb8\u9875\u9762\u8fdb\u884c\u5b9e\u65f6\u66f4\u65b0\u3002\u5e38\u89c1\u7684\u524d\u7aef\u5f02\u6b65\u8bf7\u6c42\u65b9\u5f0f\u5305\u62ec\u4f7f\u7528XMLHttpRequest\u5bf9\u8c61\u3001Fetch API\u3001\u4ee5\u53ca\u4f7f\u7528jQuery\u5e93\u4e2d\u7684AJAX\u65b9\u6cd5\uff0c\u4ee5\u53ca\u76ee\u524d\u6700\u5e38\u7528\u7684Axios\u6846\u67b6\u7b49\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u540e\u7aef\u6709\u4e00\u4e2a\u9700\u8981\u5b9e\u65f6\u5237\u65b0\u7684\u6570\u636e\uff08\u968f\u65f6\u95f4\u800c\u53d8\u5316\uff09\u73b0\u5728\u9700\u8981\u518d\u524d\u7aef\u5b9e\u65f6\u66f4\u65b0\u5c55\u793a\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee5axios\u6846\u67b6\u7684\u7b80\u5355\u4f7f\u7528\u4e3a\u4f8b\u5b50\uff0c\u5e26\u5404\u4f4d\u5c0f\u4f19\u4f34\u4f53\u9a8c\u5982\u4f55\u53d1\u8d77\u5f02\u6b65\u8bf7\u6c42\u5e76\u66f4\u65b0\u6211\u4eec\u9875\u9762\u4e2d\u7684\u6570\u636e\u3002</p> <p>\u9996\u5148\u662f\u524d\u7aef\u9875\u9762\uff0c\u76f4\u63a5\u6284\u4f5c\u4e1a\u5c31\u884c\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u6d4b\u8bd5&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/axios@1.1.2/dist/axios.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;p&gt;\u6b22\u8fce\u6765\u5230GayHub\u5168\u7403\u6700\u5927\u540c\u6027\u4ea4\u53cb\u7f51\u7ad9&lt;/p&gt;\n  &lt;p&gt;\u7528\u6237\u540d: &lt;span id=\"username\"&gt;&lt;/span&gt;&lt;/p&gt;\n  &lt;p&gt;\u5bc6\u7801: &lt;span id=\"password\"&gt;&lt;/span&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u4f7f\u7528axios\u6846\u67b6\u76f4\u63a5\u5bf9\u540e\u7aef\u8bf7\u6c42JSON\u6570\u636e\uff1a</p> <pre><code>&lt;script&gt;\n    function getInfo() {\n        axios.get('/mvc/test').then(({data}) =&gt; {\n            document.getElementById('username').innerText = data.username\n            document.getElementById('password').innerText = data.password\n        })\n    }\n&lt;/script&gt;\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u4ece\u670d\u52a1\u7aef\u83b7\u53d6\u6570\u636e\u5e76\u66f4\u65b0\u5230\u9875\u9762\u4e2d\uff0c\u524d\u7aef\u5f00\u53d1\u8005\u5229\u7528JS\u53d1\u8d77\u5f02\u6b65\u8bf7\u6c42\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5404\u79cd\u5404\u6837\u7684\u6548\u679c\uff0c\u800c\u6211\u4eec\u540e\u7aef\u5f00\u53d1\u8005\u53ea\u9700\u8981\u5173\u5fc3\u63a5\u53e3\u8fd4\u56de\u6b63\u786e\u7684\u6570\u636e\u5373\u53ef\uff0c\u8fd9\u5c31\u5df2\u7ecf\u6709\u524d\u540e\u7aef\u5206\u79bb\u5f00\u53d1\u7684\u96cf\u5f62\u4e86\uff08\u5b9e\u9645\u4e0a\u4e4b\u524d\uff0c\u6211\u4eec\u5728JavaWeb\u9636\u6bb5\u4f7f\u7528XHR\u8bf7\u6c42\u4e5f\u6f14\u793a\u8fc7\uff0c\u4e0d\u8fc7\u5f53\u65f6\u662f\u7eaf\u7cb9\u7684\u6570\u636e\uff09</p> <p>\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c\u5982\u4f55\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u4e2aJS\u5bf9\u8c61\u6570\u636e\u5e76\u8fdb\u884c\u89e3\u6790\uff0c\u8fd9\u91cc\u4ee5\u7b80\u5355\u7684\u767b\u5f55\u4e3a\u4f8b\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u6d4b\u8bd5&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/axios@1.1.2/dist/axios.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;p&gt;\u6b22\u8fce\u6765\u5230GayHub\u5168\u7403\u6700\u5927\u540c\u6027\u4ea4\u53cb\u7f51\u7ad9&lt;/p&gt;\n  &lt;button onclick=\"login()\"&gt;\u7acb\u5373\u767b\u5f55&lt;/button&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u8fd9\u91cc\u4f9d\u7136\u4f7f\u7528axios\u53d1\u9001POST\u8bf7\u6c42\uff1a</p> <pre><code>&lt;script&gt;\n    function login() {\n        axios.post('/mvc/test', {\n            username: 'test',\n            password: '123456'\n        }, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n            }\n        }).then(({data}) =&gt; {\n            if(data.success) {\n                alert('\u767b\u5f55\u6210\u529f')\n            } else {\n                alert('\u767b\u5f55\u5931\u8d25')\n            }\n        })\n    }\n&lt;/script&gt;\n</code></pre> <p>\u670d\u52a1\u5668\u7aef\u53ea\u9700\u8981\u5728\u8bf7\u6c42\u53c2\u6570\u4f4d\u7f6e\u6dfb\u52a0\u4e00\u4e2a\u5bf9\u8c61\u63a5\u6536\u5373\u53ef\uff08\u548c\u524d\u9762\u662f\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u8fd9\u91cc\u4e5f\u662f\u63d0\u4ea4\u7684\u8868\u5355\u6570\u636e\uff09\uff1a</p> <pre><code>@ResponseBody\n@PostMapping(value = \"/test\", produces = \"application/json\")\npublic String hello(String username, String password){\n    boolean success = \"test\".equals(user.getUsername()) &amp;&amp; \"123456\".equals(user.getPassword());\n    JSONObject object = new JSONObject();\n    object.put(\"success\", success);\n    return object.toString();\n}\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06js\u5bf9\u8c61\u8f6c\u6362\u4e3aJSON\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u8fd9\u91cc\u9700\u8981\u4f7f\u7528ajax\u65b9\u6cd5\u6765\u5904\u7406\uff1a</p> <pre><code>&lt;script&gt;\n    function login() {\n        axios.post('/mvc/test', {\n            username: 'test',\n            password: '123456'\n        }).then(({data}) =&gt; {\n            if(data.success) {\n                alert('\u767b\u5f55\u6210\u529f')\n            } else {\n                alert('\u767b\u5f55\u5931\u8d25')\n            }\n        })\n    }\n&lt;/script&gt;\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u9700\u8981\u8bfb\u53d6\u524d\u7aef\u53d1\u9001\u7ed9\u6211\u4eec\u7684JSON\u683c\u5f0f\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u6dfb\u52a0<code>@RequestBody</code>\u6ce8\u89e3\uff1a</p> <pre><code>@ResponseBody\n@PostMapping(value = \"/test\", produces = \"application/json\")\npublic String hello(@RequestBody User user){\n    boolean success = \"test\".equals(user.getUsername()) &amp;&amp; \"123456\".equals(user.getPassword());\n    JSONObject object = new JSONObject();\n    object.put(\"success\", success);\n    return object.toString();\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u524d\u540e\u7aef\u4f7f\u7528JSON\u5b57\u7b26\u4e32\u8fdb\u884c\u901a\u4fe1\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20MVC/#_8","title":"\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20\u548c\u4e0b\u8f7d","text":"<p>\u5229\u7528SpringMVC\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20\u548c\u4e0b\u8f7d\uff0c\u6211\u4eec\u9700\u8981\u5728MainInitializer\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\uff1a</p> <pre><code>public class MainInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n    ...\n\n    @Override\n    protected void customizeRegistration(ServletRegistration.Dynamic registration) {\n          // \u76f4\u63a5\u901a\u8fc7registration\u914d\u7f6eMultipart\u76f8\u5173\u914d\u7f6e\uff0c\u5fc5\u987b\u914d\u7f6e\u4e34\u65f6\u4e0a\u4f20\u8def\u5f84\uff0c\u5efa\u8bae\u9009\u62e9\u65b9\u4fbf\u6253\u5f00\u7684\n        // \u540c\u6837\u53ef\u4ee5\u8bbe\u7f6e\u5176\u4ed6\u5c5e\u6027\uff1amaxFileSize, maxRequestSize, fileSizeThreshold\n        registration.setMultipartConfig(new MultipartConfigElement(\"/Users/nagocoler/Download\"));\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u76f4\u63a5\u7f16\u5199Controller\u5373\u53ef\uff1a</p> <pre><code>@RequestMapping(value = \"/upload\", method = RequestMethod.POST)\n@ResponseBody\npublic String upload(@RequestParam MultipartFile file) throws IOException {\n    File fileObj = new File(\"test.png\");\n    file.transferTo(fileObj);\n    System.out.println(\"\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\u5df2\u4fdd\u5b58\u5230\uff1a\"+fileObj.getAbsolutePath());\n    return \"\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\uff01\";\n}\n</code></pre> <p>\u6700\u540e\u5728\u524d\u7aef\u6dfb\u52a0\u4e00\u4e2a\u6587\u4ef6\u7684\u4e0a\u4f20\u70b9\uff1a</p> <pre><code>&lt;div&gt;\n    &lt;form action=\"upload\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n        &lt;input type=\"file\" name=\"file\"&gt;\n        &lt;input type=\"submit\"&gt;\n    &lt;/form&gt;\n&lt;/div&gt;\n</code></pre> <p>\u8fd9\u6837\uff0c\u70b9\u51fb\u63d0\u4ea4\u4e4b\u540e\uff0c\u6587\u4ef6\u5c31\u4f1a\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e86\u3002</p> <p>\u4e0b\u8f7d\u5176\u5b9e\u548c\u6211\u4eec\u4e4b\u524d\u7684\u5199\u6cd5\u5927\u81f4\u4e00\u6837\uff0c\u76f4\u63a5\u4f7f\u7528HttpServletResponse\uff0c\u5e76\u5411\u8f93\u51fa\u6d41\u4e2d\u4f20\u8f93\u6570\u636e\u5373\u53ef\u3002</p> <pre><code>@RequestMapping(value = \"/download\", method = RequestMethod.GET)\n@ResponseBody\npublic void download(HttpServletResponse response){\n    response.setContentType(\"multipart/form-data\");\n    try(OutputStream stream = response.getOutputStream();\n        InputStream inputStream = new FileInputStream(\"test.png\")){\n        IOUtils.copy(inputStream, stream);\n    }catch (IOException e){\n        e.printStackTrace();\n    }\n}\n</code></pre> <p>\u5728\u524d\u7aef\u9875\u9762\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u4e0b\u8f7d\u70b9\uff1a</p> <pre><code>&lt;a href=\"download\" download=\"test.png\"&gt;\u4e0b\u8f7d\u6700\u65b0\u8d44\u6e90&lt;/a&gt;\n</code></pre>"},{"location":"notes/Java%20Spring/Spring%20MVC/#dispatcherservlet","title":"\u89e3\u8bfbDispatcherServlet\u6e90\u7801","text":"<p>\u6ce8\u610f\uff1a\u672c\u90e8\u5206\u4f5c\u4e3a\u9009\u5b66\u5185\u5bb9\uff01</p> <p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5173\u4e8eSpringMVC\u7684\u76f8\u5173\u5185\u5bb9\u5c31\u5b66\u4e60\u5f97\u5dee\u4e0d\u591a\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u5728\u6700\u540e\u8fd8\u662f\u9700\u8981\u6df1\u5165\u4e86\u89e3\u4e00\u4e0bDispatcherServlet\u5e95\u5c42\u662f\u5982\u4f55\u8fdb\u884c\u8c03\u5ea6\u7684\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u4f1a\u4ece\u6e90\u7801\u89d2\u5ea6\u8fdb\u884c\u8bb2\u89e3\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u627e\u5230<code>DispatcherServlet</code>\u7684\u6700\u9876\u5c42<code>HttpServletBean</code>\uff0c\u5728\u8fd9\u91cc\u76f4\u63a5\u7ee7\u627f\u7684<code>HttpServlet</code>\uff0c\u90a3\u4e48\u6211\u4eec\u9996\u5148\u6765\u770b\u4e00\u4e0b\uff0c\u5b83\u5728\u521d\u59cb\u5316\u65b9\u6cd5\u4e2d\u505a\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>public final void init() throws ServletException {\n      //\u8bfb\u53d6\u914d\u7f6e\u53c2\u6570\uff0c\u5e76\u8fdb\u884c\u914d\u7f6e\n    PropertyValues pvs = new HttpServletBean.ServletConfigPropertyValues(this.getServletConfig(), this.requiredProperties);\n    if (!pvs.isEmpty()) {\n        try {\n            BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(this);\n            ResourceLoader resourceLoader = new ServletContextResourceLoader(this.getServletContext());\n            bw.registerCustomEditor(Resource.class, new ResourceEditor(resourceLoader, this.getEnvironment()));\n            this.initBeanWrapper(bw);\n            bw.setPropertyValues(pvs, true);\n        } catch (BeansException var4) {\n            if (this.logger.isErrorEnabled()) {\n                this.logger.error(\"Failed to set bean properties on servlet '\" + this.getServletName() + \"'\", var4);\n            }\n\n            throw var4;\n        }\n    }\n        //\u6b64\u521d\u59cb\u5316\u9636\u6bb5\u7531\u5b50\u7c7b\u5b9e\u73b0\uff0c\n    this.initServletBean();\n}\n</code></pre> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b<code>initServletBean()</code>\u65b9\u6cd5\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u5b83\u662f\u5728\u5b50\u7c7b<code>FrameworkServlet</code>\u4e2d\u5b9a\u4e49\u7684\uff1a</p> <pre><code>protected final void initServletBean() throws ServletException {\n    this.getServletContext().log(\"Initializing Spring \" + this.getClass().getSimpleName() + \" '\" + this.getServletName() + \"'\");\n    if (this.logger.isInfoEnabled()) {\n        this.logger.info(\"Initializing Servlet '\" + this.getServletName() + \"'\");\n    }\n\n    long startTime = System.currentTimeMillis();\n\n    try {\n          //\u6ce8\u610f\uff1a\u6211\u4eec\u5728\u4e00\u5f00\u59cb\u8bf4\u4e86SpringMVC\u6709\u4e24\u4e2a\u5bb9\u5668\uff0c\u4e00\u4e2a\u662fWeb\u5bb9\u5668\u4e00\u4e2a\u662f\u6839\u5bb9\u5668\n          //Web\u5bb9\u5668\u53ea\u8d1f\u8d23Controller\u7b49\u8868\u73b0\u5c42\u5185\u5bb9\n          //\u6839\u5bb9\u5668\u5c31\u662fSpring\u5bb9\u5668\uff0c\u5b83\u8d1f\u8d23Service\u3001Dao\u7b49\uff0c\u5e76\u4e14\u5b83\u662fWeb\u5bb9\u5668\u7684\u7236\u5bb9\u5668\u3002\n          //\u521d\u59cb\u5316WebApplicationContext\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4f1a\u4e3a\u6839\u5bb9\u5668\u548cWeb\u5bb9\u5668\u8fdb\u884c\u7236\u5b50\u5173\u7cfb\u5efa\u7acb\n        this.webApplicationContext = this.initWebApplicationContext();\n        this.initFrameworkServlet();\n    } catch (RuntimeException | ServletException var4) {\n      //...\u4ee5\u4e0b\u5185\u5bb9\u5168\u662f\u6253\u5370\u65e5\u5fd7\n}\n</code></pre> <p>img</p> <p>\u6211\u4eec\u6765\u770b\u770b<code>initWebApplicationContext</code>\u662f\u5982\u4f55\u8fdb\u884c\u521d\u59cb\u5316\u7684\uff1a</p> <pre><code>protected WebApplicationContext initWebApplicationContext() {\n      //\u8fd9\u91cc\u83b7\u53d6\u7684\u662f\u6839\u5bb9\u5668\uff0c\u4e00\u822c\u7528\u4e8e\u914d\u7f6eService\u3001\u6570\u636e\u6e90\u7b49\n    WebApplicationContext rootContext = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext());\n    WebApplicationContext wac = null;\n    if (this.webApplicationContext != null) {\n          //\u5982\u679cwebApplicationContext\u5728\u4e4b\u524d\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u7ed9\u5230wac\n        wac = this.webApplicationContext;\n        if (wac instanceof ConfigurableWebApplicationContext) {\n            ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext)wac;\n            if (!cwac.isActive()) {\n                if (cwac.getParent() == null) {\n                      //\u8bbe\u5b9a\u6839\u5bb9\u5668\u4e3aWeb\u5bb9\u5668\u7684\u7236\u5bb9\u5668\n                    cwac.setParent(rootContext);\n                }\n\n                this.configureAndRefreshWebApplicationContext(cwac);\n            }\n        }\n    }\n\n    if (wac == null) {\n          //\u5982\u679cwebApplicationContext\u662f\u7a7a\uff0c\u90a3\u4e48\u5c31\u4eceServletContext\u627e\u4e00\u4e0b\u6709\u6ca1\u6709\u521d\u59cb\u5316\u4e0a\u4e0b\u6587\n        wac = this.findWebApplicationContext();\n    }\n\n    if (wac == null) {\n          //\u5982\u679c\u8fd8\u662f\u627e\u4e0d\u5230\uff0c\u76f4\u63a5\u521b\u4e2a\u65b0\u7684\uff0c\u5e76\u76f4\u63a5\u5c06\u6839\u5bb9\u5668\u4f5c\u4e3a\u7236\u5bb9\u5668\n        wac = this.createWebApplicationContext(rootContext);\n    }\n\n    if (!this.refreshEventReceived) {\n        synchronized(this.onRefreshMonitor) {\n              //\u6b64\u65b9\u6cd5\u7531DispatcherServlet\u5b9e\u73b0\n            this.onRefresh(wac);\n        }\n    }\n\n    if (this.publishContext) {\n        String attrName = this.getServletContextAttributeName();\n          //\u628aWeb\u5bb9\u5668\u4e22\u8fdbServletContext\n        this.getServletContext().setAttribute(attrName, wac);\n    }\n\n    return wac;\n}\n</code></pre> <p>\u6211\u4eec\u63a5\u7740\u6765\u770bDispatcherServlet\u4e2d\u5b9e\u73b0\u7684<code>onRefresh()</code>\u65b9\u6cd5\uff1a</p> <pre><code>@Override\nprotected void onRefresh(ApplicationContext context) {\n    initStrategies(context);\n}\n\nprotected void initStrategies(ApplicationContext context) {\n      //\u521d\u59cb\u5316\u5404\u79cd\u89e3\u6790\u5668\n    initMultipartResolver(context);\n    initLocaleResolver(context);\n    initThemeResolver(context);\n      //\u5728\u5bb9\u5668\u4e2d\u67e5\u627e\u6240\u6709\u7684HandlerMapping\uff0c\u653e\u5165\u96c6\u5408\u4e2d\n      //HandlerMapping\u4fdd\u5b58\u4e86\u6240\u6709\u7684\u8bf7\u6c42\u6620\u5c04\u4fe1\u606f\uff08Controller\u4e2d\u5b9a\u4e49\u7684\uff09\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u8bf7\u6c42\u627e\u5230\u5904\u7406\u5668Handler\uff0c\u4f46\u5e76\u4e0d\u662f\u7b80\u5355\u7684\u8fd4\u56de\u5904\u7406\u5668\uff0c\u800c\u662f\u5c06\u5904\u7406\u5668\u548c\u62e6\u622a\u5668\u5c01\u88c5\uff0c\u5f62\u6210\u4e00\u4e2a\u5904\u7406\u5668\u6267\u884c\u94fe\uff08\u7c7b\u4f3c\u4e8e\u4e4b\u524d\u7684Filter\uff09\n    initHandlerMappings(context);\n      //\u5728\u5bb9\u5668\u4e2d\u67e5\u627e\u6240\u6709\u7684HandlerAdapter\uff0c\u5b83\u7528\u4e8e\u5904\u7406\u8bf7\u6c42\u5e76\u8fd4\u56deModelAndView\u5bf9\u8c61\n      //\u9ed8\u8ba4\u6709\u4e09\u79cd\u5b9e\u73b0HttpRequestHandlerAdapter\uff0cSimpleControllerHandlerAdapter\u548cAnnotationMethodHandlerAdapter\n      //\u5f53HandlerMapping\u627e\u5230\u5904\u7406\u8bf7\u6c42\u7684Controller\u4e4b\u540e\uff0c\u4f1a\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684HandlerAdapter\u5904\u7406\u8bf7\u6c42\n      //\u6bd4\u5982\u6211\u4eec\u4e4b\u524d\u4f7f\u7528\u7684\u662f\u6ce8\u89e3\u65b9\u5f0f\u914d\u7f6eController\uff0c\u73b0\u5728\u6709\u4e00\u4e2a\u8bf7\u6c42\u643a\u5e26\u4e86\u4e00\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48HandlerAdapter\u4f1a\u5bf9\u8bf7\u6c42\u7684\u6570\u636e\u8fdb\u884c\u89e3\u6790\uff0c\u5e76\u4f20\u5165\u65b9\u6cd5\u4f5c\u4e3a\u5b9e\u53c2\uff0c\u6700\u540e\u6839\u636e\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5c06\u5176\u5c01\u88c5\u4e3aModelAndView\u5bf9\u8c61\n    initHandlerAdapters(context);\n      //\u5176\u4ed6\u7684\u5185\u5bb9\n    initHandlerExceptionResolvers(context);\n    initRequestToViewNameTranslator(context);\n    initViewResolvers(context);\n    initFlashMapManager(context);\n}\n</code></pre> <p>DispatcherServlet\u521d\u59cb\u5316\u8fc7\u7a0b\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u63a5\u7740\u6765\u770bDispatcherServlet\u662f\u5982\u4f55\u8fdb\u884c\u8c03\u5ea6\u7684\uff0c\u9996\u5148\u6211\u4eec\u7684\u8bf7\u6c42\u80af\u5b9a\u4f1a\u7ecf\u8fc7<code>HttpServlet</code>\uff0c\u7136\u540e\u5176\u4ea4\u7ed9\u5bf9\u5e94\u7684doGet\u3001doPost\u7b49\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u800c\u5728<code>FrameworkServlet</code>\u4e2d\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u88ab\u91cd\u5199\uff0c\u5e76\u4e14\u4f7f\u7528<code>processRequest</code>\u6765\u8fdb\u884c\u5904\u7406\uff1a</p> <pre><code>protected final void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n    this.processRequest(request, response);\n}\n\nprotected final void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n    this.processRequest(request, response);\n}\n</code></pre> <p>\u6211\u4eec\u6765\u770b\u770b<code>processRequest</code>\u505a\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>protected final void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n      //\u524d\u671f\u51c6\u5907\u5de5\u4f5c\n    long startTime = System.currentTimeMillis();\n    Throwable failureCause = null;\n    LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();\n    LocaleContext localeContext = this.buildLocaleContext(request);\n    RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();\n    ServletRequestAttributes requestAttributes = this.buildRequestAttributes(request, response, previousAttributes);\n    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), new FrameworkServlet.RequestBindingInterceptor());\n    this.initContextHolders(request, localeContext, requestAttributes);\n\n    try {\n          //\u91cd\u70b9\u5728\u8fd9\u91cc\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86Service\u7684\u6267\u884c\uff0c\u4e0d\u8fc7\u662f\u5728DispatcherServlet\u4e2d\u5b9a\u4e49\u7684\n        this.doService(request, response);\n    } catch (IOException | ServletException var16) {\n        //...\n}\n</code></pre> <p>\u8bf7\u5404\u4f4d\u4e00\u5b9a\u8981\u8010\u5fc3\uff0c\u8fd9\u4e9b\u5927\u578b\u6846\u67b6\u7684\u5e95\u5c42\u4e00\u822c\u90fd\u662f\u5c42\u5c42\u5957\u5a03\uff0c\u56e0\u4e3a\u8fd9\u6837\u5199\u8d77\u6765\u5c42\u6b21\u4f1a\u66f4\u52a0\u6e05\u6670\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770b<code>DispatcherServlet</code>\u4e2d\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1a</p> <pre><code>protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception {\n   //...\n    try {\n          //\u91cd\u70b9\u5728\u8fd9\u91cc\uff0c\u8fd9\u624d\u662f\u6574\u4e2a\u5904\u7406\u8fc7\u7a0b\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\n        this.doDispatch(request, response);\n    } finally {\n        //...\n}\n</code></pre> <p>\u7ec8\u4e8e\u627e\u5230\u6700\u6838\u5fc3\u7684\u90e8\u5206\u4e86\uff1a</p> <pre><code>protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {\n    HttpServletRequest processedRequest = request;\n    HandlerExecutionChain mappedHandler = null;\n    boolean multipartRequestParsed = false;\n    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n\n    try {\n        try {\n            ModelAndView mv = null;\n            Object dispatchException = null;\n\n            try {\n                processedRequest = this.checkMultipart(request);\n                multipartRequestParsed = processedRequest != request;\n                  //\u5728HandlerMapping\u96c6\u5408\u4e2d\u5bfb\u627e\u53ef\u4ee5\u5904\u7406\u5f53\u524d\u8bf7\u6c42\u7684HandlerMapping\n                mappedHandler = this.getHandler(processedRequest);\n                if (mappedHandler == null) {\n                    this.noHandlerFound(processedRequest, response);\n                      //\u627e\u4e0d\u5230HandlerMapping\u5219\u65e0\u6cd5\u8fdb\u884c\u5904\u7406\n                    return;\n                }\n\n                  //\u6839\u636eHandlerMapping\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u627e\u5230\u53ef\u4ee5\u5904\u7406\u7684HandlerAdapter\n                HandlerAdapter ha = this.getHandlerAdapter(mappedHandler.getHandler());\n                String method = request.getMethod();\n                boolean isGet = HttpMethod.GET.matches(method);\n                if (isGet || HttpMethod.HEAD.matches(method)) {\n                    long lastModified = ha.getLastModified(request, mappedHandler.getHandler());\n                    if ((new ServletWebRequest(request, response)).checkNotModified(lastModified) &amp;&amp; isGet) {\n                        return;\n                    }\n                }\n\n                  //\u6267\u884c\u6240\u6709\u62e6\u622a\u5668\u7684preHandle()\u65b9\u6cd5\n                if (!mappedHandler.applyPreHandle(processedRequest, response)) {\n                    return;\n                }\n\n                  //\u4f7f\u7528HandlerAdapter\u8fdb\u884c\u5904\u7406\uff08\u6211\u4eec\u7f16\u5199\u7684\u8bf7\u6c42\u6620\u5c04\u65b9\u6cd5\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u624d\u771f\u6b63\u5730\u6267\u884c\u4e86\uff09\n                  //HandlerAdapter\u4f1a\u5e2e\u52a9\u6211\u4eec\u5c06\u8bf7\u6c42\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u518d\u6765\u8c03\u7528\u6211\u4eec\u7f16\u5199\u7684\u8bf7\u6c42\u6620\u5c04\u65b9\u6cd5\n                  //\u6700\u540eHandlerAdapter\u4f1a\u5c06\u7ed3\u679c\u5c01\u88c5\u4e3aModelAndView\u8fd4\u56de\u7ed9mv\n                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());\n                if (asyncManager.isConcurrentHandlingStarted()) {\n                    return;\n                }\n\n                this.applyDefaultViewName(processedRequest, mv);\n                  //\u6267\u884c\u6240\u6709\u62e6\u622a\u5668\u7684postHandle()\u65b9\u6cd5\n                mappedHandler.applyPostHandle(processedRequest, response, mv);\n            } catch (Exception var20) {\n                dispatchException = var20;\n            } catch (Throwable var21) {\n                dispatchException = new NestedServletException(\"Handler dispatch failed\", var21);\n            }\n\n              //\u6700\u540e\u5904\u7406\u7ed3\u679c\uff0c\u5bf9\u89c6\u56fe\u8fdb\u884c\u6e32\u67d3\u7b49\uff0c\u5982\u679c\u629b\u51fa\u5f02\u5e38\u4f1a\u51fa\u73b0\u9519\u8bef\u9875\u9762\n            this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);\n        } catch (Exception var22) {\n            this.triggerAfterCompletion(processedRequest, response, mappedHandler, var22);\n        } catch (Throwable var23) {\n            this.triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException(\"Handler processing failed\", var23));\n        }\n\n    } finally {\n        if (asyncManager.isConcurrentHandlingStarted()) {\n            if (mappedHandler != null) {\n                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);\n            }\n        } else if (multipartRequestParsed) {\n            this.cleanupMultipart(processedRequest);\n        }\n\n    }\n}\n</code></pre> <p>\u6240\u4ee5\uff0c\u6839\u636e\u4ee5\u4e0a\u6e90\u7801\u5206\u6790\u5f97\u51fa\u6700\u7ec8\u7684\u6d41\u7a0b\u56fe\uff1a</p> <p>img</p> <p>\u867d\u7136\u5b8c\u6210\u672c\u7ae0\u5b66\u4e60\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u57fa\u672c\u80fd\u591f\u57fa\u4e8eSpring\u53bb\u91cd\u65b0\u7f16\u5199\u4e00\u4e2a\u66f4\u52a0\u9ad8\u7ea7\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u4e86\uff0c\u4f46\u662f\u767b\u9646\u9a8c\u8bc1\u590d\u6742\u7684\u95ee\u9898\u4f9d\u7136\u6ca1\u6709\u89e3\u51b3\uff0c\u5982\u679c\u6211\u4eec\u4f9d\u7136\u6309\u7167\u4e4b\u524d\u7684\u65b9\u5f0f\u7f16\u5199\u767b\u9646\u9a8c\u8bc1\uff0c\u663e\u7136\u592a\u8fc7\u7b80\u5355\uff0c\u5b83\u4ec5\u4ec5\u53ea\u662f\u4e00\u4e2a\u767b\u9646\uff0c\u4f46\u662f\u6ca1\u6709\u4efb\u4f55\u7684\u6743\u9650\u5212\u5206\u6216\u662f\u52a0\u5bc6\u5904\u7406\uff0c\u6211\u4eec\u9700\u8981\u66f4\u52a0\u9ad8\u7ea7\u7684\u6743\u9650\u6821\u9a8c\u6846\u67b6\u6765\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u767b\u9646\u64cd\u4f5c\uff0c\u4e0b\u4e00\u7ae0\uff0c\u6211\u4eec\u4f1a\u8be6\u7ec6\u8bb2\u89e3\u5982\u4f55\u4f7f\u7528\u66f4\u52a0\u9ad8\u7ea7\u7684SpringSecurity\u6846\u67b6\u6765\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/","title":"Spring Security","text":"<p>image-20230701170904832</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#springsecurity","title":"SpringSecurity","text":"<p>\u57fa\u4e8eSpring6\u7684\u91cd\u5236\u7248\uff0c\u622a\u6b62\u76ee\u524d\uff0c\u6700\u65b0\u7684\u7248\u672c\u662f6.1.1\u7248\u672c\u3002</p> <p>\u524d\u7f6e\u8bfe\u7a0b\uff1a\u300aSpring\u6838\u5fc3\u5185\u5bb9\u300b\u300aSpringMvc\u300b\u300aJavaWeb\u300b\u300aJava9-17\u65b0\u7279\u6027\u300b</p> <p>\u5b89\u5168\u662f\u5f00\u53d1\u8005\u6c38\u8fdc\u7ed5\u4e0d\u5f00\u7684\u8bdd\u9898\uff0c\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u7f51\u7ad9\uff0c\u5f80\u5f80\u5b58\u5728\u7740\u5404\u79cd\u81f4\u547d\u6f0f\u6d1e\uff0c\u53ea\u8981\u88ab\u4e0d\u6cd5\u5206\u5b50\u7a0d\u52a0\u5229\u7528\uff0c\u5c31\u80fd\u76f4\u63a5\u51fb\u6e83\u6574\u4e2a\u7f51\u7ad9\uff0c\u751a\u81f3\u7834\u574f\u7f51\u7ad9\u5b9d\u8d35\u7684\u7528\u6237\u6570\u636e\u3002\u800c\u7528\u6237\u7684\u6388\u6743\u6821\u9a8c\uff0c\u5219\u662f\u7f51\u7ad9\u5b89\u5168\u7cfb\u7edf\u7684\u5178\u578b\u4ee3\u8868\uff0c\u8fd9\u4e5f\u662f\u7528\u6237\u8bbf\u95ee\u7f51\u7ad9\u7684\u7b2c\u4e00\u5173\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u66f4\u52a0\u5b89\u5168\u548c\u53ef\u9760\u7684\u6388\u6743\u6821\u9a8c\u6846\u67b6\uff0c\u624d\u80fd\u8ba9\u6211\u4eec\u7684\u7f51\u7ad9\u66f4\u52a0\u7a33\u5b9a\u3002</p> <p>SpringSecurity\u662f\u4e00\u4e2a\u57fa\u4e8eSpring\u5f00\u53d1\u7684\u975e\u5e38\u5f3a\u5927\u7684\u6743\u9650\u9a8c\u8bc1\u6846\u67b6\uff0c\u5176\u6838\u5fc3\u529f\u80fd\u5305\u62ec\uff1a</p> <ul> <li>\u8ba4\u8bc1 \uff08\u7528\u6237\u767b\u5f55\uff09</li> <li>\u6388\u6743 \uff08\u6b64\u7528\u6237\u80fd\u591f\u505a\u54ea\u4e9b\u4e8b\u60c5\uff09</li> <li>\u653b\u51fb\u9632\u62a4 \uff08\u9632\u6b62\u4f2a\u9020\u8eab\u4efd\u653b\u51fb\uff09</li> </ul> <p>\u672c\u7ae0\uff0c\u6211\u4eec\u4f1a\u4ece\u591a\u4e2a\u65b9\u9762\u5bf9\u6b64\u6846\u67b6\u8fdb\u884c\u4ecb\u7ecd\uff0c\u8ba9\u5404\u4f4d\u5c0f\u4f19\u4f34\u80fd\u591f\u5728\u81ea\u5df1\u7684\u9879\u76ee\u4e2d\u4f7f\u7528\u66f4\u52a0\u5b89\u5168\u548c\u53ef\u9760\u7684\u8eab\u4efd\u6821\u9a8c\u65b9\u6848\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_1","title":"\u7f51\u7edc\u5b89\u5168\u57fa\u7840","text":"<p>\u7f51\u7edc\u5b89\u5168\u662f\u5f53\u4eca\u4e92\u8054\u7f51\u65f6\u4ee3\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u8bae\u9898\u3002\u5728\u4fe1\u606f\u7206\u70b8\u7684\u4eca\u5929\uff0c\u7f51\u7edc\u5b89\u5168\u95ee\u9898\u9891\u9891\u53d1\u751f\uff0c\u7ed9\u4e2a\u4eba\u548c\u7ec4\u7ec7\u5e26\u6765\u4e86\u4e25\u91cd\u7684\u635f\u5931\u548c\u5a01\u80c1\uff0c\u968f\u7740\u6280\u672f\u7684\u53d1\u5c55\u548c\u4e92\u8054\u7f51\u7684\u666e\u53ca\uff0c\u6211\u4eec\u8d8a\u6765\u8d8a\u610f\u8bc6\u5230\u7f51\u7edc\u5b89\u5168\u5df2\u7ecf\u6210\u4e3a\u4e00\u4e2a\u5168\u7403\u6027\u7684\u6311\u6218\u3002\u672c\u90e8\u5206\uff0c\u6211\u4eec\u4f1a\u7ed9\u5404\u4f4d\u5c0f\u4f19\u4f34\u4ecb\u7ecd\u7f51\u7edc\u5b89\u5168\u7684\u76f8\u5173\u6982\u5ff5\uff0c\u4ee5\u53ca\u5e38\u89c1\u7684Web\u670d\u52a1\u5668\u653b\u51fb\u5f62\u5f0f\uff0c\u5982\u679c\u4f60\u5df2\u7ecf\u4e86\u89e3\u76f8\u5173\u5185\u5bb9\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u672c\u677f\u5757\u3002</p> <p>\u5176\u4e2d\u6bd4\u8f83\u5178\u578b\u7684\u6848\u4f8b\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a</p> <p>image-20230701174518205</p> <p>\u57282017\u5e74\uff0c\u4e00\u6b3e\u540d\u53ebWannaCry\u7684\u52d2\u7d22\u8f6f\u4ef6\u5e2d\u5377\u5168\u7403\uff0c\u5bfc\u81f4\u5168\u7403\u5927\u91cf\u8ba1\u7b97\u673a\u53d7\u5230\u5f71\u54cd\uff0c\u5f97\u76ca\u4e8e\u5168\u7403\u7f51\u7edc\u7684\u53d1\u8fbe\uff0c\u8fd9\u6b3e\u75c5\u6bd2\u4ece\u5c0f\u89c4\u6a21\u5f88\u5feb\u53d1\u5c55\u81f3\u5168\u7403\u8303\u56f4\uff0c\u52d2\u7d22\u75c5\u6bd2\u662f\u81ea\u718a\u732b\u70e7\u9999\u4ee5\u6765\u5f71\u54cd\u529b\u6700\u5927\u7684\u75c5\u6bd2\u4e4b\u4e00\u3002</p> <p>WannaCry\uff08\u53c8\u53ebWanna Decryptor\uff09\uff0c\u4e00\u79cd\u201c\u8815\u866b\u5f0f\u201d\u7684\u52d2\u7d22\u75c5\u6bd2\u8f6f\u4ef6\uff0c\u5927\u5c0f3.3MB\uff0c\u7531\u4e0d\u6cd5\u5206\u5b50\u5229\u7528NSA\uff08National Security Agency\uff0c\u7f8e\u56fd\u56fd\u5bb6\u5b89\u5168\u5c40\uff09\u6cc4\u9732\u7684\u5371\u9669\u6f0f\u6d1e\u201cEternalBlue\u201d\uff08\u6c38\u6052\u4e4b\u84dd\uff09\u8fdb\u884c\u4f20\u64ad [1] \u3002\u52d2\u7d22\u75c5\u6bd2\u8086\u8650\uff0c\u4fe8\u7136\u662f\u4e00\u573a\u5168\u7403\u6027\u4e92\u8054\u7f51\u707e\u96be\uff0c\u7ed9\u5e7f\u5927\u7535\u8111\u7528\u6237\u9020\u6210\u4e86\u5de8\u5927\u635f\u5931\u3002\u6700\u65b0\u7edf\u8ba1\u6570\u636e\u663e\u793a\uff0c100\u591a\u4e2a\u56fd\u5bb6\u548c\u5730\u533a\u8d85\u8fc710\u4e07\u53f0\u7535\u8111\u906d\u5230\u4e86\u52d2\u7d22\u75c5\u6bd2\u653b\u51fb\u3001\u611f\u67d3\u3002 [2] \u52d2\u7d22\u75c5\u6bd2\u662f\u81ea\u718a\u732b\u70e7\u9999\u4ee5\u6765\u5f71\u54cd\u529b\u6700\u5927\u7684\u75c5\u6bd2\u4e4b\u4e00\u3002WannaCry\u52d2\u7d22\u75c5\u6bd2\u5168\u7403\u5927\u7206\u53d1\uff0c\u81f3\u5c11150\u4e2a\u56fd\u5bb6\u300130\u4e07\u540d\u7528\u6237\u4e2d\u62db\uff0c\u9020\u6210\u635f\u5931\u8fbe80\u4ebf\u7f8e\u5143\uff0c\u5df2\u7ecf\u5f71\u54cd\u5230\u91d1\u878d\uff0c\u80fd\u6e90\uff0c\u533b\u7597\u7b49\u4f17\u591a\u884c\u4e1a\uff0c\u9020\u6210\u4e25\u91cd\u7684\u5371\u673a\u7ba1\u7406\u95ee\u9898\u3002</p> <p>image-20230701175101126</p> <p>\u9664\u4e86\u75c5\u6bd2\u5728\u7f51\u7edc\u4e0a\u4f20\u64ad\u5916\uff0c\u8fd8\u6709\u975e\u5e38\u6076\u5fc3\u7684DDOS\u653b\u51fb\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u6210\u672c\u4f4e\uff0c\u6548\u7387\u9ad8\uff0c\u53ea\u8981\u6301\u7eed\u4e00\u6bb5\u65f6\u95f4\u5c31\u80fd\u5bfc\u81f4\u6ca1\u6709\u7279\u6b8a\u9632\u5fa1\u7684\u7f51\u7ad9\u65e0\u6cd5\u6b63\u5e38\u8fd0\u4f5c\uff1a</p> <p>2022\u5e744\u6708\uff0c\u90d1\u5dde\u8b66\u65b9\u63a5\u5230\u62a5\u8b66\u79f0\uff0c\u67d0\u653f\u5e9c\u7f51\u7ad9\u5e73\u53f0\u4e8e\u8fd1\u65e5\u906d\u53d7\u591a\u6b21DDoS\u653b\u51fb\uff0c\u5bfc\u81f4\u5e73\u53f0\u8bbf\u95ee\u91cf\u77ac\u95f4\u66b4\u589e\u591a\u500d\uff0c\u9020\u6210\u6570\u5341\u5bb6\u653f\u5e9c\u7f51\u7ad9\u548c\u653f\u52a1\u65b0\u5a92\u4f53\u8d26\u53f7\u65e0\u6cd5\u6b63\u5e38\u8bbf\u95ee\u3002\u63a5\u5230\u62a5\u8b66\u540e\uff0c\u90d1\u5dde\u8b66\u65b9\u7acb\u5373\u5f00\u5c55\u4fa6\u67e5\u8c03\u67e5\uff0c\u7b2c\u4e00\u65f6\u95f4\u9501\u5b9a\u72af\u7f6a\u5acc\u7591\u4eba\u5f20\u67d0\u67d0\uff0c\u4ec522\u5c0f\u65f6\u5c31\u5c06\u72af\u7f6a\u5acc\u7591\u4eba\u5f20\u67d0\u67d0\u6293\u6355\u5230\u6848\u3002</p> <p>\u7ecf\u5ba1\u67e5\uff0c\u5f20\u67d0\u67d0\u4e3a\u67d0\u533b\u9662\u7f51\u7edc\u5b89\u5168\u90e8\u6280\u672f\u7ef4\u62a4\u4eba\u5458\uff0c2022\u5e744\u67082\u65e5\uff0c\u5176\u4e2a\u4eba\u7f51\u7ad9\u88abDDoS\u653b\u51fb\uff0c\u5bfc\u81f4\u7f51\u7ad9\u65e0\u6cd5\u767b\u9646\u3002\u4e3a\u51cf\u5c11\u653b\u51fb\u5bf9\u5176\u4e2a\u4eba\u7f51\u7ad9\u7684\u5f71\u54cd\uff0c\u5f20\u67d0\u67d0\u79c1\u81ea\u5c06\u4e2a\u4eba\u7f51\u7ad9\u57df\u540d\u89e3\u6790\u5730\u5740\u53d8\u66f4\u4e3a\u67d0\u653f\u5e9c\u7f51\u7ad9\u5e73\u53f0\u5730\u5740\uff0c\u201c\u8f6c\u5ac1\u201d\u653b\u51fb\u6d41\u91cf\uff0c\u81f4\u4f7f\u8be5\u653f\u5e9c\u7f51\u7ad9\u5e73\u53f0\u88ab\u6076\u610f\u7f51\u7edc\u6d41\u91cf\u653b\u51fb\uff0c\u591a\u5bb6\u653f\u5e9c\u7f51\u7ad9\u3001\u653f\u52a1\u65b0\u5a92\u4f53\u8d26\u53f7\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>\u76ee\u524d\uff0c\u5f20\u67d0\u67d0\u56e0\u6d89\u5acc\u7834\u574f\u8ba1\u7b97\u673a\u4fe1\u606f\u7cfb\u7edf\u72af\u7f6a\u88ab\u516c\u5b89\u673a\u5173\u79fb\u9001\u8d77\u8bc9\uff0c\u6848\u4ef6\u6b63\u5728\u8fdb\u4e00\u6b65\u4fa6\u529e\u4e2d\u3002</p> <p>image-20230701175235964</p> <p>\u4fe1\u606f\u6cc4\u9732\u4e5f\u662f\u975e\u5e38\u4e25\u91cd\u7684\u7f51\u7edc\u5b89\u5168\u95ee\u9898\uff0c\u6211\u4eec\u7684\u4e2a\u4eba\u4fe1\u606f\u662f\u6211\u4eec\u7684\u9690\u79c1\uff0c\u800c\u5728\u7f51\u7edc\u53d1\u8fbe\u7684\u4eca\u5929\uff0c\u5728\u5404\u5927APP\u4e0a\u586b\u5199\u7684\u4fe1\u606f\u5f88\u6709\u53ef\u80fd\u4f1a\u88ab\u7b2c\u4e09\u65b9\u83b7\u53d6\uff0c\u4ece\u4e2d\u8c0b\u53d6\u5229\u76ca\u3002</p> <p>\u4eca\u5e74\u65e9\u4e9b\u65f6\u5019\u4fbf\u5df2\u53d1\u73b0\u76f8\u5173\u5b89\u5168\u6f0f\u6d1e\u7684\u7f51\u7edc\u5b89\u5168\u4e13\u5bb6\u79f0\uff0c \u4e00\u4e2a\u5e38\u89c1\u6f0f\u6d1e\u5bfc\u81f4\u4e86\u8fd9\u573a\u6709\u8bb0\u5f55\u4ee5\u6765\u6700\u5927\u89c4\u6a21\u7684\u4e2a\u4eba\u6570\u636e\u6cc4\u9732\uff0c\u4e5f\u662f\u4e2d\u56fd\u6240\u906d\u9047\u6700\u5927\u89c4\u6a21\u7684\u7f51\u7edc\u5b89\u5168\u4e8b\u4ef6\uff0c\u9020\u6210\u6570\u636e\u88ab\u516c\u5f00\u5728\u4e92\u8054\u7f51\u4e0a\uff0c\u4f9b\u4eba\u53d6\u7528\u3002</p> <p>\u636e\u8fd9\u4e9b\u7f51\u7edc\u5b89\u5168\u4e13\u5bb6\u79f0\uff0c\u4e0a\u6d77\u8b66\u65b9\u7684\u8fd9\u4e9b\u8bb0\u5f55\u662f\u88ab\u5b89\u5168\u5b58\u50a8\u7684\uff0c\u5176\u4e2d\u5305\u542b\u4e2a\u4eba\u59d3\u540d\u3001\u8eab\u4efd\u8bc1\u53f7\u7801\u3001\u7535\u8bdd\u53f7\u7801\u4ee5\u53ca\u8b66\u60c5\u4fe1\u606f\uff0c\u6d89\u53ca\u8fd110\u4ebf\u4e2d\u56fd\u516c\u6c11\u7684\u6570\u636e\u3002\u4ed6\u4eec\u8bf4\uff0c\u4f46\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u548c\u8bbf\u95ee\u8be5\u6570\u636e\u5e93\u7684\u663e\u793a\u754c\u9762(dashboard)\u88ab\u8bbe\u7f6e\u5728\u4e00\u4e2a\u516c\u5f00\u7f51\u5740\u4e0a\uff0c\u6ca1\u6709\u52a0\u8bbe\u5bc6\u7801\uff0c\u4efb\u4f55\u6709\u76f8\u5bf9\u57fa\u672c\u6280\u672f\u77e5\u8bc6\u7684\u4eba\u90fd\u53ef\u4ee5\u8f7b\u677e\u8bbf\u95ee\u3001\u590d\u5236\u6216\u7a83\u53d6\u5e93\u4e2d\u7684\u6d77\u91cf\u4fe1\u606f\u3002</p> <p>\u6697\u7f51\u60c5\u62a5\u516c\u53f8Shadowbyte\u7684\u521b\u59cb\u4ebaVinny Troia\u8bf4\uff1a\u201c\u4ed6\u4eec\u628a\u8fd9\u4e48\u591a\u6570\u636e\u66b4\u9732\u5728\u5916\uff0c\u8fd9\u592a\u75af\u72c2\u4e86\u3002\u201d\u8fd9\u5bb6\u516c\u53f8\u4e13\u95e8\u5728\u7f51\u4e0a\u626b\u63cf\u641c\u5bfb\u5b58\u5728\u5b89\u5168\u6f0f\u6d1e\u7684\u6570\u636e\u5e93\uff0c\u65e9\u5728\u4eca\u5e741\u6708\u626b\u63cf\u65f6\u53d1\u73b0\u4e86\u4e0a\u6d77\u8b66\u65b9\u7684\u8fd9\u4e2a\u6570\u636e\u5e93\u3002</p> <p>\u4e2a\u4eba\u4fe1\u606f\u6570\u636e\u4e00\u65e6\u6cc4\u9732\uff0c\u76f8\u5f53\u4e8e\u522b\u4eba\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u76f4\u63a5\u5b9a\u4f4d\u4f60\u7684\u4f4f\u5740\u3001\u7535\u8bdd\u53f7\u7801\u3001\u5404\u79cd\u793e\u4ea4\u8d26\u53f7\u3001\u8eab\u4efd\u8bc1\u4fe1\u606f\u751a\u81f3\u662f\u673a\u7968\u3001\u706b\u8f66\u7968\u3001\u9152\u5e97\u5f00\u623f\u4fe1\u606f\u7b49\uff0c\u505a\u7684\u518d\u7edd\u4e00\u5b9a\uff0c\u5982\u679c\u8fd9\u4e2a\u9152\u5e97\u88ab\u4eba\u5077\u5077\u653e\u4e86\u9488\u5b54\u6444\u50cf\u5934\uff0c\u751a\u81f3\u8fd8\u80fd\u6839\u636e\u8bb0\u5f55\u67e5\u5230\u4f60\u5f00\u623f\u89c6\u9891\uff0c\u8fd9\u4e9b\u4e8b\u60c5\u5149\u662f\u60f3\u60f3\u90fd\u53ef\u6015\uff0c\u8fd9\u7b49\u540c\u4e8e\u5728\u4e92\u8054\u7f51\u4e0a\u201c\u88f8\u5954\u201d\u3002</p> <p>\u7f51\u7edc\u5b89\u5168\u95ee\u9898\u975e\u540c\u5c0f\u53ef\uff0c\u800c\u6211\u4eec\u4f5c\u4e3a\u7f51\u7ad9\u7684\u5f00\u53d1\u8005\uff0c\u66f4\u5e94\u8be5\u9996\u5f53\u5176\u51b2\u89e3\u51b3\u8fd9\u4e9b\u6f5c\u5728\u95ee\u9898\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f1a\u4ecb\u7ecd\u51e0\u4e2a\u5e38\u89c1\u7684Web\u7f51\u7ad9\u653b\u51fb\u65b9\u5f0f\uff0c\u4ee5\u53ca\u5728\u540e\u7eed\u4f7f\u7528SpringSecurity\u65f6\u5982\u4f55\u53bb\u9632\u8303\u8fd9\u4e9b\u653b\u51fb\u884c\u4e3a\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_2","title":"\u6d4b\u8bd5\u73af\u5883\u642d\u5efa","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u6211\u4eec\u4e4b\u524d\u7684\u7f51\u7ad9\u5b89\u5168\u6027\uff0c\u8fd9\u91cc\u6211\u4eec\u57fa\u4e8eMvc\u6846\u67b6\u91cd\u65b0\u642d\u5efa\u4e00\u4e2a\u91c7\u7528\u4e4b\u524d\u7684\u9a8c\u8bc1\u65b9\u5f0f\u7684\u7b80\u6613\u7f51\u7ad9\uff0c\u9996\u5148\u662f\u767b\u5f55\u754c\u9762\u90e8\u5206\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u767b\u5f55\u767d\u9a6c\u94f6\u884c&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;form action=\"login\" method=\"post\"&gt;\n    &lt;label&gt;\n      \u7528\u6237\u540d\uff1a\n      &lt;input name=\"username\" type=\"text\"&gt;\n    &lt;/label&gt;\n    &lt;label&gt;\n      \u5bc6\u7801\uff1a\n      &lt;input name=\"password\" type=\"password\"&gt;\n    &lt;/label&gt;\n    &lt;button type=\"submit\"&gt;\u767b\u5f55&lt;/button&gt;\n  &lt;/form&gt;\n  &lt;div th:if=\"${status}\"&gt;\u767b\u5f55\u5931\u8d25\uff0c\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u63a5\u7740\u662f\u767b\u5f55\u4e4b\u540e\u7684\u9996\u9875\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u767d\u9a6c\u94f6\u884c - \u9996\u9875&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u63a5\u7740\u662fController\u90e8\u5206\uff1a</p> <pre><code>@Controller\npublic class HelloController {\n    //\u5904\u7406\u767b\u5f55\u64cd\u4f5c\u5e76\u8df3\u8f6c\n    @PostMapping(\"/login\")\n    public String login(@RequestParam String username,\n                        @RequestParam String password,\n                        HttpSession session,\n                        Model model){\n        if(\"test\".equals(username) &amp;&amp; \"123456\".equals(password)) {\n            session.setAttribute(\"login\", true);\n            return \"redirect:/\";\n        } else {\n            model.addAttribute(\"status\", true);\n            return \"login\";\n        }\n    }\n\n    //\u5904\u7406\u9996\u9875\u6216\u662f\u767b\u5f55\u754c\u9762\u8df3\u8f6c\n    @GetMapping(\"/\")\n    public String index(HttpSession session){\n        if(session.getAttribute(\"login\") != null) {\n            return \"index\";\n        }else {\n            return \"login\";\n        }\n    }\n}\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u7b80\u5355\u767b\u5f55\u4e86\uff1a</p> <p>image-20230701184920238</p> <p>\u63a5\u7740\u6211\u4eec\u5728\u9996\u9875\u52a0\u4e00\u4e2a\u8f6c\u8d26\u64cd\u4f5c\uff0c\u8981\u6c42\u586b\u5199\u8f6c\u8d26\u4eba\u8d26\u53f7\u540d\u79f0\uff1a</p> <pre><code>@ResponseBody\n@PostMapping(\"/pay\")\npublic JSONObject pay(@RequestParam String account,\n                      HttpSession session){\n    JSONObject object = new JSONObject();\n    //\u767b\u5f55\u4e4b\u540e\u624d\u80fd\u8f6c\u8d26\n    if(session.getAttribute(\"login\") != null) {\n        System.out.println(\"\u8f6c\u8d26\u7ed9\"+account+\"\u6210\u529f\uff0c\u4ea4\u6613\u5df2\u5b8c\u6210\uff01\");\n        object.put(\"success\", true);\n    } else {\n        System.out.println(\"\u8f6c\u8d26\u7ed9\"+account+\"\u5931\u8d25\uff0c\u7528\u6237\u672a\u767b\u5f55\uff01\");\n        object.put(\"success\", false);\n    }\n    return object;\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5728\u9875\u9762\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u7b80\u5355\u7684\u8f6c\u8d26\u64cd\u4f5c\u6309\u952e\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u767d\u9a6c\u94f6\u884c - \u9996\u9875&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/axios@1.1.2/dist/axios.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div&gt;\n        &lt;label&gt;\n            \u8f6c\u8d26\u8d26\u53f7\uff1a\n            &lt;input type=\"text\" id=\"account\"/&gt;\n        &lt;/label&gt;\n        &lt;button onclick=\"pay()\"&gt;\u7acb\u5373\u8f6c\u8d26&lt;/button&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n&lt;script&gt;\nfunction pay() {\n    const account = document.getElementById(\"account\").value\n    axios.post('/mvc/pay', { account: account }, {\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        }\n    }).then(({data}) =&gt; {\n        if(data.success)\n            alert(\"\u8f6c\u8d26\u6210\u529f\")\n        else\n            alert(\"\u8f6c\u8d26\u5931\u8d25\")\n    })\n}\n&lt;/script&gt;\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u6210\u529f\u642d\u5efa\u597d\u7f51\u7edc\u5b89\u5168\u7684\u6d4b\u8bd5\u9879\u76ee\u4e86\uff0c\u5404\u4f4d\u5c0f\u4f19\u4f34\u8bf7\u5c06\u8fd9\u4e2a\u9879\u76ee\u8fdb\u884c\u4fdd\u5b58\uff0c\u540e\u9762\u9700\u8981\u91cd\u590d\u4f7f\u7528\u3002</p> <p>image-20230701224909319</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#csrf","title":"CSRF\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u653b\u51fb","text":"<p>CSRF\u662f\u6211\u4eec\u8981\u4ecb\u7ecd\u7684\u7b2c\u4e00\u79cd\u653b\u51fb\u5f62\u5f0f\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u975e\u5e38\u597d\u7406\u89e3\u3002</p> <p>image-20230701181244150</p> <p>\u6211\u4eec\u65f6\u5e38\u4f1a\u5728QQ\u4e0a\u6536\u5230\u522b\u4eba\u53d1\u9001\u7684\u9493\u9c7c\u7f51\u7ad9\u94fe\u63a5\uff0c\u53ea\u8981\u4f60\u5728\u4e0a\u9762\u767b\u9646\u4e86\u4f60\u7684QQ\u8d26\u53f7\uff0c\u90a3\u4e48\u4e0d\u51fa\u610f\u5916\uff0c\u4f60\u7684\u53f7\u5df2\u7ecf\u5728\u522b\u4eba\u624b\u4e2d\u4e86\u3002\u5b9e\u9645\u4e0a\u8fd9\u4e00\u7c7b\u7f51\u7ad9\u90fd\u5c5e\u4e8e\u6076\u610f\u7f51\u7ad9\uff0c\u4e13\u95e8\u7528\u4e8e\u76d7\u53d6\u4ed6\u4eba\u4fe1\u606f\uff0c\u6267\u884c\u975e\u6cd5\u64cd\u4f5c\uff0c\u751a\u81f3\u83b7\u53d6\u4ed6\u4eba\u8d26\u6237\u4e2d\u7684\u8d22\u4ea7\uff0c\u975e\u6cd5\u8f6c\u8d26\u7b49\u3002\u800c\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e00\u79cd\u6bd4\u8f83\u5bb9\u6613\u53d1\u751f\u7684\u6076\u610f\u64cd\u4f5c\uff0c\u4ece\u4e0d\u6cd5\u5206\u5b50\u7684\u89d2\u5ea6\u53bb\u4e86\u89e3\u6574\u4e2a\u6d41\u7a0b\u3002</p> <p>\u6211\u4eec\u5728JavaWeb\u9636\u6bb5\u5df2\u7ecf\u4e86\u89e3\u4e86Session\u548cCookie\u7684\u673a\u5236\uff0c\u5728\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u4f1a\u7ed9\u6d4f\u89c8\u5668\u4e00\u4e2a\u540d\u4e3aJSESSIONID\u7684Cookie\u4fe1\u606f\u4f5c\u4e3a\u4f1a\u8bdd\u7684\u552f\u4e00\u51ed\u636e\uff0c\u53ea\u8981\u7528\u6237\u643a\u5e26\u6b64Cookie\u8bbf\u95ee\u6211\u4eec\u7684\u7f51\u7ad9\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u6b64\u4f1a\u8bdd\u5c5e\u4e8e\u54ea\u4e2a\u6d4f\u89c8\u5668\u7528\u6237\u3002\u56e0\u6b64\uff0c\u53ea\u8981\u6b64\u4f1a\u8bdd\u7684\u7528\u6237\u6267\u884c\u4e86\u767b\u5f55\u64cd\u4f5c\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u968f\u610f\u8bbf\u95ee\u4e2a\u4eba\u4fe1\u606f\u7b49\u5185\u5bb9\u3002</p> <p>\u6211\u4eec\u6765\u5c1d\u8bd5\u6a21\u62df\u4e00\u4e0b\u8fd9\u79cd\u64cd\u4f5c\uff0c\u6765\u7f16\u5199\u4e00\u4e2a\u9493\u9c7c\u7f51\u7ad9\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u5764\u5764\u7092\u7c89\u653e\u9e21\u7cbe\u89c6\u9891\u5728\u7ebf\u89c2\u770b&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/axios@1.1.2/dist/axios.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;iframe name=\"hiddenIframe\" hidden&gt;&lt;/iframe&gt;\n&lt;form action=\"http://localhost:8080/mvc/pay\" method=\"post\" target=\"hiddenIframe\"&gt;\n    &lt;input type=\"text\" name=\"account\" value=\"\u9ed1\u5ba2\" hidden&gt;\n    &lt;button type=\"submit\"&gt;\u70b9\u51fb\u4e0b\u8f7d\u5168\u5957\u89c6\u9891&lt;/button&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u8fd9\u4e2a\u9875\u9762\u5e76\u4e0d\u662f\u6211\u4eec\u5b98\u65b9\u63d0\u4f9b\u7684\u9875\u9762\uff0c\u800c\u662f\u4e0d\u6cd5\u5206\u5b50\u642d\u5efa\u7684\u6076\u610f\u7f51\u7ad9\u3002\u6211\u4eec\u53d1\u73b0\u6b64\u9875\u9762\u4e2d\u6709\u4e00\u4e2a\u8868\u5355\uff0c\u4f46\u662f\u8868\u5355\u4e2d\u7684\u8f93\u5165\u6846\u88ab\u9690\u85cf\u4e86\uff0c\u800c\u6211\u4eec\u770b\u5230\u7684\u53ea\u6709\u4e00\u4e2a\u6309\u94ae\uff0c\u6211\u4eec\u4e0d\u77e5\u9053\u8fd9\u662f\u4e00\u4e2a\u8868\u5355\uff0c\u4e5f\u4e0d\u77e5\u9053\u8868\u5355\u4f1a\u63d0\u4ea4\u7ed9\u90a3\u4e2a\u5730\u5740\uff0c\u8fd9\u65f6\u6574\u4e2a\u9875\u9762\u5c31\u975e\u5e38\u6709\u8ff7\u60d1\u6027\u4e86\u3002\u5982\u679c\u6211\u4eec\u70b9\u51fb\u6b64\u6309\u94ae\uff0c\u90a3\u4e48\u6574\u4e2a\u8868\u5355\u7684\u6570\u636e\u4f1a\u4ee5POST\u7684\u5f62\u5f0f\u53d1\u9001\u7ed9\u6211\u4eec\u7684\u670d\u52a1\u7aef\uff08\u4f1a\u643a\u5e26\u4e4b\u524d\u767b\u9646\u6211\u4eec\u7f51\u7ad9\u7684Cookie\u4fe1\u606f\uff09\uff0c\u4f46\u662f\u8fd9\u91cc\u5f88\u660e\u663e\u662f\u53e6\u4e00\u4e2a\u7f51\u7ad9\u8df3\u8f6c\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u6076\u610f\u7f51\u7ad9\u5c31\u6210\u529f\u5730\u5728\u6211\u4eec\u6beb\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u5f15\u5bfc\u6211\u4eec\u6267\u884c\u4e86\u8f6c\u8d26\u64cd\u4f5c\uff0c\u5f53\u4f60\u53d1\u73b0\u4e0a\u5f53\u53d7\u9a97\u65f6\uff0c\u94b1\u5df2\u7ecf\u88ab\u8f6c\u8d70\u4e86\u3002</p> <p>\u6211\u4eec\u9996\u5148\u4f5c\u4e3a\u7528\u6237\uff0c\u5148\u5728\u6b63\u5e38\u7684\u7f51\u7ad9\u8fdb\u884c\u767b\u5f55\uff1a</p> <p>image-20230701233127287</p> <p>\u63a5\u7740\u6211\u4eec\u5047\u88c5\u81ea\u5df1\u4e0a\u5f53\uff0c\u8fdb\u5165\u5230\u6211\u4eec\u7684\u9493\u9c7c\u7f51\u7ad9\uff1a</p> <p>image-20230701233202016</p> <p>\u73b0\u5728\u6211\u4eec\u6beb\u4e0d\u77e5\u60c5\uff0c\u5982\u679c\u662f\u6b63\u5e38\u4eba\u601d\u7ef4\u7684\u8bdd\uff0c\u5c31\u4f1a\u76f4\u63a5\u70b9\u51fb\u4e0b\u8f7d\u5168\u5957\u89c6\u9891\uff0c\u606d\u559c\uff0c\u6b64\u65f6\u540e\u53f0\u5df2\u7ecf\u8f6c\u8d26\u6210\u529f\u4e86\uff0c\u7559\u4e0b\u4e00\u8138\u61f5\u903c\u7684\u4f60\uff1a</p> <p>image-20230701233317019</p> <p>\u800c\u8fd9\u79cd\u6784\u5efa\u6076\u610f\u9875\u9762\uff0c\u5f15\u5bfc\u7528\u6237\u8bbf\u95ee\u5bf9\u5e94\u7f51\u7ad9\u6267\u884c\u64cd\u4f5c\u7684\u65b9\u5f0f\u79f0\u4e3a\uff1a\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\uff08CSRF\uff0cCross Site Request Forgery\uff09</p> <p>\u663e\u7136\uff0c\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u5c31\u5b58\u5728\u8fd9\u6837\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u800cSpringSecurity\u5c31\u89e3\u51b3\u4e86\u8fd9\u6837\u7684\u95ee\u9898\u3002</p> <p>\u5f53\u7136\uff0c\u9664\u4e86\u901a\u8fc7\u6211\u4eec\u81ea\u5df1SpringSecurity\u4f7f\u7528\u53bb\u89e3\u51b3\u4e4b\u5916\uff0c\u968f\u7740\u73b0\u5728\u7684\u6d4f\u89c8\u5668\u4e0d\u65ad\u53d1\u5c55\uff0c\u5b89\u5168\u6027\u8d8a\u6765\u8d8a\u53d7\u5230\u91cd\u89c6\uff0c\u5f88\u591a\u6d4f\u89c8\u5668\u90fd\u6709SameSite\u4fdd\u62a4\u673a\u5236\uff0c\u5f53\u7528\u6237\u5728\u4e24\u4e2a\u4e0d\u540c\u57df\u540d\u7684\u7ad9\u70b9\u64cd\u4f5c\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bCookie\u5c31\u4f1a\u88ab\u81ea\u52a8\u5c4f\u853d\uff1a</p> <p>a3421f74c3cee6b67d214809adb743a5</p> <p>SameSite\u662f\u4e00\u79cd\u5b89\u5168\u673a\u5236\uff0c\u65e8\u5728\u9632\u6b62\u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020\uff08CSRF\uff09\u653b\u51fb\uff0c\u5b83\u901a\u8fc7\u9650\u5236\u7b2c\u4e09\u65b9Cookie\u7684\u4f7f\u7528\u6765\u5b9e\u73b0\u8fd9\u4e00\u76ee\u7684\u3002\u5728Chrome\u6d4f\u89c8\u5668\u4e2d\uff0cSameSite\u9ed8\u8ba4\u4e3aLax\uff0c\u8fd9\u610f\u5473\u7740\u7b2c\u4e09\u65b9Cookie\u53ea\u80fd\u5728\u7528\u6237\u5bfc\u822a\u5230\u4e0e\u539f\u59cb\u7ad9\u70b9\u76f8\u540c\u7684\u7ad9\u70b9\u65f6\u53d1\u9001\u3002\u8fd9\u540c\u6837\u5927\u5927\u63d0\u5347\u4e86\u7528\u6237\u7684\u5b89\u5168\u6027\uff0c\u8ba9\u9ed1\u5ba2\u5c11\u4e86\u8bb8\u591a\u53ef\u4e58\u4e4b\u673a\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u673a\u5236\u5bf9\u505a\u5b9e\u65bd\u7684\u540c\u5b66\uff08\u53ef\u80fd\uff09\u4e0d\u592a\u53cb\u597d\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#sfa","title":"SFA\u4f1a\u8bdd\u56fa\u5b9a\u653b\u51fb","text":"<p>\u8fd9\u540c\u6837\u662f\u5229\u7528Cookie\u4e2d\u76f8\u540c\u7684JSESSIONID\u8fdb\u884c\u7684\u653b\u51fb\uff0c\u4f1a\u8bdd\u56fa\u5b9a\u653b\u51fb\uff08Session fixation attack\uff09\u662f\u4e00\u79cd\u9488\u5bf9Web\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u6f0f\u6d1e\u653b\u51fb\uff0c\u653b\u51fb\u8005\u5229\u7528\u8fd9\u79cd\u6f0f\u6d1e\uff0c\u5c06\u4e00\u4e2a\u6709\u6548\u7684\u4f1a\u8bddID\u5206\u914d\u7ed9\u7528\u6237\uff0c\u5e76\u8bf1\u4f7f\u7528\u6237\u5728\u8be5\u4f1a\u8bdd\u4e2d\u8fdb\u884c\u64cd\u4f5c\uff0c\u7136\u540e\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528\u8be5\u4f1a\u8bddID\u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\uff0c\u6216\u8005\u901a\u8fc7\u6b64\u4f1a\u8bdd\u7ee7\u7eed\u8fdb\u884c\u5176\u4ed6\u653b\u51fb\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u9ed1\u5ba2\u628a\u4ed6\u7684JSESSIONID\u76f4\u63a5\u7ed9\u4f60\uff0c\u4f60\u4e00\u65e6\u4f7f\u7528\u8fd9\u4e2aID\u767b\u5f55\uff0c\u90a3\u4e48\u5728\u540e\u7aef\u8fd9\u4e2aID\u5c31\u88ab\u8ba4\u5b9a\u4e3a\u5df2\u767b\u5f55\u72b6\u6001\uff0c\u90a3\u4e48\u4e5f\u5c31\u7b49\u540c\u4e8e\u4ed6\u76f4\u63a5\u8fdb\u5165\u4e86\u5df2\u767b\u5f55\u72b6\u6001\uff0c\u4ece\u800c\u76f4\u63a5\u8bbf\u95ee\u4f60\u8d26\u53f7\u7684\u4efb\u610f\u5185\u5bb9\uff0c\u6267\u884c\u4efb\u610f\u64cd\u4f5c\u3002</p> <p>\u653b\u51fb\u8005\u901a\u5e38\u4f7f\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u8fdb\u884c\u4f1a\u8bdd\u56fa\u5b9a\u653b\u51fb\uff1a</p> <ol> <li>\u4f1a\u8bdd\u4f20\u9012\uff1a\u653b\u51fb\u8005\u901a\u8fc7URL\u53c2\u6570\u3001\u8868\u5355\u9690\u85cf\u5b57\u6bb5\u3001cookie\u7b49\u65b9\u5f0f\u5c06\u4f1a\u8bddID\u4f20\u9012\u7ed9\u7528\u6237\u3002\u5f53\u7528\u6237\u4f7f\u7528\u8be5\u4f1a\u8bddID\u767b\u5f55\u65f6\uff0c\u653b\u51fb\u8005\u5c31\u80fd\u5229\u7528\u8be5\u4f1a\u8bddID\u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\u3002</li> <li>\u4f1a\u8bdd\u52ab\u6301\uff1a\u653b\u51fb\u8005\u5229\u7528\u52ab\u6301\u7528\u6237\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u6d41\u91cf\uff0c\u83b7\u53d6\u5230\u7528\u6237\u7684\u4f1a\u8bddID\uff0c\u7136\u540e\u5229\u7528\u8be5\u4f1a\u8bddID\u5192\u5145\u7528\u6237\u8fdb\u884c\u64cd\u4f5c\u3002</li> <li>\u4f1a\u8bdd\u52ab\u6301\uff1a\u653b\u51fb\u8005\u4e8b\u5148\u83b7\u53d6\u5230\u4f1a\u8bddID\uff0c\u5e76\u5c06\u5176\u5206\u914d\u7ed9\u7528\u6237\uff0c\u4e4b\u540e\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u6b3a\u9a97\u7528\u6237\u767b\u5f55\u8be5\u4f1a\u8bdd\u3002\u8fd9\u6837\uff0c\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u5229\u7528\u4f1a\u8bddID\u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\u3002</li> </ol> <p>\u8fd9\u91cc\u6211\u4eec\u6765\u5c1d\u8bd5\u4e00\u4e0b\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u8fd9\u91cc\u6211\u4eec\u9996\u5148\u7528\u53e6\u4e00\u4e2a\u6d4f\u89c8\u5668\u8bbf\u95ee\u76ee\u6807\u7f51\u7ad9\uff0c\u6b64\u65f6\u9700\u8981\u767b\u5f55\uff0c\u5f00\u59cb\u4e4b\u524d\u8bb0\u5f97\u5148\u6e05\u7406\u4e00\u4e0b\u4e24\u4e2a\u6d4f\u89c8\u5668\u7684\u7f13\u5b58\uff0c\u5426\u5219\u53ef\u80fd\u65e0\u6cd5\u751f\u6548\uff1a</p> <p>image-20230702001501063</p> <p>\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u8bb0\u5f55\u4e0b\u8fd9\u4e2aJSESSIONID\uff0c\u7136\u540e\u5c06\u5176\u7f16\u5199\u5230\u6211\u4eec\u7684\u8bc8\u9a97\u7f51\u7ad9\u4e2d\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u6076\u610f\u811a\u672c\uff0c\u4f1a\u81ea\u52a8\u5c06\u5bf9\u5e94\u7528\u6237\u7684Cookie\u8fdb\u884c\u66ff\u6362\uff0c\u53d8\u6210\u6211\u4eec\u7684JSESSIONID\u503c\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;\u51a0\u5e0c\u54e5\u5168\u5957\u89c6\u9891&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/axios@1.1.2/dist/axios.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script&gt;\n      //\u7b2c\u4e09\u65b9\u7f51\u7ad9\u6076\u610f\u811a\u672c\uff0c\u81ea\u52a8\u4fee\u6539Cookie\u4fe1\u606f\n    document.cookie = \"JSESSIONID=6AAF677EC2B630704A80D36311F08E01; path=/mvc; domain=localhost\"\n      //\u7136\u540e\u7ed9\u4f60\u5f04\u5230\u539f\u6765\u7684\u7f51\u7ad9\n      location.href = 'http://localhost:8080/mvc/'\n&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u8bbf\u95ee\u8fd9\u4e2a\u6076\u610f\u7f51\u7ad9\uff0c\u7136\u540e\u518d\u4f5c\u4e3a\u7528\u6237\uff0c\u53bb\u6b63\u5e38\u8bbf\u95ee\u76ee\u6807\u7f51\u7ad9\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\uff1a</p> <p>image-20230702001831904</p> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u7528\u6237\u7684\u6d4f\u89c8\u5668JSESSIONID\u503c\u4e3a\u521a\u521a\u6076\u610f\u7f51\u7ad9\u4f2a\u9020\u7684\u503c\uff0c\u73b0\u5728\u6211\u4eec\u6765\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\uff1a</p> <p>image-20230702002007450</p> <p>\u6b64\u65f6\u6211\u4eec\u56de\u5230\u4e00\u5f00\u59cb\u7684\u6d4f\u89c8\u5668\uff0c\u5237\u65b0\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u6d4f\u89c8\u5668\u540c\u6837\u5df2\u7ecf\u767b\u5f55\u6210\u529f\u4e86\uff0c\u539f\u7406\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u76f8\u5f53\u4e8e\u8ba9\u7528\u6237\u76f4\u63a5\u5e2e\u6211\u4eec\u767b\u5f55\u4e86\uff0c\u662f\u4e0d\u662f\u611f\u89c9\u7279\u522b\u5371\u9669\uff1f</p> <p>\u5f53\u7136\uff0c\u73b0\u5728\u7684\u6d4f\u89c8\u5668\u540c\u6837\u6709\u7740\u5bf9\u5e94\u7684\u4fdd\u62a4\u673a\u5236\uff0cTomcat\u53d1\u9001\u7684SESSIONID\u9ed8\u8ba4\u662f\u52fe\u9009\u4e86HttpOnly\u9009\u9879\u7684\uff0c\u4e00\u65e6\u88ab\u8bbe\u5b9a\u662f\u65e0\u6cd5\u88ab\u968f\u610f\u4fee\u6539\u7684\uff0c\u5f53\u7136\u524d\u63d0\u662f\u5148\u5f97\u6b63\u5e38\u8bbf\u95ee\u4e00\u6b21\u7f51\u7ad9\u624d\u884c\uff0c\u5426\u5219\u4ecd\u7136\u5b58\u5728\u5b89\u5168\u9690\u60a3\u3002</p> <p>HttpOnly\u662fCookie\u4e2d\u4e00\u4e2a\u5c5e\u6027\uff0c\u7528\u4e8e\u9632\u6b62\u5ba2\u6237\u7aef\u811a\u672c\u901a\u8fc7document.cookie\u5c5e\u6027\u8bbf\u95eeCookie\uff0c\u6709\u52a9\u4e8e\u4fdd\u62a4Cookie\u4e0d\u88ab\u8de8\u7ad9\u811a\u672c\u653b\u51fb\u7a83\u53d6\u6216\u7be1\u6539\u3002\u4f46\u662f\uff0cHttpOnly\u7684\u5e94\u7528\u4ecd\u5b58\u5728\u5c40\u9650\u6027\uff0c\u4e00\u4e9b\u6d4f\u89c8\u5668\u53ef\u4ee5\u963b\u6b62\u5ba2\u6237\u7aef\u811a\u672c\u5bf9Cookie\u7684\u8bfb\u64cd\u4f5c\uff0c\u4f46\u5141\u8bb8\u5199\u64cd\u4f5c\uff1b\u6b64\u5916\u5927\u591a\u6570\u6d4f\u89c8\u5668\u4ecd\u5141\u8bb8\u901a\u8fc7XMLHTTP\u5bf9\u8c61\u8bfb\u53d6HTTP\u54cd\u5e94\u4e2d\u7684Set-Cookie\u5934\u3002</p> <p>image-20230702002624508</p> <p>\u4e3a\u4e86\u5f7b\u5e95\u675c\u7edd\u8fd9\u4e2a\u95ee\u9898\uff0c\u767b\u5f55\u6210\u529f\u4e4b\u540e\u5e94\u8be5\u91cd\u65b0\u7ed9\u7528\u6237\u5206\u914d\u4e00\u4e2a\u65b0\u7684JSESSIONID\u624d\u884c\uff0c\u800c\u8fd9\u4e9b\u90fd\u7531SpringSecurity\u5e2e\u6211\u4eec\u5b9e\u73b0\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#xss","title":"XSS\u8de8\u7ad9\u811a\u672c\u653b\u51fb","text":"<p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\u4e24\u79cd\u653b\u51fb\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u90fd\u662f\u4ece\u5916\u90e8\u5e72\u6d89\uff0c\u5728\u5916\u90e8\u65e0\u6cd5\u5e72\u6d89\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4ece\u5185\u90e8\u51fb\u6e83\u7f51\u7ad9\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u9686\u91cd\u4ecb\u7ecdXSS\u8de8\u7ad9\u811a\u672c\u653b\u51fb\u65b9\u5f0f\u3002</p> <p>XSS\uff08\u8de8\u7ad9\u811a\u672c\u653b\u51fb\uff09\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u7f51\u7edc\u5b89\u5168\u6f0f\u6d1e\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u5728\u5408\u6cd5\u7f51\u7ad9\u4e2d\u6ce8\u5165\u6076\u610f\u811a\u672c\u4ee3\u7801\u6765\u653b\u51fb\u7528\u6237\u3002\u5f53\u7528\u6237\u8bbf\u95ee\u53d7\u5230\u6ce8\u5165\u653b\u51fb\u7684\u9875\u9762\u65f6\uff0c\u6076\u610f\u4ee3\u7801\u4f1a\u5728\u7528\u6237\u7684\u6d4f\u89c8\u5668\u4e2d\u6267\u884c\uff0c\u4ece\u800c\u5bfc\u81f4\u653b\u51fb\u8005\u80fd\u591f\u7a83\u53d6\u7528\u6237\u7684\u654f\u611f\u4fe1\u606f\u3001\u8bf1\u5bfc\u7528\u6237\u64cd\u4f5c\u3001\u751a\u81f3\u63a7\u5236\u7528\u6237\u7684\u8d26\u53f7\u3002</p> <p>XSS\u653b\u51fb\u5e38\u89c1\u7684\u65b9\u5f0f\u6709\u4e09\u79cd\uff1a</p> <ol> <li>\u5b58\u50a8\u578bXSS\u653b\u51fb\uff1a\u653b\u51fb\u8005\u5c06\u6076\u610f\u4ee3\u7801\u5b58\u50a8\u5230\u76ee\u6807\u7f51\u7ad9\u7684\u6570\u636e\u5e93\u4e2d\uff0c\u5f53\u5176\u4ed6\u7528\u6237\u8bbf\u95ee\u5305\u542b\u6076\u610f\u4ee3\u7801\u7684\u9875\u9762\u65f6\uff0c\u6076\u610f\u4ee3\u7801\u4f1a\u88ab\u6267\u884c\u3002</li> <li>\u53cd\u5c04\u578bXSS\u653b\u51fb\uff1a\u653b\u51fb\u8005\u5c06\u6076\u610f\u4ee3\u7801\u5d4c\u5165\u5230URL\u4e2d\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u5305\u542b\u6076\u610f\u4ee3\u7801\u7684URL\u65f6\uff0c\u6076\u610f\u4ee3\u7801\u4f1a\u88ab\u6267\u884c\u3002</li> <li>DOM-based XSS\u653b\u51fb\uff1a\u653b\u51fb\u8005\u5229\u7528\u524d\u7aefJavaScript\u4ee3\u7801\u7684\u6f0f\u6d1e\uff0c\u901a\u8fc7\u4fee\u6539\u9875\u9762\u7684DOM\u7ed3\u6784\u6765\u6267\u884c\u6076\u610f\u4ee3\u7801\u3002</li> </ol> <p>\u5728\u4e00\u4e9b\u793e\u4ea4\u7f51\u7ad9\u4e0a\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u7531\u53d1\u5e16\uff0c\u800c\u5e16\u5b50\u662f\u4ee5\u5bcc\u6587\u672c\u5f62\u5f0f\u8fdb\u884c\u7f16\u8f91\u548c\u4e0a\u4f20\u7684\uff0c\u53d1\u9001\u7ed9\u540e\u53f0\u7684\u5e16\u5b50\u5f80\u5f80\u662f\u76f4\u63a5\u4ee5HTML\u4ee3\u7801\u7684\u5f62\u5f0f\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u7ed9\u9ed1\u5ba2\u53ef\u4e58\u4e4b\u673a\u4e86\u3002</p> <p>image-20230702003831742</p> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53d1\u5e16\u4f1a\u5411\u540e\u7aef\u4e0a\u4f20\u4ee5\u4e0b\u5185\u5bb9\uff0c\u8fd9\u4e9b\u662f\u7ecf\u8fc7\u8f6c\u6362\u5f97\u5230\u7684\u6b63\u5e38HTML\u4ee3\u7801\uff0c\u65b9\u4fbf\u540e\u7eed\u76f4\u63a5\u5c55\u793a\uff1a</p> <pre><code>&lt;div class=\"content ql-editor\"&gt;\n  &lt;p&gt;\n    &lt;strong&gt;\u8428\u8fbe\u7761\u89c9\u4e86\u5927\u6570\u636e&lt;/strong&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\u6492\u5927\u5927\u6492\u5927\u58f0\u5730&lt;/p&gt;\n&lt;/div&gt;\n</code></pre> <p>\u800c\u73b0\u5728\uff0c\u9ed1\u5ba2\u4e0d\u8d70\u5e38\u89c4\u7684\u65b9\u5f0f\u53d1\u5e16\uff0c\u800c\u662f\u53d1\u9001\u4ee5\u4e0b\u5185\u5bb9\u7ed9\u670d\u52a1\u7aef\uff1a</p> <pre><code>&lt;div class=\"content ql-editor\"&gt;\n  &lt;p \u03bfnl\u03bfad=\"alert('xss')\"&gt;\n    &lt;strong&gt;\u8428\u8fbe\u7761\u89c9\u4e86\u5927\u6570\u636e&lt;/strong&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\u6492\u5927\u5927\u6492\u5927\u58f0\u5730&lt;/p&gt;\n&lt;/div&gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230<code>p</code>\u6807\u7b7e\u4e0a\u6dfb\u52a0\u4e86\u4e00\u6bb5JS\u6076\u610f\u811a\u672c\uff0c\u9ed1\u5ba2\u53ef\u4ee5\u5229\u7528\u8fd9\u79cd\u7279\u6027\uff0c\u83b7\u53d6\u7528\u6237\u7684\u5404\u79cd\u4fe1\u606f\uff0c\u751a\u81f3\u76f4\u63a5\u53d1\u9001\u5230\u4ed6\u7684\u540e\u53f0\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u7684\u4e2a\u4eba\u4fe1\u606f\u5c31\u4ece\u7f51\u7ad9\u5185\u90e8\u88ab\u6cc4\u9732\u4e86\u3002</p> <p>XSS\u6f0f\u6d1e\u6700\u65e9\u88ab\u53d1\u73b0\u662f\u57281996\u5e74\uff0c\u7531\u4e8eJavaScript\u7684\u51fa\u73b0\uff0c\u5bfc\u81f4\u5728Web\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5b58\u5728\u4e86\u4e00\u4e9b\u5b89\u5168\u95ee\u9898\u3002\u57281997\u5e74\uff0c\u9ad8\u667a\u6587(Gareth Owen)\u4e5f\u5c31\u662f\u201cXSS\u4e4b\u7236\u201d\uff0c\u5728\u4ed6\u7684\u535a\u5ba2\u4e2d\u63cf\u8ff0\u4e86\u4e00\u79cd\u79f0\u4e3a\u201c\u811a\u672c\u6ce8\u5165\u201d(script injection)\u7684\u653b\u51fb\u6280\u672f\uff0c\u8fd9\u5c31\u662fXSS\u6f0f\u6d1e\u7684\u524d\u8eab\u3002\u4ece\u90a3\u65f6\u8d77\uff0cXSS\u6f0f\u6d1e\u4fbf\u6210\u4e3a\u4e86Web\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u4e00\u79cd\u5e38\u89c1\u5b89\u5168\u6f0f\u6d1e\u3002</p> <p>image-20230702004827194</p> <p>\u8fd9\u79cd\u653b\u51fb\u4e00\u822c\u9700\u8981\u524d\u7aef\u914d\u5408\u540e\u7aef\u8fdb\u884c\u9632\u5fa1\uff0c\u6216\u8005\u540e\u7aef\u5bf9\u524d\u7aef\u53d1\u9001\u7684\u5185\u5bb9\u8fdb\u884c\u5b89\u5168\u626b\u63cf\u5e76\u5904\u7406\uff0c\u6709\u673a\u4f1a\u6211\u4eec\u4f1a\u5206\u4eab\u5982\u4f55\u9632\u8303\u6b64\u7c7b\u653b\u51fb\u3002</p> <p>\u5728\u4e86\u89e3\u8fd9\u4e48\u591a\u653b\u51fb\u65b9\u5f0f\u4e4b\u540e\uff0c\u60f3\u5fc5\u5404\u4f4d\u5c0f\u4f19\u4f34\u80af\u5b9a\u6709\u4e86\u4e00\u5b9a\u7684\u7f51\u7edc\u5b89\u5168\u610f\u8bc6\uff0c\u4e0d\u8fc7\u6211\u4eec\u5e76\u4e0d\u662f\u7f51\u7edc\u5b89\u5168\u4e13\u4e1a\u7684\u8bfe\u7a0b\uff0c\u81f3\u4e8e\u66f4\u591a\u7684\u653b\u51fb\u5f62\u5f0f\uff0c\u8fd8\u8bf7\u5404\u4f4d\u5c0f\u4f19\u4f34\u81ea\u884c\u4e86\u89e3\uff0c\u4ece\u4e0b\u4e00\u4e2a\u677f\u5757\u5f00\u59cb\uff0c\u6211\u4eec\u5c06\u4f1a\u6b63\u5f0f\u5f00\u59cbSpringSecurity\u6846\u67b6\u7684\u4ecb\u7ecd\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_3","title":"\u5f00\u53d1\u73af\u5883\u914d\u7f6e","text":"<p>\u6211\u4eec\u7ee7\u7eed\u4f7f\u7528\u4e4b\u524d\u7684\u6d4b\u8bd5\u9879\u76ee\u8fdb\u884c\u6559\u5b66\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5bfc\u5165SpringSecurity\u7684\u76f8\u5173\u4f9d\u8d56\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u5bfc\u5165\u9700\u8981\u7684\u6a21\u5757\uff0c\u5e38\u7528\u7684\u662f\u4ee5\u4e0b\u4e24\u4e2a\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;\n    &lt;version&gt;6.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;\n    &lt;version&gt;6.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u914d\u7f6eSpringSecurity\uff0c\u4e0eMvc\u4e00\u6837\uff0c\u9700\u8981\u4e00\u4e2a\u521d\u59cb\u5316\u5668\uff1a</p> <pre><code>public class SecurityInitializer extends AbstractSecurityWebApplicationInitializer {\n    //\u4e0d\u7528\u91cd\u5199\u4efb\u4f55\u5185\u5bb9\n      //\u8fd9\u91cc\u5b9e\u9645\u4e0a\u4f1a\u81ea\u52a8\u6ce8\u518c\u4e00\u4e2aFilter\uff0cSpringSecurity\u5e95\u5c42\u5c31\u662f\u4f9d\u9760N\u4e2a\u8fc7\u6ee4\u5668\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u4e4b\u540e\u518d\u63a2\u8ba8\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u518d\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u7c7b\u7528\u4e8e\u914d\u7f6eSpringSecurity\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity   //\u5f00\u542fWebSecurity\u76f8\u5173\u529f\u80fd\npublic class SecurityConfiguration {\n\n}\n</code></pre> <p>\u63a5\u7740\u5728\u6839\u5bb9\u5668\u4e2d\u6dfb\u52a0\u6b64\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\uff1a</p> <pre><code>@Override\nprotected Class&lt;?&gt;[] getRootConfigClasses() {\n    return new Class[]{MainConfiguration.class, SecurityConfiguration.class};\n}\n</code></pre> <p>\u8fd9\u6837\uff0cSpringSecurity\u7684\u914d\u7f6e\u5c31\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u518d\u6b21\u8fd0\u884c\u9879\u76ee\uff0c\u4f1a\u53d1\u73b0\u65e0\u6cd5\u8fdb\u5165\u7684\u6211\u4eec\u7684\u9875\u9762\u4e2d\uff0c\u65e0\u8bba\u6211\u4eec\u8bbf\u95ee\u54ea\u4e2a\u9875\u9762\uff0c\u90fd\u4f1a\u8fdb\u5165\u5230SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u4e00\u4e2a\u9ed8\u8ba4\u767b\u5f55\u9875\u9762\uff0c\u4e4b\u540e\u6211\u4eec\u4f1a\u8bb2\u89e3\u5982\u4f55\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>image-20230702135644834</p> <p>\u81f3\u6b64\uff0c\u9879\u76ee\u73af\u5883\u642d\u5efa\u5b8c\u6210\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_4","title":"\u8ba4\u8bc1","text":"<p>\u8ba4\u8bc1\u662f\u6211\u4eec\u7f51\u7ad9\u7684\u7b2c\u4e00\u6b65\uff0c\u7528\u6237\u9700\u8981\u767b\u5f55\u4e4b\u540e\u624d\u80fd\u8fdb\u5165\uff0c\u8fd9\u4e00\u90e8\u5206\u6211\u4eec\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528SpringSecurity\u5b9e\u73b0\u7528\u6237\u767b\u5f55\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_5","title":"\u57fa\u4e8e\u5185\u5b58\u9a8c\u8bc1","text":"<p>\u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u6700\u7b80\u5355\u7684\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u76f4\u63a5\u4ee5\u4ee3\u7801\u7684\u5f62\u5f0f\u914d\u7f6e\u6211\u4eec\u7f51\u7ad9\u7684\u7528\u6237\u548c\u5bc6\u7801\uff0c\u914d\u7f6e\u65b9\u5f0f\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728Security\u914d\u7f6e\u7c7b\u4e2d\u6ce8\u518c\u4e00\u4e2aBean\u5373\u53ef\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    @Bean   //UserDetailsService\u5c31\u662f\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u670d\u52a1\n    public UserDetailsService userDetailsService() {\n          //\u6bcf\u4e00\u4e2aUserDetails\u5c31\u4ee3\u8868\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\uff0c\u5176\u4e2d\u5305\u542b\u7528\u6237\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u4ee5\u53ca\u89d2\u8272\n        UserDetails user = User.withDefaultPasswordEncoder()\n                .username(\"user\")\n                .password(\"password\")\n                .roles(\"USER\")  //\u89d2\u8272\u76ee\u524d\u6211\u4eec\u4e0d\u9700\u8981\u5173\u5fc3\uff0c\u968f\u4fbf\u5199\u5c31\u884c\uff0c\u540e\u9762\u4f1a\u4e13\u95e8\u8bb2\u89e3\n                .build();\n        UserDetails admin = User.withDefaultPasswordEncoder()\n                .username(\"admin\")\n                .password(\"password\")\n                .roles(\"ADMIN\", \"USER\")\n                .build();\n        return new InMemoryUserDetailsManager(user, admin); \n          //\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u7528\u6237\u4fe1\u606f\u7ba1\u7406\u5668\u4f5c\u4e3aUserDetailsService\n    }\n}\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u524d\u5f80\u767b\u5f55\u754c\u9762\uff0c\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\u4e86\uff1a</p> <p>image-20230702144938540</p> <p>\u767b\u5f55\u6210\u529f\u540e\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u6211\u4eec\u4e4b\u524d\u7684\u754c\u9762\u4e86\uff1a</p> <p>image-20230702145011992</p> <p>\u5e76\u4e14\u4e3a\u4e86\u9632\u6b62\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u7684\u4f1a\u8bdd\u56fa\u5b9a\u95ee\u9898\uff0c\u5728\u767b\u5f55\u4e4b\u540e\uff0cJSESSIONID\u4f1a\u5f97\u5230\u91cd\u65b0\u5206\u914d\uff1a</p> <p>image-20230703192441811</p> <p>\u5f53\u6211\u4eec\u60f3\u8981\u9000\u51fa\u65f6\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff1ahttp://localhost:8080/mvc/logout \u5730\u5740\uff0c\u6211\u4eec\u4f1a\u8fdb\u5165\u5230\u4e00\u4e2a\u9000\u51fa\u767b\u5f55\u754c\u9762\uff1a</p> <p>image-20230702145432892</p> <p>\u9000\u51fa\u767b\u5f55\u540e\u5c31\u9700\u8981\u91cd\u65b0\u767b\u5f55\u624d\u80fd\u8bbf\u95ee\u6211\u4eec\u7684\u7f51\u7ad9\u4e86\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u6709\u4e86SpringSecurity\u4e4b\u540e\uff0c\u6211\u4eec\u7f51\u7ad9\u7684\u767b\u5f55\u9a8c\u8bc1\u6a21\u5757\u76f8\u5f53\u4e8e\u76f4\u63a5\u88ab\u63a5\u7ba1\u4e86\uff0c\u56e0\u6b64\uff0c\u4ece\u73b0\u5728\u5f00\u59cb\uff0c\u6211\u4eec\u7684\u7f51\u7ad9\u4e0d\u9700\u8981\u518d\u81ea\u5df1\u7f16\u5199\u767b\u5f55\u6a21\u5757\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u53bb\u6389\uff0c\u53ea\u7559\u4e0b\u4e3b\u9875\u9762\uff1a</p> <pre><code>@Controller\npublic class HelloController {\n\n    //\u73b0\u5728\u6240\u6709\u63a5\u53e3\u4e0d\u9700\u8981\u4efb\u4f55\u9a8c\u8bc1\u4e86\uff0c\u56e0\u4e3aSecurity\u5df2\u7ecf\u5e2e\u6211\u4eec\u505a\u4e86\uff0c\u6ca1\u767b\u5f55\u662f\u6839\u672c\u8fdb\u4e0d\u6765\u7684\n    @GetMapping(\"/\")\n    public String index(){\n        return \"index\";\n    }\n\n    @ResponseBody\n    @PostMapping(\"/pay\")\n    public JSONObject pay(@RequestParam String account){\n        JSONObject object = new JSONObject();\n        System.out.println(\"\u8f6c\u8d26\u7ed9\"+account+\"\u6210\u529f\uff0c\u4ea4\u6613\u5df2\u5b8c\u6210\uff01\");\n        object.put(\"success\", true);\n        return object;\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u7684\u7f51\u7ad9\u5c31\u6210\u529f\u7528\u4e0a\u4e86\u66f4\u52a0\u5b89\u5168\u7684SpringSecurity\u6846\u67b6\u4e86\u3002\u7ec6\u5fc3\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u53d1\u73b0\u4e86\uff0c\u6211\u4eec\u5728\u914d\u7f6e\u7528\u6237\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u62a5\u4e86\u9ec4\u6807\uff0c\u5b9e\u9645\u4e0a\u8fd9\u79cd\u65b9\u5f0f\u5b58\u50a8\u5bc6\u7801\u5e76\u4e0d\u5b89\u5168\uff1a</p> <p>image-20230702151123338</p> <p>\u8fd9\u662f\u56e0\u4e3aSpringSecurity\u7684\u5bc6\u7801\u6821\u9a8c\u4e0d\u63a8\u8350\u76f4\u63a5\u4f7f\u7528\u539f\u6587\u8fdb\u884c\u6bd4\u8f83\uff0c\u800c\u662f\u4f7f\u7528\u52a0\u5bc6\u7b97\u6cd5\u5c06\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\uff08\u66f4\u51c6\u786e\u5730\u8bf4\u5e94\u8be5\u8fdb\u884cHash\u5904\u7406\uff0c\u6b64\u8fc7\u7a0b\u662f\u4e0d\u53ef\u9006\u7684\uff0c\u65e0\u6cd5\u89e3\u5bc6\uff09\uff0c\u6700\u540e\u5c06\u7528\u6237\u63d0\u4f9b\u7684\u5bc6\u7801\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u52a0\u5bc6\u540e\u4e0e\u5bc6\u6587\u8fdb\u884c\u6bd4\u8f83\u3002\u5bf9\u4e8e\u6211\u4eec\u6765\u8bf4\uff0c\u7528\u6237\u63d0\u4f9b\u7684\u5bc6\u7801\u5c5e\u4e8e\u9690\u79c1\u4fe1\u606f\uff0c\u76f4\u63a5\u660e\u6587\u5b58\u50a8\u5e76\u4e0d\u597d\uff0c\u800c\u4e14\u5982\u679c\u6570\u636e\u5e93\u5185\u5bb9\u88ab\u7a83\u53d6\uff0c\u90a3\u4e48\u6240\u6709\u7528\u6237\u7684\u5bc6\u7801\u5c06\u5168\u90e8\u6cc4\u9732\uff0c\u8fd9\u662f\u6211\u4eec\u4e0d\u5e0c\u671b\u770b\u5230\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u65e2\u80fd\u9690\u85cf\u7528\u6237\u5bc6\u7801\u4e5f\u80fd\u5b8c\u6210\u8ba4\u8bc1\u7684\u673a\u5236\uff0c\u800cHash\u5904\u7406\u5c31\u662f\u4e00\u79cd\u5f88\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u901a\u8fc7\u5c06\u7528\u6237\u7684\u5bc6\u7801\u8fdb\u884cHash\u503c\u8ba1\u7b97\uff0c\u8ba1\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u4e00\u822c\u662f\u5355\u5411\u7684\uff0c\u65e0\u6cd5\u8fd8\u539f\u4e3a\u539f\u6587\uff0c\u5982\u679c\u9700\u8981\u9a8c\u8bc1\u662f\u5426\u4e0e\u6b64\u5bc6\u7801\u4e00\u81f4\uff0c\u90a3\u4e48\u9700\u8981\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u52a0\u5bc6\u518d\u6bd4\u8f83\u4e24\u4e2aHash\u503c\u662f\u5426\u4e00\u81f4\uff0c\u8fd9\u6837\u5c31\u5f88\u597d\u7684\u4fdd\u8bc1\u4e86\u7528\u6237\u5bc6\u7801\u7684\u5b89\u5168\u6027\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u914d\u7f6e\u7528\u6237\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684BCrypt\u52a0\u5bc6\u5de5\u5177\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n      //\u8fd9\u91cc\u5c06BCryptPasswordEncoder\u76f4\u63a5\u6ce8\u518c\u4e3aBean\uff0cSecurity\u4f1a\u81ea\u52a8\u8fdb\u884c\u9009\u62e9\n    @Bean\n    public PasswordEncoder passwordEncoder(){\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public UserDetailsService userDetailsService(PasswordEncoder encoder) {\n        UserDetails user = User\n                .withUsername(\"user\")\n                .password(encoder.encode(\"password\"))   //\u8fd9\u91cc\u5c06\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u540e\u5b58\u50a8\n                .roles(\"USER\")\n                .build();\n          System.out.println(encoder.encode(\"password\"));  //\u4e00\u4f1a\u89c2\u5bdf\u4e00\u4e0b\u52a0\u5bc6\u51fa\u6765\u4e4b\u540e\u7684\u5bc6\u7801\u957f\u5565\u6837\n        UserDetails admin = User\n                .withUsername(\"admin\")\n                .password(encoder.encode(\"password\"))   //\u8fd9\u91cc\u5c06\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u540e\u5b58\u50a8\n                .roles(\"ADMIN\", \"USER\")\n                .build();\n        return new InMemoryUserDetailsManager(user, admin);\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5b58\u50a8\u7684\u5bc6\u7801\u5c31\u662f\u66f4\u52a0\u5b89\u5168\u7684\u5bc6\u7801\u4e86\uff1a</p> <p>image-20230702152150157</p> <p>image-20230702152216162</p> <p>\u8fd9\u6837\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u6743\u9650\u6821\u9a8c\u5c31\u914d\u7f6e\u5b8c\u6210\u4e86\uff0c\u662f\u4e0d\u662f\u611f\u89c9\u7528\u8d77\u6765\u8fd8\u662f\u633a\u7b80\u5355\u7684\uff1f</p> <p>\u4e0d\u8fc7\uff0c\u53ef\u80fd\u4f1a\u6709\u5c0f\u4f19\u4f34\u53d1\u73b0\uff0c\u6240\u6709\u7684POST\u8bf7\u6c42\u90fd\u88ab403\u4e86\uff1a</p> <p>image-20230702183040922</p> <p>\u8fd9\u662f\u56e0\u4e3aSpringSecurity\u81ea\u5e26\u4e86csrf\u9632\u62a4\uff0c\u9700\u6c42\u6211\u4eec\u5728POST\u8bf7\u6c42\u4e2d\u643a\u5e26\u9875\u9762\u4e2d\u7684csrfToken\u624d\u53ef\u4ee5\uff0c\u5426\u5219\u4e00\u5f8b\u8fdb\u884c\u62e6\u622a\u64cd\u4f5c\uff0c\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u5d4c\u5165\u5230\u9875\u9762\u4e2d\uff0c\u968f\u4fbf\u627e\u4e00\u4e2a\u5730\u65b9\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>&lt;input type=\"text\" th:id=\"${_csrf.getParameterName()}\" th:value=\"${_csrf.token}\" hidden&gt;\n</code></pre> <p>\u63a5\u7740\u5728axios\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u643a\u5e26\u8fd9\u4e2ainput\u7684value\u503c\uff1a</p> <pre><code>function pay() {\n    const account = document.getElementById(\"account\").value\n    const csrf = document.getElementById(\"_csrf\").value\n    axios.post('/mvc/pay', {\n        account: account,\n        _csrf: csrf   //\u643a\u5e26\u6b64\u4fe1\u606f\u5373\u53ef\uff0c\u5426\u5219\u4f1a\u88ab\u62e6\u622a\n    }, {\n      ...\n</code></pre> <p>\u5982\u679c\u540e\u7eed\u5404\u4f4d\u5c0f\u4f19\u4f34\u9047\u5230\u90a3\u79cd\u9700\u8981\u518dform\u8868\u5355\u4e2d\u63d0\u4ea4\u7684\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u50cf\u4e0b\u9762\u8fd9\u6837\u7ed9\u585e\u5230\u8868\u5355\u91cc\uff1a</p> <pre><code>&lt;form action=\"/xxxx\" method=\"post\"&gt;\n      ...\n    &lt;input type=\"text\" th:name=\"${_csrf.getParameterName()}\" th:value=\"${_csrf.token}\" hidden&gt;\n      ...\n&lt;/form&gt;\n</code></pre> <p>\u5b9e\u9645\u4e0a\u73b0\u5728\u7684\u6d4f\u89c8\u5668\u5df2\u7ecf\u5f88\u5b89\u5168\u4e86\uff0c\u5b8c\u5168\u4e0d\u9700\u8981\u4f7f\u7528\u81ea\u5e26\u7684csrf\u9632\u62a4\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u8bb2\u89e3\u5982\u4f55\u901a\u8fc7\u914d\u7f6e\u5173\u95edcsrf\u9632\u62a4\u3002\u8fd9\u91cc\u6e29\u99a8\u63d0\u9192\u4e00\u4e0b\uff0c\u5728\u540e\u7eed\u5404\u4f4d\u5c0f\u4f19\u4f34\u8ddf\u6211\u4eec\u7684\u5b9e\u6218\u9879\u76ee\u65f6\uff0c\u5982\u679c\u9047\u5230\u8bf8\u5982401\u3001403\u8fd9\u79cd\u9519\u8bef\u65f6\uff0c\u4f18\u5148\u67e5\u770b\u4f60\u7684SpringSecurity\u914d\u7f6e\u662f\u5426\u9519\u8bef\u3002</p> <p>\u4eceSpring Security 4.0\u5f00\u59cb\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u542f\u7528CSRF\u4fdd\u62a4\uff0c\u4ee5\u9632\u6b62CSRF\u653b\u51fb\u5e94\u7528\u7a0b\u5e8f\uff0cSpring Security CSRF\u4f1a\u9488\u5bf9PATCH\uff0cPOST\uff0cPUT\u548cDELETE\u65b9\u6cd5\u7684\u8bf7\u6c42\uff08\u4e0d\u4ec5\u4ec5\u53ea\u662f\u767b\u9646\u8bf7\u6c42\uff0c\u8fd9\u91cc\u6307\u7684\u662f\u4efb\u4f55\u8bf7\u6c42\u8def\u5f84\uff09\u8fdb\u884c\u9632\u62a4\uff0c\u800c\u8fd9\u91cc\u7684\u767b\u9646\u8868\u5355\u6b63\u597d\u662f\u4e00\u4e2aPOST\u7c7b\u578b\u7684\u8bf7\u6c42\u3002\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u65e0\u8bba\u662f\u5426\u767b\u9646\uff0c\u9875\u9762\u4e2d\u53ea\u8981\u53d1\u8d77\u4e86PATCH\uff0cPOST\uff0cPUT\u548cDELETE\u8bf7\u6c42\u4e00\u5b9a\u4f1a\u88ab\u62d2\u7edd\uff0c\u5e76\u8fd4\u56de403\u9519\u8bef\uff08\u6ce8\u610f\uff0c\u8fd9\u91cc\u662f\u4e2a\u7a76\u6781\u5927\u5751\uff0c\u8fd9\u4e2a\u6ca1\u6709\u4efb\u4f55\u63d0\u793a\uff0c\u76f4\u63a5403\uff0c\u56e0\u6b64\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u7684\u8bdd\u6839\u672c\u4e0d\u6e05\u695a\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u5c31\u4e00\u76f4\u5361\u8fd9\u91cc\u4e86\uff09\uff0c\u9700\u8981\u5728\u8bf7\u6c42\u7684\u65f6\u5019\u52a0\u5165csrfToken\u624d\u884c\uff0c\u4e5f\u5c31\u662f\"83421936-b84b-44e3-be47-58bb2c14571a\"\uff0c\u6b63\u662fcsrfToken\uff0c\u5982\u679c\u63d0\u4ea4\u7684\u662f\u8868\u5355\u7c7b\u578b\u7684\u6570\u636e\uff0c\u90a3\u4e48\u8868\u5355\u4e2d\u5fc5\u987b\u5305\u542b\u6b64Token\u5b57\u7b26\u4e32\uff0c\u952e\u540d\u79f0\u4e3a\"_csrf\"\uff1b\u5982\u679c\u662fJSON\u6570\u636e\u683c\u5f0f\u53d1\u9001\u7684\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5728\u8bf7\u6c42\u5934\u4e2d\u5305\u542b\u6b64Token\u5b57\u7b26\u4e32\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_6","title":"\u57fa\u4e8e\u6570\u636e\u5e93\u9a8c\u8bc1","text":"<p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u76f4\u63a5\u8ba4\u8bc1\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5b9e\u9645\u9879\u76ee\u4e2d\u5f80\u5f80\u90fd\u662f\u5c06\u7528\u6237\u4fe1\u606f\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u90a3\u4e48\u5982\u4f55\u5c06\u5176\u8fde\u63a5\u5230\u6570\u636e\u5e93\uff0c\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u7684\u7528\u6237\u4fe1\u606f\u6765\u8fdb\u884c\u7528\u6237\u767b\u5f55\u5462\uff1f</p> <p>\u5b98\u65b9\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684\u7528\u6237\u548c\u6743\u9650\u8868\u8bbe\u8ba1\uff0c\u6839\u672c\u4e0d\u9700\u8981\u6211\u4eec\u6765\u5efa\u8868\uff0c\u76f4\u63a5\u5728Navicat\u4e2d\u6267\u884c\u4ee5\u4e0b\u67e5\u8be2\uff1a</p> <pre><code>create table users(username varchar(50) not null primary key,password varchar(500) not null,enabled boolean not null);\ncreate table authorities (username varchar(50) not null,authority varchar(50) not null,constraint fk_authorities_users foreign key(username) references users(username));\ncreate unique index ix_auth_username on authorities (username,authority);\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u6dfb\u52a0Mybatis\u548cMySQL\u76f8\u5173\u7684\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;\n    &lt;version&gt;3.5.13&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;\n    &lt;version&gt;3.0.2&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n    &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n    &lt;version&gt;8.0.31&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n    &lt;version&gt;6.0.10&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u7f16\u5199\u914d\u7f6e\u7c7b\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    @Bean PasswordEncoder passwordEncoder(){\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public DataSource dataSource(){\n          //\u6570\u636e\u6e90\u914d\u7f6e\n        return new PooledDataSource(\"com.mysql.cj.jdbc.Driver\",\n                \"jdbc:mysql://localhost:3306/test\", \"root\", \"123456\");\n    }\n\n    @Bean\n    public UserDetailsService userDetailsService(DataSource dataSource,\n                                                 PasswordEncoder encoder) {\n        JdbcUserDetailsManager manager = new JdbcUserDetailsManager(dataSource);\n          //\u4ec5\u9996\u6b21\u542f\u52a8\u65f6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\u7528\u4e8e\u6d4b\u8bd5\uff0c\u540e\u7eed\u65e0\u9700\u521b\u5efa\n               manager.createUser(User.withUsername(\"user\")\n                      .password(encoder.encode(\"password\")).roles(\"USER\").build());\n        return manager;\n    }\n}\n</code></pre> <p>\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u5f20\u8868\u4e2d\u5df2\u7ecf\u81ea\u52a8\u6dfb\u52a0\u597d\u5bf9\u5e94\u7684\u6570\u636e\u4e86\uff1a</p> <p>image-20230702181131252</p> <p>image-20230702181119809</p> <p>\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c1d\u8bd5\u8fdb\u884c\u767b\u5f55\uff0c\u4f7f\u7528\u65b9\u5f0f\u548c\u4e4b\u524d\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff1a</p> <p>image-20230702181211157</p> <p>\u8fd9\u6837\uff0c\u5f53\u6211\u4eec\u4e0b\u6b21\u9700\u8981\u5feb\u901f\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u767b\u5f55\u7684\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u5c31\u80fd\u5feb\u901f\u5b8c\u6210\u4e86\uff0c\u662f\u4e0d\u662f\u611f\u89c9\u7279\u522b\u65b9\u4fbf\u3002</p> <p>\u65e0\u8bba\u662f\u6211\u4eec\u4e0a\u8282\u8bfe\u8ba4\u8bc6\u7684InMemoryUserDetailsManager\u8fd8\u662f\u73b0\u5728\u8ba4\u8bc6\u7684JdbcUserDetailsManager\uff0c\u4ed6\u4eec\u90fd\u662f\u5b9e\u73b0\u81eaUserDetailsManager\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u4e2d\u6709\u7740\u4e00\u5957\u5b8c\u6574\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u65b9\u4fbf\u6211\u4eec\u76f4\u63a5\u5bf9\u7528\u6237\u8fdb\u884c\u5904\u7406\uff1a</p> <pre><code>public interface UserDetailsManager extends UserDetailsService {\n\n  //\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\n    void createUser(UserDetails user);\n\n  //\u66f4\u65b0\u7528\u6237\u4fe1\u606f\n    void updateUser(UserDetails user);\n\n  //\u5220\u9664\u7528\u6237\n    void deleteUser(String username);\n\n  //\u4fee\u6539\u7528\u6237\u5bc6\u7801\n    void changePassword(String oldPassword, String newPassword);\n\n  //\u5224\u65ad\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7528\u6237\n    boolean userExists(String username);\n}\n</code></pre> <p>\u901a\u8fc7\u4f7f\u7528UserDetailsManager\u5bf9\u8c61\uff0c\u6211\u4eec\u5c31\u80fd\u5feb\u901f\u6267\u884c\u7528\u6237\u76f8\u5173\u7684\u7ba1\u7406\u64cd\u4f5c\uff0c\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u7f51\u7ad9\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5feb\u901f\u91cd\u7f6e\u5bc6\u7801\u7684\u63a5\u53e3\uff0c\u9996\u5148\u9700\u8981\u914d\u7f6e\u4e00\u4e0bJdbcUserDetailsManager\uff0c\u4e3a\u5176\u6dfb\u52a0\u4e00\u4e2aAuthenticationManager\u7528\u4e8e\u539f\u5bc6\u7801\u7684\u6821\u9a8c\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    ...\n\n    //\u624b\u52a8\u521b\u5efa\u4e00\u4e2aAuthenticationManager\u7528\u4e8e\u5904\u7406\u5bc6\u7801\u6821\u9a8c\n    private AuthenticationManager authenticationManager(UserDetailsManager manager,\n                                                        PasswordEncoder encoder){\n        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();\n        provider.setUserDetailsService(manager);\n        provider.setPasswordEncoder(encoder);\n        return new ProviderManager(provider);\n    }\n\n    @Bean\n    public UserDetailsManager userDetailsService(DataSource dataSource,\n                                                 PasswordEncoder encoder) throws Exception {\n        JdbcUserDetailsManager manager = new JdbcUserDetailsManager(dataSource);\n          //\u4e3aUserDetailsManager\u8bbe\u7f6eAuthenticationManager\u5373\u53ef\u5f00\u542f\u91cd\u7f6e\u5bc6\u7801\u7684\u65f6\u7684\u6821\u9a8c\n        manager.setAuthenticationManager(authenticationManager(manager, encoder));\n        return manager;\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u5feb\u901f\u91cd\u7f6e\u5bc6\u7801\u7684\u63a5\u53e3\uff1a</p> <pre><code>@ResponseBody\n@PostMapping(\"/change-password\")\npublic JSONObject changePassword(@RequestParam String oldPassword,\n                                 @RequestParam String newPassword) {\n    manager.changePassword(oldPassword, encoder.encode(newPassword));\n    JSONObject object = new JSONObject();\n    object.put(\"success\", true);\n    return object;\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5728\u4e3b\u754c\u9762\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u91cd\u7f6e\u5bc6\u7801\u7684\u64cd\u4f5c\uff1a</p> <pre><code>&lt;div&gt;\n    &lt;label&gt;\n        \u4fee\u6539\u5bc6\u7801\uff1a\n        &lt;input type=\"text\" id=\"oldPassword\" placeholder=\"\u65e7\u5bc6\u7801\"/&gt;\n        &lt;input type=\"text\" id=\"newPassword\" placeholder=\"\u65b0\u5bc6\u7801\"/&gt;\n    &lt;/label&gt;\n    &lt;button onclick=\"change()\"&gt;\u4fee\u6539\u5bc6\u7801&lt;/button&gt;\n&lt;/div&gt;\n</code></pre> <pre><code>function change() {\n    const oldPassword = document.getElementById(\"oldPassword\").value\n    const newPassword = document.getElementById(\"newPassword\").value\n    const csrf = document.getElementById(\"_csrf\").value\n    axios.post('/mvc/change-password', {\n        oldPassword: oldPassword,\n        newPassword: newPassword,\n        _csrf: csrf\n    }, {\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        }\n    }).then(({data}) =&gt; {\n        alert(data.success ? \"\u5bc6\u7801\u4fee\u6539\u6210\u529f\" : \"\u5bc6\u7801\u4fee\u6539\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u539f\u5bc6\u7801\u662f\u5426\u6b63\u786e\")\n    })\n}\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u9996\u9875\u8fdb\u884c\u4fee\u6539\u5bc6\u7801\u64cd\u4f5c\u4e86\uff1a</p> <p>image-20230703001525592</p> <p>\u5f53\u7136\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u6743\u9650\u6821\u9a8c\u867d\u7136\u80fd\u591f\u76f4\u63a5\u4f7f\u7528\u6570\u636e\u5e93\uff0c\u4f46\u662f\u5b58\u5728\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u53ea\u9002\u5408\u5feb\u901f\u642d\u5efaDemo\u4f7f\u7528\uff0c\u4e0d\u9002\u5408\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e0b\u7f16\u5199\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u4ecb\u7ecd\u5982\u4f55\u5b9e\u73b0\u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff0c\u4ee5\u5e94\u5bf9\u5404\u79cd\u60c5\u51b5\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_7","title":"\u81ea\u5b9a\u4e49\u9a8c\u8bc1","text":"<p>\u6709\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u7684\u6570\u636e\u5e93\u53ef\u80fd\u5e76\u4e0d\u4f1a\u50cfSpringSecurity\u9ed8\u8ba4\u7684\u90a3\u6837\u8fdb\u884c\u8bbe\u8ba1\uff0c\u800c\u662f\u91c7\u7528\u81ea\u5b9a\u4e49\u7684\u8868\u7ed3\u6784\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e0a\u9762\u4e24\u79cd\u65b9\u5f0f\u5c31\u5f88\u96be\u8fdb\u884c\u9a8c\u8bc1\u4e86\uff0c\u6b64\u65f6\u6211\u4eec\u5f97\u7f16\u5199\u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff0c\u6765\u5e94\u5bf9\u5404\u79cd\u4efb\u610f\u53d8\u5316\u7684\u60c5\u51b5\u3002</p> <p>\u65e2\u7136\u9700\u8981\u81ea\u5b9a\u4e49\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u81ea\u884c\u5b9e\u73b0UserDetailsService\u6216\u662f\u529f\u80fd\u66f4\u5b8c\u5584\u7684UserDetailsManager\u63a5\u53e3\uff0c\u8fd9\u91cc\u4e3a\u4e86\u7b80\u5355\uff0c\u6211\u4eec\u76f4\u63a5\u9009\u62e9\u524d\u8005\u8fdb\u884c\u5b9e\u73b0\uff1a</p> <pre><code>@Service\npublic class AuthorizeService implements UserDetailsService {\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        return null;\n    }\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u53bb\u5b9e\u73b0\u8fd9\u4e2a<code>loadUserByUsername</code>\u65b9\u6cd5\uff0c\u8868\u793a\u5728\u9a8c\u8bc1\u7684\u65f6\u5019\u901a\u8fc7\u81ea\u5b9a\u4e49\u7684\u65b9\u5f0f\uff0c\u6839\u636e\u7ed9\u5b9a\u7684\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\uff0c\u5e76\u5c01\u88c5\u4e3a<code>UserDetails</code>\u5bf9\u8c61\u8fd4\u56de\uff0c\u7136\u540e\u7531SpringSecurity\u5c06\u6211\u4eec\u8fd4\u56de\u7684\u5bf9\u8c61\u4e0e\u7528\u6237\u767b\u5f55\u7684\u4fe1\u606f\u8fdb\u884c\u6838\u9a8c\uff0c\u57fa\u672c\u6d41\u7a0b\u5b9e\u9645\u4e0a\u8ddf\u4e4b\u524d\u662f\u4e00\u6837\u7684\uff0c\u53ea\u662f\u73b0\u5728\u7531\u6211\u4eec\u81ea\u5df1\u6765\u63d0\u4f9b\u7528\u6237\u67e5\u8be2\u65b9\u5f0f\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u5728\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u7528\u6237\u8868\uff1a</p> <p>image-20230703181046326</p> <p>\u968f\u4fbf\u63d2\u5165\u4e00\u70b9\u6570\u636e\uff1a</p> <p>image-20230703152719655</p> <p>\u63a5\u7740\u6211\u4eec\u81ea\u884c\u7f16\u5199\u5bf9\u5e94\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b\uff1a</p> <pre><code>@Data\npublic class Account {\n    int id;\n    String username;\n    String password;\n}\n</code></pre> <p>\u7136\u540e\u662f\u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u7684Mapper\u63a5\u53e3\uff1a</p> <pre><code>public interface UserMapper {\n    @Select(\"select * from user where username = #{username}\")\n    Account findUserByName(String username);\n}\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u5728\u914d\u7f6e\u7c7b\u4e0a\u6dfb\u52a0\u76f8\u5e94\u7684\u5305\u626b\u63cf\uff1a</p> <pre><code>@EnableWebMvc\n@Configuration\n@ComponentScans({\n        @ComponentScan(\"com.example.controller\"),\n        @ComponentScan(\"com.example.service\")\n})\n@MapperScan(\"com.example.mapper\")\npublic class WebConfiguration implements WebMvcConfigurer {\n      ...\n}\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u6765\u5230Service\u8fd9\u8fb9\u8fdb\u884c\u4e00\u4e0b\u5b8c\u5584\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u67e5\u8be2\uff1a</p> <pre><code>@Service\npublic class AuthorizeService implements UserDetailsService {\n\n    @Resource\n    UserMapper mapper;\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        Account account = mapper.findUserByName(username);\n        if(account == null)\n            throw new UsernameNotFoundException(\"\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\");\n        return User\n                .withUsername(username)\n                .password(account.getPassword())\n                .build();\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u901a\u8fc7\u81ea\u5b9a\u4e49\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\u6570\u636e\u5e93\u4fe1\u606f\u67e5\u8be2\uff0c\u5e76\u5b8c\u6210\u7528\u6237\u767b\u5f55\u64cd\u4f5c\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_8","title":"\u5176\u4ed6\u914d\u7f6e","text":"<p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u679c\u5c06SpringSecurity\u4f5c\u4e3a\u6211\u4eec\u7684\u767b\u5f55\u6821\u9a8c\u6846\u67b6\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u4e09\u79cd\u65b9\u5f0f\u7684\u6821\u9a8c\uff0c\u4f46\u662f\u5149\u662f\u8fd9\u6837\uff0c\u81ea\u7531\u5ea6\u8fd8\u8fdc\u8fdc\u4e0d\u591f\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u8fd8\u4f1a\u9762\u5bf9\u5404\u79cd\u5404\u6837\u7684\u9700\u6c42\uff0c\u8fd9\u4e00\u90e8\u5206\u6211\u4eec\u63a5\u7740\u6765\u8fdb\u884c\u66f4\u52a0\u6df1\u5c42\u6b21\u7684\u914d\u7f6e\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_9","title":"\u81ea\u5b9a\u4e49\u767b\u5f55\u754c\u9762","text":"<p>\u867d\u7136SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8fd8\u884c\u7684\u767b\u5f55\u754c\u9762\uff0c\u4f46\u662f\u5f88\u591a\u60c5\u51b5\u4e0b\u5f80\u5f80\u90fd\u662f\u6211\u4eec\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u767b\u5f55\u754c\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u8fdb\u884c\u66f4\u591a\u7684\u914d\u7f6e\u4e86\uff0c\u6211\u4eec\u8fd8\u662f\u4ee5\u4e4b\u524d\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u4f7f\u7528\u7684\u6a21\u7248\u4e3a\u4f8b\u3002</p> <p>\u4e0b\u8f7d\u597d\u6a21\u7248\u540e\uff0c\u6211\u4eec\u5c06\u5176\u4e2d\u7684\u4e24\u4e2a\u9875\u9762\u548c\u8d44\u6e90\u6587\u4ef6\u653e\u5230\u7c7b\u8def\u5f84\u4e0b\uff1a</p> <p>image-20230703180438190</p> <p>\u63a5\u7740\u6211\u4eec\u914d\u7f6e\u5bf9\u5e94\u9875\u9762\u7684Controller\u63a7\u5236\u5668\uff1a</p> <pre><code>@Controller\npublic class HelloController {\n    @GetMapping(\"/\")\n    public String index(){\n        return \"index\";\n    }\n\n    @GetMapping(\"/login\")\n    public String login(){\n        return \"login\";\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5728\u767b\u5f55\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5c55\u793a\u524d\u7aef\u6a21\u7248\u9875\u9762\u4e86\uff1a</p> <p>image-20230703182321093</p> <p>\u4e0d\u8fc7\u73b0\u5728\u4f9d\u7136\u662f\u9ed8\u8ba4\u8fdb\u5165\u5230SpringSecurity\u9ed8\u8ba4\u7684\u767b\u5f55\u754c\u9762\uff0c\u73b0\u5728\u6211\u4eec\u6765\u914d\u7f6e\u81ea\u5b9a\u4e49\u7684\u767b\u5f55\u754c\u9762\uff0c\u5c06\u6211\u4eec\u7684\u524d\u7aef\u6a21\u7248\u4e2d\u7684\u767b\u5f55\u9875\u9762\u4f5c\u4e3aSpringSecurity\u7684\u9ed8\u8ba4\u767b\u5f55\u754c\u9762\u3002</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n      ...\n\n        //\u5982\u679c\u4f60\u5b66\u4e60\u8fc7SpringSecurity 5.X\u7248\u672c\uff0c\u53ef\u80fd\u4f1a\u53d1\u73b0\u65b0\u7248\u672c\u7684\u914d\u7f6e\u65b9\u5f0f\u5b8c\u5168\u4e0d\u4e00\u6837\n    //\u65b0\u7248\u672c\u5168\u90e8\u91c7\u7528lambda\u5f62\u5f0f\u8fdb\u884c\u914d\u7f6e\uff0c\u65e0\u6cd5\u518d\u4f7f\u7528\u4e4b\u524d\u7684and()\u65b9\u6cd5\u8fdb\u884c\u8fde\u63a5\u4e86\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        return http\n                //\u4ee5\u4e0b\u662f\u9a8c\u8bc1\u8bf7\u6c42\u62e6\u622a\u548c\u653e\u884c\u914d\u7f6e\n                .authorizeHttpRequests(auth -&gt; {\n                    auth.anyRequest().authenticated();    //\u5c06\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u62e6\u622a\uff0c\u4e00\u5f8b\u9700\u8981\u9a8c\u8bc1\n                })\n                //\u4ee5\u4e0b\u662f\u8868\u5355\u767b\u5f55\u76f8\u5173\u914d\u7f6e\n                .formLogin(conf -&gt; {\n                    conf.loginPage(\"/login\");   //\u5c06\u767b\u5f55\u9875\u8bbe\u7f6e\u4e3a\u6211\u4eec\u81ea\u5df1\u7684\u767b\u5f55\u9875\u9762\n                    conf.loginProcessingUrl(\"/doLogin\"); //\u767b\u5f55\u8868\u5355\u63d0\u4ea4\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\n                    conf.defaultSuccessUrl(\"/\");   //\u767b\u5f55\u6210\u529f\u540e\u8df3\u8f6c\u7684\u9875\u9762\n                    conf.permitAll();    //\u5c06\u767b\u5f55\u76f8\u5173\u7684\u5730\u5740\u653e\u884c\uff0c\u5426\u5219\u672a\u767b\u5f55\u7684\u7528\u6237\u8fde\u767b\u5f55\u754c\u9762\u90fd\u8fdb\u4e0d\u53bb\n                      //\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u8868\u5355\u5b57\u6bb5\u540d\u79f0\uff0c\u4e0d\u8fc7\u9ed8\u8ba4\u5c31\u662f\u8fd9\u4e2a\uff0c\u53ef\u4ee5\u4e0d\u914d\u7f6e\uff0c\u9664\u975e\u6709\u7279\u6b8a\u9700\u6c42\n                    conf.usernameParameter(\"username\");\n                    conf.passwordParameter(\"password\");\n                })\n                .build();\n    }\n}\n</code></pre> <p>\u9700\u8981\u914d\u7f6e\u767b\u9646\u9875\u9762\u7684\u5730\u5740\u548c\u767b\u9646\u8bf7\u6c42\u53d1\u9001\u7684\u5730\u5740\uff0c\u8fd9\u91cc\u767b\u9646\u9875\u9762\u586b\u5199\u4e3a<code>/login</code>\uff0c\u767b\u9646\u8bf7\u6c42\u5730\u5740\u4e3a<code>/doLogin</code>\uff0c\u767b\u9646\u9875\u9762\u6211\u4eec\u521a\u521a\u5df2\u7ecf\u81ea\u5df1\u7f16\u5199Controller\u6765\u5b9e\u73b0\u4e86\uff0c\u767b\u9646\u8bf7\u6c42\u63d0\u4ea4\u5904\u7406\u7531SpringSecurity\u63d0\u4f9b\uff0c\u53ea\u9700\u8981\u5199\u8def\u5f84\u5c31\u53ef\u4ee5\u4e86\u3002\u73b0\u5728\u8bbf\u95ee\u6211\u4eec\u7684\u7f51\u7ad9\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u5230\u81ea\u5b9a\u4e49\u7684\u767b\u5f55\u754c\u9762\u4e86\uff1a</p> <p>image-20230703184425313</p> <p>\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u7684\u9875\u9762\u53ea\u6709\u4e00\u4e2a\u7eaf\u6587\u672c\uff0c\u8fd9\u662f\u56e0\u4e3a\u5728\u83b7\u53d6\u9759\u6001\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u6240\u6709\u7684\u9759\u6001\u8d44\u6e90\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e5f\u4f1a\u88ab\u62e6\u622a\uff0c\u56e0\u6b64\u5168\u90e8\u88ab302\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762\uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u5bf9\u7684\uff1a</p> <p>image-20230703184641792</p> <p>\u56e0\u6b64\uff0c\u73b0\u5728\u6211\u4eec\u9700\u8981\u5c06\u6240\u6709\u7684\u9759\u6001\u8d44\u6e90\u4e5f\u7ed9\u653e\u884c\uff0c\u5426\u5219\u767b\u5f55\u754c\u9762\u90fd\u6ca1\u6cd5\u6b63\u5e38\u5c55\u793a\uff1a</p> <pre><code>.authorizeHttpRequests(auth -&gt; {\n      auth.requestMatchers(\"/static/**\").permitAll();   //\u5c06\u6240\u6709\u7684\u9759\u6001\u8d44\u6e90\u653e\u884c\uff0c\u4e00\u5b9a\u8981\u6dfb\u52a0\u5728\u5168\u90e8\u8bf7\u6c42\u62e6\u622a\u4e4b\u524d\n      auth.anyRequest().authenticated();    //\u5c06\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u62e6\u622a\uff0c\u4e00\u5f8b\u9700\u8981\u9a8c\u8bc1\n})\n</code></pre> <p>\u518d\u6b21\u8bbf\u95ee\u6211\u4eec\u7684\u7f51\u7ad9\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u6b63\u5e38\u663e\u793a\u7684\u767b\u5f55\u754c\u9762\u4e86\uff1a</p> <p>image-20230703185027927</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u5404\u4f4d\u5c0f\u4f19\u4f34\u540e\u7eed\u5728\u7f16\u5199\u9879\u76ee\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u6709302\u7684\u60c5\u51b5\uff0c\u4e00\u5b9a\u8981\u5148\u68c0\u67e5\u662f\u5426\u56e0\u4e3a\u6ca1\u6709\u653e\u884c\u5bfc\u81f4\u88abSpringSecurity\u7ed9\u62e6\u622a\u4e86\uff0c\u522b\u518d\u9047\u5230302\u4e00\u8138\u61f5\u903c\u4e86\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u6765\u914d\u7f6e\u767b\u5f55\u64cd\u4f5c\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u914d\u7f6e\u4e00\u4e0b\u767b\u5f55\u7684\u5730\u5740\u548c\u767b\u5f55\u6309\u94ae\u5373\u53ef\uff0c\u5f53\u7136\uff0c\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u8981\u628aCSRF\u7684\u8f93\u5165\u6846\u4e5f\u52a0\u4e0a\uff1a</p> <pre><code>&lt;form action=\"doLogin\" method=\"post\"&gt;\n        ...\n  &lt;input type=\"text\" name=\"username\" placeholder=\"Email Address\" class=\"ad-input\"&gt;\n  ...\n  &lt;input type=\"password\" name=\"password\" placeholder=\"Password\" class=\"ad-input\"&gt;\n  ...\n  &lt;input type=\"text\" th:name=\"${_csrf.getParameterName()}\" th:value=\"${_csrf.token}\" hidden&gt;\n  &lt;div class=\"ad-auth-btn\"&gt;\n     &lt;button type=\"submit\" class=\"ad-btn ad-login-member\"&gt;Login&lt;/button&gt;\n  &lt;/div&gt;\n    ...\n&lt;/form&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\u4e86\uff1a</p> <p>image-20230703185916404</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u6210\u529f\u5730\u767b\u5f55\u5230\u4e3b\u9875\u4e86\u3002</p> <p>\u9000\u51fa\u767b\u5f55\u4e5f\u662f\u540c\u6837\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7a0d\u5fae\u8fdb\u884c\u4e00\u4e0b\u914d\u7f6e\u5c31\u53ef\u4ee5\u5b9e\u73b0\uff0c\u6211\u4eec\u9996\u5148\u7ee7\u7eed\u5b8c\u5584\u914d\u7f6e\u7c7b\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    ...\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        return http\n                ...\n                //\u4ee5\u4e0b\u662f\u9000\u51fa\u767b\u5f55\u76f8\u5173\u914d\u7f6e\n                .logout(conf -&gt; {\n                    conf.logoutUrl(\"/doLogout\");   //\u9000\u51fa\u767b\u5f55\u5730\u5740\uff0c\u8ddf\u4e0a\u9762\u4e00\u6837\u53ef\u81ea\u5b9a\u4e49\n                    conf.logoutSuccessUrl(\"/login\");  //\u9000\u51fa\u767b\u5f55\u6210\u529f\u540e\u8df3\u8f6c\u7684\u5730\u5740\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e3a\u767b\u5f55\u754c\u9762\n                    conf.permitAll();\n                })\n                .build();\n    }\n}\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u6765\u7a0d\u5fae\u9b54\u6539\u4e00\u4e0b\u9875\u9762\u4e2d\u7684\u9000\u51fa\u767b\u5f55\u6309\u94ae\uff1a</p> <pre><code>&lt;li&gt;\n   &lt;form action=\"doLogout\" method=\"post\"&gt;\n        &lt;input type=\"text\" th:name=\"${_csrf.getParameterName()}\" th:value=\"${_csrf.token}\" hidden&gt;\n        &lt;button type=\"submit\"&gt;\n           &lt;i class=\"fas fa-sign-out-alt\"&gt;&lt;/i&gt; logout\n        &lt;/button&gt;\n   &lt;/form&gt;\n&lt;/li&gt;\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u9000\u51fa\u6309\u94ae\u5c31\u53ef\u4ee5\u9000\u51fa\u4e86\uff1a</p> <p>image-20230703190714519</p> <p>\u4e0d\u8fc7\uff0c\u53ef\u80fd\u4f1a\u6709\u5c0f\u4f19\u4f34\u89c9\u5f97\uff0c\u6211\u4eec\u73b0\u5728\u65e0\u8bba\u63d0\u4ea4\u4ec0\u4e48\u8bf7\u6c42\u90fd\u9700\u8981Csrf\u6821\u9a8c\uff0c\u6709\u4e9b\u592a\u9ebb\u70e6\u4e86\uff0c\u5b9e\u9645\u4e0a\u73b0\u5728\u6d4f\u89c8\u5668\u5df2\u7ecf\u5f88\u5b89\u5168\u4e86\uff0c\u6ca1\u5fc5\u8981\u9632\u5fa1\u5230\u8fd9\u79cd\u7a0b\u5ea6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u4e2d\u5173\u95edcsrf\u6821\u9a8c\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n       ...\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        return http\n                ...\n                //\u4ee5\u4e0b\u662fcsrf\u76f8\u5173\u914d\u7f6e\n                .csrf(conf -&gt; {\n                    conf.disable();   //\u6b64\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u5173\u95ed\u5168\u90e8\u7684csrf\u6821\u9a8c\uff0c\u4e00\u6b65\u5230\u4f4d\n                    conf.ignoringRequestMatchers(\"/xxx/**\");   //\u6b64\u65b9\u6cd5\u53ef\u4ee5\u6839\u636e\u60c5\u51b5\u5ffd\u7565\u67d0\u4e9b\u5730\u5740\u7684csrf\u6821\u9a8c\n                })\n                .build();\n    }\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u518d\u5f80\u9875\u9762\u4e2d\u5d4c\u5165CSRF\u76f8\u5173\u7684\u8f93\u5165\u6846\u4e86\uff0c\u53d1\u9001\u8bf7\u6c42\u65f6\u4e5f\u4e0d\u4f1a\u8fdb\u884c\u6821\u9a8c\uff0c\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u7b80\u5355\u7684\u81ea\u5b9a\u4e49\u767b\u5f55\u754c\u9762\u914d\u7f6e\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_10","title":"\u8bb0\u4f4f\u6211\u529f\u80fd","text":"<p>\u6211\u4eec\u7684\u7f51\u7ad9\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u529f\u80fd\uff0c\u5c31\u662f\u8bb0\u4f4f\u6211\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646\u4e4b\u540e\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u65e0\u9700\u518d\u6b21\u8f93\u5165\u8d26\u53f7\u548c\u5bc6\u7801\u8fdb\u884c\u767b\u9646\uff0c\u76f8\u5f53\u4e8e\u670d\u52a1\u7aef\u5df2\u7ecf\u8bb0\u4f4f\u5f53\u524d\u7528\u6237\uff0c\u518d\u6b21\u8bbf\u95ee\u65f6\u5c31\u53ef\u4ee5\u514d\u767b\u9646\u8fdb\u5165\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u7528\u7684\u529f\u80fd\u3002</p> <p>\u6211\u4eec\u4e4b\u524d\u5728JavaWeb\u9636\u6bb5\uff0c\u4f7f\u7528\u672c\u5730Cookie\u5b58\u50a8\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\u8bb0\u4f4f\u6211\u529f\u80fd\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u5b89\u5168\uff0c\u540c\u65f6\u5728\u4ee3\u7801\u7f16\u5199\u4e0a\u4e5f\u6bd4\u8f83\u9ebb\u70e6\uff0c\u90a3\u4e48\u80fd\u5426\u6709\u4e00\u79cd\u66f4\u52a0\u9ad8\u6548\u7684\u8bb0\u4f4f\u6211\u529f\u80fd\u5b9e\u73b0\u5462\uff1f</p> <p>SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u4f18\u79c0\u7684\u5b9e\u73b0\uff0c\u5b83\u4e3a\u6bcf\u4e2a\u5df2\u7ecf\u767b\u9646\u7684\u6d4f\u89c8\u5668\u5206\u914d\u4e00\u4e2a\u643a\u5e26Token\u7684Cookie\uff0c\u5e76\u4e14\u6b64Cookie\u9ed8\u8ba4\u4f1a\u88ab\u4fdd\u755914\u5929\uff0c\u53ea\u8981\u6211\u4eec\u4e0d\u6e05\u7406\u6d4f\u89c8\u5668\u7684Cookie\uff0c\u90a3\u4e48\u4e0b\u6b21\u643a\u5e26\u6b64Cookie\u8bbf\u95ee\u670d\u52a1\u5668\u5c06\u65e0\u9700\u767b\u9646\uff0c\u76f4\u63a5\u7ee7\u7eed\u4f7f\u7528\u4e4b\u524d\u767b\u9646\u7684\u8eab\u4efd\uff0c\u8fd9\u6837\u663e\u7136\u6bd4\u6211\u4eec\u4e4b\u524d\u7684\u5199\u6cd5\u66f4\u52a0\u7b80\u4fbf\u3002\u5e76\u4e14\u6211\u4eec\u9700\u8981\u8fdb\u884c\u7b80\u5355\u914d\u7f6e\uff0c\u5373\u53ef\u5f00\u542f\u8bb0\u4f4f\u6211\u529f\u80fd\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    ...\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        return http\n                ...\n                .rememberMe(conf -&gt; {\n                    conf.alwaysRemember(false);  //\u8fd9\u91cc\u4e0d\u8981\u5f00\u542f\u59cb\u7ec8\u8bb0\u4f4f\uff0c\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e3a\u7528\u6237\u81ea\u884c\u52fe\u9009\n                    conf.rememberMeParameter(\"remember-me\");   //\u8bb0\u4f4f\u6211\u8868\u5355\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u5c31\u662f\u8fd9\u4e2a\uff0c\u53ef\u4ee5\u4e0d\u914d\u7f6e\n                    conf.rememberMeCookieName(\"xxxx\");  //\u8bb0\u4f4f\u6211\u8bbe\u7f6e\u7684Cookie\u540d\u5b57\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u4e0d\u8fc7\u6ca1\u5fc5\u8981\n                })\n                .build();\n    }\n}\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u524d\u7aef\u9875\u9762\u4e2d\u7684\u8868\u5355\uff0c\u5c06\u8bb0\u4f4f\u6211\u52fe\u9009\u6846\u4e5f\u4f5c\u4e3a\u8868\u5355\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u63d0\u4ea4\uff1a</p> <pre><code>&lt;div class=\"ad-checkbox\"&gt;\n    &lt;label&gt;\n        &lt;input type=\"checkbox\" name=\"remember-me\" class=\"ad-checkbox\"&gt;\n        &lt;span&gt;Remember Me&lt;/span&gt;\n    &lt;/label&gt;\n&lt;/div&gt;\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u6765\u5c1d\u8bd5\u52fe\u9009\u8bb0\u4f4f\u6211\u9009\u9879\u8fdb\u884c\u767b\u5f55\uff1a</p> <p>image-20230704211415804</p> <p>\u6b64\u65f6\u63d0\u4ea4\u7684\u8868\u5355\u4e2d\u5c31\u5df2\u7ecf\u5305\u542b\u8bb0\u4f4f\u6211\u5b57\u6bb5\u4e86\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u7ed9\u6211\u4eec\u4e86\u4e00\u4e2a\u8bb0\u4f4f\u6211\u4e13\u5c5e\u7684Cookie\u4fe1\u606f\uff1a</p> <p>image-20230704211611369</p> <p>\u8fd9\u4e2aCookie\u4fe1\u606f\u7684\u8fc7\u671f\u65f6\u95f4\u5e76\u4e0d\u662f\u4ec5\u4f1a\u8bdd\uff0c\u800c\u662f\u9ed8\u8ba4\u4fdd\u5b58\u4e00\u6bb5\u65f6\u95f4\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u5173\u95ed\u6d4f\u89c8\u5668\u540e\u4e0b\u6b21\u518d\u6b21\u8bbf\u95ee\u7f51\u7ad9\u65f6\uff0c\u5c31\u4e0d\u9700\u8981\u6211\u4eec\u518d\u6b21\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\u4e86\uff0c\u800c\u662f\u76f4\u63a5\u7ee7\u7eed\u4e0a\u4e00\u6b21\u7684\u767b\u5f55\u72b6\u6001\u3002</p> <p>\u5f53\u7136\uff0c\u7531\u4e8e\u8bb0\u4f4f\u6211\u4fe1\u606f\u662f\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u670d\u52a1\u5668\u4e00\u76f4\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\uff0c\u5982\u679c\u5173\u95ed\u670d\u52a1\u5668\u7684\u8bdd\uff0c\u8bb0\u4f4f\u6211\u4fe1\u606f\u4f1a\u5168\u90e8\u4e22\u5931\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u8bb0\u4f4f\u6211\u80fd\u591f\u4e00\u76f4\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8fdb\u4e00\u6b65\u8fdb\u884c\u914d\u7f6e\u3002\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8eJDBC\u7684TokenRepository\u5b9e\u73b0\uff1a</p> <pre><code>@Bean\npublic PersistentTokenRepository tokenRepository(DataSource dataSource){\n    JdbcTokenRepositoryImpl repository = new JdbcTokenRepositoryImpl();\n      //\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u5728\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u5b58\u50a8\u8bb0\u4f4f\u6211\u4fe1\u606f\u7684\u8868\uff0c\u4ec5\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u4e0d\u9700\u8981\n    repository.setCreateTableOnStartup(true);\n    repository.setDataSource(dataSource);\n    return repository;\n}\n</code></pre> <p>\u7136\u540e\u6dfb\u52a0\u6b64\u4ed3\u5e93\uff1a</p> <pre><code>.rememberMe(conf -&gt; {\n     conf.rememberMeParameter(\"remember-me\");\n     conf.tokenRepository(repository);      //\u8bbe\u7f6e\u521a\u521a\u7684\u8bb0\u4f4f\u6211\u6301\u4e45\u5316\u5b58\u50a8\u5e93\n     conf.tokenValiditySeconds(3600 * 7);   //\u8bbe\u7f6e\u8bb0\u4f4f\u6211\u6709\u6548\u65f6\u95f4\u4e3a7\u5929\n})\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u6210\u529f\u914d\u7f6e\u4e86\u6570\u636e\u5e93\u6301\u4e45\u5316\u5b58\u50a8\u8bb0\u4f4f\u6211\u4fe1\u606f\uff0c\u5373\u4f7f\u6211\u4eec\u91cd\u542f\u670d\u52a1\u5668\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002\u5f53\u6211\u4eec\u767b\u5f55\u4e4b\u540e\uff0c\u6570\u636e\u5e93\u4e2d\u4f1a\u81ea\u52a8\u8bb0\u5f55\u76f8\u5173\u7684\u4fe1\u606f\uff1a</p> <p>image-20230704220701000</p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u7f51\u7ad9\u7684\u767b\u5f55\u7cfb\u7edf\u5c31\u66f4\u52a0\u5b8c\u5584\u4e86\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_11","title":"\u6388\u6743","text":"<p>\u7528\u6237\u767b\u5f55\u540e\uff0c\u53ef\u80fd\u4f1a\u6839\u636e\u7528\u6237\u5f53\u524d\u662f\u8eab\u4efd\u8fdb\u884c\u89d2\u8272\u5212\u5206\uff0c\u6bd4\u5982\u6211\u4eec\u6700\u5e38\u7528\u7684QQ\uff0c\u4e00\u4e2aQQ\u7fa4\u91cc\u9762\uff0c\u6709\u7fa4\u4e3b\u3001\u7ba1\u7406\u5458\u548c\u666e\u901a\u7fa4\u6210\u5458\u4e09\u79cd\u89d2\u8272\uff0c\u5176\u4e2d\u7fa4\u4e3b\u5177\u6709\u6700\u9ad8\u6743\u9650\uff0c\u7fa4\u4e3b\u53ef\u4ee5\u7ba1\u7406\u6574\u4e2a\u7fa4\u7684\u4efb\u4f55\u677f\u5757\uff0c\u5e76\u4e14\u5177\u6709\u89e3\u6563\u548c\u5347\u7ea7\u7fa4\u7684\u8d44\u683c\uff0c\u800c\u7ba1\u7406\u5458\u53ea\u6709\u7fa4\u4e3b\u7684\u4e00\u90e8\u5206\u6743\u9650\uff0c\u53ea\u80fd\u7528\u4e8e\u65e5\u5e38\u7ba1\u7406\uff0c\u666e\u901a\u7fa4\u6210\u5458\u5219\u53ea\u80fd\u8fdb\u884c\u6700\u57fa\u672c\u7684\u804a\u5929\u64cd\u4f5c\u3002</p> <p>image-20230704222032360</p> <p>\u5bf9\u4e8e\u6211\u4eec\u6765\u8bf4\uff0c\u7528\u6237\u7684\u4e00\u4e2a\u64cd\u4f5c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u8bbf\u95ee\u6211\u4eec\u63d0\u4f9b\u7684<code>\u63a5\u53e3</code>(\u7f16\u5199\u7684\u5bf9\u5e94\u8bbf\u95ee\u8def\u5f84\u7684Servlet\uff09\uff0c\u6bd4\u5982\u767b\u9646\uff0c\u5c31\u9700\u8981\u8c03\u7528<code>/login</code>\u63a5\u53e3\uff0c\u9000\u51fa\u767b\u9646\u5c31\u8981\u8c03\u7528/<code>logout</code>\u63a5\u53e3\uff0c\u800c\u6211\u4eec\u4e4b\u524d\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u65b0\u589e\u56fe\u4e66\u3001\u5220\u9664\u56fe\u4e66\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u6709\u7740\u5bf9\u5e94\u7684Servlet\u6765\u8fdb\u884c\u5904\u7406\u3002\u56e0\u6b64\uff0c\u4ece\u6211\u4eec\u5f00\u53d1\u8005\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u51b3\u5b9a\u7528\u6237\u80fd\u5426\u4f7f\u7528\u67d0\u4e2a\u529f\u80fd\uff0c\u53ea\u9700\u8981\u51b3\u5b9a\u7528\u6237\u662f\u5426\u80fd\u591f\u8bbf\u95ee\u5bf9\u5e94\u7684Servlet\u5373\u53ef\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u50cf\u4e0b\u9762\u8fd9\u6837\u8fdb\u884c\u5212\u5206\uff1a</p> <ul> <li>\u7fa4\u4e3b\uff1a<code>/login</code>\u3001<code>/logout</code>\u3001<code>/chat</code>\u3001<code>/edit</code>\u3001<code>/delete</code>\u3001<code>/upgrade</code></li> <li>\u7ba1\u7406\u5458\uff1a<code>/login</code>\u3001<code>/logout</code>\u3001<code>/chat</code>\u3001<code>/edit</code></li> <li>\u666e\u901a\u7fa4\u6210\u5458\uff1a<code>/login</code>\u3001<code>/logout</code>\u3001<code>/chat</code></li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u5c31\u662f\u6307\u5b9a\u54ea\u4e9b\u8bf7\u6c42\u53ef\u4ee5\u7531\u54ea\u4e9b\u7528\u6237\u53d1\u8d77\u3002</p> <p>SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e24\u79cd\u6388\u6743\u65b9\u5f0f\uff1a</p> <ul> <li>\u57fa\u4e8e\u6743\u9650\u7684\u6388\u6743\uff1a\u53ea\u8981\u62e5\u6709\u67d0\u6743\u9650\u7684\u7528\u6237\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u67d0\u4e2a\u8def\u5f84\u3002</li> <li>\u57fa\u4e8e\u89d2\u8272\u7684\u6388\u6743\uff1a\u6839\u636e\u7528\u6237\u5c5e\u4e8e\u54ea\u4e2a\u89d2\u8272\u6765\u51b3\u5b9a\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee\u67d0\u4e2a\u8def\u5f84\u3002</li> </ul> <p>\u4e24\u8005\u53ea\u662f\u6982\u5ff5\u4e0a\u7684\u4e0d\u540c\uff0c\u5b9e\u9645\u4e0a\u4f7f\u7528\u8d77\u6765\u6548\u679c\u5dee\u4e0d\u591a\u3002\u8fd9\u91cc\u6211\u4eec\u5c31\u5148\u6f14\u793a\u4ee5\u89d2\u8272\u65b9\u5f0f\u6765\u8fdb\u884c\u6388\u6743\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_12","title":"\u57fa\u4e8e\u89d2\u8272\u6388\u6743","text":"<p>\u73b0\u5728\u6211\u4eec\u5e0c\u671b\u521b\u5efa\u4e24\u4e2a\u89d2\u8272\uff0c\u666e\u901a\u7528\u6237\u548c\u7ba1\u7406\u5458\uff0c\u666e\u901a\u7528\u6237\u53ea\u80fd\u8bbf\u95eeindex\u9875\u9762\uff0c\u800c\u7ba1\u7406\u5458\u53ef\u4ee5\u8bbf\u95ee\u4efb\u4f55\u9875\u9762\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u89d2\u8272\u8868\u8fdb\u884c\u4e00\u4e9b\u4fee\u6539\uff0c\u6dfb\u52a0\u4e00\u4e2a\u7528\u6237\u89d2\u8272\u5b57\u6bb5\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\uff0cTest\u7528\u6237\u7684\u89d2\u8272\u4e3auser\uff0c\u800cAdmin\u7528\u6237\u7684\u89d2\u8272\u4e3aadmin\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u914d\u7f6eSpringSecurity\uff0c\u51b3\u5b9a\u54ea\u4e9b\u89d2\u8272\u53ef\u4ee5\u8bbf\u95ee\u54ea\u4e9b\u9875\u9762\uff1a</p> <pre><code>.authorizeHttpRequests(auth -&gt; {\n    //\u9759\u6001\u8d44\u6e90\u4f9d\u7136\u5168\u90e8\u53ef\u4ee5\u8bbf\u95ee\n    auth.requestMatchers(\"/static/**\").permitAll();\n    //\u53ea\u6709\u5177\u6709\u4ee5\u4e0b\u89d2\u8272\u7684\u7528\u6237\u624d\u80fd\u8bbf\u95ee\u8def\u5f84\"/\"\n    auth.requestMatchers(\"/\").hasAnyRole(\"user\", \"admin\");\n    //\u5176\u4ed6\u6240\u6709\u8def\u5f84\u5fc5\u987b\u89d2\u8272\u4e3aadmin\u624d\u80fd\u8bbf\u95ee\n    auth.anyRequest().hasRole(\"admin\");\n})\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u9700\u8981\u7a0d\u5fae\u4fee\u6539\u4e00\u4e0b\u9a8c\u8bc1\u903b\u8f91\uff0c\u6211\u4eec\u5728\u6570\u636e\u5e93\u4e2d\u7684\u7528\u6237\u8868\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u5b57\u6bb5\uff0c\u7528\u4e8e\u8868\u793a\u89d2\u8272\uff1a</p> <p>image-20230704222733082</p> <p>\u4fee\u6539\u4e00\u4e0b\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b\uff1a</p> <pre><code>@Data\npublic class Account {\n    int id;\n    String username;\n    String password;\n    String role;\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5728\u67e5\u8be2\u7528\u6237\u65f6\uff0c\u9700\u8981\u6dfb\u52a0\u5176\u5bf9\u5e94\u7684\u89d2\u8272\uff1a</p> <pre><code> @Override\npublic UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n    Account account = mapper.findUserByName(username);\n    if(account == null)\n        throw new UsernameNotFoundException(\"\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\");\n    return User\n            .withUsername(username)\n            .password(account.getPassword())\n            .roles(account.getRole())   //\u6dfb\u52a0\u89d2\u8272\uff0c\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u89d2\u8272\n            .build();\n}\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u6211\u4eec\u91cd\u542f\u670d\u52a1\u5668\u767b\u5f55\u770b\u770b\uff1a</p> <p>image-20230703182321093</p> <p>\u76ee\u524d\u4f9d\u7136\u662f\u53ef\u4ee5\u6b63\u5e38\u767b\u5f55\u7684\uff0c\u4f46\u662f\u6211\u4eec\u968f\u4fbf\u8bbf\u95ee\u4e00\u4e2a\u5176\u4ed6\u7684\u9875\u9762\uff0c\u5c31\u4f1a\u88ab\u62e6\u622a\u5e76\u81ea\u52a8\u9000\u56de\u5230\u767b\u5f55\u754c\u9762\uff1a</p> <p>image-20230704223248124</p> <p>\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u524d\u9762\u914d\u7f6e\u7684\u662fuser\u89d2\u8272\uff0c\u90a3\u4e48\u8fd9\u4e2a\u89d2\u8272\u53ea\u80fd\u8bbf\u95ee\u9996\u9875\uff0c\u5176\u4ed6\u7684\u90fd\u4e0d\u884c\uff0c\u6240\u4ee5\u5c31\u4f1a\u88ab\u81ea\u52a8\u62e6\u622a\u6389\u4e86\u3002\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5230\u6570\u636e\u5e93\u4e2d\u5bf9\u8fd9\u4e2a\u7528\u6237\u7684\u89d2\u8272\u8fdb\u884c\u4fee\u6539\uff0c\u770b\u770b\u4fee\u6539\u540e\u662f\u5426\u80fd\u591f\u8bbf\u95ee\u5230\u5176\u4ed6\u9875\u9762\uff1a</p> <p>image-20230704223503682</p> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6\u9875\u9762\u4e0d\u4f1a\u88ab\u62e6\u622a\u4e86\uff0c\u4e0d\u8fc7\u56e0\u4e3a\u6211\u4eec\u6ca1\u914d\u7f6e\u8fd9\u4e2a\u8def\u5f84\uff0c\u6240\u4ee5\u51fa\u6765\u7684\u662f404\u9875\u9762\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528\u89d2\u8272\u63a7\u5236\u9875\u9762\u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba9\u67d0\u4e9b\u7528\u6237\u53ea\u80fd\u8bbf\u95ee\u90e8\u5206\u9875\u9762\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_13","title":"\u57fa\u4e8e\u6743\u9650\u6388\u6743","text":"<p>\u57fa\u4e8e\u6743\u9650\u7684\u6388\u6743\u4e0e\u89d2\u8272\u7c7b\u4f3c\uff0c\u9700\u8981\u4ee5<code>hasAnyAuthority</code>\u6216<code>hasAuthority</code>\u8fdb\u884c\u5224\u65ad\uff1a</p> <pre><code>.authorizeHttpRequests(auth -&gt; {\n    //\u9759\u6001\u8d44\u6e90\u4f9d\u7136\u5168\u90e8\u53ef\u4ee5\u8bbf\u95ee\n    auth.requestMatchers(\"/static/**\").permitAll();\n    //\u57fa\u4e8e\u6743\u9650\u548c\u57fa\u4e8e\u89d2\u8272\u5176\u5b9e\u5dee\u522b\u5e76\u4e0d\u5927\uff0c\u4f7f\u7528\u65b9\u5f0f\u662f\u76f8\u540c\u7684\n    auth.anyRequest().hasAnyAuthority(\"page:index\");\n})\n</code></pre> <p>\u5b9e\u9645\u4e0a\u6743\u9650\u8ddf\u89d2\u8272\u76f8\u6bd4\u53ea\u662f\u7c92\u5ea6\u66f4\u7ec6\uff0c\u7531\u4e8e\u4f7f\u7528\u65b9\u5f0f\u5dee\u4e0d\u591a\uff0c\u8fd9\u91cc\u4e0d\u591a\u505a\u9610\u8ff0\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_14","title":"\u4f7f\u7528\u6ce8\u89e3\u6743\u9650\u5224\u65ad","text":"<p>\u9664\u4e86\u76f4\u63a5\u914d\u7f6e\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4ee5\u6ce8\u89e3\u5f62\u5f0f\u76f4\u63a5\u914d\u7f6e\uff0c\u9996\u5148\u9700\u8981\u5728\u914d\u7f6e\u7c7b\uff08\u6ce8\u610f\u8fd9\u91cc\u662f\u5728Mvc\u7684\u914d\u7f6e\u7c7b\u4e0a\u6dfb\u52a0\uff0c\u56e0\u4e3a\u8fd9\u91cc\u53ea\u9488\u5bf9Controller\u8fdb\u884c\u8fc7\u6ee4\uff0c\u6240\u6709\u7684Controller\u662f\u7531Mvc\u914d\u7f6e\u7c7b\u8fdb\u884c\u6ce8\u518c\u7684\uff0c\u5982\u679c\u9700\u8981\u4e3aService\u6216\u5176\u4ed6Bean\u4e5f\u542f\u7528\u6743\u9650\u5224\u65ad\uff0c\u5219\u9700\u8981\u5728Security\u7684\u914d\u7f6e\u7c7b\u4e0a\u6dfb\u52a0\uff09\u4e0a\u5f00\u542f\uff1a</p> <pre><code>@Configuration\n@EnableWebSecurity\n@EnableMethodSecurity   //\u5f00\u542f\u65b9\u6cd5\u5b89\u5168\u6821\u9a8c\npublic class SecurityConfiguration {\n    ...\n}\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u6211\u4eec\u60f3\u8981\u8fdb\u884c\u6743\u9650\u6821\u9a8c\u7684\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u6ce8\u89e3\u4e86\uff1a</p> <pre><code>@Controller\npublic class HelloController {\n    @PreAuthorize(\"hasRole('user')\")  //\u76f4\u63a5\u4f7f\u7528hasRole\u65b9\u6cd5\u5224\u65ad\u662f\u5426\u5305\u542b\u67d0\u4e2a\u89d2\u8272\n    @GetMapping(\"/\")\n    public String index(){\n        return \"index\";\n    }\n\n    ...\n}\n</code></pre> <p>\u901a\u8fc7\u6dfb\u52a0<code>@PreAuthorize</code>\u6ce8\u89e3\uff0c\u5728\u6267\u884c\u4e4b\u524d\u5224\u65ad\u5224\u65ad\u6743\u9650\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u7684\u6743\u9650\u6216\u662f\u5bf9\u5e94\u7684\u89d2\u8272\uff0c\u5c06\u65e0\u6cd5\u8bbf\u95ee\u9875\u9762\u3002</p> <p>\u8fd9\u91cc\u5176\u5b9e\u662f\u4f7f\u7528\u7684\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u8bb2\u89e3\u7684SpEL\u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u8fd9\u91cc\u4f7f\u7528\u6743\u9650\u5224\u65ad\u76f8\u5173\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u6709\u5fd8\u8bb0SpEL\u5982\u4f55\u4f7f\u7528\u7684\u53ef\u4ee5\u56de\u987e\u6211\u4eec\u7684Spring6\u6838\u5fc3\u7bc7\u3002\u6240\u6709\u53ef\u4ee5\u8fdb\u884c\u6743\u9650\u5224\u65ad\u7684\u65b9\u6cd5\u5728<code>SecurityExpressionRoot</code>\u7c7b\u4e2d\u6709\u5b9a\u4e49\uff0c\u5404\u4f4d\u5c0f\u4f19\u4f34\u53ef\u4ee5\u81ea\u884c\u524d\u5f80\u67e5\u770b\u3002</p> <p>\u540c\u6837\u7684\u8fd8\u6709<code>@PostAuthorize</code>\u6ce8\u89e3\uff0c\u4f46\u662f\u5b83\u662f\u5728\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u518d\u8fdb\u884c\u62e6\u622a\uff1a</p> <pre><code>@PostAuthorize(\"hasRole('user')\")\n@RequestMapping(\"/\")\npublic String index(){\n    System.out.println(\"\u6267\u884c\u4e86\");\n    return \"index\";\n}\n</code></pre> <p>\u9664\u4e86Controller\u4ee5\u5916\uff0c\u53ea\u8981\u662f\u7531Spring\u7ba1\u7406\u7684Bean\u90fd\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u5f62\u5f0f\u6765\u63a7\u5236\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u610f\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u8fd9\u4e2a\u6ce8\u89e3\uff0c\u53ea\u8981\u4e0d\u5177\u5907\u8868\u8fbe\u5f0f\u4e2d\u6307\u5b9a\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u6267\u884c\u65b9\u6cd5\u5e76\u4e14\u4f1a\u8fd4\u56de403\u9875\u9762\u3002</p> <pre><code>@Service\npublic class UserService {\n\n    @PreAuthorize(\"hasAnyRole('user')\")\n    public void test(){\n        System.out.println(\"\u6210\u529f\u6267\u884c\");\n    }\n}\n</code></pre> <p>\u4e0e\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u8fd8\u6709<code>@Secured</code>\u4f46\u662f\u5b83\u4e0d\u652f\u6301SpEL\u8868\u8fbe\u5f0f\u7684\u6743\u9650\u8868\u793a\u5f62\u5f0f\uff0c\u5e76\u4e14\u9700\u8981\u6dfb\u52a0\"ROLE_\"\u524d\u7f00\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u6f14\u793a\u4e86\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>@PreFilter</code>\u548c<code>@PostFilter</code>\u5bf9\u96c6\u5408\u7c7b\u578b\u7684\u53c2\u6570\u6216\u8fd4\u56de\u503c\u8fdb\u884c\u8fc7\u6ee4\u3002</p> <p>\u6bd4\u5982\uff1a</p> <pre><code>@PreFilter(\"filterObject.equals('lbwnb')\")   //filterObject\u4ee3\u8868\u96c6\u5408\u4e2d\u6bcf\u4e2a\u5143\u7d20\uff0c\u53ea\u8981\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u624d\u4f1a\u7559\u4e0b\npublic void test(List&lt;String&gt; list){\n    System.out.println(\"\u6210\u529f\u6267\u884c\"+list);\n}\n</code></pre> <pre><code>@RequestMapping(\"/\")\npublic String index(){\n    List&lt;String&gt; list = new LinkedList&lt;&gt;();\n    list.add(\"lbwnb\");\n    list.add(\"yyds\");\n    service.test(list);\n    return \"index\";\n}\n</code></pre> <p>\u4e0e<code>@PreFilter</code>\u7c7b\u4f3c\u7684<code>@PostFilter</code>\u8fd9\u91cc\u5c31\u4e0d\u505a\u6f14\u793a\u4e86\uff0c\u5b83\u7528\u4e8e\u5904\u7406\u8fd4\u56de\u503c\uff0c\u4f7f\u7528\u65b9\u6cd5\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5f53\u6709\u591a\u4e2a\u96c6\u5408\u65f6\uff0c\u9700\u8981\u4f7f\u7528<code>filterTarget</code>\u8fdb\u884c\u6307\u5b9a\uff1a</p> <pre><code>@PreFilter(value = \"filterObject.equals('lbwnb')\", filterTarget = \"list2\")\npublic void test(List&lt;String&gt; list, List&lt;String&gt; list2){\n    System.out.println(\"\u6210\u529f\u6267\u884c\"+list);\n}\n</code></pre> <p>\u81f3\u6b64\uff0c\u6709\u5173Security\u7684\u57fa\u672c\u529f\u80fd\uff0c\u6211\u4eec\u5c31\u5168\u90e8\u4ecb\u7ecd\u5b8c\u6bd5\u4e86\uff0c\u5728\u540e\u9762\u7684SpringBoot\u9636\u6bb5\uff0c\u6211\u4eec\u8fd8\u4f1a\u7ee7\u7eed\u6df1\u5165\u4f7f\u7528\u6b64\u6846\u67b6\uff0c\u5b9e\u73b0\u66f4\u591a\u9ad8\u7ea7\u7684\u529f\u80fd\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_15","title":"\u5185\u90e8\u673a\u5236\u63a2\u7a76","text":"<p>\u6ce8\u610f\uff1a\u672c\u5c0f\u8282\u5185\u5bb9\u4f5c\u4e3a\u9009\u5b66\u5185\u5bb9\uff0c\u4f46\u662f\u96be\u5ea6\u6bd4\u524d\u4e24\u7ae0\u7684\u6e90\u7801\u90e8\u5206\u7b80\u5355\u5f97\u591a\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_16","title":"\u6388\u6743\u6821\u9a8c\u6d41\u7a0b","text":"<p>\u6700\u540e\u6211\u4eec\u518d\u6765\u804a\u4e00\u4e0bSpringSecurity\u7684\u5b9e\u73b0\u539f\u7406\uff0c\u5b83\u672c\u8d28\u4e0a\u662f\u4f9d\u9760N\u4e2aFilter\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u8fc7\u6ee4\u94fe\uff08\u6ce8\u610f\u8fd9\u91cc\u662f\u8fc7\u6ee4\u5668\uff0c\u4e0d\u662f\u62e6\u622a\u5668\uff09</p> <p>\u6211\u4eec\u5c31\u4ece<code>AbstractSecurityWebApplicationInitializer</code>\u5f00\u59cb\u4e0b\u624b\uff0c\u6211\u4eec\u6765\u770b\u770b\u5b83\u914d\u7f6e\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>//\u6b64\u65b9\u6cd5\u4f1a\u5728\u542f\u52a8\u65f6\u88ab\u8c03\u7528\npublic final void onStartup(ServletContext servletContext) {\n    this.beforeSpringSecurityFilterChain(servletContext);\n    if (this.configurationClasses != null) {\n        AnnotationConfigWebApplicationContext rootAppContext = new AnnotationConfigWebApplicationContext();\n        rootAppContext.register(this.configurationClasses);\n        servletContext.addListener(new ContextLoaderListener(rootAppContext));\n    }\n\n    if (this.enableHttpSessionEventPublisher()) {\n        servletContext.addListener(\"org.springframework.security.web.session.HttpSessionEventPublisher\");\n    }\n\n    servletContext.setSessionTrackingModes(this.getSessionTrackingModes());\n      //\u91cd\u70b9\u5728\u8fd9\u91cc\uff0c\u8fd9\u91cc\u63d2\u5165\u4e86\u5173\u952e\u7684FilterChain\n    this.insertSpringSecurityFilterChain(servletContext);\n    this.afterSpringSecurityFilterChain(servletContext);\n}\n</code></pre> <pre><code>private void insertSpringSecurityFilterChain(ServletContext servletContext) {\n    String filterName = \"springSecurityFilterChain\";\n      //\u521b\u5efa\u4e86\u4e00\u4e2aDelegatingFilterProxy\u5bf9\u8c61\uff0c\u5b83\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2aFilter\uff0c\u4f46\u662f\u662f\u591a\u4e2aFilter\u7684\u96c6\u5408\n    DelegatingFilterProxy springSecurityFilterChain = new DelegatingFilterProxy(filterName);\n    String contextAttribute = this.getWebApplicationContextAttribute();\n    if (contextAttribute != null) {\n        springSecurityFilterChain.setContextAttribute(contextAttribute);\n    }\n        //\u901a\u8fc7ServletContext\u6ce8\u518cDelegatingFilterProxy\u8fd9\u4e2aFilter\n    this.registerFilter(servletContext, true, filterName, springSecurityFilterChain);\n}\n</code></pre> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b\u770b\uff0c<code>DelegatingFilterProxy</code>\u5728\u505a\u4ec0\u4e48\uff1a</p> <pre><code>//\u8fd9\u4e2a\u662f\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u5b83\u7531GenericFilterBean\uff08\u7236\u7c7b\uff09\u5b9a\u4e49\uff0c\u5728afterPropertiesSet\u65b9\u6cd5\u4e2d\u88ab\u8c03\u7528\nprotected void initFilterBean() throws ServletException {\n    synchronized(this.delegateMonitor) {\n        if (this.delegate == null) {\n            if (this.targetBeanName == null) {\n                this.targetBeanName = this.getFilterName();\n            }\n\n            WebApplicationContext wac = this.findWebApplicationContext();\n            if (wac != null) {\n                  //\u8010\u5fc3\u70b9\uff0c\u5957\u5a03\u5f88\u6b63\u5e38\n                this.delegate = this.initDelegate(wac);\n            }\n        }\n\n    }\n}\n</code></pre> <pre><code>protected Filter initDelegate(WebApplicationContext wac) throws ServletException {\n    String targetBeanName = this.getTargetBeanName();\n    Assert.state(targetBeanName != null, \"No target bean name set\");\n      //\u8fd9\u91cc\u901a\u8fc7WebApplicationContext\u83b7\u53d6\u4e86\u4e00\u4e2aBean\n    Filter delegate = (Filter)wac.getBean(targetBeanName, Filter.class);\n    if (this.isTargetFilterLifecycle()) {\n        delegate.init(this.getFilterConfig());\n    }\n\n      //\u8fd4\u56deFilter\n    return delegate;\n}\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u65ad\u70b9\u6765\u67e5\u770b\u5230\u5e95\u83b7\u53d6\u5230\u4e86\u4ec0\u4e48Bean\u3002</p> <p>\u901a\u8fc7\u65ad\u70b9\u8c03\u8bd5\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u653e\u56de\u7684\u5bf9\u8c61\u662f\u4e00\u4e2aFilterChainProxy\u7c7b\u578b\u7684\uff0c\u5e76\u4e14\u8c03\u7528\u4e86\u5b83\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u3002</p> <p>\u6211\u4eec\u5012\u56de\u53bb\u770b\uff0c\u5f53Filter\u8fd4\u56de\u4e4b\u540e\uff0c<code>DelegatingFilterProxy</code>\u7684\u4e00\u4e2a\u6210\u5458\u53d8\u91cf<code>delegate</code>\u88ab\u8d4b\u503c\u4e3a\u5f97\u5230\u7684Filter\uff0c\u4e5f\u5c31\u662fFilterChainProxy\u5bf9\u8c61\uff0c\u63a5\u7740\u6211\u4eec\u6765\u770b\u770b\uff0c<code>DelegatingFilterProxy</code>\u662f\u5982\u4f55\u6267\u884cdoFilter\u65b9\u6cd5\u7684\u3002</p> <pre><code>public void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain) throws ServletException, IOException {\n    Filter delegateToUse = this.delegate;\n    if (delegateToUse == null) {\n        //\u975e\u6b63\u5e38\u60c5\u51b5\uff0c\u8fd9\u91cc\u7701\u7565...\n    }\n        //\u8fd9\u91cc\u624d\u662f\u771f\u6b63\u7684\u8c03\u7528\uff0c\u522b\u5fd8\u4e86delegateToUse\u5c31\u662f\u521d\u59cb\u5316\u7684FilterChainProxy\u5bf9\u8c61\n    this.invokeDelegate(delegateToUse, request, response, filterChain);\n}\n</code></pre> <pre><code>protected void invokeDelegate(Filter delegate, ServletRequest request, ServletResponse response, FilterChain filterChain) throws ServletException, IOException {\n  //\u6700\u540e\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u662fFilterChainProxy\u7684doFilter\u65b9\u6cd5\n    delegate.doFilter(request, response, filterChain);\n}\n</code></pre> <p>\u6240\u4ee5\u6211\u4eec\u63a5\u7740\u6765\u770b\uff0c<code>FilterChainProxy</code>\u7684doFilter\u65b9\u6cd5\u53c8\u5728\u5e72\u4ec0\u4e48\uff1a</p> <pre><code>public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n    boolean clearContext = request.getAttribute(FILTER_APPLIED) == null;\n    if (!clearContext) {\n          //\u771f\u6b63\u7684\u8fc7\u6ee4\u5728\u8fd9\u91cc\u6267\u884c\n        this.doFilterInternal(request, response, chain);\n    } else {\n        //...\n    }\n}\n</code></pre> <p>image-20230705005303736</p> <pre><code>private void doFilterInternal(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n    FirewalledRequest firewallRequest = this.firewall.getFirewalledRequest((HttpServletRequest)request);\n    HttpServletResponse firewallResponse = this.firewall.getFirewalledResponse((HttpServletResponse)response);\n      //\u8fd9\u91cc\u83b7\u53d6\u4e86\u4e00\u4e2aFilter\u5217\u8868\uff0c\u5b9e\u9645\u4e0aSpringSecurity\u5c31\u662f\u7531N\u4e2a\u8fc7\u6ee4\u5668\u5b9e\u73b0\u7684\uff0c\u8fd9\u91cc\u83b7\u53d6\u7684\u90fd\u662fSpringSecurity\u63d0\u4f9b\u7684\u8fc7\u6ee4\u5668\n      //\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u7ecf\u8fc7\u6211\u4eec\u4e4b\u524d\u7684\u5206\u6790\uff0c\u5b9e\u9645\u4e0a\u771f\u6b63\u6ce8\u518c\u7684Filter\u53ea\u6709DelegatingFilterProxy\n      //\u800c\u8fd9\u91cc\u7684Filter\u5217\u8868\u4e2d\u7684\u6240\u6709Filter\u5e76\u6ca1\u6709\u88ab\u6ce8\u518c\uff0c\u800c\u662f\u5728\u8fd9\u91cc\u8fdb\u884c\u5185\u90e8\u8c03\u7528\n    List&lt;Filter&gt; filters = this.getFilters((HttpServletRequest)firewallRequest);\n      //\u53ea\u8981Filter\u5217\u8868\u4e0d\u662f\u7a7a\uff0c\u5c31\u4f9d\u6b21\u6267\u884c\u5185\u7f6e\u7684Filter\n    if (filters != null &amp;&amp; filters.size() != 0) {\n        if (logger.isDebugEnabled()) {\n            logger.debug(LogMessage.of(() -&gt; {\n                return \"Securing \" + requestLine(firewallRequest);\n            }));\n        }\n                //\u8fd9\u91cc\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u8fc7\u6ee4\u94fe\uff0c\u8fc7\u6ee4\u6d41\u7a0b\u662f\u7531SpringSecurity\u81ea\u5df1\u5b9e\u73b0\u7684\n        FilterChainProxy.VirtualFilterChain virtualFilterChain = new FilterChainProxy.VirtualFilterChain(firewallRequest, chain, filters);\n          //\u8c03\u7528\u865a\u62df\u8fc7\u6ee4\u94fe\u7684doFilter\n        virtualFilterChain.doFilter(firewallRequest, firewallResponse);\n    } else {\n        if (logger.isTraceEnabled()) {\n            logger.trace(LogMessage.of(() -&gt; {\n                return \"No security for \" + requestLine(firewallRequest);\n            }));\n        }\n\n        firewallRequest.reset();\n        chain.doFilter(firewallRequest, firewallResponse);\n    }\n}\n</code></pre> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u865a\u62df\u8fc7\u6ee4\u94fe\u7684doFilter\u662f\u600e\u4e48\u5904\u7406\u7684\uff1a</p> <pre><code>//\u770b\u4f3c\u6ca1\u6709\u4efb\u4f55\u5faa\u73af\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u5faa\u73af\uff0c\u662f\u4e00\u4e2a\u9012\u5f52\u8c03\u7528\npublic void doFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException {\n      //\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u901a\u8fc7\u5168\u90e8\u7684\u5185\u7f6e\u8fc7\u6ee4\u5668\uff0c\u5b9a\u4f4d\u662f\u5426\u7b49\u4e8e\u5f53\u524d\u5927\u5c0f\n    if (this.currentPosition == this.size) {\n        if (FilterChainProxy.logger.isDebugEnabled()) {\n            FilterChainProxy.logger.debug(LogMessage.of(() -&gt; {\n                return \"Secured \" + FilterChainProxy.requestLine(this.firewalledRequest);\n            }));\n        }\n\n        this.firewalledRequest.reset();\n          //\u6240\u6709\u7684\u5185\u7f6e\u8fc7\u6ee4\u5668\u5df2\u7ecf\u5b8c\u6210\uff0c\u6309\u7167\u6b63\u5e38\u6d41\u7a0b\u8d70DelegatingFilterProxy\u7684\u4e0b\u4e00\u4e2aFilter\n          //\u4e5f\u5c31\u662f\u8bf4\u8fd9\u91cc\u4e4b\u540e\u5c31\u4e0eDelegatingFilterProxy\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u4e86\uff0c\u8be5\u8d70\u5176\u4ed6\u8fc7\u6ee4\u5668\u5c31\u8d70\u5176\u4ed6\u5730\u65b9\u914d\u7f6e\u7684\u8fc7\u6ee4\u5668\uff0cSpringSecurity\u7684\u8fc7\u6ee4\u64cd\u4f5c\u5df2\u7ecf\u7ed3\u675f\n        this.originalChain.doFilter(request, response);\n    } else {\n          //\u5b9a\u4f4d\u81ea\u589e\n        ++this.currentPosition;\n          //\u83b7\u53d6\u5f53\u524d\u5b9a\u4f4d\u7684Filter\n        Filter nextFilter = (Filter)this.additionalFilters.get(this.currentPosition - 1);\n        if (FilterChainProxy.logger.isTraceEnabled()) {\n            FilterChainProxy.logger.trace(LogMessage.format(\"Invoking %s (%d/%d)\", nextFilter.getClass().getSimpleName(), this.currentPosition, this.size));\n        }\n                //\u6267\u884c\u5185\u90e8\u8fc7\u6ee4\u5668\u7684doFilter\u65b9\u6cd5\uff0c\u4f20\u5165\u5f53\u524d\u5bf9\u8c61\u672c\u8eab\u4f5c\u4e3aFilter\uff0c\u6267\u884c\u5982\u679c\u6210\u529f\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a\u518d\u6b21\u8c03\u7528\u5f53\u524d\u5bf9\u8c61\u7684doFilter\u65b9\u6cd5\n          //\u53ef\u80fd\u6700\u4e0d\u7406\u89e3\u7684\u5c31\u662f\u8fd9\u91cc\uff0c\u6267\u884c\u7684\u96be\u9053\u4e0d\u662f\u5185\u90e8\u5176\u4ed6Filter\u7684doFilter\u65b9\u6cd5\u5417\uff0c\u600e\u4e48\u4f1a\u8ba9\u5f53\u524d\u5bf9\u8c61\u7684doFilter\u65b9\u6cd5\u9012\u5f52\u8c03\u7528\u5462\uff1f\n          //\u6ca1\u5173\u7cfb\uff0c\u4e0b\u9762\u6211\u4eec\u63a5\u7740\u4e86\u89e3\u4e86\u5176\u4e2d\u4e00\u4e2a\u5185\u90e8\u8fc7\u6ee4\u5668\u5c31\u660e\u767d\u4e86\n        nextFilter.doFilter(request, response, this);\n    }\n}\n</code></pre> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5dee\u4e0d\u591a\u5df2\u7ecf\u4e86\u89e3\u4e86\u6574\u4e2aSpringSecurity\u7684\u5b9e\u73b0\u673a\u5236\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u968f\u4fbf\u770b\u4e00\u4e2a\u5185\u90e8\u7684\u8fc7\u6ee4\u5668\u5728\u505a\u4ec0\u4e48\u3002</p> <p>\u6bd4\u5982\u7528\u4e8e\u5904\u7406\u767b\u9646\u7684\u8fc7\u6ee4\u5668<code>UsernamePasswordAuthenticationFilter</code>\uff0c\u5b83\u7ee7\u627f\u81ea<code>AbstractAuthenticationProcessingFilter</code>\uff0c\u6211\u4eec\u6765\u770b\u770b\u5b83\u662f\u600e\u4e48\u8fdb\u884c\u8fc7\u6ee4\u7684\uff1a</p> <pre><code>public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n    this.doFilter((HttpServletRequest)request, (HttpServletResponse)response, chain);\n}\n\nprivate void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException {\n      //\u5982\u679c\u4e0d\u662f\u767b\u9646\u8bf7\u6c42\uff0c\u90a3\u4e48\u6839\u672c\u4e0d\u4f1a\u7406\u8fd9\u4e2a\u8bf7\u6c42\n    if (!this.requiresAuthentication(request, response)) {\n          //\u76f4\u63a5\u8c03\u7528\u4f20\u5165\u7684FilterChain\u7684doFilter\u65b9\u6cd5\n          //\u800c\u8fd9\u91cc\u4f20\u5165\u7684\u6b63\u597d\u662fVirtualFilterChain\u5bf9\u8c61\n          //\u8fd9\u4e0b\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0a\u9762\u8bf4\u662f\u9012\u5f52\u4e86\u5427\n        chain.doFilter(request, response);\n    } else {\n          //\u5982\u679c\u662f\u767b\u9646\u8bf7\u6c42\uff0c\u90a3\u4e48\u4f1a\u6267\u884c\u767b\u9646\u8bf7\u6c42\u7684\u76f8\u5173\u903b\u8f91\uff0c\u6ce8\u610f\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4efb\u4f55\u95ee\u9898\u90fd\u4f1a\u629b\u51fa\u5f02\u5e38\n          //\u6bd4\u5982\u7528\u6237\u540d\u548c\u5bc6\u7801\u9519\u8bef\uff0c\u6211\u4eec\u4e4b\u524d\u4e5f\u5df2\u7ecf\u6d4b\u8bd5\u8fc7\u4e86\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2aBadCredentialsException\n        try {\n              //\u8fdb\u884c\u8ba4\u8bc1\n            Authentication authenticationResult = this.attemptAuthentication(request, response);\n            if (authenticationResult == null) {\n                return;\n            }\n\n            this.sessionStrategy.onAuthentication(authenticationResult, request, response);\n            if (this.continueChainBeforeSuccessfulAuthentication) {\n                chain.doFilter(request, response);\n            }\n\n              //\u5982\u679c\u4e00\u8def\u7eff\u706f\uff0c\u6ca1\u6709\u62a5\u9519\uff0c\u90a3\u4e48\u9a8c\u8bc1\u6210\u529f\uff0c\u6267\u884csuccessfulAuthentication\n            this.successfulAuthentication(request, response, chain, authenticationResult);\n        } catch (InternalAuthenticationServiceException var5) {\n            this.logger.error(\"An internal error occurred while trying to authenticate the user.\", var5);\n              //\u9a8c\u8bc1\u5931\u8d25\uff0c\u4f1a\u6267\u884cunsuccessfulAuthentication\n            this.unsuccessfulAuthentication(request, response, var5);\n        } catch (AuthenticationException var6) {\n            this.unsuccessfulAuthentication(request, response, var6);\n        }\n\n    }\n}\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u6765\u770b\u770bsuccessfulAuthentication\u548cunsuccessfulAuthentication\u5206\u522b\u505a\u4e86\u4ec0\u4e48\uff1a</p> <pre><code>protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException {\n      //\u5411SecurityContextHolder\u6dfb\u52a0\u8ba4\u8bc1\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7SecurityContextHolder\u5bf9\u8c61\u83b7\u53d6\u5f53\u524d\u767b\u9646\u7684\u7528\u6237\n    SecurityContextHolder.getContext().setAuthentication(authResult);\n    if (this.logger.isDebugEnabled()) {\n        this.logger.debug(LogMessage.format(\"Set SecurityContextHolder to %s\", authResult));\n    }\n\n      //\u8bb0\u4f4f\u6211\u5b9e\u73b0\n    this.rememberMeServices.loginSuccess(request, response, authResult);\n    if (this.eventPublisher != null) {\n        this.eventPublisher.publishEvent(new InteractiveAuthenticationSuccessEvent(authResult, this.getClass()));\n    }\n\n      //\u8c03\u7528\u9ed8\u8ba4\u7684\u6216\u662f\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684AuthenticationSuccessHandler\u7684onAuthenticationSuccess\u65b9\u6cd5\n      //\u8fd9\u4e2a\u6839\u636e\u6211\u4eec\u914d\u7f6e\u6587\u4ef6\u51b3\u5b9a\n      //\u5230\u8fd9\u91cc\u5176\u5b9e\u9875\u9762\u5c31\u5df2\u7ecf\u76f4\u63a5\u8df3\u8f6c\u4e86\n    this.successHandler.onAuthenticationSuccess(request, response, authResult);\n}\n\nprotected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) throws IOException, ServletException {\n      //\u767b\u9646\u5931\u8d25\u4f1a\u76f4\u63a5\u6e05\u7406\u6389SecurityContextHolder\u4e2d\u7684\u8ba4\u8bc1\u4fe1\u606f\n    SecurityContextHolder.clearContext();\n    this.logger.trace(\"Failed to process authentication request\", failed);\n    this.logger.trace(\"Cleared SecurityContextHolder\");\n    this.logger.trace(\"Handling authentication failure\");\n      //\u767b\u9646\u5931\u8d25\u7684\u8bb0\u4f4f\u6211\u5904\u7406\n    this.rememberMeServices.loginFail(request, response);\n      //\u540c\u4e0a\uff0c\u8c03\u7528\u9ed8\u8ba4\u6216\u662f\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684AuthenticationFailureHandler\n    this.failureHandler.onAuthenticationFailure(request, response, failed);\n}\n</code></pre> <p>\u4e86\u89e3\u4e86\u6574\u4e2a\u7528\u6237\u9a8c\u8bc1\u5b9e\u73b0\u6d41\u7a0b\uff0c\u5176\u5b9e\u5176\u5b83\u7684\u8fc7\u6ee4\u5668\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u4e5f\u5c31\u5f88\u5bb9\u6613\u8054\u60f3\u5230\u4e86\uff0cSpringSecurity\u7684\u8fc7\u6ee4\u5668\u4ece\u67d0\u79cd\u610f\u4e49\u4e0a\u6765\u8bf4\uff0c\u66f4\u50cf\u662f\u4e00\u4e2a\u5904\u7406\u4e1a\u52a1\u7684Servlet\uff0c\u5b83\u505a\u7684\u4e8b\u60c5\u4e0d\u50cf\u662f\u62e6\u622a\uff0c\u66f4\u50cf\u662f\u5b8c\u6210\u81ea\u5df1\u5bf9\u5e94\u7684\u804c\u8d23\uff0c\u53ea\u4e0d\u8fc7\u662f\u4f7f\u7528\u4e86\u8fc7\u6ee4\u5668\u673a\u5236\u8fdb\u884c\u5b9e\u73b0\u7f62\u4e86\uff0c\u4ece\u800c\u5c06\u6240\u6709\u7684\u9a8c\u8bc1\u63d0\u524d\u5230\u8fdb\u5165Controller\u4e4b\u524d\u3002</p> <p>\u6700\u540e\u9644\u4e0a\u5b8c\u6574\u7684\u8fc7\u6ee4\u5668\u6e05\u5355\uff0c\u8fd9\u91cc\u5217\u51fa14\u4e2a\u5e38\u89c1\u7684\u5185\u90e8\u8fc7\u6ee4\u5668\uff1a</p> \u8fc7\u6ee4\u5668\u540d\u79f0 \u804c\u8d23 DisableEncodeUrlFilter \u7981\u6b62 HttpServletResponse \u5bf9 URL \u8fdb\u884c\u7f16\u7801\uff0c\u4ee5\u9632\u6b62\u5728 URL \u4e2d\u5305\u542b Session ID\uff0c\u6b64\u7c7b URL \u4e0d\u88ab\u89c6\u4e3a URL\uff0c\u56e0\u4e3a\u4f1a\u8bdd ID \u53ef\u80fd\u4f1a\u5728 HTTP \u8bbf\u95ee\u65e5\u5fd7\u7b49\u5185\u5bb9\u4e2d\u6cc4\u9732\u3002 WebAsyncManagerIntegrationFilter \u5b9e\u73b0\u4e86\u5bf9SecurityContext\u4e0eWebAsyncManager\u7684\u96c6\u6210\uff0c\u4f7f Controller \u4e2d\u80fd\u591f\u7ebf\u7a0b\u5b89\u5168\u5730\u83b7\u53d6\u5230\u7528\u6237\u4e0a\u4e0b\u6587\u8ba4\u8bc1\u4fe1\u606f\u3002 SecurityContextHolderFilter \u901a\u8fc7HttpSessionSecurityContextRepository\u63a5\u53e3\u4eceSession\u4e2d\u8bfb\u53d6SecurityContext\u6216\u662f\u76f4\u63a5\u521b\u5efa\u65b0\u7684\uff0c\u7136\u540e\u5b58\u5165\u5230SecurityContextHolder\u4e2d\uff0c\u6700\u540e\u8bf7\u6c42\u7ed3\u675f\u65f6\u4f1a\u8fdb\u884c\u6e05\u7406\u3002 HeaderWriterFilter \u7ed9HTTP\u54cd\u5e94\u6dfb\u52a0\u4e00\u4e9bHeader\u5c5e\u6027\uff0c\u5982\uff1aX-Frame-Options\u3001X-XSS-Protection\u3001X-Content-Type-Options\u7b49\u3002 CsrfFilter \u9488\u5bf9Csrf\u76f8\u5173\u6821\u9a8c\u3002 LogoutFilter \u5bf9\u9000\u51fa\u767b\u5f55\u7684\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\uff0c\u6267\u884c\u767b\u51fa\u64cd\u4f5c\u3002 UsernamePasswordAuthenticationFilter \u5bf9\u767b\u5f55\u7684\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\uff0c\u6267\u884c\u767b\u5f55\u64cd\u4f5c\u3002 ConcurrentSessionFilter \u68c0\u67e5SessionRegistry\u4fdd\u5b58\u7684Session\u4fe1\u606f\u662f\u5426\u8fc7\u671f\u3002 RequestCacheAwareFilter \u7f13\u5b58Request\u8bf7\u6c42\uff0c\u53ef\u4ee5\u7528\u4e8e\u6062\u590d\u56e0\u767b\u5f55\u800c\u6253\u65ad\u7684\u8bf7\u6c42\u3002 SecurityContextHolderAwareRequestFilter \u5bf9ServletRequest\u8fdb\u884c\u8fdb\u4e00\u6b65\u5305\u88c5\uff0c\u8ba9Request\u5177\u6709\u66f4\u52a0\u4e30\u5bcc\u7684\u5185\u5bb9\u3002 RememberMeAuthenticationFilter \u9488\u5bf9\u4e8e\u8bb0\u4f4f\u6211Cookie\u8fdb\u884c\u6821\u9a8c\u3002 AnonymousAuthenticationFilter \u672a\u9a8c\u8bc1\u6210\u529f\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u533f\u540d\u767b\u5f55\u64cd\u4f5c\u3002 SessionManagementFilter Session\u7ba1\u7406\u76f8\u5173\u3002 ExceptionTranslationFilter \u5f02\u5e38\u8f6c\u6362\u5904\u7406\uff0c\u6bd4\u5982\u6700\u5e38\u89c1\u7684AccessDenied\u4e4b\u7c7b\u7684\u3002 <p>\u5404\u4f4d\u5c0f\u4f19\u4f34\u611f\u5174\u8da3\u7684\u8bdd\u53ef\u4ee5\u81ea\u884c\u4e86\u89e3\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_17","title":"\u5b89\u5168\u4e0a\u4e0b\u6587","text":"<p>\u7528\u6237\u767b\u5f55\u4e4b\u540e\uff0c\u600e\u4e48\u83b7\u53d6\u5f53\u524d\u5df2\u7ecf\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f\u5462\uff1f\u901a\u8fc7\u4f7f\u7528SecurityContextHolder\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5f97\u5230SecurityContext\u5bf9\u8c61\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528SecurityContext\u5bf9\u8c61\u6765\u83b7\u53d6\u5f53\u524d\u7684\u8ba4\u8bc1\u4fe1\u606f\uff1a</p> <pre><code>@RequestMapping(\"/index\")\n    public String index(){\n        SecurityContext context = SecurityContextHolder.getContext();\n        Authentication authentication = context.getAuthentication();\n        User user = (User) authentication.getPrincipal();\n        System.out.println(user.getUsername());\n        System.out.println(user.getAuthorities());\n        return \"index\";\n    }\n</code></pre> <p>\u901a\u8fc7SecurityContext\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u540d\u79f0\u548c\u6388\u6743\u4fe1\u606f\u7b49\uff1a</p> <p>image-20230706215806040</p> <p>\u9664\u4e86\u8fd9\u79cd\u65b9\u5f0f\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4eceSession\u4e2d\u83b7\u53d6\uff1a</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(@SessionAttribute(\"SPRING_SECURITY_CONTEXT\") SecurityContext context){\n    Authentication authentication = context.getAuthentication();\n    User user = (User) authentication.getPrincipal();\n    System.out.println(user.getUsername());\n    System.out.println(user.getAuthorities());\n    return \"index\";\n}\n</code></pre> <p>\u6ce8\u610fSecurityContextHolder\u662f\u6709\u4e00\u5b9a\u7684\u5b58\u50a8\u7b56\u7565\u7684\uff0cSecurityContextHolder\u4e2d\u7684SecurityContext\u5bf9\u8c61\u4f1a\u5728\u4e00\u5f00\u59cb\u8bf7\u6c42\u5230\u6765\u65f6\u88ab\u8bbe\u5b9a\uff0c\u81f3\u4e8e\u5b58\u50a8\u65b9\u5f0f\u5176\u5b9e\u662f\u7531\u5b58\u50a8\u7b56\u7565\u51b3\u5b9a\u7684\uff0c\u5982\u679c\u6211\u4eec\u8fd9\u6837\u7f16\u5199\uff0c\u90a3\u4e48\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u65e0\u6cd5\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u7684\uff1a</p> <pre><code>@RequestMapping(\"/index\")\npublic String index(){\n    new Thread(() -&gt; {   //\u521b\u5efa\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u53bb\u83b7\u53d6\n        SecurityContext context = SecurityContextHolder.getContext();\n        Authentication authentication = context.getAuthentication();\n        User user = (User) authentication.getPrincipal();   //NPE\n        System.out.println(user.getUsername());\n        System.out.println(user.getAuthorities()); \n    }).start();\n    return \"index\";\n}\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3aSecurityContextHolder\u7684\u5b58\u50a8\u7b56\u7565\u9ed8\u8ba4\u662f<code>MODE_THREADLOCAL</code>\uff0c\u5b83\u662f\u57fa\u4e8eThreadLocal\u5b9e\u73b0\u7684\uff0c<code>getContext()</code>\u65b9\u6cd5\u672c\u8d28\u4e0a\u8c03\u7528\u7684\u662f\u5bf9\u5e94\u7684\u5b58\u50a8\u7b56\u7565\u5b9e\u73b0\u7684\u65b9\u6cd5\uff1a</p> <pre><code>public static SecurityContext getContext() {\n    return strategy.getContext();\n}\n</code></pre> <p>SecurityContextHolderStrategy\u6709\u4e09\u4e2a\u5b9e\u73b0\u7c7b\uff1a</p> <ul> <li>GlobalSecurityContextHolderStrategy\uff1a\u5168\u5c40\u6a21\u5f0f\uff0c\u4e0d\u5e38\u7528</li> <li>ThreadLocalSecurityContextHolderStrategy\uff1a\u57fa\u4e8eThreadLocal\u5b9e\u73b0\uff0c\u7ebf\u7a0b\u5185\u53ef\u89c1</li> <li>InheritableThreadLocalSecurityContextHolderStrategy\uff1a\u57fa\u4e8eInheritableThreadLocal\u5b9e\u73b0\uff0c\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u53ef\u89c1</li> </ul> <p>\u56e0\u6b64\uff0c\u5982\u679c\u4e0a\u8ff0\u60c5\u51b5\u9700\u8981\u5728\u5b50\u7ebf\u7a0b\u4e2d\u83b7\u53d6\uff0c\u90a3\u4e48\u9700\u8981\u4fee\u6539SecurityContextHolder\u7684\u5b58\u50a8\u7b56\u7565\uff0c\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u8bbe\u7f6e\uff1a</p> <pre><code>@PostConstruct\npublic void init(){\n    SecurityContextHolder.setStrategyName(SecurityContextHolder.MODE_INHERITABLETHREADLOCAL);\n}\n</code></pre> <p>\u8fd9\u6837\u5728\u5b50\u7ebf\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u4e86\u3002</p> <p>\u56e0\u4e3a\u7528\u6237\u7684\u9a8c\u8bc1\u4fe1\u606f\u662f\u57fa\u4e8eSecurityContext\u8fdb\u884c\u5224\u65ad\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539SecurityContext\u7684\u5185\u5bb9\uff0c\u6765\u624b\u52a8\u4e3a\u7528\u6237\u8fdb\u884c\u767b\u9646\uff1a</p> <pre><code>@RequestMapping(\"/auth\")\n@ResponseBody\npublic String auth(){\n    SecurityContext context = SecurityContextHolder.getContext();  //\u83b7\u53d6SecurityContext\u5bf9\u8c61\uff08\u5f53\u524d\u4f1a\u8bdd\u80af\u5b9a\u662f\u6ca1\u6709\u767b\u9646\u7684\uff09\n    UsernamePasswordAuthenticationToken token = new UsernamePasswordAuthenticationToken(\"Test\", null,\n            AuthorityUtils.commaSeparatedStringToAuthorityList(\"ROLE_user\"));  //\u624b\u52a8\u521b\u5efa\u4e00\u4e2aUsernamePasswordAuthenticationToken\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u89d2\u8272\u9700\u8981\u6dfb\u52a0ROLE_\u524d\u7f00\uff0c\u6743\u9650\u76f4\u63a5\u5199\n    context.setAuthentication(token);  //\u624b\u52a8\u4e3aSecurityContext\u8bbe\u5b9a\u8ba4\u8bc1\u4fe1\u606f\n    return \"Login success\uff01\";\n}\n</code></pre> <p>\u5728\u672a\u767b\u9646\u7684\u60c5\u51b5\u4e0b\uff0c\u8bbf\u95ee\u6b64\u5730\u5740\u5c06\u76f4\u63a5\u8fdb\u884c\u624b\u52a8\u767b\u9646\uff0c\u518d\u6b21\u8bbf\u95ee<code>/index</code>\u9875\u9762\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u8bf4\u660e\u624b\u52a8\u8bbe\u7f6e\u8ba4\u8bc1\u4fe1\u606f\u6210\u529f\u3002</p> <p>\u7591\u60d1\uff1aSecurityContext\u8fd9\u73a9\u610f\u4e0d\u662f\u9ed8\u8ba4\u7ebf\u7a0b\u72ec\u5360\u5417\uff0c\u90a3\u6bcf\u6b21\u8bf7\u6c42\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u6309\u7406\u8bf4\u4e0a\u4e00\u6b21\u7684SecurityContext\u5bf9\u8c61\u5e94\u8be5\u6ca1\u4e86\u624d\u5bf9\u554a\uff0c\u4e3a\u4ec0\u4e48\u518d\u6b21\u8bf7\u6c42\u4f9d\u7136\u80fd\u591f\u7ee7\u7eed\u4f7f\u7528\u4e0a\u4e00\u6b21SecurityContext\u4e2d\u7684\u8ba4\u8bc1\u4fe1\u606f\u5462\uff1f</p> <p>SecurityContext\u7684\u751f\u547d\u5468\u671f\uff1a\u8bf7\u6c42\u5230\u6765\u65f6\u4eceSession\u4e2d\u53d6\u51fa\uff0c\u653e\u5165SecurityContextHolder\u4e2d\uff0c\u8bf7\u6c42\u7ed3\u675f\u65f6\u4eceSecurityContextHolder\u53d6\u51fa\uff0c\u5e76\u653e\u5230Session\u4e2d\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u4f9d\u9760Session\u6765\u5b58\u50a8\u7684\uff0c\u4e00\u65e6\u4f1a\u8bdd\u8fc7\u671f\u9a8c\u8bc1\u4fe1\u606f\u4e5f\u8ddf\u7740\u6d88\u5931\u3002</p> <p>\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u8be6\u7ec6\u8ba8\u8bba\u5b83\u7684\u5b9e\u73b0\u8fc7\u7a0b\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_18","title":"\u5b89\u5168\u4e0a\u4e0b\u6587\u6301\u4e45\u5316\u8fc7\u6ee4\u5668","text":"<p>SecurityContextHolderFilter\u4e5f\u662f\u5185\u7f6e\u7684Filter\uff0c\u5b83\u5c31\u662f\u4e13\u95e8\u7528\u4e8e\u5904\u7406SecurityContext\u7684\uff0c\u8fd9\u91cc\u5148\u8bf4\u4e00\u4e0b\u5927\u81f4\u6d41\u7a0b\uff0c\u4ee5\u4fbf\u6211\u4eec\u540e\u7eed\u66f4\u52a0\u65b9\u4fbf\u5730\u7406\u89e3\uff1a</p> <p>\u5f53\u8fc7\u6ee4\u5668\u94fe\u6267\u884c\u5230SecurityContextHolderFilter\u65f6\uff0c\u5b83\u4f1a\u4eceHttpSession\u4e2d\u628aSecurityContext\u5bf9\u8c61\u53d6\u51fa\u6765\uff08\u662f\u5b58\u5728Session\u4e2d\u7684\uff0c\u8ddf\u968f\u4f1a\u8bdd\u7684\u6d88\u5931\u800c\u6d88\u5931\uff09\uff0c\u7136\u540e\u653e\u5165SecurityContextHolder\u5bf9\u8c61\u4e2d\u3002\u8bf7\u6c42\u7ed3\u675f\u540e\uff0c\u518d\u628aSecurityContext\u5b58\u5165HttpSession\u4e2d\uff0c\u5e76\u6e05\u9664SecurityContextHolder\u5185\u7684SecurityContext\u5bf9\u8c61\u3002</p> <p>\u6211\u4eec\u8fd8\u662f\u76f4\u63a5\u8fdb\u5165\u5230\u6e90\u7801\u4e2d\uff1a</p> <pre><code>    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n    //\u5f00\u59cb\u5957\u5a03\n        doFilter((HttpServletRequest) request, (HttpServletResponse) response, chain);\n    }\n\n    private void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain)\n            throws ServletException, IOException {\n    //\u9632\u6b62\u91cd\u590d\u7684\u5b89\u5168\u8bf7\u6c42\uff0c\u4e0d\u9700\u8981\u5173\u5fc3\uff0c\u4e00\u822c\u662f\u76f4\u63a5\u8d70\u4e0b\u9762\n        if (request.getAttribute(FILTER_APPLIED) != null) {\n            chain.doFilter(request, response);\n            return;\n        }\n        request.setAttribute(FILTER_APPLIED, Boolean.TRUE);\n    //\u8fd9\u91cc\u901a\u8fc7SecurityContextRepository\u7684loadDeferredContext\u83b7\u53d6\u5230SecurityContext\u5bf9\u8c61\u7684Supplier\n        Supplier&lt;SecurityContext&gt; deferredContext = this.securityContextRepository.loadDeferredContext(request);\n        ...\n    }\n</code></pre> <p>\u6211\u4eec\u63a5\u7740\u6765\u770b<code>loadDeferredContext</code>\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u5176\u4e2dSecurityContextRepository\u7684\u5b9e\u73b0\u7c7b\u662fDelegatingSecurityContextRepository\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u4e2d\u7ef4\u62a4\u4e86\u591a\u4e2aSecurityContextRepository\u5b9e\u73b0\u7c7b\uff0c\u800c\u5176\u672c\u8eab\u5e76\u6ca1\u6709\u5b9e\u73b0<code>loadDeferredContext</code>\u65b9\u6cd5\uff0c\u800c\u662f\u9760\u5185\u90e8\u7ef4\u62a4\u7684\u5176\u4ed6SecurityContextRepository\u5b9e\u73b0\u7c7b\u6765\u5b8c\u6210\uff1a</p> <pre><code>    @Override\n    public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {\n    //DeferredSecurityContext\u662f\u4e00\u4e2a\u652f\u6301\u5ef6\u65f6\u751f\u6210\u7684SecurityContext\uff0c\u672c\u8d28\u662f\u4e00\u4e2aSecurityContext\u7684Supplier\n        DeferredSecurityContext deferredSecurityContext = null;\n    //\u904d\u5386\u5185\u90e8\u7ef4\u62a4\u7684\u5176\u4ed6SecurityContextRepository\u5b9e\u73b0\uff0c\u4e00\u822c\u5305\u542b\u4ee5\u4e0b\u4e24\u4e2a\uff1a\n    //1. HttpSessionSecurityContextRepository\n    //2. RequestAttributeSecurityContextRepository\n        for (SecurityContextRepository delegate : this.delegates) {\n      //\u8fd9\u4e2aif-else\u8bed\u53e5\u5176\u5b9e\u4e3a\u4e86\u6dfb\u52a0\u591a\u4e2aSecurityContextRepository\u63d0\u4f9b\u7684SecurityContext\u5e76\u5c06\u5176\u7ec4\u6210\u4e00\u4e2a\u94fe\u72b6\u7ed3\u6784\u7684DelegatingDeferredSecurityContext\uff08\u81f3\u4e8e\u4e3a\u4ec0\u4e48\uff0c\u6211\u4eec\u63a5\u7740\u5f80\u4e0b\u770b\uff09\n            if (deferredSecurityContext == null) {\n                deferredSecurityContext = delegate.loadDeferredContext(request);\n            }\n            else {\n                DeferredSecurityContext next = delegate.loadDeferredContext(request);\n                deferredSecurityContext = new DelegatingDeferredSecurityContext(deferredSecurityContext, next);\n            }\n        }\n        return deferredSecurityContext;\n    }\n</code></pre> <p>\u9996\u5148\u6211\u4eec\u6765\u770b\u7b2c\u4e00\u4e2aHttpSessionSecurityContextRepository\uff0c\u5b83\u662f\u7b2c\u4e00\u4e2a\u88ab\u904d\u5386\u7684\u5b9e\u73b0\uff1a</p> <pre><code>    @Override\n    public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {\n        Supplier&lt;SecurityContext&gt; supplier = () -&gt; readSecurityContextFromSession(request.getSession(false));  //\u4eceSession\u4e2d\u53d6\u51faSecurityContext\n        return new SupplierDeferredSecurityContext(supplier, this.securityContextHolderStrategy);\n    }\n\n    public static final String SPRING_SECURITY_CONTEXT_KEY = \"SPRING_SECURITY_CONTEXT\";\n    private String springSecurityContextKey = SPRING_SECURITY_CONTEXT_KEY;\n\n    private SecurityContext readSecurityContextFromSession(HttpSession httpSession) {\n        ...\n    //\u5b9e\u9645\u4e0a\u8fd9\u91cc\u5c31\u662f\u4eceSession\u4e2d\u901a\u8fc7\u952e\u201cSPRING_SECURITY_CONTEXT\u201d\u53d6\u51fa\u7684SecurityContext\n    //\u8ddf\u6211\u4eec\u4e0a\u4e00\u8282\u4f7f\u7528\u7684\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u8fd9\u4e0b\u5c31\u5f88\u6e05\u6670\u4e86\n    //\u5982\u679c\u7528\u6237\u6ca1\u6709\u767b\u5f55\u9a8c\u8bc1\uff0c\u90a3\u4e48\u8fd9\u91cc\u83b7\u53d6\u5230\u7684SecurityContext\u5c31\u662fnull\u4e86\n        Object contextFromSession = httpSession.getAttribute(this.springSecurityContextKey);\n        ...\n        return (SecurityContext) contextFromSession;\n    }\n</code></pre> <p>\u6700\u540e\u8fd4\u56de\u56de\u53bb\u7684\u662f\u4e00\u4e2aSupplierDeferredSecurityContext\u5bf9\u8c61\uff1a</p> <pre><code>final class SupplierDeferredSecurityContext implements DeferredSecurityContext {\n\n    private static final Log logger = LogFactory.getLog(SupplierDeferredSecurityContext.class);\n\n    private final Supplier&lt;SecurityContext&gt; supplier;\n\n    private final SecurityContextHolderStrategy strategy;\n\n    private SecurityContext securityContext;\n\n    private boolean missingContext;\n\n    SupplierDeferredSecurityContext(Supplier&lt;SecurityContext&gt; supplier, SecurityContextHolderStrategy strategy) {\n        this.supplier = supplier;\n        this.strategy = strategy;\n    }\n\n    @Override\n    public SecurityContext get() {\n    //\u5728\u83b7\u53d6SecurityContext\u65f6\u4f1a\u8fdb\u884c\u4e00\u6b21\u521d\u59cb\u5316\n        init();\n        return this.securityContext;\n    }\n\n    @Override\n    public boolean isGenerated() {\n        init();\n    //\u521d\u59cb\u5316\u540e\u5224\u65ad\u662f\u5426\u4e3a\u672a\u767b\u5f55\u7684SecurityContext\n        return this.missingContext;\n    }\n\n    private void init() {\n    //\u5982\u679csecurityContext\u4e0d\u4e3anull\u8868\u793a\u5df2\u7ecf\u521d\u59cb\u5316\u8fc7\u4e86\n        if (this.securityContext != null) {\n            return;\n        }\n        //\u76f4\u63a5\u901a\u8fc7supplier\u83b7\u53d6securityContext\u5bf9\u8c61\n        this.securityContext = this.supplier.get();\n    //\u5982\u679csecurityContext\u5bf9\u8c61\u4e3anull\uff0c\u90a3\u4e48\u5c31\u6807\u8bb0missingContext\n        this.missingContext = (this.securityContext == null);\n        if (this.missingContext) {\n      //\u5f53missingContext\u4e3a\u771f\u65f6\uff0c\u8bf4\u660e\u6ca1\u6709securityContext\uff08\u4e00\u822c\u662f\u672a\u767b\u5f55\u7684\u60c5\u51b5\uff09\n      //\u90a3\u4e48\u5c31\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684securityContext\uff0c\u4e0d\u5305\u542b\u4efb\u4f55\u8ba4\u8bc1\u4fe1\u606f\n            this.securityContext = this.strategy.createEmptyContext();\n      //\u65e5\u5fd7\u65e0\u89c6\u5c31\u597d\n            if (logger.isTraceEnabled()) {\n                logger.trace(LogMessage.format(\"Created %s\", this.securityContext));\n            }\n        }\n    }\n\n}\n</code></pre> <p>\u63a5\u7740\u662f\u7b2c\u4e8c\u4e2a\u88ab\u904d\u5386\u7684\u5b9e\u73b0RequestAttributeSecurityContextRepository\u7c7b\uff1a</p> <pre><code>    @Override\n    public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {\n        Supplier&lt;SecurityContext&gt; supplier = () -&gt; getContext(request);\n    //\u540c\u6837\u662f\u8fd4\u56deSupplierDeferredSecurityContext\u5bf9\u8c61\n        return new SupplierDeferredSecurityContext(supplier, this.securityContextHolderStrategy);\n    }\n\n    private SecurityContext getContext(HttpServletRequest request) {\n    //\u901a\u8fc7HttpServletRequest\u7684Attribute\u83b7\u53d6SecurityContext\n    //\u7531\u4e8e\u4e00\u822c\u60c5\u51b5\u4e0b\u6ca1\u6709\u8bbe\u5b9a\u8fc7\uff0c\u56e0\u6b64\u5f97\u5230\u7684\u5c31\u662fnull\n        return (SecurityContext) request.getAttribute(this.requestAttributeName);\n    }\n</code></pre> <p>\u6700\u540e\uff0c\u4e24\u4e2aSecurityContext\u5c31\u4f1a\u4ee5\u94fe\u5f0f\u5b58\u653e\u5728DelegatingDeferredSecurityContext\u5bf9\u8c61\u4e2d\uff0c\u4e00\u5e76\u8fd4\u56de\u4e86\uff0c\u5b83\u7684\u5185\u90e8\u957f\u8fd9\u6837\uff1a</p> <pre><code>static final class DelegatingDeferredSecurityContext implements DeferredSecurityContext {\n\n        private final DeferredSecurityContext previous;\n\n        private final DeferredSecurityContext next;\n\n        DelegatingDeferredSecurityContext(DeferredSecurityContext previous, DeferredSecurityContext next) {\n            this.previous = previous;\n            this.next = next;\n        }\n\n        @Override\n        public SecurityContext get() {\n      //\u5728\u83b7\u53d6SecurityContext\u65f6\uff0c\u4f1a\u9996\u5148\u4ece\u6700\u524d\u9762\u7684\u5f00\u59cb\u83b7\u53d6\n            SecurityContext securityContext = this.previous.get();\n      //\u5982\u679c\u6700\u524d\u9762\u7684SecurityContext\u662f\u5df2\u767b\u5f55\u7684\uff0c\u90a3\u4e48\u76f4\u63a5\u8fd4\u56de\u8fd9\u4e2aSecurityContext\n            if (!this.previous.isGenerated()) {\n                return securityContext;\n            }\n      //\u5426\u5219\u7ee7\u7eed\u770b\u540e\u9762\u7684\uff0c\u4e5f\u8bb8\u540e\u9762\u7684\u4f1a\u6709\u5df2\u767b\u5f55\u7684\uff08\u5b9e\u5728\u6ca1\u6709\u5c31\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u7a7a\u7684SecurityContext\u4e86\uff09\n            return this.next.get();\n        }\n\n        @Override\n        public boolean isGenerated() {\n            return this.previous.isGenerated() &amp;&amp; this.next.isGenerated();\n        }\n}\n</code></pre> <p>\u515c\u4e86\u8fd9\u4e48\u5927\u4e00\u5708\uff0c\u73b0\u5728\u56de\u5230\u4e00\u5f00\u59cb\u7684Filter\u4e2d\uff1a</p> <pre><code>    private void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain)\n            throws ServletException, IOException {\n        ...\n    Supplier&lt;SecurityContext&gt; deferredContext = this.securityContextRepository.loadDeferredContext(request);\n    //\u62ff\u5230\u6700\u7ec8\u7684SecurityContext\u7684Supplier\u540e\uff0c\u7ee7\u7eed\u4e0b\u9762\u7684\u8bed\u53e5\n        try {\n      //\u5411securityContextHolderStrategy\u4e2d\u8bbe\u7f6e\u6211\u4eec\u4e0a\u9762\u5f97\u5230\u7684DeferredSecurityContext\n            this.securityContextHolderStrategy.setDeferredContext(deferredContext);\n      //\u8bf7\u6c42\u524d\u7684\u4efb\u52a1\u5df2\u5b8c\u6210\uff0c\u7ee7\u7eed\u5176\u4ed6\u8fc7\u6ee4\u5668\u4e86\n            chain.doFilter(request, response);\n        }\n        finally {\n      //\u8bf7\u6c42\u7ed3\u675f\u540e\uff0c\u6e05\u7406\u6389securityContextHolderStrategy\u4e2d\u7684DeferredSecurityContext\n            this.securityContextHolderStrategy.clearContext();\n            request.removeAttribute(FILTER_APPLIED);\n        }\n    }\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e0b\u6211\u4eec\u4e4b\u524d\u901a\u8fc7SecurityContextHolder\u662f\u5982\u4f55\u83b7\u53d6\u5230SecurityContext\u7684\uff1a</p> <pre><code>public class SecurityContextHolder {\n    ...\n  private static String strategyName = System.getProperty(SYSTEM_PROPERTY);\n    private static SecurityContextHolderStrategy strategy;\n    private static int initializeCount = 0;\n\n    static {\n    //\u7c7b\u52a0\u8f7d\u65f6\u4f1a\u8fdb\u884c\u4e00\u6b21\u521d\u59cb\u5316\n        initialize();\n    }\n\n    private static void initialize() {\n    //\u521d\u59cb\u5316\u4f1a\u5c06\u5bf9\u5e94\u7684SecurityContextHolderStrategy\u5bf9\u8c61\u7ed9\u521b\u5efa\n        initializeStrategy();\n        initializeCount++;\n    }\n\n  //\u521d\u59cb\u5316SecurityContextHolderStrategy\u5bf9\u8c61\n    private static void initializeStrategy() {\n        ...\n        // \u5c1d\u8bd5\u52a0\u8f7d\u7cfb\u7edf\u914d\u7f6e\u4e2d\u8bbe\u5b9a\u7684Strategy\u5b9e\u73b0\u7c7b\uff0c\u9ed8\u8ba4\u662fMODE_THREADLOCAL\n        try {\n            Class&lt;?&gt; clazz = Class.forName(strategyName);\n            Constructor&lt;?&gt; customStrategy = clazz.getConstructor();\n      // \u8fd9\u91cc\u76f4\u63a5\u6839\u636e\u914d\u7f6e\u4e2d\u7684\u7c7b\u540d\uff0c\u7528\u53cd\u5c04\u6012\u8279\u4e00\u4e2a\u5bf9\u8c61\u51fa\u6765\n            strategy = (SecurityContextHolderStrategy) customStrategy.newInstance();\n        }\n        catch (Exception ex) {\n            ReflectionUtils.handleReflectionException(ex);\n        }\n    }\n\n    //\u6e05\u9664Context\u4e2d\u7684\u5185\u5bb9\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6e05\u7406SecurityContextHolderStrategy\u4e2d\u7684\u5185\u5bb9\n    public static void clearContext() {\n        strategy.clearContext();\n    }\n\n    //\u83b7\u53d6SecurityContext\u5bf9\u8c61\n    public static SecurityContext getContext() {\n    //\u83b7\u53d6SecurityContext\u5b9e\u9645\u4e0a\u4e5f\u662f\u901a\u8fc7SecurityContextHolderStrategy\u6839\u636e\u7b56\u7565\u6765\u83b7\u53d6\n        return strategy.getContext();\n    }\n\n  ...\n}\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u5b9e\u9645\u4e0aSecurityContextHolder\u83b7\u53d6SecurityContext\u5bf9\u8c61\uff0c\u5c31\u662f\u901a\u8fc7SecurityContextHolderStrategy\u6839\u636e\u7b56\u7565\u6765\u83b7\u53d6\uff0c\u6211\u4eec\u76f4\u63a5\u6765\u770bSecurityContextHolderStrategy\u7684\u5b9e\u73b0\u7c7b\uff1a</p> <pre><code>final class ThreadLocalSecurityContextHolderStrategy implements SecurityContextHolderStrategy {\n\n  //\u5185\u90e8\u7ef4\u62a4\u4e00\u4e2aThreadLocal\u5bf9\u8c61\uff0c\u6309\u7ebf\u7a0b\u5b58\u50a8\u5bf9\u5e94\u7684DeferredSecurityContext\n    private static final ThreadLocal&lt;Supplier&lt;SecurityContext&gt;&gt; contextHolder = new ThreadLocal&lt;&gt;();\n\n    @Override\n    public void clearContext() {\n    //\u6e05\u7406\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u6e05\u7406\u6389ThreadLocal\u4e2d\u5b58\u7684\u5bf9\u8c61\n        contextHolder.remove();\n    }\n\n    @Override\n    public SecurityContext getContext() {\n    //\u83b7\u53d6\u4e5f\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u901a\u8fc7Supplier\u62ff\u5230\u9700\u8981\u7684SecurityContext\u5bf9\u8c61\n        return getDeferredContext().get();\n    }\n\n    @Override\n    public Supplier&lt;SecurityContext&gt; getDeferredContext() {\n        Supplier&lt;SecurityContext&gt; result = contextHolder.get();\n    //\u5982\u679c\u5b58\u50a8\u7684DeferredSecurityContext\u4e3anull\uff0c\u8fd9\u91cc\u4e34\u65f6\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684SecurityContext\u5e76\u4fdd\u5b58\n        if (result == null) {\n            SecurityContext context = createEmptyContext();\n            result = () -&gt; context;\n            contextHolder.set(result);\n        }\n        return result;\n    }\n\n    ...\n\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6574\u4e2a\u6d41\u7a0b\u5176\u5b9e\u5c31\u5f88\u6e05\u695a\u4e86\uff0c\u9879\u76ee\u542f\u52a8\u65f6\uff0cSecurityContextHolder\u4f1a\u81ea\u52a8\u6839\u636e\u914d\u7f6e\u521b\u5efa\u5bf9\u5e94\u7684SecurityContextHolderStrategy\u5bf9\u8c61\u3002\u5f53\u6211\u4eec\u7684\u8bf7\u6c42\u5230\u6765\u4e4b\u540e\uff0c\u9996\u5148\u4f1a\u7ecf\u8fc7SecurityContextHolderFilter\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u901a\u8fc7SecurityContextRepository\u6765\u5c06\u4e0d\u540c\u5730\u65b9\u5b58\u50a8\uff08\u4e00\u822c\u662fSession\u4e2d\u5b58\u50a8\uff09\u7684SecurityContext\u5bf9\u8c61\u53d6\u51fa\u5e76\u5c01\u88c5\u4e3aDefferdSecurityContext\uff0c\u7136\u540e\u5c06\u5176\u6dfb\u52a0\u5230\u4e00\u5f00\u59cb\u521b\u5efa\u597d\u7684SecurityContextHolderStrategy\u5bf9\u8c61\u4e2d\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u7684Controller\u5728\u5904\u7406\u65f6\u5c31\u80fd\u76f4\u63a5\u4eceSecurityContextHolder\u53d6\u51faSecurityContext\u5bf9\u8c61\u4e86\uff0c\u6700\u540e\u5728\u5904\u7406\u7ed3\u675f\u8fd4\u56de\u54cd\u5e94\u65f6\uff0cSecurityContextHolderFilter\u4e5f\u4f1a\u5c06SecurityContextHolderStrategy\u5b58\u50a8\u7684DefferdSecurityContext\u6e05\u9664\u6389\uff0c\u81f3\u6b64\uff0c\u4e00\u4e2a\u5b8c\u6574\u6d41\u7a0b\u7ed3\u675f\u3002</p>"},{"location":"notes/Java%20Spring/Spring%20Security/#_19","title":"\u5b9e\u6218\uff1a\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u5728\u4e86\u89e3\u4e86SpringSecurity\u7684\u5927\u90e8\u5206\u529f\u80fd\u540e\uff0c\u6211\u4eec\u5c31\u6765\u5c06\u6574\u4e2a\u7f51\u7ad9\u7684\u5185\u5bb9\u8fdb\u884c\u5b8c\u5584\uff0c\u767b\u9646\u76ee\u524d\u5df2\u7ecf\u5b9e\u73b0\u4e86\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u6ce8\u518c\u529f\u80fd\uff08\u4ec5\u9488\u5bf9\u4e8e\u5b66\u751f\uff09</li> <li>\u89d2\u8272\u5206\u4e3a\u540c\u5b66\u548c\u7ba1\u7406\u5458<ul> <li>\u7ba1\u7406\u5458\u8d1f\u8d23\u4e0a\u67b6\u3001\u5220\u9664\u3001\u66f4\u65b0\u4e66\u7c4d\uff0c\u67e5\u770b\u6240\u6709\u540c\u5b66\u7684\u501f\u9605\u5217\u8868</li> <li>\u540c\u5b66\u53ef\u4ee5\u501f\u9605\u548c\u5f52\u8fd8\u4e66\u7c4d\uff0c\u4ee5\u53ca\u67e5\u770b\u81ea\u5df1\u7684\u501f\u9605\u5217\u8868</li> </ul> </li> </ul> <p>\u73b0\u5728\u6211\u4eec\u5c31\u6765\u4ece\u5934\u7f16\u5199\u4e00\u4e2a\u57fa\u4e8eSSM\u7684\u56fe\u4e66\u7ba1\u7406\u7cfb\u7edf\u5427\uff01</p>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/","title":"Manjaro+Windows \u53cc\u7cfb\u7edf\u5b89\u88c5\u6559\u7a0b","text":"<p>(\u53ef\u53c2\u8003archlinux \u88c5\u673a\u6307\u5357)</p>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#_1","title":"\u4e0b\u8f7d\u5b89\u88c5\u5305","text":"<ol> <li>dowmload .iso from offical website \u4e0b\u8f7d\u5730\u5740</li> <li>make installer with an empty storage and rufus</li> <li>\u66f4\u6539BIOS</li> <li>magicbook pro<ol> <li>Getting into the BIOS, changer HDD device</li> <li>reboot</li> </ol> </li> <li>pavilon 14 plus<ol> <li>\u5f00\u673a\u754c\u9762\u6309F10\u8fdb\u5165BIOS, \u5173\u95ed\u5b89\u5168\u542f\u52a8</li> <li>\u91cd\u542f\uff0c\u63d2\u5165U\u76d8\uff0c\u6309F9, \u9009\u62e9 UEFI: xxxx \u4eceu\u76d8\u542f\u52a8 </li> </ol> </li> <li>config, and restart</li> <li>\u5982\u679c\u60f3\u8981\u5c06u\u76d8\u56de\u590d\u6210\u6b63\u5e38\u72b6\u6001\uff0c\u53ef\u53c2\u8003</li> <li>\u4e4b\u540e\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 ventory, \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a u \u76d8\u5b89\u88c5\u591a\u4e2a\u542f\u52a8\u7a0b\u5e8f</li> </ol>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#_2","title":"\u5b89\u88c5\u540e\u7684\u57fa\u672c\u914d\u7f6e","text":"<ul> <li>\u5982\u679c\u4f60\u662f\u9ad8\u5206\u5c4f\uff0c\u53ef\u4ee5\u5728 settings -&gt; System-settings -&gt; Display and Monitor \u91cc\u9762\u8bbe\u7f6e\u7f29\u653e\u6bd4\u4f8b (kde)</li> <li>\u5982\u679c\u4f60\u662f\u9ad8\u5206\u5c4f\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u8bbe\u7f6e grub \u7684\u7f29\u653e\u3002</li> <li>\u9996\u5148\u5728 grub \u754c\u9762 (\u5c31\u662f\u9009\u62e9\u54ea\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u542f\u52a8\u7684\u754c\u9762) \u6309 <code>c</code> \u8fdb\u5165 cmd \u754c\u9762\uff0c\u8f93\u5165   <code>videoinfo</code> \u67e5\u770b\u5c4f\u5e55\u652f\u6301\u7684\u5206\u8fa8\u7387</li> <li>\u5f00\u673a\u540e\u5728 <code>/etc/default/grub</code> \u4e0b\u6dfb\u52a0 <code>GRUB_GFXMODE=\"640x480x32\"</code></li> <li><code>sudo grub-mkconfig -o /boot/grub/grub.cfg</code> \u66f4\u65b0grub</li> <li>\u914d\u7f6e archlinuxcn    \u8f93\u5165<code>sudo nano /etc/pacman.conf</code>   \u5c06\u4e0b\u9762\u8fd9\u4e2a\u955c\u50cf\u6dfb\u52a0\u5728\u6587\u4ef6\u6700\u4e0b\u9762   <pre><code>[archlinuxcn]\nSigLevel = Never\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch\n</code></pre></li> <li>\u5207\u6362\u56fd\u5185\u6e90 <code>sudo pacman-mirrors -c china</code></li> <li>\u5b89\u88c5 yay\uff0caur \u52a9\u624b   <pre><code>sudo pacman -Syu\nsudo pacman -S yay # \u5b89\u88c5 AUR \u52a9\u624b\n</code></pre></li> <li>\u5b89\u88c5 obs \u7528\u4e8e\u5f55\u5c4f</li> <li>\u5b89\u88c5\u5e38\u7528\u8f6f\u4ef6\uff0c\u4fbf\u4e8e\u540e\u7eed\u914d\u7f6e neovim, lazygit, ranger, tmux\uff0calacritty</li> <li>\u5b89\u88c5\u6d4f\u89c8\u5668</li> <li>chromium \u9700\u8981\u989d\u5916\u914d\u7f6e\u624d\u53ef\u4ee5\u8fdb\u884c\u540c\u6b65 ref</li> <li>\u914d\u7f6e\u4ee3\u7406 (clash)<ul> <li>\u68c0\u67e5\u7ec8\u7aef\u4ee3\u7406\u662f\u5426\u6b63\u5e38</li> <li>\u68c0\u67e5\u6d4f\u89c8\u5668\u4ee3\u7406\u662f\u5426\u6b63\u5e38</li> </ul> </li> <li>\u5b89\u88c5\u5b57\u4f53\u6587\u4ef6</li> <li>\u7ed9 github \u6dfb\u52a0 SSH-key</li> <li>\u8bbe\u7f6e ssh \u8d70 http \u4ee3\u7406 doc</li> <li>\u7ed9\u5e38\u7528\u8f6f\u4ef6\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6 (dotfiles)</li> <li>nvim \u7684\u914d\u7f6e\u4f9d\u8d56 npm, nodejs, yarn</li> </ul> <p>bonus </p> <ul> <li>\u53ef\u4ee5\u5728\u65e7\u673a\u5668\u4e0a\u5f00\u542f sshd, \u65b9\u4fbf\u4e24\u4e2a\u673a\u5668\u4e4b\u95f4\u4e92\u4f20\u6587\u4ef6</li> <li>\u786e\u4fdd\u4e24\u4e2a\u673a\u5668\u5728\u76f8\u540c\u5c40\u57df\u7f51\u4e0b</li> <li>\u5728\u65e7\u673a\u5668\u4e0a\u5f00\u542f <code>sudo systemctl enable sshd &amp;&amp; sudo systemctl start sshd</code></li> <li>\u901a\u8fc7 <code>ip addr</code> \u67e5\u770b ip \u5730\u5740</li> <li>\u5728\u65b0\u673a\u5668\u4e0a \u901a\u8fc7 <code>ssh {username}@{ip}</code> </li> <li>\u5c06\u65e7\u673a\u5668\u4e0a gnome \u7684\u914d\u7f6e\u5bfc\u51fa\u5230 \u65b0\u673a\u5668</li> <li>\u53ef\u4ee5\u4f7f\u7528 localsend \u6765\u8fdb\u884c\u4e0d\u540c\u8bbe\u5907\u95f4\u7684\u6587\u4ef6\u4f20\u8f93</li> </ul>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#_3","title":"\u5b89\u88c5\u5e38\u7528\u8f6f\u4ef6","text":""},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#pacman","title":"pacman","text":"<p>summery: [\u8f93\u5165\u6cd5] fcxit5 [ASCII ART]: lolcat, figlet [\u56fe\u7247\u58c1\u7eb8]\uff1avariety feh flameshot [\u5199\u4f5c\u5de5\u5177] obsdian emacs zotero [\u56fe\u50cf\u5904\u7406\u3001\u89c6\u9891\u526a\u8f91] kdenlive [\u591a\u5c4f\u534f\u540c] rustdesk scrcpy [\u90ae\u4ef6\u7ba1\u7406] thunderbird [RSS\u8ba2\u9605] fluent-reader [podcast] vocal [wechat] wine-wechat-setup</p> <p>fcitx5</p> <ol> <li> <p>\u5b89\u88c5\u7a0b\u5e8f</p> <pre><code>sudo pacman -S fcitx5-im # \u8f93\u5165\u6cd5\u57fa\u7840\u5305\u7ec4\nsudo pacman -S fcitx5-chinese-addons # \u5b98\u65b9\u4e2d\u6587\u8f93\u5165\u5f15\u64ce\nsudo pacman -S fcitx5-anthy # \u65e5\u6587\u8f93\u5165\u5f15\u64ce\nsudo pacman -S fcitx5-pinyin-moegirl # \u840c\u5a18\u767e\u79d1\u8bcd\u5e93\u3002\u4e8c\u523a\u733f\u5fc5\u5907\uff08archlinuxcn\uff09\nsudo pacman -S fcitx5-material-color # \u8f93\u5165\u6cd5\u4e3b\u9898\n</code></pre> </li> <li> <p>\u5b89\u88c5 rime-auto-deploy</p> </li> <li>\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002\u901a\u8fc7 vim \u7f16\u8f91\u6587\u4ef6 /etc/environment</li> </ol> <p><pre><code> GTK_IM_MODULE=fcitx\n QT_IM_MODULE=fcitx\n XMODIFIERS=@im=fcitx\n SDL_IM_MODULE=fcitx\n GLFW_IM_MODULE=ibus\n</code></pre> 4. \u5728 Fcitx \u754c\u9762\u6dfb\u52a0 Rime</p> <p></p> <p></p> <p>emacs</p> <p>\u5220\u9664\u63d2\u4ef6\u76ee\u5f55\uff0c\u4f7f\u7528 <code>M-x install-selected-packages</code> \u91cd\u65b0\u5b89\u88c5\u63d2\u4ef6</p>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#_4","title":"\u5e38\u7528\u7684\u547d\u4ee4\u884c\u5de5\u5177","text":"<p><code>sudo pacman -S ripgrep fd lsd zoxide fzf tldr</code></p>"},{"location":"notes/tools/Manjaro%2BWindows%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/#yay","title":"yay","text":"<p>summery: linux_qq, wps-office, visual-studio-code-bin</p> <pre><code>yay -S wps-office-mui-zh-cn wps-office-mime-cn wps-office-cn wps-office-fonts ttf-ms-fonts  ttf-wps-fonts\nyay -S wemeet-bin\nyay -S baidunetdisk-bin\nyay -S clash-for-windows-bin\nyay -S netease-cloud-music-gtk-bin\nyay -S xmind\n</code></pre> <p>vscode</p> <p>\u542f\u7528\u540c\u6b65\u529f\u80fd\uff0c\u540c\u6b65\u8bbe\u7f6e</p> <p> Tips  </p> <ul> <li>\u8f93\u5165\u6cd5\u811a\u672c github </li> <li>flameshot \u65e0\u6cd5\u83b7\u53d6\u622a\u56fe <code>yay -S xdg-desktop-portal-gnome-noprompt-git</code> </li> <li>wpspdf \u6ca1\u6709\u529e\u6cd5\u6253\u5f00 <code>yay -S libtiff5</code> </li> <li>pyright import \u62a5\u9519\u7684\u8bdd\uff0c\u9000\u51fa\u91cd\u65b0\u8fdb\u5165\u8bd5\u8bd5\u3002\u5728 neovim \u91cc\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e0d\u5173\u95ed neovim\uff0c\u800c</li> <li>\u4f7f\u7528 <code>e XX</code> \u6253\u5f00\u53e6\u4e00\u4e2a py \u6587\u4ef6\uff0c\u5f15\u7528\u521a\u521a\u521b\u5efa\u7684\u6587\u4ef6\u65f6\uff0c\u4f1a\u5931\u8d25</li> <li>wps \u65e0\u6cd5\u4f7f\u7528fcitx5 \u5b89\u88c5manjaro-asian-input-support-fcitx5 </li> </ul>"},{"location":"notes/tools/outline/","title":"\u5206\u4eab\u4f1a","text":""},{"location":"notes/tools/outline/#intro","title":"Intro","text":"<p>\u5927\u5bb6\u597d\uff0c\u8fd9\u662f\u7b2c\u516d\u6b21\u5206\u4eab\u4f1a\u8865\u5f55\uff0c\u586b\u4e00\u4e0b\u4e4b\u524d\u7559\u4e0b\u7684\u5751, slide \u7684\u94fe\u63a5\u5728\u653e\u5728\u7b80\u4ecb\u91cc\u3002</p> <p>\u90a3\u4e48\u505a\u8fd9\u4e2a\u5206\u4eab\u4f1a\u7684\u521d\u8877\u5c31\u662f\u6765\u4f20\u6559\u4e00\u4e0b Linux qaq\u3002 \u56e0\u4e3a\u6211\u770b\u8eab\u8fb9\u540c\u5b66\u4f7f\u7528Linux \u505a\u4e3b\u529b\u7cfb\u7edf\u7684\u4e0d\u662f\u5f88\u591a\u3002\u7136\u540e\u4e0d\u5c11\u540c\u5b66\u5176\u5b9e\u5bf9 Linux \u64cd\u4f5c\u7cfb\u7edf\u6709\u4e0d\u5c11\u504f\u89c1\uff0c\u6bd4\u5982\u4f7f\u7528 Linux \u5c31\u4e00\u5b9a\u662f\u5728 \u9ed1\u6846\u6846\u91cc\u6572\u547d\u4ee4\u3002\u5176\u5b9e Linux \u662f\u4e00\u76f4\u6709\u56fe\u5f62\u5316\u754c\u9762\u7684\uff0c\u6700\u65e9\u662f Xwindow, \u53d1\u5c55\u5230\u73b0\u5728\u7684 wayland, hyperland, \u53ea\u4e0d\u8fc7\u662f\u73b0\u5728\u670d\u52a1\u5668\u4f7f\u7528Linux\u64cd\u4f5c\u7cfb\u7edf\u6bd4\u8f83\u591a\u3002 </p> <p>\u5982\u679c\u4f60\u60f3\u8981\u6298\u817e\uff0c \u5728 Linux \u4e0b\u53ef\u4ee5\u505a\u5230\u4e0d\u8f93 MacOS \u7684\u4ea4\u4e92\u4f53\u9a8c\uff0c\u5982\u679c\u4f60\u4e0d\u60f3\u6298\u817e\uff0c\u90a3\u4e48\u60f3 Gnome, kde \u8fd9\u7c7b\u684c\u9762\u73af\u5883\u4e5f\u80fd\u505a\u5230\u5f00\u7bb1\u5373\u7528\u3002</p>"},{"location":"notes/tools/outline/#_2","title":"\u6b63\u9898","text":""},{"location":"notes/tools/outline/#_3","title":"\u64cd\u4f5c\u7cfb\u7edf\u4ecb\u7ecd","text":"<p>\u597d\u4e86\uff0c\u8fdb\u5165\u6211\u4eec\u4eca\u5929\u7684\u6b63\u9898\u90e8\u5206\u3002\u6211\u4eec\u4eca\u5929\u4e3b\u8981\u4ecb\u7ecd\u4e3b\u6d41\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 Linux\uff0cLinux \u4e0b\u5f00\u53d1\u73af\u5883\u5927\u6982\u662f\u600e\u6837\u7684\u3002\u518d\u8be6\u7ec6\u4ecb\u7ecd\u4e24\u4e2a\u5e38\u7528\u7684 Linux \u4e0b\u7684\u5e94\u7528\u7a0b\u5e8f Vim, Make, \u6700\u540e\u63a8\u8350\u4e00\u4e9b\u597d\u7528\u7684\u73b0\u4ee3\u5316\u547d\u4ee4\u884c\u5de5\u5177\u3002</p> <p>\u76ee\u524d\u4e3b\u6d41\u7684\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4e09\u79cd\uff0c\u5927\u5bb6\u6700\u719f\u6089\u7684 Windows, \u7136\u540e MacOS, \u6700\u540e\u662f Linux\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cMacOS \u672c\u8eab\u5c31\u662f\u57fa\u4e8e BSD Linux \u4e8c\u6b21\u521b\u4f5c\u7684\u3002\u6240\u4ee5 MacOS \u5176\u5b9e\u4e5f\u7b97\u534a\u4e2a Linux\u3002</p> <p>\u5e02\u573a\u4efd\u989d maybe**</p>"},{"location":"notes/tools/outline/#windows","title":"\u4e3a\u4ec0\u4e48\u4e0d\u63a8\u8350\u7528 windows\u3002","text":"<p>\u9996\u5148\u662f\u81c3\u80bf\uff0c\u4f60\u77e5\u9053 \u5bb6\u5ead\u7248\u548c\u65d7\u8230\u7248 windows \u6709\u4ec0\u4e48\u533a\u522b\u5417\uff1f\u4e13\u4e1a\u7248\u548c\u65d7\u8230\u7248\u5462\uff1f\u6211\u4e5f\u4e0d\u77e5\u9053 -=-\u3002\u7136\u540e\u63d0\u5230 windows \u5c31\u4e0d\u5f97\u4e0d\u63d0\u5230\u4e00\u4e2a\u53eb\u4f5c\u6ce8\u518c\u8868\u7684\u4e1c\u897f\uff0c\u8fd9\u4e2a\u7ec4\u4ef6 windows \u4ece 3.1 \u7528\u5230\u73b0\u5728 windows11, 30\u591a\u5e74\u4e86\uff0c\u6838\u5fc3\u903b\u8f91\u8fd8\u662f\u6ca1\u53d8\u3002\u4f60\u8bf4\u80fd\u4e0d\u81c3\u80bf\u5417\uff1f</p> <p>Windows \u9002\u5408\u4f7f\u7528\uff0c\u4f46\u4e0d\u9002\u5408\u5f00\u53d1\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728windows \u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u9996\u5148\u9700\u8981\u6253\u5f00\u63a7\u5236\u9762\u677f\uff0c\u9ad8\u7ea7\u8bbe\u8ba1\uff0c\u7f16\u8f91\u73af\u5883\u53d8\u91cf\uff0c\u7136\u540e\u8fd8\u8981\u533a\u5206\u4e00\u4e0b\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u548cPATH\u3002Linux \u4e0b\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u53ea\u9700\u8981\u5728 .bashrc / .zshrc \u4e0b \u6dfb\u52a0 <code>export VAR=VALUE</code> \u5373\u53ef\u3002</p> <p>\u800c\u4e14\u5728 Windows \u6dfb\u52a0\u4e86\u90a3\u4e48\u591a\u6b21\u73af\u5883\u53d8\u91cf\uff0c\u4f60\u6050\u6015\u4e5f\u4e0d\u77e5\u9053\u73af\u5883\u53d8\u91cf\u5230\u5e95\u662f\u5e72\u561b\u7684\u3002</p> <p>\u7a33\u5b9a\u6027\u4e0d\u7528\u8bf4\uff0c\u5927\u5bb6\u6216\u591a\u6216\u5c11\u90fd\u9047\u5230\u8fc7 windows \u7684 \u84dd\u5c4f\u73b0\u8c61\uff0c\u800c\u4e14\u89e3\u51b3\u529e\u6cd5\u4e00\u822c\u4e5f\u53ea\u6709\u4e00\u4e2a\uff0c\u91cd\u542f\u3002</p> <p>\u5b89\u5168\u6027\u95ee\u9898\uff0c\u5176\u5b9e\u6211\u4e5f\u4e0d\u662f\u5f88\u4e86\u89e3\uff0c\u5927\u5bb6\u81ea\u5df1\u8bfe\u540e\u770b\u770b\u5427\u3002</p>"},{"location":"notes/tools/outline/#linux","title":"\u4e3a\u4ec0\u4e48\u7528Linux","text":"<ul> <li>Linux \u662f\u81ea\u7531\u8f6f\u4ef6\uff0c\u6e90\u4ee3\u7801\u516c\u5f00\u3002</li> <li>\u8f7b\u91cf\u7ea7\uff0c\u5bf9\u786c\u4ef6\u8981\u6c42\u4e0d\u9ad8\uff0cAlpine Linux \u7684\u955c\u50cf\u6587\u4ef6\u53ea\u6709 5MB</li> <li>\u7a33\u5b9a\uff0c\u517c\u5bb9\u6027\u5f3a\u3002\u8fd9\u91cc\u7684 Arduino Uno \u82af\u7247\u4e3b\u9891\u53ea\u6709 700HZ,\u8fd9\u662f\u4ec0\u4e48\u6982\u5ff5\u5462\uff1f\u6211\u7ed9\u5927\u5bb6\u5c55\u793a\u4e00\u4e0b\u6211\u76ee\u524d\u8fd9\u53f0\u7b14\u8bb0\u672c\u7684\u4e3b\u9891</li> <li>\u6700\u91cd\u8981\u7684\uff0c\u5f00\u53d1\u4f53\u9a8c\u597d\u3002\u8fd9\u4e2a\u6211\u4e4b\u540e\u5728\u5de5\u4f5c\u6d41\u91cc\u4f1a\u63d0\u5230</li> </ul> <p>Linux \u4e25\u683c\u610f\u4e49\u4e0a\u6765\u8bb2\u662f\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff0c\u8fd8\u9700\u8981\u52a0\u4e0a\u4e00\u4e9b\u7cfb\u7edf\u8f6f\u4ef6\u624d\u80fd\u7b97\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u8fd9\u4e5f\u5c31\u662f Linux \u6709\u4f17\u591a\u53d1\u884c\u7248\u7684\u539f\u56e0\uff0c\u4f60\u53ef\u4ee5\u628a Linux kernel \u7406\u89e3\u4e3a\u6c7d\u8f66\u7684\u53d1\u52a8\u673a\uff0c\u4e0d\u540c\u7684\u53d1\u884c\u7248\u5c31\u662f\u4e0d\u540c\u724c\u5b50\u7684\u6c7d\u8f66\u3002</p> <p>\u8fd9\u4e48\u591a\u53d1\u884c\u7248\u600e\u4e48\u9009\u5462? \u6211\u63a8\u8350\u65b0\u624b\u7528 Ubuntu\uff0c\u4e4b\u540e\u719f\u6089\u4e86\u4e4b\u540e\u53ef\u4ee5\u6362\u6210 Arch Linux  manjaro Linux  NixOS</p> <p>\u6700\u540e\u6211\u60f3\u8bf4\u7684\u662f\uff0cLinux \u548c windows macos \u4e00\u6837\uff0c\u4ed6\u5c31\u662f\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0a\u9762\u5b66\u4e60\u3001\u770b\u89c6\u9891\u3001\u6253\u6e38\u620f\u3002\u5927\u5bb6\u5b66 Linux \u7684\u65f6\u5019\u4e0d\u8981\u6709\u592a\u5927\u7684\u5fc3\u7406\u5305\u88b1\uff0c\u5c31\u628a Linux \u5f53\u6210\u4e00\u4e2a\u5927\u53f7\u73a9\u5177\uff0c\u8fd9\u4e2a\u73a9\u5177\u7684\u8bf4\u660e\u4e66\u5c31\u662f\u547d\u4ee4\u884c\u7684 mannul, \u6216\u8005\u662f\u7f51\u4e0a\u7684\u6559\u7a0b\u4e5f\u597d\uff0c\u76f8\u4fe1 Linux \u80fd\u5e26\u7ed9\u4f60\u5feb\u4e50\u7684\u3002</p>"},{"location":"notes/tools/outline/#linux_1","title":"Linux \u4e0b\u5de5\u4f5c\u73af\u5883\u4ecb\u7ecd","text":"<p>\u5927\u5bb6\u5bf9GUI\u5e94\u8be5\u5f88\u719f\u6089\u4e86\uff0c Windows \u7684\u8bdd\uff0c\u90fd\u5728\u548c GUI \u6253\u4ea4\u9053\u3002 \u547d\u4ee4\u884c\u5de5\u5177\u5927\u5bb6\u5e94\u8be5\u4e0d\u964c\u751f\uff0c\u5c31\u662f <code>cd</code> \u4e4b\u7c7b\u7684\u3002\u90a3\u4e48\u5982\u679c\u6211\u65e2\u4e0d\u60f3\u7528\u9f20\u6807\u70b9\u6765\u70b9\u53bb\uff0c\u4e5f\u4e0d\u50cf\u5728\u547d\u4ee4\u884c\u4e00\u4e2a\u4e2a\u7684\u6572\uff0c\u54ea\u6709\u4ec0\u4e48\u5de5\u5177\u53ef\u4ee5\u7528\u5417\uff1f\u5176\u5b9e\u662f\u6709\u7684\uff0c\u6211\u4eec\u53eb\u4ed6 TUI</p> <p>\u6211\u5728 Linux \u4e0b\u5199\u5199\u4ee3\u7801\uff0c\u4e3b\u8981\u4f7f\u7528\u7684\u5c31\u662f\u56db\u4e2a\u5de5\u5177 \u9996\u5148\u6765\u4ecb\u7ecd ranger (\u6f14\u793a\u4e00\u4e0b\u9884\u89c8\u6548\u679c) \u5176\u6b21\u662f tmux (\u6f14\u793a\u5206\u5c4f\u3001\u6302\u8d77\u64cd\u4f5c) \u7136\u540e\u662f vim (\u6f14\u793a\u4e00\u4e0b \u6587\u4ef6\u6811\uff0c\u4ee3\u7801\u7ed3\u6784\uff0c\u667a\u80fd\u8865\u5168\u7b49) \u6700\u540e\u662f LazyGit (\u6f14\u793a\u4e00\u4e0b git add, commit push \u5c31\u597d)</p>"},{"location":"notes/tools/outline/#vim","title":"Vim \u4e13\u9898","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u91cd\u70b9\u4ecb\u7ecd Vim </p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e00\u4e0b\u4ec0\u4e48\u662f Vim\u3002Vim \u662f\u4e00\u4e2a\u6587\u672c\u7f16\u8f91\u5668\uff0c\u4ed6\u7684\u524d\u8eab\u662f vi\uff0cvi\u7684\u524d\u751f\u662fex (\u53ef\u4ee5\u6f14\u793a\u4e00\u4e0b oeasy vim tutorial \u91cc ex \u7684\u56fe\u7247) \u518d\u6765\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528 vim \u7684\u65b9\u5f0f\u3002\u5982\u679c\u4f60\u73b0\u5728\u6ca1\u6709 Linux \u7cfb\u7edf\u73af\u5883\u7684\u8bdd\uff0c\u53ef\u4ee5\u6253\u5f00 Vscode \u7684\u63d2\u4ef6\u5546\u573a\u4e0b\u8f7d\u4e00\u4e2a vim \u63d2\u4ef6\u3002\u8fd9\u4e2a\u63d2\u4ef6\u6a21\u62df\u4e86\u5927\u90e8\u5206 vim \u7684\u529f\u80fd\uff0c\u521d\u5b66\u662f\u8db3\u591f\u4e86\u3002</p> <p>\u6211\u4eec\u4e3a\u4ec0\u4e48\u4f7f\u7528 vim</p> <p>\u6700\u91cd\u8981\u7684\u662f\u56e0\u4e3a vim \u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u7684\u63d0\u9ad8\u4f60\u7684\u7f16\u8f91\u6548\u7387\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f60\u60f3\u751f\u6210\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5305\u542b\u4e86 1-100\u4e2a\u6570\uff0c\u6bcf\u4e2a\u6570\u5404\u5360\u4e00\u884c\uff0c\u4f60\u4f1a\u600e\u4e48\u505a\u3002\u5199\u4e00\u6bb5 c \u7a0b\u5e8f\uff0c\u8fd8\u662f\u5199\u4e00\u4e2a Python \u811a\u672c\uff1f\u5728 Vim\u91cc\u8981\u8fbe\u5230\u8fd9\u4e2a\u6548\u679c\uff0c\u53ea\u9700\u8981\u51e0\u4e2a\u952e\u3002\u6211\u518d\u6f14\u793a\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u73b0\u5728\u6709\u4e00\u4e2a\u5b58\u653e\u56fe\u7247\u7684\u6587\u4ef6\u5939\uff0c\u6211\u73b0\u5728\u60f3\u5199\u4e00\u4e2a\u7f51\u9875\uff0c\u6765\u9648\u5217\u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u56fe\u7247,\u6211\u4eec\u770b\u7528 vim \u662f\u600e\u4e48\u505a\u7684\u3002</p> <p>vim \u53ef\u4ee5\u63d0\u5347\u4f60\u5199\u4ee3\u7801\u65f6\u7684\u4e13\u6ce8\u7a0b\u5ea6\uff0c\u56e0\u4e3a\u5728\u7f16\u8f91\u65f6\uff0c\u4f60\u53cc\u624b\u4e0d\u9700\u8981\u79bb\u5f00\u952e\u76d8\uff0c\u4e0d\u4f1a\u88ab\u9f20\u6807\u6253\u65ad\u3002vim \u8fd8\u6709\u826f\u597d\u7684\u63d2\u4ef6\u751f\u6001\uff0c\u57fa\u672c\u4e0a\u4f60\u60f3\u8981\u6dfb\u52a0\u7684\u529f\u80fd\uff0c\u522b\u4eba\u90fd\u5df2\u7ecf\u5199\u597d\u4e86\u63d2\u4ef6\uff0c\u4f60\u76f4\u63a5\u5b89\u88c5\u5c31\u597d\u4e86\uff0c\u6211\u7684vim\u5c31\u88c5\u4e86\u4e0d\u5c11\u63d2\u4ef6\u3002</p> <p>\u5373\u4fbf\u4f60\u4e0d\u60f3\u4f7f\u7528 vim \u4f5c\u4e3a\u4f60\u7684\u4e3b\u529b\u7f16\u8f91\u5668\uff0c\u4f60\u4e5f\u5e94\u8be5\u5b66\u4e60 vim \u7684\u952e\u4f4d\u903b\u8f91\uff0c\u56e0\u4e3a\u7ec8\u7aef\u4e0b\u4e0d\u5c11\u5de5\u5177\u7684\u5feb\u6377\u952e\u90fd\u662f vim \u98ce\u683c\u7684\uff0c\u6bd4\u5982 more\uff0cman ...</p> <p>\u5982\u679c\u4f60\u4f7f\u7528 ide \u7684\u8bdd\uff0c\u90a3\u4e48\u5927\u6982\u7387\u8fd9\u4e2a ide \u4e5f\u662f\u6709 vim \u63d2\u4ef6\u7684\uff0c\u6240\u4ee5 vim \u548c ide \u5b9e\u9645\u4e0a\u4e5f\u5e76\u4e0d\u662f\u51b2\u7a81\u7684\u3002</p> <p>\u597d\uff0c\u6211\u4eec\u73b0\u5728\u5f00\u59cb\u6b63\u5f0f\u4ecb\u7ecd vim</p> <p>\u8fd9\u6709\u4e00\u4e2a\u6bb5\u5b50\uff0c\u5c31\u662f\u8bf4\u5982\u4f55\u751f\u6210\u4e00\u6bb5\u968f\u673a\u5e8f\u5217\uff0c\u90a3\u5c31\u662f\u8ba9\u65b0\u624b\u9000\u51favim\u3002\u4f60\u4eec\u53ef\u4ee5\u6253\u5f00\u4e00\u4e2avim\u8bd5\u8bd5\u3002</p> <pre><code>vim \n</code></pre> <p>\u4f60\u4f1a\u53d1\u73b0\u6ca1\u6709\u952e\u4f4d\u63d0\u793a\uff0c\u6309 esc \u952e\u6ca1\u53cd\u5e94\uff0c\u6309 ctrl-c \u952e\u4e5f\u6ca1\u53cd\u5e94\uff0c\u600e\u4e48\u56de\u4e8b\u5462\uff1f\u597d\u4e86\uff0c \u73b0\u5728\u6211\u544a\u8bc9\u4f60\u600e\u4e48\u9000\u51fa vim\uff0c\u4eca\u5929\u8fd9\u8282\u8bfe\u4f60\u5176\u4ed6\u7684\u90fd\u53ef\u4ee5\u4e0d\u4f1a\uff0c\u4f46\u81f3\u5c11\u4f60\u5f97\u77e5\u9053\u5982\u4f55\u9000\u51fa vim\u3002\u5c06\u8f93\u5165\u6cd5\u8c03\u5236\u82f1\u6587, \u8f93\u5165 <code>:q</code> \u6216\u8005 <code>:x</code> \u90fd\u53ef\u4ee5\u9000\u51fa</p> <p>\u8981\u9ad8\u6548\u7684\u4f7f\u7528 vim\uff0c\u5c31\u4e0d\u5f97\u4e0d\u63d0\u5230 vim \u7684\u51e0\u79cd\u64cd\u4f5c\u6a21\u5f0f\u3002\u6211\u4eec\u6328\u4e2a\u6765\u4ecb\u7ecd\u3002\u8fdb\u5165 vim \u4e4b\u540e\uff0c\u9ed8\u8ba4\u662f\u666e\u901a\u6a21\u5f0f\uff0c\u6309\u4e0b a / i \u952e\u53ef\u4ee5\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\uff0c\u5728\u63d2\u5165\u6a21\u5f0f\u4e0b\uff0cvim\u4e8e\u5176\u4ed6\u7f16\u8f91\u5668\u65e0\u5dee\u5f02\u3002\u6309\u4e0b esc \u952e\uff0cvim \u9000\u56de\u666e\u901a\u6a21\u5f0f\u3002\u8f93\u5165 <code>:wq</code> \uff0c\u4fdd\u5b58\u5e76\u9000\u51fa\u3002</p> <p>\u4e3a\u4ec0\u4e48\uff0cvim \u8981\u5206\u63d2\u5165\u6a21\u5f0f\u548c\u666e\u901a\u6a21\u5f0f\u5462\uff0c\u76f4\u63a5\u8fdb\u5165 vim \u5c31\u80fd\u7f16\u8f91\u4e0d\u597d\u5417\u3002\u4f60\u8bf4\u5f97\u5bf9\uff0c\u6240\u4ee5\u6709 nano\u3002vim \u5047\u5b9a\u4f60\u4e0d\u4ec5\u5728 vim \u91cc\u5199\u4ee3\u7801\uff0c\u4f60\u8fd8\u4f1a\u82b1\u5927\u91cf\u65f6\u95f4\u4fee\u6539\u3001\u9605\u8bfb\u4ee3\u7801\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e00\u822c\u5904\u4e8e\u666e\u901a\u6a21\u5f0f\uff0c\u800c\u952e\u76d8\u7684\u6240\u6709\u6309\u952e\u51e0\u4e4e\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u64cd\u7eb5\u6587\u672c\u7684\u5feb\u6377\u952e\u3002</p> <p>\u6211\u4eec\u9996\u5148\u4ecb\u7ecd\u79fb\u52a8\u3001\u7136\u540e\u662f\u7f16\u8f91\u3002</p> <ul> <li>\u79fb\u52a8\uff1a</li> </ul> <p>h j k l \u5bf9\u5e94\u4e0a \u4e0b \u5de6 \u53f3\uff0c \u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u65b9\u5411\u952e\uff0c\u4f46\u662f\u4e0d\u63a8\u8350\u3002 w for word, \u5411\u524d\u79fb\u52a8\u4e00\u4e2a\u5355\u8bcd\uff0cb for back, \u5411\u540e\u9000\u4e00\u4e2a\u5355\u8bcd\u3002 e for end, \u79fb\u52a8\u5230\u5f53\u524d\u5355\u8bcd\u7684\u672b\u5c3e\u3002 ( \u53ef\u4ee5\u5411\u524d\u79fb\u52a8\u4e00\u53e5\u8bdd\uff0c )\u5411\u540e\u79fb\u52a8\u4e00\u53e5\u3002 { \u53ef\u4ee5\u5411\u524d\u79fb\u52a8\u4e00\u6bb5\uff0c} \u53ef\u4ee5\u5411\u540e\u79fb\u52a8\u4e00\u6bb5 (\u4f7f\u7528\u7a7a\u884c\u6765\u5224\u65ad)\u3002</p> <ul> <li>\u7f16\u8f91</li> </ul> <p>\u5148\u7c97\u7565\u4ecb\u7ecd\u4e00\u4e0b y for yank, \u590d\u5236 (yy \u590d\u5236\u6574\u884c)\uff1bp for paste, \u7c98\u8d34 (pp\u5230\u4e0b\u4e00\u884c) d for delete (dd \u5220\u9664\u6574\u884c)\u3002\u53ef\u4ee5\u770b\u51fa\u91cd\u590d\u4e24\u6b21\u90fd\u662f\u5bf9\u6574\u884c\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>i for insert, \u5411\u524d\u63d2\u5165\uff0ca for append \u5411\u540e\u63d2\u5165\u3002 o \u5728\u4e0b\u4e00\u884c\u63d2\u5165, O\u5728\u4e0a\u4e00\u884c\u63d2\u5165(\u4e00\u822c\u5c0f\u5199\u5b57\u6bcd\u90fd\u662f\u5728\u5149\u6807\u4e0b\u65b9\u7f16\u8f91\uff0c\u5927\u5199\u5b57\u6bcd\u662f\u5728\u5149\u6807\u4e0a\u65b9\u7f16\u8f91)</p> <p>\u518d\u4ecb\u7ecd\u53ef\u89c6\u6a21\u5f0f</p> <p>\u5728\u666e\u901a\u6a21\u5f0f\u4e0b\uff0c\u6309\u4e0b v \u8fdb\u5165 \u53ef\u89c6 \u6a21\u5f0f\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528\u79fb\u52a8\u952e\u4f4d\u6765\u9009\u62e9\u6587\u672c\uff0chjklwb \u7b49\u7b49\u3002\u9009\u4e2d\u540e \u6309 y/p/d \u590d\u5236/\u66ff\u6362/\u5220\u9664</p> <p>\u6309\u4e0b V \u8fdb\u5165 \u884c\u53ef\u89c6\u6a21\u5f0f\uff0c\u8fd9\u65f6\u5019\u662f\u4e00\u884c\u4e00\u884c\u7684\u9009\u62e9 c-v \u8fdb\u5165 \u5feb\u53ef\u89c6\u6a21\u5f0f\uff0c\u8fd9\u65f6\u5019\u662f\u4e00\u4e2a\u77e9\u5f62\u4e00\u4e2a\u77e9\u5f62\u7684\u9009\u62e9</p> <p>\u7ec4\u5408\u6280</p> <p>\u5728\u666e\u901a\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7 \u6570\u5b57 + \u547d\u4ee4 \u6765\u91cd\u590d\u6267\u884c\u6307\u5b9a\u547d\u4ee4</p> <ul> <li>\u6bd4\u5982 7w \u7b49\u4ef7\u4e8e\u63097\u6b21w</li> <li>7dw \u5220\u9664\u5149\u6807\u540e7\u4e2a\u5355\u8bcd</li> </ul> <p>\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u6587\u672c\u5bf9\u8c61\u6765\u8fdb\u884c\u4fee\u6539</p> <ul> <li>\u6bd4\u5982 di(\uff0c\u5220\u9664\u62ec\u53f7\u5185\u7684\u6240\u6709\u5185\u5bb9</li> <li>da(, \u5220\u9664\u62ec\u53f7\u5185\u7684\u6240\u6709\u5185\u5bb9\uff0c\u5305\u62ec \u62ec\u53f7\u672c\u8eab</li> </ul> <p>vim \u7684\u8fdb\u9636\u5b66\u4e60</p> <p>\u8fd9\u91cc\u6839\u636e\u5269\u4f59\u65f6\u95f4\u9009\u62e9\u6027\u7684\u4ecb\u7ecd\u5427\u3002\u6211\u611f\u89c9\u81f3\u5c11\u8981\u8bb2\u4e00\u4e0b vim \u914d\u7f6e\u6587\u4ef6\u3002</p> <p>vim \u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u9ed8\u8ba4\u8bfb\u53d6 <code>~/.vimrc</code> \u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4fe1\u606f\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u505a\u5199\u4ec0\u4e48\u5462\uff1f</p> <ul> <li>\u914d\u7f6e\u5feb\u6377\u952e</li> <li>\u914d\u7f6e\u63d2\u4ef6</li> <li>\u8c03\u6574 vim \u7f16\u8f91\u5668\u7684\u4e00\u4e9b\u9ed8\u8ba4\u5c5e\u6027</li> </ul> <p>tab \u548c buffer \u662f\u4ec0\u4e48 </p> <p>\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u5728vim\u4e2d\u5206\u5c4f\uff0c\u5f00\u591a\u7a97\u53e3</p>"},{"location":"notes/tools/outline/#make","title":"\u4ecb\u7ecd Make","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u4ecb\u7ecd Make \uff1f\u4e00\u8a00\u4ee5\u853d\u4e4b\uff1a\u81ea\u52a8\u5316\u3002 make \u4f1a\u8bfb\u53d6 Makefile \u8fd9\u4e2a\u6587\u4ef6\u6765\u6784\u5efa\u9879\u76ee\uff0c\u5e9e\u5927\u5982 Linux \u8fd9\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7b80\u7b80\u5355\u5355\u4e00\u4e2a <code>make</code> \u6765\u8fdb\u884c\u6784\u5efa\uff0c\u53ef\u4ee5\u628a\u5b83\u7406\u89e3\u4e3a ide \u4e2d \u8fd0\u884c\u7684\u90a3\u4e2a\u8868\u793a \u8fd0\u884c\u7684 \u4e09\u89d2\u5f62\u6309\u94ae</p> <p>\u4f60\u53ef\u80fd\u4f1a\u8bf4\uff0c\u6709\u4e86 ide\uff0c \u6211\u8fd8\u5b66\u4ec0\u4e48 make \u6b63\u662f\u56e0\u4e3a ide \u5c4f\u853d\u4e86\u8fd9\u4e9b\u7ec6\u8282\uff0c\u4f5c\u4e3a\u8ba1\u7b97\u673a\u4e13\u4e1a\u7684\u6211\u4eec \u4e5f\u5e94\u8be5\u7406\u89e3 \u8fd0\u884c\u80cc\u540e\u7684\u903b\u8f91\u3002 \u51b5\u4e14\uff0c\u6709\u65f6\u5019\u4f60\u5e76\u4e0d\u4e00\u5b9a\u80fd\u4f7f\u7528 ide \u6765\u8fd0\u884c\u9879\u76ee</p> <p>\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684 Makefile \u6587\u4ef6\u6765\u4ecb\u7ecd make\u3002 \u6211\u4eec\u90fd\u77e5\u9053(\u4e5f\u8bb8\u5427) \u8fd0\u884c py \u6587\u4ef6\uff0c\u53ef\u4ee5\u5728\u7ec8\u7aef\u8f93\u5165 python filename\u3002\u90a3\u4e48\u8fd0\u884c c \u8bed\u8a00\u80fd\u4e0d\u80fd\u4e5f\u8fd9\u4e48\u65b9\u4fbf\uff1f\u6211\u4eec\u7528 make \u8bd5\u4e00\u4e0b</p> <p>(\u5f00\u59cb\u8fd0\u884c\u4ee3\u7801)</p> <p>\u4ecb\u7ecd\u6700\u7b80 Makefile \u7684\u542b\u4e49\u3002\u9996\u5148\u5192\u53f7\u524d\u7684\u662f\u6784\u5efa\u76ee\u6807\uff0c\u5192\u53f7\u540e\u7684\u662f\u4f9d\u8d56\u6587\u4ef6\u3002\u518d\u4e0b\u9762\u7684\u662f\u6784\u5efa\u76ee\u6807\u8bf4\u4f7f\u7528\u7684\u547d\u4ee4\u3002</p> <p>\u5f53\u6211\u4eec\u5728\u7ec8\u7aef\u8f93\u5165 make \u540e, <code>make</code> \u4f1a\u6784\u5efa\u7b2c\u4e00\u4e2a\u76ee\u6807\u6587\u4ef6(\u4e5f\u5c31\u662f\u6211\u4eec\u8fd9\u91cc\u7684 default), default \u4f9d\u8d56\u7684\u6587\u4ef6\u662f $(TARGET), \u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u627e\u4e0d\u5230 $(TARGET), \u6240\u4ee5 make \u63a5\u7740\u627e $(TARGET)\u7684\u6784\u5efa\u89c4\u5219\uff0c $(TARGET) \u7684\u4f9d\u8d56\u6587\u4ef6\u662f foo.o  \u800c\u73b0\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u6ca1\u6709 foo.o \u8fd9\u4e2a\u6587\u4ef6, \u90a3\u4e48\u63a5\u7740\u627e foo.o \u7684\u6784\u5efa\u89c4\u5219\uff0cfoo.o \u7684\u4f9d\u8d56\u6587\u4ef6\u662f foo.c, \u6b38\u627e\u5230\u4e86\u3002\u90a3\u4e48\u5f00\u59cb\u6267\u884c <code>gcc -c foo.c foo.c</code>, \u6709\u4e86 <code>foo.o</code> \u540e\uff0c\u5c31\u5f00\u59cb\u6267\u884c <code>gcc foo.o -o foo</code>, <code>@./foo</code> </p> <p>@ \u8868\u793a\u6267\u884c\u4f46\u662f\u4e0d\u518d\u7ec8\u7aef\u6253\u5370\u8fd9\u4e2a\u547d\u4ee4</p> <p>\u9690\u5f0f\u89c4\u5219</p> <p>\u4e4b\u524d\u6211\u4eec\u8bf4\u800c\u73b0\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u6ca1\u6709 foo.o \u8fd9\u4e2a\u6587\u4ef6, \u90a3\u4e48make\u4f1a\u627e\u627e foo.o \u7684\u6784\u5efa\u89c4\u5219\uff0c\u5176\u5b9e\u4e0d\u5199\u8fd9\u4e2a\u4e5f\u884c\uff0cmake \u4f1a\u9690\u5f0f\u63a8\u5bfc\u51fa .o \u6587\u4ef6\u7684\u6784\u5efa\u65b9\u6cd5\u3002</p> <p>\u53ef\u4ee5\u518d\u8bb2\u4e00\u4e0b\u591a\u6587\u4ef6\u6784\u5efa\uff0c\u4f53\u73b0 make \u7684\u7075\u6d3b\u6027</p> <p>\u7ec8\u7aef\u4e0b\u4f7f\u7528\u5de5\u5177\u63a8\u8350\uff1a \u8fd9\u4e2a\u6f14\u793a\u4e00\u4e0b\u5c31\u597d\u4e86\u3002</p>"},{"location":"notes/tools/outline/#_4","title":"\u5b66\u4e60\u65b9\u6cd5","text":"<p>learn by practice, bing(google)/gpt/manual is all you need</p> <p>\u4e00\u5b9a\u8981\u953b\u70bc\u81ea\u5df1\u7684\u4fe1\u606f\u68c0\u7d22\u80fd\u529b\uff0c\u4e00\u5b9a\u8981\u953b\u70bc\u81ea\u5df1\u770b\u6587\u6863\u7684\u80fd\u529b\uff0c \u4e00\u5b9a\u8981\u953b\u70bc\u81ea\u5df1\u770b\u82f1\u6587\u6587\u6863\u7684\u80fd\u529b</p> <p>\u597d\u4e86\uff0c\u6700\u540e\u5c55\u793a\u4e00\u4e0b\u6211slide \u7684\u90e8\u5206\u6765\u6e90\uff0c\u548c\u4e00\u4e9b\u63a8\u8350\u7684\u7f51\u7ad9 \u4eca\u5929\u5206\u4eab\u4f1a\u5230\u6b64\u4ecb\u7ecd\uff0c\u518d\u6b21\u8c22\u8c22\u5927\u5bb6\u80fd\u62bd\u7a7a\u524d\u6765\u53c2\u52a0\u3002</p>"},{"location":"notes/tools/outline/#ysyx","title":"ysyx \u4ecb\u7ecd","text":"<p>\u90a3\u4e48\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u63a5\u4e0b\u6765\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b ysyx \u8fd9\u4e2a\u9879\u76ee\uff0c\u5b83\u878d\u5408\u4e86\u5357\u4eac\u5927\u5b66\u7684PA, \u4fa7\u91cd\u4e8e\u8ba9\u4f60\u4ece 0 \u5f00\u59cb \u642d\u5efa\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684\u5904\u7406\u5668\uff0c\u7136\u540e\u518d\u8fd9\u4e2a\u5904\u7406\u5668\u4e0a\u5199\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\uff0c\u518d\u5728\u8fd9\u4e2a\u64cd\u4f5c\u7cfb\u901a\u7684\u57fa\u7840\u4e0a\u5199\u5e94\u7528\u7a0b\u5e8f\u3002\u6700\u7ec8\u8fbe\u5230\u7684\u6548\u679c\u662f\u80fd\u8fd0\u884c 2000 \u5e74\u5de6\u53f3\u53d1\u884c\u7684\u4ed9\u5251\u5947\u4fa0\u4f20\u6e38\u620f\u3002</p> <p>\u6574\u4e2a\u9879\u76ee\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5  Preveiw \u9884\u5b66\u4e60, \u9884\u5b66\u4e60\u9636\u6bb5\u4e3b\u8981\u662f\u5b66\u4e60\u4e00\u5199\u524d\u7f6e\u77e5\u8bc6\uff0c\u90a3\u4e48\u5176\u4e2d\u5b89\u6392\u5b66\u4e60 Linux\uff0c\u8fd8\u6709\u5bf9 C \u8bed\u8a00\u7684\u57fa\u7840\u7684\u68c0\u67e5\u3002\u5927\u4e00\u7684\u540c\u5b66\u53ef\u4ee5\u501f\u6b64\u68c0\u6d4b\u4e00\u4e0b\u81ea\u5df1\u6c34\u5e73\u3002 \u90a3\u4e48\u5982\u679c\u662f\u5927\u4e8c\u7684\u540c\u5b66\uff0c\u9884\u5b66\u4e60\u9636\u6bb5\u521a\u597d\u4e5f\u6709\u5b89\u6392\u6570\u7535\u7684\u8bfe\u7a0b\uff0c\u5927\u6982\u662f\u5728 FPGA \u6a21\u62df\u5668\u4e0a\u505a\u4e00\u4e9b\u6709\u8da3\u7684\u4eff\u771f\u7535\u8def\u3002</p> <ul> <li>preview \u9884\u5b66\u4e60</li> <li>Base    \u57fa\u7840</li> <li>Advaneced \u9ad8\u7ea7</li> <li>* Super  </li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/","title":"\u5e38\u7528\u914d\u7f6e\u62fe\u9057","text":"<p>${toc}</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_1","title":"\u5e38\u89c1\u914d\u7f6e\u62fe\u9057","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#neovim","title":"neovim","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#neovim_1","title":"\u5b89\u88c5 neovim","text":"<p>for ubuntu</p> <pre><code>sudo apt install software-properties-common -y\nsudo add-apt-repository ppa:neovim-ppa/stable -\nsudo add-apt-repository ppa:neovim-ppa/unstable -y\nsudo apt-get update\nsudo apt install neovim -y\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#neovim_2","title":"neovim \u81ea\u52a8\u8865\u5168","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_2","title":"\u81ea\u52a8\u8865\u5168\u89e6\u53d1\u7684\u903b\u8f91","text":"<p>\u9996\u5148\u5728coc\u4e2d\uff0c\u63a8\u8350\u7684\u914d\u7f6e\u662f\u7528 tab \u9009\u62e9\u8865\u5168\uff0c\u7528cr or \u786e\u8ba4\u9009\u62e9 \u4e5f\u53ef\u4ee5\u914d\u7f6e\u6210\u4f7f\u7528\u65b9\u5411\u952e\u9009\u62e9\u8865\u5168\uff0c\u7528tab\u8fdb\u884c\u786e\u8ba4\uff0c\u8df3\u8f6c <p>\u800c\u7531\u4e8e\u5728 utilsnippets \u4e2d \u7528\u4e8e\u89e6\u53d1\u8865\u5168\u7684\u952e\u662f tab, \u548ccoc\u7684\u5feb\u6377\u952e\u51b2\u7a81\u4e86 \u6240\u4ee5tab\u5207\u6362\u65e0\u6548\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 vimrc \u4e2d\u5c06 util snippets \u7684\u89e6\u53d1\u6539\u6210c-e \u8fd9\u6837\u5927\u5bb6\u5c31\u4e0d\u4e92\u76f8\u5e72\u6270\uff0c\u5404\u73a9\u5404\u7684\u3002</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#snippets","title":"\u4e3asnippets\u589e\u52a0\u6570\u5b66\u73af\u5883","text":"<p>\u5728snippets\u6587\u4ef6 \u6700\u5f00\u59cb\u7684\u5730\u65b9\u52a0\u4e0a</p> <pre><code>global !p\ndef math():\n    return vim.eval('vimtex#syntax#in_mathzone()') == '1'\n\ndef comment(): \n    return vim.eval('vimtex#syntax#in_comment()') == '1'\n\ndef env(name):\n    [x,y] = vim.eval(\"vimtex#env#is_inside('\" + name + \"')\") \n    return x != '0' and x != '0'\nendglobal\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#snippets_1","title":"snippets \u7684\u7ec4\u6210","text":"<p>tutorial </p> symbol meaning w expand on word boundaries A automaticaly expanding &lt;++&gt; <p>\u518d\u7ed9\u5c5e\u4e8e \u6570\u5b66\u73af\u5883\u4e0b\u7684snippets \u5934\u4e0a\u52a0 context \u201cmath()\u201d</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#lsp","title":"\u914d\u7f6e lsp","text":"<p>coc-nvim-lsp </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#c-c","title":"c / c++","text":"<ul> <li>install clangd <code>sudo apt install clangd</code>     Then</li> <li>add <code>coc-clangd</code>     or</li> <li>config language server in cocconfig.json</li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#java","title":"java","text":"<ul> <li>add <code>coc-java</code> in <code>g:coc\\_global\\_extensions</code> list</li> <li>install open-jdk (version &gt;= 17)</li> </ul> <pre><code> apt-cache search openjdk | egrep '11|17|18'\n apt update\n apt install openjdk-17-jdk\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#rust","title":"rust","text":"<p><code>cargo</code></p> <p>very simple</p> <ul> <li>install rust itself website <code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code></li> <li>add <code>coc-rust-analyzer</code> in <code>g:coc\\_global\\_extensions</code> list</li> <li>some tutorial offical tutorial </li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#go","title":"go","text":"<ul> <li>install go itself website</li> <li>install gopls<ol> <li>export GO111MODULE=on</li> <li>go env -w GOPROXY=https://goproxy.cn,direct \u5207\u6362\u4e3a\u56fd\u5185\u4ee3\u7406</li> <li>go install golang.org/x/tools/gopls@latest \u4e0b\u8f7d gopls</li> <li>set up languageserver in cocConfig, remember write absolute path for gopls</li> </ol> </li> <li>begin writing code</li> </ul> <pre><code>go mod init example/hello\ncd example/hello\ntouch hello.go\n</code></pre> <pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, World!\")\n}\n</code></pre> <ul> <li>some tutorial offical </li> </ul> <pre><code>rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.19.4.linux-amd64.tar.gz\n</code></pre> <ul> <li>add <code>coc-rust-analyzer</code> in <code>g:coc\\_global\\_extensions</code> list</li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#haskell","title":"haskell","text":"<ul> <li>first install ghcup, website <p>after installing, may need to add ghcup to your environment variable. <code>export PATH=$PATH: ...</code></p> </li> <li>using ghcup to install hls, website</li> <li>Then add configrations in cocConfig.json</li> </ul> <pre><code>    \"haskell\": {\n            \"command\": \"haskell-language-server-wrapper\",\n            \"args\": [\"--lsp\"],\n            \"rootPatterns\": [\"*.cabal\", \"stack.yaml\", \"cabal.project\", \"package.yaml\", \"hie.yaml\"],\n            \"filetypes\": [\"haskell\", \"lhaskell\"],\n            // Settings are optional, here are some example values\n            \"settings\": {\n                \"haskell\": {\n                    \"checkParents\": \"CheckOnSave\",\n                    \"checkProject\": true,\n                    \"maxCompletions\": 40,\n                    \"formattingProvider\": \"ormolu\",\n                    \"plugin\": {\n                        \"stan\": { \"globalOn\": true }\n                    }\n                }\n            }\n        },\n</code></pre> <ul> <li>some tutorial ws3 school offical tutorial </li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#kotlin","title":"kotlin","text":"<ol> <li>download kotlin lsp at github </li> <li>add configrations <pre><code>\"languageserver\": {\n  \"kotlin\": {\n    \"command\": \"~/lsp/kotlin/server/bin/kotlin-language-server\",\n    \"filetypes\": [\"kotlin\"]\n  }\n}\n</code></pre></li> <li> <p>install kotlin via sdk</p> </li> <li> <p>\u4e0b\u8f7d <code>kotlin</code> tutorial </p> <p>\u6ce8\u610f\u4f7f\u7528 <code>curl -s \"https://get.sdkman.io\" | bash</code> \u5b89\u88c5 <code>sdkman</code> sdkman usage </p> </li> <li> <p>\u5982\u679c\u4e0b\u8f7d\u901f\u5ea6\u592a\u6162\uff0c\u53ef\u4ee5\u524d\u5f80 kotlin  \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff0c\u89e3\u538b\u5230\u4efb\u610f\u4f4d\u7f6e\uff0c\u518d\u5c06 \u89e3\u538b\u540e\u6839\u76ee\u5f55\u4e2d <code>bin</code> \u6587\u4ef6\u5939 \u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf</p> <p>\u89e3\u538b .tar.gz \u6587\u4ef6 \u7528  tar -xzf \u547d\u4ee4</p> </li> <li> <p>need install gradle (can not directly use kotlinc)</p> <p>using gradle to build project and run project</p> </li> </ol> <p>see this link Neovim for beginners </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#php","title":"php","text":"<ul> <li><code>coc-phpls</code></li> </ul> <p>web development in wsl2 </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#lua","title":"lua","text":"<p>how to install lua and luarock 1. follow the offical doc  <pre><code>curl -R -O http://www.lua.org/ftp/lua-5.4.4.tar.gz\ntar zxf lua-5.4.4.tar.gz\ncd lua-5.4.4\nmake all test\n</code></pre> 2. configure the environment variable 3. run <code>make local</code>, and copy everything in <code>install</code> directories to  /usr/local/bin/lua-5.4</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#python","title":"python","text":"<p>meet with issue 600  fixed by deleting coc-python in directory</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#latex","title":"latex","text":"<p>installing <code>texlive</code> </p> <pre><code>sudo pacman -S texlive texlive-langchinese\n</code></pre> <p>\u6216\u8005 \u53ef\u53c2\u8003 Linux \u4e0b\u7684LaTex\u5199\u4f5c\u5de5\u5177\u94fe Makefiles</p> <pre><code>LATEX=xelatex #\u5b9a\u4e49\u53d8\u91cf\uff0c\u6307\u5b9a\u7f16\u8bd1\u5f15\u64ce\nLATEXOPT=--shell-escape #\u5b9a\u4e49\u53d8\u91cf \u6307\u5b9a\u7f16\u8bd1\u53c2\u6570\nNONSTOP=--interaction=nonstopmode #\u5b9a\u4e49\u53d8\u91cf \u6307\u5b9a\u7f16\u8bd1\u6a21\u5f0f\nLATEXMK=latexmk #\u91c7\u7528latexmk\u6765\u7f16\u8bd1latex\u6587\u6863\nLATEXMKOPT=-pdf #latexmk\u53c2\u6570 \u8f93\u51fapdf\nCONTINUOUS=-pvc #\u82e5\u52a0\u5165-pvc\u9009\u9879\u5219\u53ef\u4ee5\u6301\u7eed\u68c0\u6d4b\u6587\u4ef6\u6539\u52a8\u5e76\u5b9e\u65f6\u663e\u793a\nMAIN=main #\u6839\u6587\u4ef6\u540d\u79f0\n\nMAIN_SRC = $(patsubst %, %.tex, $(MAIN))\n\nSOURCES= $(MAIN_SRC)  \nFIGURES := $(shell find figures/* movies/* -type f)\n\nall:    $(MAIN).pdf\n\n$(MAIN).pdf: $(SOURCES) $(FIGURES)\n    $(LATEXMK) $(LATEXMKOPT)  \\\n            -pdflatex=\"$(LATEX) $(LATEXOPT) $(NONSTOP) %O %S\" $(MAIN)\nforce:\n    rm $(MAIN).pdf\n    $(LATEXMK) $(LATEXMKOPT) $(CONTINUOUS) \\\n            -pdflatex=\"$(LATEX) $(LATEXOPT) %O %S\" $(MAIN)\nclean:\n    $(LATEXMK) -C $(MAIN)\n    -rm -f $(MAIN).pdfsync\n    -rm -rf *~ *.tmp\n    -rm -f *.bbl *.blg *.aux *.end *.fls *.log *.out *.fdb_latexmk\nonce:\n    $(LATEXMK) $(LATEXMKOPT) -pdflatex=\"$(LATEX) $(LATEXOPT) %O %S\" $(MAIN)\ndebug:\n    $(LATEX) $(LATEXOPT) $(MAIN)\n.PHONY: clean force once all\n</code></pre> <ul> <li>download and build <code>texlab</code> </li> <li>config settings</li> </ul> <pre><code>    \"texlab.path\": \"$HOME/notes/tex/texlab/target/release/texlab\",\n    \"texlab.build.onSave\": true,\n    \"texlab.build.args\": [\"-xelatex\", \"-interaction=nonstopmode\", \"-synctex=1\", \"%f\"],\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#git","title":"git \u4ee3\u7406","text":"<ul> <li>\u6839\u636e\u8fd9\u7bc7\u535a\u5ba2\uff0c\u914d\u7f6e\u4e86github\u7684\u4ee3\u7406\u3002git \u4ee3\u7406 </li> <li>\u5982\u679c\u9047\u5230\u4e86\u4ecegithub\u62c9\u53d6\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u8981\u4e48\u662f\u6ca1\u5f00clash \u4ee3\u7406\uff0c\u8981\u4e48\u662f\u8282\u70b9\u5e9f\u4e86</li> <li>\u6709\u65f6\u5019\u901a\u8fc7 ssh \u7684\u65b9\u5f0f clone \u4ed3\u5e93\u4e5f\u4f1a\u5931\u8d25\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u914d\u7f6e ssh \u8d70 http \u7684\u4ee3\u7406</li> <li>\u8bbe\u7f6e ssh \u8d70 http \u4ee3\u7406 doc</li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#android-studio","title":"\u914d\u7f6e Android Studio","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#maven","title":"\u914d\u7f6e maven","text":"<ol> <li>In IDEA find settings-&gt;build-&gt;Maven change <code>User settings file</code>, and <code>Local Repository</code> </li> <li>In the location of <code>user settings file</code>,touch a settings json, which Maven will read before execution</li> <li>In <code>settings.json</code>, add <code>local repository</code> and <code>mirror</code> . settings <p>~/.m_2/settings.xml is user config file ../conf/settings.xml is system config file  The priority of user file weights than system configration file.</p> </li> </ol> <p>if you are not sure what script is being executed, you can somehow random change the contents  see whether the change affect idea</p> <ul> <li>for maven or some thing related to java, go to bilibli channel to see tutorial.</li> <li>intelliJ offical doc is also a great reference</li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#gradle","title":"\u914d\u7f6e gradle","text":"<ul> <li>To modify gradle location permanently, Add a environment variable <code>GRADLE_USER_HOME</code>,  and set its value as your self defined location.  for example <code>D:\\.gradle</code></li> <li>To move location of avd. go <code>~/.android/avd</code>, modify <code>XXX.ini</code> file</li> </ul> <pre><code>avd.ini.encoding=UTF-8\npath=D:\\avd\\Pixel_XL_API_33_2.avd // change this to your desired location\npath.rel=avd\\Pixel_XL_API_33_2.avd\ntarget=android-33\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#vscode","title":"\u914d\u7f6e vscode","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#vscode-configration","title":"vscode configration","text":"<ul> <li><code>which-key</code> could specify function of same key-bindings for different circustances</li> <li><code>multi-command</code></li> <li>find the api for spercific action in vscode docs  </li> </ul> <p>reference dotfiles tasks </p> <pre><code>\"terminal.integrated.fontFamily\": \"NotoSansMono Nerd Font\"     \n// amazing\n\"keyboard.dispatch\": \"keyCode\"  \n// keyboard\n// Place your key bindings in this file to override the defaults\n[\n{\n  \"key\": \"ctrl+alt+t\",  // you could use     \"key\": \"ctrl+`\",  if you wish\n  \"command\": \"workbench.action.closePanel\",\n  // \"when\": \"terminalFocus\"\n},\n\n{\n  \"key\": \"ctrl+alt+t\",\n  \"command\": \"workbench.action.toggleMaximizedPanel\",\n  \"when\": \"!terminalFocus\"\n},\n{\n  \"key\": \"ctrl+shift+alt+z\",\n  \"command\": \"workbench.action.tasks.runTask\"\n},\n{ \n    \"key\": \"tab\",     \n    \"command\": \"selectNextSuggestion\",\n    \"when\": \"editorTextFocus &amp;&amp; suggestWidgetMultipleSuggestions &amp;&amp; suggestWidgetVisible\" },\n{ \n    \"key\": \"tab\",                   \n    \"command\": \"-acceptSelectedSuggestion\"\n},\n]\n</code></pre> <p>vscode cpp \u8c03\u8bd5 </p> <ol> <li>\u4ece \u5b98\u7f51 \u62f7\u8d1d task.json, launch.json</li> <li>\u9009\u62e9 debug cpp/c \u6587\u4ef6\u65f6\uff0c\u8bb0\u5f97\u4e0d\u8981\u9009 \u5e26\u6709 <code>/usr/bin/cpp</code> \u90a3\u4e2a\u4efb\u52a1</li> </ol> <p></p> <ol> <li>\u4e4b\u540e\u5c31\u53ef\u4ee5\u4e86</li> </ol>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#ideavim","title":"\u914d\u7f6e ideavim","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#ideavimrc","title":"ideavimrc","text":"<ul> <li>how to use which key</li> <li>how to find the task id<ul> <li>first, <code>shift</code> <code>shift</code> and search <code>track action ID</code> </li> <li>perform and copy the action</li> <li>write mappings <code>map keyMappings &lt;Action&gt;({action_id})</code></li> </ul> </li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_3","title":"\u4e0d\u5e38\u7528\u547d\u4ee4\u884c","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#git_1","title":"git","text":"<p>git stash pop \u53ef\u4ee5\u64a4\u9500git stash \u64cd\u4f5c\u5e76\u5220\u9664stash\u7684\u8bb0\u5f55</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#pandoc","title":"pandoc","text":"<p><code>!pandoc % -o %&lt;.pdf --pdf-engine=xelatex -V CJKmainfont=KaiTi</code> </p> <p>\\(a_1 + b_2 = c_3\\) </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#ranger","title":"ranger","text":"<ul> <li>need syntax highlighting</li> <li>open pdf document for the first time is extremely slow</li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#wget","title":"wget","text":"<pre><code>wget --mirror --convert-links --adjust-extension --page-requisites --no-parent https://www.eecs189.org/sp18/\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#rclone","title":"rclone","text":"<pre><code>rclone mount oss:trace1729 /home/trace/rclone  --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 --daemon\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#pacman","title":"pacman","text":"<ol> <li><code>pacman -Ss {{package}}</code> s for search.</li> <li><code>pacman -Sc</code> clear cache </li> <li><code>pacman -Scc</code> clear all cache</li> <li><code>pacman -Rc {{package}}</code> remove package</li> <li><code>pacman -Rs</code> remove package and its dependency </li> <li><code>pacman -Rns</code> remove package, its dependency and its global configration file</li> <li><code>pacman -Qe</code> search user installed package</li> <li><code>pacman -R $(pacman -Qdtq)</code> </li> </ol> <p>\u5f53\u592a\u4e45\u6ca1\u66f4\u65b0</p> <p>pacman-key --populate archlinux</p> <p>pacman -S archlinux-keyring</p> <p>\u66f4\u65b0\u51fa\u73b0\u62a5\u9519 </p> <p>\"Failed to commit transaction (conflicting files)\" error</p> <p>\u9996\u5148\u53bb arch wiki \u4e0a\u627e pacman \u7684 trouble shooting.</p> <p>\u4f7f\u7528 <code>pacman -Qo</code> \u786e\u5b9a\u51b2\u7a81\u7684\u6587\u4ef6\u4e0d\u662f\u5176\u4ed6\u5305\u7684\u4f9d\u8d56\u540e\uff0c\u53ef\u4ee5\u5c06\u51b2\u7a81\u6587\u4ef6\u91cd\u547d\u540d\u6216\u8005\u5220\u9664\uff0c\u518d\u5c1d\u8bd5\u66f4\u65b0</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#zellij","title":"zellij","text":"<ol> <li>\u914d\u7f6e\u6587\u4ef6 <code>~/.config/zellij</code> </li> <li>\u5e03\u5c40\u6587\u4ef6 <code>~/.config/zellij/layouts</code> </li> <li>\u52a0\u8f7d\u5e03\u5c40 <code>zellij --layout {\u5199\u6587\u4ef6\u540d\u5c31\u597d}</code> </li> </ol> <p>\u5e03\u5c40\u4ecb\u7ecd - tab \u662f\u4e00\u4e2a\u6ee1\u5c4f  - \u4e00\u4e2a tab \u4e0b \u53ef\u4ee5\u6709 \u591a\u4e2a pane</p> <p>\u53c2\u8003\u914d\u7f6e</p> <pre><code>layout {\n    pane split_direction=\"vertical\" {\n                    pane\n                    pane\n            }\n}\n</code></pre>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#gdb","title":"gdb","text":"<ol> <li><code>.gdbinit</code> \u53ef\u4ee5\u9884\u8bbe\u4e00\u4e9bgdb \u547d\u4ee4 \u65b9\u4fbf\u8c03\u8bd5 </li> <li>\u9700\u8981\u5728 <code>~/.config/gdb/gdbinit</code> \u91cc\u6dfb\u52a0\u5b89\u5168\u8def\u5f84\uff0c<code>.gdbinit</code> \u624d\u80fd\u88ab\u6267\u884c  </li> </ol> <pre><code>add-auto-load-safe-path /home/trace/trace/learning/open_course/6.s081/xv6-labs-2021/.gdbinit\nadd-auto-load-safe-path /home/trace/trace/learning/cpp/.gdbinit\n</code></pre> <ol> <li>\u5982\u679c gdb \u6253\u5370 \u5f02\u5e38</li> </ol> <pre><code>(gdb) p intervals[0][0]\n$2 = (__gnu_cxx::__alloc_traits&lt;std::allocator&lt;int&gt;, int&gt;::value_type &amp;) @0x555555\n572000: 15\n</code></pre> <p>\u53ef\u80fd\u662f\u56e0\u4e3a\u8bbe\u7f6e\u4e86 <code>set auto-load safe-path XXX</code></p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#manjaro-cheatsheet","title":"Manjaro cheatsheet","text":"<ul> <li>How to installing fonts for manjaro</li> <li>downloading <code>ttf</code> file</li> <li>create directory for your font in <code>/usr/share/fonts</code> </li> <li>move your <code>ttf</code> file into the directory you just created</li> <li> <p>Done!</p> </li> <li> <p>\u6ce8\u610f \u4f7f\u7528 <code>yay</code> \u65f6\uff0c\u9700\u8981\u5f00\u4ee3\u7406\uff0c\u800c\u65e5\u7ec8\u7aef\u9ed8\u8ba4\u662f\u4e0d\u8d70\u4ee3\u7406\u7684\uff0c\u9700\u8981\u624b\u52a8\u8fd0\u884c</p> </li> </ul> <pre><code>export http_proxy=''\nexport https_proxt=''\n</code></pre> <ul> <li>i3wm \u4f7f\u7528 </li> <li><code>font:pango {{fontsize}}</code> </li> <li>\u9700\u8981\u5728\u4f7f\u7528\u4ee3\u7406\u7684\u7ec8\u7aef\u4e0b\uff0c\u5f00\u542f\u6d4f\u89c8\u5668\uff0c\u624d\u80fd\u8d70\u4ee3\u7406</li> <li><code>./clash-linux-amd64-v3-v1.11.4 -f config.yml &gt;/dev/null 2&gt;&amp; 1 &amp;</code> </li> <li> <p><code>source proxy.sh</code> </p> </li> <li> <p>\u5173\u95ed\u4ee3\u7406 </p> </li> <li><code>ps aux | grep clash</code> </li> <li><code>kill -9</code> </li> <li> <p><code>source noproxy.sh</code> </p> </li> <li> <p>\u952e\u4f4d\u7ed1\u5b9a</p> </li> <li><code>xev</code> show ascii code for keystroke</li> <li> <p>capslock: 66, esc: 9</p> </li> <li> <p>\u5f85\u6298\u817e</p> </li> <li> <p>\u8c03\u6574\u6807\u7b7e\u9875\u7684\u5927\u5c0f</p> </li> <li> <p>When using <code>fanyi</code> command line tools</p> </li> <li>either using <code>-S</code> option to close voice</li> <li>or you install relavent package <code>pacman -S festival festival-englist</code> </li> </ul> <p>npm - \u6dd8\u5b9d\u955c\u50cfhttps \u8bc1\u4e66\u8fc7\u671f\u4e86\uff0c\u800c\u6709\u4e9b\u9879\u76ee\u6784\u5efa\u65f6\uff0c\u53c8\u6307\u5b9a \u4e86\u6dd8\u5b9d\u955c\u50cf\uff0c\u5bfc\u81f4\u6784\u5efa\u5931\u8d25\u3002\u76ee\u524d\u6ca1\u627e\u5230\u89e3\u51b3\u529e\u6cd5     - \u4e5f\u8bb8\u53ef\u4ee5\u624b\u52a8\u5b89\u88c5\uff0c\u4f46\u662f\u4e0d\u60f3\u6298\u817e\u4e86\u3002</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_4","title":"\u5378\u8f7d\u8f6f\u4ef6","text":"<ul> <li>\u4f7f\u7528 pacman \u5378\u8f7d\u8f6f\u4ef6\u540e\uff0c\u53ef\u80fd\u4f1a\u6709\u6b8b\u7559\u6587\u4ef6\uff0c\u4e00\u822c\u68c0\u67e5\u4e00\u4e0b\u51e0\u4e2a\u6587\u4ef6\u4f4d\u7f6e<ul> <li><code>~/.config/</code></li> <li><code>~/</code></li> <li><code>/usr/share/</code></li> <li><code>~/cache/</code></li> </ul> </li> </ul>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#bluetoothctl","title":"bluetoothctl","text":"<p>\u9996\u5148\u542f\u52a8\u670d\u52a1</p> <pre><code>sudo systemctl enable bluetoothctl.service\nsudo systemctl start bluetoothctl.service\n</code></pre> <p>\u518d\u8f93\u5165 <code>bluetoothctl</code> \u8fdb\u5165\u547d\u4ee4\u884c\u754c\u9762</p> <pre><code>bluetoothctl #\u8fde\u63a5\u4ea4\u4e92\u547d\u4ee4\npower on #\u5f00\u542f\u63a7\u5236\u5668\u7535\u6e90\uff0c\u9ed8\u8ba4\u5173\u95ed\ndevices #\u83b7\u53d6\u8981\u914d\u5bf9\u8bbe\u5907\u7684MAC\nagent on #\u6253\u5f00\u4ee3\u7406\npair MAC_ADDRESS #\u914d\u5bf9\uff0c\u8f93\u5165MAC\u5730\u5740\u5373\u53ef\u914d\u5bf9\uff0c\u5efa\u8bae\u4f7f\u7528Tab\nconnect MAC_ADDRESS #\u8fde\u63a5\uff0c\u5efa\u8bae\u4f7f\u7528Tab\n</code></pre> <p>\u5982\u679c\u8f93\u5165 <code>power on</code> \u540e\uff0c\u51fa\u73b0 <code>Failed to set power on: org.bluez.Error.Failed</code> \u9519\u8bef, \u8fd4\u56de\u7ec8\u7aef\u8f93\u5165 <code>rfkill unblock bluetooth</code>\uff0c\u518d\u8fdb\u5165\u5230 <code>bluetoothctl</code> \u754c\u9762\u91cd\u65b0\u8f93\u5165 <code>power on</code> </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_5","title":"\u901a\u77e5","text":"<p>\u5982\u679cqq\u4e0d\u73b0\u5b9e\u6d88\u606f\u901a\u77e5\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u4f60\u5f00\u4e86 <code>Do not Disturb</code> \u6a21\u5f0f</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_6","title":"\u670d\u52a1\u5668\u914d\u7f6e\u62fe\u9057","text":""},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#how-to-deploy-website-using-apacha2","title":"How to deploy website using Apacha2","text":"<ol> <li> <p>install <code>apache</code> <pre><code>sudo apt update\nsudo apt install apache2\n</code></pre></p> </li> <li> <p>config ufw (ubuntu firewall)</p> </li> </ol> <p><pre><code>sudo ufw allow OpenSSH # for ssh into server \nsudo ufw allow 'Apache Full' # \u4e3a apache \u670d\u52a1 \u653e\u884c\nsudo ufw enable # \u542f\u7528\u9632\u706b\u5899\n</code></pre> 3. \u542f\u52a8 apache \u670d\u52a1</p> <pre><code>sudo systemctl start apache2\n</code></pre> <ol> <li>installing php, <code>php plugin for apache</code>, mysql, <code>sql plugin for php</code></li> </ol> <p><code>sudo apt install php libapache-mod-php mysql-server php-mysql</code> </p> <ol> <li> <p>the root dir is located at <code>/var/www/html</code>, You can modify the content in index.html</p> </li> <li> <p>mysql \u670d\u52a1</p> <p>After installing mysql service automaticaly activatied</p> </li> </ol> <p>First we need to config password for root <code>Alter ...</code> </p> <p>Then run <code>mysql_secure_installation</code> </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_7","title":"\u5b9a\u65f6\u4efb\u52a1","text":"<p>0 22 * * * ncdu / -o ~/log/disk_$(date +\\%Y\\%m\\%d_\\%H\\%M\\%S).json</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#side-notes","title":"Side Notes","text":"<ul> <li>About <code>systemctl</code> </li> <li> <p><code>systemctl [start | reload | restart | stop] {{service}}</code></p> </li> <li> <p>About <code>ufw</code> </p> </li> <li><code>ufw status</code> </li> <li><code>ufw allow in {{service}}</code> </li> <li> <p><code>ufw app list</code> </p> </li> <li> <p>About Apache </p> </li> <li>apache2.conf \u4e3b\u914d\u7f6e</li> <li>ports.conf  \u914d\u7f6e\u7aef\u53e3</li> <li>conf-available</li> <li>conf-enabled </li> <li><code>mods-available</code> \u5b89\u88c5\u7684\u63d2\u4ef6</li> <li><code>mods-enabled</code> \u542f\u7528\u7684\u63d2\u4ef6</li> <li><code>sites-available</code> \u5f85\u4f7f\u7528\u7684\u7ad9\u70b9</li> <li> <p><code>sites-enabled</code> \u542f\u7528\u7684\u7ad9\u70b9</p> </li> <li> <p>\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5</p> </li> </ul> <p><code>sudo netstat -tlnp | grep ':80'</code> </p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_8","title":"\u6587\u4ef6\u63cf\u8ff0\u7b26","text":"<p>&amp;1 \u8868\u793a \u5e8f\u53f7\u4e3a1 \u7684 \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u800c\u975e\u6587\u4ef6\u540d\u4e3a1\u6587\u4ef6</p> <p>2&gt;&amp;1 \u8868\u793a \u8ba9\u6587\u4ef6\u63cf\u8ff0\u7b262\u6307\u5411 \u6587\u4ef6\u63cf\u8ff0\u7b261\u6240\u6307\u5411\u7684\u8bbe\u5907</p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#cloud-server-hexo","title":"cloud server + hexo","text":"<ol> <li>\u8fdb\u5165 <code>trace1729.github.io</code>, \u8f93\u5165 <code>hexo new  {post name}</code> \u65b0\u5efa\u535a\u5ba2 </li> <li><code>hexo g</code> \u751f\u4ea7\u9759\u6001\u9875\u9762 </li> <li><code>hexo d</code> \u5c06\u5185\u5bb9\u540c\u6b65\u81f3 github </li> <li>oss \u5982\u679c\u9700\u8981\u5c06\u6587\u4ef6\u4e0a\u4f20\u81f3\u4e91\u7aef\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a</li> </ol>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#github","title":"Github","text":"<p>Repo \u5bfc\u5165 secrets.TOKEN</p> <p></p>"},{"location":"notes/tools/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8B%BE%E9%81%97/#_9","title":"\u6d82\u9e26\u533a","text":""},{"location":"notes/tools/sysadmin/lab1/","title":"Lab1","text":"<p><code>tgz</code> \u6587\u4ef6\u5b9e\u9645\u4e0a\u662f\u4e24\u79cd\u6587\u4ef6\u683c\u5f0f\u7684\u7ec4\u5408, \u6709\u65f6\u8fd9\u4e2a\u6587\u4ef6\u683c\u5f0f\u4e5f\u88ab\u5199\u4f5c <code>tar.gz</code> .      - <code>tar</code> \u662f tape archive \u7684\u7f29\u5199, \u4e4b\u524d\u4eba\u4eec\u4f7f\u7528\u78c1\u5e26\u505a\u5f52\u6863\u5de5\u4f5c,\u8fd9\u5c31\u6709\u4e86 tar.     - <code>tar</code> \u672c\u8eab\u53ea\u662f\u5c06 \u591a\u4e2a\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2a\u6587\u4ef6,\u5e76\u4e0d\u80fd\u538b\u7f29.\u8fd9\u5c31\u6709\u4e86 <code>gzip</code> .</p> <p>file --(tar)--&gt; file.tar --(gzip)--&gt; file.tar.gz</p>"},{"location":"notes/tools/sysadmin/lab4%28systemd%29/","title":"Systemd","text":"<p>Q: what is a service A service is a type of process known as a Daemon (\u5b88\u62a4\u8fdb\u7a0b)</p> <p>Q: what is host, and what is client. A: If running a vm on a real laptop, the real laptop is the host and the vm is the client</p> <p>Q: What is the difference between <code>restart</code> and <code>reload</code>  A:</p> <p>\u5728\u914d\u7f6e\u73af\u5883\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898</p> <pre><code>AttributeError: module 'virtualenv.create.via_global_ref.builtin.cpython.mac_os' has no attribute 'CPython2macOsArmFramework'\n</code></pre> <p>How can I solve it? </p> <p>\u539f\u56e0\u662f\u4f7f\u7528 apt \u548c pip \u5206\u522b\u5b89\u88c5\u4e86 virtualenv. \u89e3\u51b3\u65b9\u6848\uff0c\u5168\u90e8\u5378\u8f7d\uff0c\u518d\u4efb\u610f\u9009\u4e00\u79cd\u65b9\u6848\u5b89\u88c5\u3002</p> <p>Q: what is the command to crash the service A: using curl command to send post request</p> <pre><code>curl --data '{\"crash\": true}' --header 'Content-Type: application/json' http://106.14.250.49:5000/crash\n</code></pre>"},{"location":"notes/tools/sysadmin/lab4%28systemd%29/#systemd_1","title":"systemd","text":"<p>systemd \u7ba1\u7406\u7740\u4e00\u7cfb\u5217\u7684\u5b88\u62a4\u8fdb\u7a0b(daemon or services)\uff0c\u6bd4\u5982 sshd, networkd. </p> <p>\u5982\u4f55\u4f7f\u7528 systemd \u7ba1\u7406\u4e00\u4e2a\u81ea\u5b9a\u4e49\u670d\u52a1</p> <p>\u5728 <code>/etc/systemd/system/</code> \u4e0b\u6dfb\u52a0\u4e00\u4e2a <code>XXX.service</code> \u7684\u6587\u4ef6\u3002 systemd \u901a\u8fc7\u8fd9\u4e2a\u6587\u4ef6\u6765\u7ba1\u7406\u670d\u52a1\u3002</p> <p>\u6587\u4ef6\u4e00\u822c\u9075\u5faa\u4e00\u4e0b\u683c\u5f0f\u3002\u6bcf\u4e00\u4e2a\u57df\u7684\u53ef\u9009\u503c\u548c\u8bf4\u660e\uff0c\u8bf7\u770b\u6587\u6863</p> <pre><code>[Unit]\nDescription=\nRequires=\nAfter=\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nExecStart=\nUser=\n</code></pre>"},{"location":"notes/tools/sysadmin/lab4%28systemd%29/#process","title":"process","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173</p> <p>\u53ef\u4ee5\u770b htop \u8be6\u89e3 \u8fd9\u4e2a\u535a\u5ba2\uff0c\u5bf9 Linux \u4e0b\u8fdb\u7a0b\u6709\u5f88\u8be6\u7ec6\u7684\u5206\u6790\u3002</p>"},{"location":"notes/tools/sysadmin/lab5%28network%29/","title":"network","text":""},{"location":"notes/tools/sysadmin/lab5%28network%29/#_1","title":"\u534f\u8bae","text":"<p>MAC\u5730\u5740</p> <p>MAC \u5730\u5740\u662f\u5206\u914d\u7ed9\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684\u6807\u8bc6\u7b26, \u5b83\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u63a5\u53e3\uff0c\u6240\u4ee5\u53c8\u88ab\u79f0\u4e3a\u7269\u7406\u5730\u5740\u3002</p> <p>\u4e00\u4e2a\u5178\u578b\u7684 MAC \u5730\u5740\u662f 00:14:22:01:23:45, \u6ce8\u610f\u524d\u4e09\u5b57\u8282\u662f\u7ec4\u7ec7\u6807\u8bc6\u7b26\uff0c\u7528\u6765\u5224\u65ad\u8bbe\u5907\u7684\u5236\u9020\u5546\u3002</p> <p>IP\u5730\u5740 </p> <p>\u533a\u5206\u8fde\u63a5\u5728\u4e92\u8054\u7f51\u4e0a\u4e0d\u540c\u8bbe\u5907\u7684\u65b9\u6cd5</p> <p>ARP  \u5c06 IP \u5730\u5740\u89e3\u6790\u4e3a MAC \u5730\u5740\u7684 \u4e00\u79cd\u534f\u8bae\u3002</p> <p>DNS </p> <p>DNS \u662f\u4e00\u4e2a\u5c06 32\u4f4dIP\u5730\u5740\u6620\u5c04\u5230\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u534f\u8bae\u3002 DNS \u670d\u52a1\u5668\u6570\u636e\u4ee5 <code>Resource Records</code> \u7684\u5f62\u5f0f\u5b58\u50a8\u3002<code>Resource Records</code> \u5305\u62ec\u4ee5\u4e0b\u5b57\u6bb5</p> <ol> <li>name</li> <li>value</li> <li>type</li> <li>TTL</li> </ol> <p>TCP UDP </p>"},{"location":"notes/tools/sysadmin/lab5%28network%29/#_2","title":"\u6709\u7528\u7684\u547d\u4ee4","text":"<p><code>hostname</code>  \u5c55\u793a\u672c\u673a\u7684\u4e00\u4e9b\u7f51\u7edc\u4fe1\u606f\u3002 <code>ping</code> <code>traceout</code> <code>arp</code> <code>dig</code> <code>ip</code> <code>curl</code> <code>wget</code> <code>netstat</code> <code>tcpdump</code> <code>nc</code> </p>"},{"location":"notes/tools/sysadmin/lab5%28network%29/#_3","title":"\u7ec3\u4e60","text":"<p>\u5feb\u95ee\u5feb\u7b54</p> <ol> <li>HTTP uses TCP. \u4fdd\u8bc1\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0c\u4e0d\u80fd\u51fa\u5dee\u9519\u3002</li> <li>paypal</li> <li>2^24 - 2</li> <li>address record (storing a mapping between a domain name and a ip address)     or NS record (the name server responsible for resoving the domian name).     etc.</li> <li>yes, because ping can send ICMP packet to the destination. If the packets failed to arrive, it states the connection may fail.</li> </ol>"},{"location":"notes/tools/sysadmin/lab6%28network%29/","title":"network \u8fdb\u9636\u7248 (\u5305\u542b nginx)","text":"<ul> <li> <p>Question 1a: What command did you use to display the networked services?</p> <p>netstat</p> </li> <li> <p>Question 1b: Paste the output of the command.</p> </li> </ul> <pre><code>    Active Internet connections (only servers)\n    Proto Recv-Q Send-Q Local Address           Foreign Address         State      \n    tcp        0      0 localhost:domain        0.0.0.0:*               LISTEN     \n    tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     \n    tcp        0      0 localhost:3000          0.0.0.0:*               LISTEN     \n    tcp        0      0 0.0.0.0:8096            0.0.0.0:*               LISTEN     \n    tcp        0      0 localhost:33060         0.0.0.0:*               LISTEN     \n    tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN     \n    tcp        0      0 localhost:mysql         0.0.0.0:*               LISTEN     \n    tcp        0      0 localhost:42063         0.0.0.0:*               LISTEN     \n    tcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN     \n    tcp6       0      0 [::]:ssh                [::]:*                  LISTEN     \n    tcp6       0      0 [::]:5244               [::]:*                  LISTEN     \n    tcp6       0      0 localhost:42063         [::]:*                  LISTEN     \n    tcp6       0      0 [::]:http               [::]:*                  LISTEN     \n    udp        0      0 0.0.0.0:43741           0.0.0.0:*                          \n    udp        0      0 0.0.0.0:1900            0.0.0.0:*                          \n    udp        0      0 localhost:domain        0.0.0.0:*                          \n    udp        0      0 iZuf64e9ug9p2r9x:bootpc 0.0.0.0:*                          \n    udp        0      0 iZuf64e9ug9p2r9xd:55448 0.0.0.0:*                          \n    udp        0      0 0.0.0.0:7359            0.0.0.0:*                          \n    udp        0      0 localhost:323           0.0.0.0:*                          \n    udp        0      0 localhost:58039         0.0.0.0:*                          \n    udp6       0      0 localhost:323           [::]:*                             \n    raw6       0      0 [::]:ipv6-icmp          [::]:*                  7          \n    Active UNIX domain sockets (only servers)\n    Proto RefCnt Flags       Type       State         I-Node   Path\n    unix  2      [ ACC ]     STREAM     LISTENING     18887    /run/uuidd/request\n    unix  2      [ ACC ]     STREAM     LISTENING     11226310 /run/systemd/userdb/io.systemd.DynamicUser\n    unix  2      [ ACC ]     STREAM     LISTENING     26241    /usr/local/cloudmonitor/local_data/argus.sock\n    unix  2      [ ACC ]     SEQPACKET  LISTENING     13386    /run/udev/control\n    unix  2      [ ACC ]     STREAM     LISTENING     13371    /run/systemd/fsck.progress\n    unix  2      [ ACC ]     STREAM     LISTENING     13381    /run/systemd/journal/stdout\n    unix  2      [ ACC ]     STREAM     LISTENING     98918    /run/user/1001/systemd/private\n    unix  2      [ ACC ]     STREAM     LISTENING     98923    /run/user/1001/bus\n    unix  2      [ ACC ]     STREAM     LISTENING     98924    /run/user/1001/gnupg/S.dirmngr\n    unix  2      [ ACC ]     STREAM     LISTENING     98925    /run/user/1001/gnupg/S.gpg-agent.browser\n    unix  2      [ ACC ]     STREAM     LISTENING     98926    /run/user/1001/gnupg/S.gpg-agent.extra\n    unix  2      [ ACC ]     STREAM     LISTENING     98927    /run/user/1001/gnupg/S.gpg-agent.ssh\n    unix  2      [ ACC ]     STREAM     LISTENING     98928    /run/user/1001/gnupg/S.gpg-agent\n    unix  2      [ ACC ]     STREAM     LISTENING     11226912 /run/systemd/journal/io.systemd.journal\n    unix  2      [ ACC ]     STREAM     LISTENING     98929    /run/user/1001/pk-debconf-socket\n    unix  2      [ ACC ]     STREAM     LISTENING     11216897 /run/containerd/containerd.sock.ttrpc\n    unix  2      [ ACC ]     STREAM     LISTENING     11227920 /tmp/dotnet-diagnostic-1223391-511743523-socket\n    unix  2      [ ACC ]     STREAM     LISTENING     11216902 /run/containerd/containerd.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     11241197 /var/run/docker/metrics.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     11243004 /var/run/docker/libnetwork/3fdc8a1ceef3.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     26685    /tmp/.s.PGSQL.42063\n    unix  2      [ ACC ]     STREAM     LISTENING     11253192 /var/run/mysqld/mysqlx.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     11253194 /var/run/mysqld/mysqld.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     6848300  /tmp/aliyun_assist_service.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     26240    /tmp/argus.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     11247111 /var/run/openvswitch/db.sock\n    unix  2      [ ACC ]     STREAM     LISTENING     11247112 /var/run/openvswitch/ovsdb-server.1228681.ctl\n    unix  2      [ ACC ]     STREAM     LISTENING     11226308 /run/systemd/private\n    unix  2      [ ACC ]     STREAM     LISTENING     18883    /run/dbus/system_bus_socket\n    unix  2      [ ACC ]     STREAM     LISTENING     11247265 /var/run/openvswitch/ovs-vswitchd.1228731.ctl\n    unix  2      [ ACC ]     STREAM     LISTENING     18885    /run/docker.sock\n</code></pre> <ul> <li> <p>Question 1c: Choose one service from the output and describe what it does.</p> <p>ssh, \u8fdc\u7a0b\u94fe\u63a5</p> </li> </ul> <p>Q: Why is this the case? What DNS server are requests currently being sent to if @localhost is not specified in the command? A: <code>dig www.baidu.com @localhost</code> \u6307\u5b9a\u4e86\u5728\u672c\u5730\u7684 DNS \u670d\u52a1\u5668\u67e5\u8be2 <code>www.baidu.com</code> \u76f8\u5173\u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019 \u672c\u5730\u7684 DNS \u670d\u52a1\u5668\u662f\u5904\u4e8e\u5173\u95ed\u72b6\u6001\u7684\u3002</p> <ul> <li> <p>Question 2a: What is the systemctl command to show whether bind9 is running or not?</p> <p><code>systemctl status</code> </p> </li> <li> <p>Question 2b: Why does the dig command (dig ocf.berkeley.edu) work if @localhost is not present at the end (if bind9 is not started) but times out when @localhost is added?</p> </li> </ul> <p>A: <code>dig www.baidu.com @localhost</code> \u6307\u5b9a\u4e86\u5728\u672c\u5730\u7684 DNS \u670d\u52a1\u5668\u67e5\u8be2 <code>www.baidu.com</code> \u76f8\u5173\u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019 \u672c\u5730\u7684 DNS \u670d\u52a1\u5668\u662f\u5904\u4e8e\u5173\u95ed\u72b6\u6001\u7684\u3002</p> <ul> <li> <p>Question 2c: What additional entries did you add to your DNS server config (the db.example.com file)?</p> <p>test1 IN CNAME test</p> </li> <li> <p>Question 2d: What commands did you use to make requests to the local DNS server for your additional entries?</p> <p>dig</p> </li> </ul>"},{"location":"notes/tools/sysadmin/lab6%28network%29/#nginx-engine-x","title":"nginx (engine x) \u6587\u6863","text":"<p>Beginners guide </p> <ol> <li>How start, stop and reload</li> <li>explains the structure of the configruation file </li> <li>how to set up nginx to serve out static content</li> <li>how to configure nginx as a proxy server</li> <li>how to connect it with a FastCGI application</li> </ol> <p>nginx \u7684 \u914d\u7f6e\u6587\u4ef6\u7531\u4e24\u79cd <code>directive</code> \u6784\u6210</p> <ul> <li><code>simple directive</code> \u7531\u540d\u5b57\u548c\u53c2\u6570\u6784\u6210\uff0c\u4e2d\u95f4\u7531\u7a7a\u683c\u5206\u5f00\uff0c\u7ed3\u5c3e\u6709\u5206\u53f7</li> <li><code>block directive</code> \u6784\u6210\u4e0e <code>simple directive</code> \u7c7b\u4f3c\uff0c\u4f46\u662f\u4ee5\u4e00\u5bf9 <code>{}</code> \u7ed3\u5c3e\uff0c\u6ca1\u6709\u5206\u53f7\u3002\u5728 \u62ec\u53f7\u5185\u90e8\u53ef\u4ee5\u5b9a\u4e49\u5176\u4ed6\u7684 <code>directive</code> </li> </ul> <p>\u6700\u5916\u5c42\u7684 directive \u53eb\u4f5c main directive, \u6bd4\u5982 <code>event</code> <code>http</code></p> <p>\u5982\u4f55\u8bbe\u7f6e\u53cd\u5411\u4ee3\u7406\uff1f</p> <p>\u5728 <code>nginx.conf</code> \u7684 http context \u4e0b\uff0c\u52a0\u5165 server \u7684\u914d\u7f6e\u8bed\u53e5\u5373\u53ef\u3002<code>server</code> \u7684\u5199\u6cd5\u53ef\u53c2\u8003 <code>sites-enable/myblog.trace1729.top</code> </p> <p>\u5982\u4f55\u8bbe\u7f6e SSL \u8bc1\u4e66\uff1f</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u53bb\u963f\u91cc\u4e91\u63a7\u5236\u53f0\u4e3a\u6211\u4eec\u7684\u4e8c\u7ea7\u57df\u540d\u6ce8\u518c\u4e00\u4e2assl\u8bc1\u4e66 ssl\u8bc1\u4e66\u6ce8\u518c\u5e73\u53f0 \u3002(\u53ea\u9700\u8981\u586b\u5199\u4e8c\u7ea7\u57df\u540d\u548c\u8054\u7cfb\u65b9\u5f0f\u5373\u53ef\uff0c\u5176\u4f59\u9ed8\u8ba4\u8bbe\u7f6e)</p> <p>\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u4e0b\u8f7d ssl \u8bc1\u4e66 \u5e76\u4e0a\u4f20\u5230\u670d\u52a1\u5668 (/etc/nginx/cert/)\u3002(.key \u548c .pem \u6587\u4ef6)</p> <p>\u5728 <code>nginx.conf</code> \u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e</p> <pre><code>server {\n    server_name cloud.trace1729.top;\n    rewrite ^(.*)$  https://$host$1 permanent; # \u91cd\u5b9a\u5411\u5230 https\n}\n\nserver {\n    listen 443 ssl;\n    server_name cloud.trace1729.top; # \u586b\u5199\u6ce8\u518c\u7684\u57df\u540d\n    ssl_certificate cert/cloud.trace1729.top.pem; # \u8bc1\u4e66\u540d\u79f0\n    ssl_certificate_key cert/cloud.trace1729.top.key; # \u8bc1\u4e66\u5bc6\u94a5\n    ssl_session_timeout 5m;\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n\n    location / {\n    proxy_pass http://localhost:5244;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    }\n\n}\n</code></pre> <p>haproxy \u914d\u7f6e\u8d1f\u8f7d\u5747\u8861</p> <ol> <li>\u5237\u65b0\u9875\u9762\u591a\u6b21\uff0c\u6709\u4ec0\u4e48\u89c4\u5f8b\u5417\uff1f \u6309\u7167 1, 2, 3, 4, 5 \u7684\u987a\u5e8f\u6539\u53d8</li> <li>\u8d1f\u8f7d\u5747\u8861\u7684\u7b97\u6cd5\u662f\u4ec0\u4e48 round-robin</li> <li>\u4f60\u52a0\u7684\u914d\u7f6e\u662f\u4ec0\u4e48? <pre><code>global\n    maxconn 50000\n    log /dev/log local0\n    user haproxy\n    group haproxy\n    stats socket /run/haproxy/admin.sock user haproxy group haproxy mode 660 level admin\n    cpu-map auto:1/1-4 0-3\n    ssl-default-bind-ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256\n    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets\n\n\n\ndefaults\n    timeout connect 10s\n    timeout client 30s\n    timeout server 30s\n    log global\n    mode http\n    option httplog\n    maxconn 3000\n\n\nlisten stats\n  bind    0.0.0.0:7001\n  mode    http\n  stats   enable\n  stats   hide-version\n  stats   uri /stats\n\nfrontend web.trace1729.top\n    bind 0.0.0.0:7000\n    default_backend web_servers\n\n\nbackend web_servers\n    balance roundrobin\n    cookie SERVERUSED insert indirect nocache\n    default-server check maxconn 20\n    server server1 0.0.0.0:8082 cookie server1\n    server server2 0.0.0.0:8081 cookie server2\n    server server3 0.0.0.0:8082 cookie server3\n    server server4 0.0.0.0:8083 cookie server4\n    server server5 0.0.0.0:8084 cookie server5\n</code></pre></li> </ol> <p>\u4e0d\u77e5\u4e3a\u4f55\uff0c\u8fd9\u91cc\u7684 ip \u5730\u5740\u4e00\u5b9a\u8981\u5199\u6210 0.0.0.0 \u624d\u80fd\u6210\u529f\u3002 \u6211\u5f88\u597d\u5947 0.0.0.0, localhost, \u670d\u52a1\u5668\u516c\u7f51\u5730\u5740, 127.0.0.1 \u8fd9\u4e9b\u5730\u5740\u7684\u533a\u522b\u3002 </p> <p>\u603b\u7ed3\u4e00\u4e0b\u914d\u7f6e\u8981\u70b9 \u9996\u5148 frontend \u63a5\u53d7\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u8ba9\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9 backend \u7684\u670d\u52a1\u5668\u3002 backend \u66f4\u5177\u58f0\u660e\u7684\u8c03\u5ea6\u7b97\u6cd5\u9009\u62e9\u670d\u52a1\u5668\u3002\u518d\u628a\u670d\u52a1\u5668\u7684\u8fd4\u56de\u7ed3\u679c\u53d1\u7ed9 frontend</p> <ol> <li>Total change, green</li> <li>red</li> <li>503 service unavaliable</li> </ol>"},{"location":"notes/tools/sysadmin/lab7%28encrypt%29/","title":"Encrypt","text":"<ul> <li> <p>Decrypt <code>file1.txt.gpg</code> with the password <code>ocfdecal</code> (for real-life purposes, never store passwords in plaintext). What are the decrypted contents of <code>file1.txt.gpg</code>?</p> <p>command <code>gpg -d file1.txt.gpg</code>  quack</p> </li> <li> <p>What command allows you to import a key?</p> <p><code>gpg --import</code> </p> </li> <li> <p>What command allows you to export a key to a file? (Add the <code>--armor</code> flag to ASCII-encode the key so it can be sent easily in text form)</p> <p><code>gpg --export --armor</code> </p> </li> <li> <p>What command allows you to see all of the keys on your keyring?</p> <p><code>gpg --list-keys</code> </p> </li> <li> <p>Use the private key <code>lab7privkey</code> to decrypt the file <code>file2.txt.gpg</code> (for real-life purposes, it is necessary to keep private keys secret). What are the decrypted contents of <code>b8/file2.txt.gpg</code>?</p> <pre><code>gpg --import lab7privkey \ngpg -d file2.txt.gpg\n</code></pre> </li> </ul> <p>Hashing</p> <p>md5sum file3.txt ddbefc9c1d8a8d9195a420a7181352e9  file3.txt</p> <p>md5sum file3.txt | cut -d ' ' -f 1 | sha1sum 15c3d7fa41fcc2ed98c2fda065e3248047a048f4  -</p> <p>file permission a: file owner, group, people not in the group u: file owner  g: group o: other people who are not in the group</p> <p>Make this file executable and execute it. - chmod u+x file5</p> <p>change file to be under my permission: - chmod code_server file6.txt</p> <p>Make this file readable only to you. What command did you use? - chmod u-r file7.txt</p> <p>Change this file\u2019s permissions such that only root should be able to read this file and no one should be able to edit it. What command did you use? - chmod a-rwx file8.txt</p> <p>Choose any method to make this file readable to you and unreadable to the previous owner. What command did you use? - change the ownership, and chmod o-rwx file9.txt</p>"},{"location":"notes/tools/sysadmin/lab9%28docker%29/","title":"Docker","text":"<ul> <li> <p>Run the image you just built with no flags. What do you observe?</p> <p>\u6253\u5370\u51fa\u7684\u5b57\u7b26\u6ca1\u6709\u989c\u8272 (\u56e0\u4e3a\u6ca1\u6709 tty)</p> </li> <li> <p>Write and build a <code>Dockerfile</code> based on <code>ubuntu:bionic</code> that installs the packages <code>fortune</code> and <code>fortunes-min</code> and runs the fortune executable (located in <code>/usr/games/fortune</code> after you install it). Note that you won\u2019t need to use the <code>-it</code> flags when you run the container as fortune doesn\u2019t need <code>STDIN</code>. Submit your <code>Dockerfile</code> with this lab. Hint: if you\u2019re having trouble writing your Dockerfile, try booting an interactive container and installing both packages. How can you translate what you did interactively to a Dockerfile?</p> <pre><code>FROM ubuntu:bionic\nRUN mv /etc/apt/sources.list /etc/apt/sources.list.b\nCOPY sources.list /etc/apt/\nRUN apt update  \nRUN apt install fortune fortunes-min -y\nCMD [\"/usr/games/fortune\"]\n</code></pre> </li> <li> <p>Paste the output of running <code>docker images</code> command after completing questions 1 and 2. (\u6211\u628a\u7b2c\u4e00\u4e2a\u955c\u50cf\u5220\u9664\u4e86)</p> <pre><code>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nfortune      latest    6ab713c79802   33 minutes ago   138MB\n</code></pre> </li> <li> <p>While your three containerized Apache web servers are running in detached mode, paste the output of <code>docker ps</code>.</p> <pre><code>CONTAINER ID   IMAGE     COMMAND              CREATED         STATUS         PORTS                                   NAMES\n35c7e2d9a094   httpd     \"httpd-foreground\"   3 minutes ago   Up 3 minutes   0.0.0.0:4002-&gt;80/tcp, :::4002-&gt;80/tcp   sad_tu\n4fbf5feb56c7   httpd     \"httpd-foreground\"   3 minutes ago   Up 3 minutes   0.0.0.0:4001-&gt;80/tcp, :::4001-&gt;80/tcp   charming_jennings\n706531c86ece   httpd     \"httpd-foreground\"   3 minutes ago   Up 3 minutes   0.0.0.0:4000-&gt;80/tcp, :::4000-&gt;80/tcp   recursing_chaplygin\n</code></pre> </li> <li> <p>Observe that in the output of <code>docker ps</code>, each container has an associated container ID. Explain why containers have IDs/Names rather than being named after the image, for example <code>httpd</code>.</p> <p>\u56e0\u4e3a\u4e00\u4e2a\u955c\u50cf\u53ef\u4ee5\u88ab\u5b9e\u4f8b\u5316\u4e3a\u591a\u4e2a\u5bb9\u5668</p> </li> <li> <p>Now go ahead and stop your containers. Paste the command you used to stop one of the containers.</p> <p>docker stop 35c7e2d9a094</p> </li> </ul> <p>\u4f7f\u7528 docker \u7684\u65b9\u6cd5\uff1a 1. docker build / docker pull \u6784\u5efa / \u83b7\u53d6\u955c\u50cf 2. docker run -it image command. \u5c06 image \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u5e76\u6267\u884c cmd \u547d\u4ee4 3. docker run -d -p host_port:container_port image command. \u5728\u540e\u53f0\u8fd0\u884c\u5bb9\u5668\uff0c\u5e76\u5c06 container_port \u6620\u5c04\u5230 \u5bbf\u4e3b\u673a\u7684host_port 4. docker-compose: \u591a\u5bb9\u5668\u6784\u5efa\u3002</p> <p>docker-compose:</p> <pre><code>version: '3'\nservices:\n  database: # \u6570\u636e\u5e93 \u7684 hostname\n    image: \"mongo:latest\"\n    container_name: \"database\"\n    volumes:\n          - data:/data/db\n    env_file: ./.env\n    environment:\n      - MONGO_INITDB_ROOT_USERNAME=$MONGODB_USER\n      - MONGO_INITDB_ROOT_PASSWORD=$MONGODB_PASSWORD\n    ports:\n      - $MONGODB_LOCAL_PORT:$MONGODB_DOCKER_PORT\n\n  web:\n    build: . # \u8868\u793a\u5728\u5f53\u524d\u76ee\u5f55\u5bfb\u627e Dockerfile \u6784\u5efa\uff0c\u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u955c\u50cf\n    command: \"./wait-for database:27017 -- node server.js\" # \u8fd9\u4e2a commnad \u7684\u6267\u884c\u8def\u5f84\u4e0e dockcerfile \u8bbe\u7f6e\u7684 work_dir y\u4e00\u81f4 \n    depends_on: \n      - database\n    env_file: ./.env # \u4ece\u5f53\u524d\u6587\u4ef6\u5939\u8bfb\u53d6 \u914d\u7f6e\u6587\u4ef6\n    ports:  # \u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\n      - $NODE_LOCAL_PORT:$NODE_DOCKER_PORT\n    environment:\n      - DB_HOST=database\n      - DB_USER=$MONGODB_USER\n      - DB_PASSWORD=$MONGODB_PASSWORD\n      - DB_PORT=$MONGODB_DOCKER_PORT\n    stdin_open: true\n    tty: true\n\nvolumes:\n  data:\n</code></pre> <p>\u6700\u540e\u662f\u6210\u529f\u6784\u5efa\u4e86\uff0c\u4f46\u662f\u70b9\u51fb\u7f51\u9875\u7684\u65f6\u5019\uff0cnode.js \u5e94\u7528\u4f1a\u62a5\u5f02\u5e38\u9000\u51fa\u3002 \u4e0d\u77e5\u9053\u662f\u9879\u76ee\u7684\u95ee\u9898\uff0c\u8fd8\u662f\u6211\u914d\u7f6e\u7684\u95ee\u9898\uff0c\u6682\u65f6\u5c31\u6401\u7f6e\u5728\u8fd9\u91cc\u628a</p>"},{"location":"notes/tools/%E5%AE%9E%E7%94%A8%E7%BD%91%E7%AB%99/%E5%85%AC%E5%BC%80%E8%AF%BE%E7%BD%91%E7%AB%99/","title":"\u516c\u5f00\u8bfe\u7f51\u7ad9","text":"\u63cf\u8ff0 \u94fe\u63a5 cs537-\u64cd\u4f5c\u7cfb\u7edf CS-537: Introduction to Operating Systems FA19 COMPSCI 537 001-\u64cd\u4f5c\u7cfb\u7edf FA19 COMPSCI 537 001 &lt;++&gt; &lt;++&gt; &lt;++&gt; &lt;++&gt;"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/","title":"PA1 \u590d\u76d8","text":""},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#pa11","title":"PA1.1","text":"<ul> <li>nemu \u662f\u4ec0\u4e48?</li> <li>nemu \u662f\u4e00\u4e2a\u6a21\u62df\u5668\uff0c\u662f\u4e00\u4e2a\u5728 Linux \u8fd0\u884c\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u4ed6\u6a21\u62df\u4e86\u7ea2\u767d\u673a\u8fd0\u884c\u6240\u9700\u8981\u7684\u5168\u90e8\u786c\u4ef6\u8bbe\u65bd\u3002\u7ea2\u767d\u673a\u8fd0\u884c\u5728 nemu \u4e0a\uff0c\u5c31\u5982\u540c\u8fd0\u884c\u5728\u771f\u5b9e\u673a\u5668\u4e0a\u4e00\u6837\u3002</li> </ul>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#pa12","title":"PA1.2","text":"<p>\u8ba1\u7b97\u673a\u5c31\u662f\u4e00\u4e2a\u72b6\u6001\u673a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8ba1\u7b97\u673a\u5316\u6210\u4e24\u90e8\u5206\u3002</p> <ul> <li>\u4e00\u90e8\u5206\u662f\u7531\u6240\u6709\u65f6\u5e8f\u903b\u8f91\u7535\u8def\u6784\u6210</li> <li>\u5269\u4e0b\u662f\u7531\u7ec4\u5408\u903b\u8f91\u6784\u6210</li> </ul> <p>\u8fd9\u6837\uff0c\u5f53\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u5230\u6765\u7684\u65f6\u5019\uff0c\u8ba1\u7b97\u673a\u6839\u636e\u5f53\u524d\u65f6\u5e8f\u903b\u8f91\u90e8\u4ef6\u7684\u72b6\u6001\uff0c\u5728\u7ec4\u5408\u903b\u8f91\u7535\u8def\u7684\u4f5c\u7528\u4e0b\uff0c\u8ba1\u7b97\u673a\u5e76\u8f6c\u79fb\u5230\u4e0b\u4e00\u65f6\u949f\u5468\u671f\u7684\u65b0\u72b6\u6001\u3002</p> <p>\u8fd9\u91cc\u7684\u5728\u7ec4\u5408\u903b\u8f91\u7535\u8def\u7684\u4f5c\u7528\u4e0b\uff0c\u5e76\u4e0d\u662f\u5f88\u7406\u89e3\u3002\u901a\u8fc7\u540e\u9762\u7684\u7ae0\u8282\u518d\u6765\u5b66\u4e60\u5427</p> <p>\u7a0b\u5e8f\u662f\u4ec0\u4e48\uff1f</p> <p>\u7ed9\u5b9a\u4e00\u4e2a\u7a0b\u5e8f, \u628a\u5b83\u653e\u5230\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u4e2d, \u5c31\u76f8\u5f53\u4e8e\u5728\u72b6\u6001\u6570\u91cf\u4e3a<code>N</code>\u7684\u72b6\u6001\u8f6c\u79fb\u56fe\u4e2d\u6307\u5b9a\u4e86\u4e00\u4e2a\u521d\u59cb\u72b6\u6001, \u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u5c31\u662f\u4ece\u8fd9\u4e2a\u521d\u59cb\u72b6\u6001\u5f00\u59cb, \u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4, \u5c31\u4f1a\u8fdb\u884c\u4e00\u6b21\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb. \u4e5f\u5c31\u662f\u8bf4, \u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u72b6\u6001\u673a! \u8fd9\u4e2a\u72b6\u6001\u673a\u662f\u4e0a\u6587\u63d0\u5230\u7684\u5927\u72b6\u6001\u673a(\u72b6\u6001\u6570\u91cf\u4e3a<code>N</code>)\u7684\u5b50\u96c6.</p>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#pa13","title":"PA1.3","text":""},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#_1","title":"\u914d\u7f6e\u7cfb\u7edf","text":"<ul> <li>\u914d\u7f6e\u7cfb\u7edf\u7a0b\u5e8f\u4f4d\u4e8e <code>nemu/tools/kconfig</code></li> <li>\u914d\u7f6e\u63cf\u8ff0\u6587\u4ef6\u4f4d\u4e8e <code>nemu/Kconfig</code> </li> </ul> <p>\u8fd0\u884c <code>make menuconfig</code> \u65f6\uff0c<code>nemu/tools/kconfig/mconf</code> \u4f1a\u89e3\u6790 <code>nemu/Kconfig</code> \u4e2d\u7684\u63cf\u8ff0\u6587\u4ef6\uff0c\u5e76\u4ee5 TUI \u7684\u5f62\u5f0f\u5c55\u793a\uff0c\u9000\u51fa\u83dc\u5355\u65f6\uff0cmconf \u4f1a\u5c06\u7528\u6237\u9009\u62e9\u4fdd\u5b58\u5230 <code>.config</code> \u6587\u4ef6\u4e2d</p> <p>\u4e4b\u540e <code>conf</code> \u7a0b\u5e8f\u4f1a\u7ed3\u5408 <code>Kconfig</code> \u548c <code>.config</code> \u6587\u4ef6\u6765\u751f\u6210</p> <ol> <li>\u53ef\u4f9b c \u8bed\u8a00\u5f15\u7528\u7684\u5b8f\u5b9a\u4e49\u6587\u4ef6</li> <li>\u53ef\u4f9b Makefile \u5f15\u7528\u7684 \u5b8f\u5b9a\u4e49\u6587\u4ef6</li> </ol>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#makefile","title":"Makefile","text":"<p>\u5982\u4f55\u4e86\u89e3\u4e00\u4e2a\u9879\u76ee</p> <ul> <li>\u9759\u6001\u5206\u6790\uff0c\u770b\u6e90\u7801</li> <li>\u52a8\u6001\u5206\u6790\uff0c\u770b\u52a8\u6001\u8fc7\u7a0b</li> </ul> <p><code>make</code> \u6709\u4e00\u4e9b\u9009\u9879\u53ef\u4ee5\u6253\u5370\u51fa\u9879\u76ee\u6784\u5efa\u7684\u4e00\u4e9b\u547d\u4ee4\u3002\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u4e86\u89e3\u4e00\u4e2a\u9879\u76ee\u7684 \u8fd0\u884c\u8fc7\u7a0b</p>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#_2","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u5728\u547d\u4ee4\u884c\u91cc\u67e5\u627e\u6587\u4ef6\u540d\u6216\u8005\u6587\u4ef6\u5185\u5bb9\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528 rg \u548c fd \u53ef\u4ee5\u76f4\u63a5\u6a21\u7cca\u67e5\u627e\uff0c\u907f\u514d\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f</p> <p>\u6709\u65f6\u5019\u9700\u8981\u8fdb\u884c\u7cbe\u786e\u7684\u6b63\u5219\u66ff\u6362\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528\u6b63\u5219\u3002</p> <p>\u5e38\u7528\u6b63\u5219\u8868\u8fbe\u5f0f</p> <ul> <li><code>?</code> 0 \u6216\u8005 \u4e00\u4e2a atom</li> <li><code>.</code> \u4efb\u4e00\u4e00\u4e2a atom</li> <li><code>*</code> \u91cd\u590d\u524d\u9762\u7684 atom 0\u4e2a\u6216\u8005\u591a\u4e2a </li> <li><code>+</code> \u91cd\u590d\u524d\u9762\u7684 atom 1\u4e2a\u6216\u8005\u591a\u4e2a </li> <li><code>.*?</code> \u975e\u8d2a\u5a6a\u5339\u914d</li> <li><code>.\\{-}</code> vim \u4e0b\u7684\u975e\u8d2a\u5a6a\u5339\u914d</li> <li><code>^</code> \u884c\u9996</li> <li><code>$</code> \u884c\u5c3e</li> <li><code>\\b \\b</code> \u4e00\u822c\u7684 word boundary</li> <li><code>\\&lt; \\&gt;</code> vim \u4e0b word boundary</li> </ul> <p>\u8fd9\u91cc\u4e0d\u5f97\u4e0d\u63d0\u5230 vim \u4e2d\u7684 <code>:s</code> \u547d\u4ee4\uff0c\u548c\u547d\u4ee4\u884c\u91cc\u7684 sed\uff0c\u57fa\u672c\u4e00\u81f4</p> <pre><code>:%s/ / # \u5168\u6587(%\u8868\u793a\u5168\u6587)\u67e5\u627e\u66ff\u6362\n:%s/ /g # \u5168\u6587\u8d2a\u5a6a\u66ff\u6362\n# \u5982\u679c\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32\u4e2d\u5305\u542b /\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528 + \u4f5c\u4e3a\u5206\u9694\u7b26\n:%s+ +g\n</code></pre>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#monitor","title":"monitor","text":"<ul> <li>\u5b8f\u662f\u5982\u4f55\u5c55\u5f00\u7684</li> <li>\u4e3a\u4ec0\u4e48 init_monitor \u5168\u662f\u51fd\u6570<ul> <li>\u53ef\u4ee5\u4f7f init_monitor \u7684\u5b9e\u73b0\u66f4\u52a0\u7cbe\u7b80\uff0c\u6709\u7740\u4e0d\u8a00\u81ea\u660e\u7684\u6548\u679c\uff0c\u51fd\u6570\u540d\u672c\u8eab\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u6ce8\u91ca\u7684\u6548\u679c</li> </ul> </li> </ul> <p>\u7a76\u7adf\u8981\u6267\u884c\u591a\u4e45?</p> <p>\u5728<code>cmd_c()</code>\u51fd\u6570\u4e2d, \u8c03\u7528<code>cpu_exec()</code>\u7684\u65f6\u5019\u4f20\u5165\u4e86\u53c2\u6570<code>-1</code>, \u4f60\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\u5417?</p> <p>\u7b54: cpu_exec \u63a5\u53d7\u7684\u53c2\u6570\u662f\u6267\u884c\u8d44\u6599\u7684\u6761\u6570\uff0c\u5b83\u7684\u7c7b\u578b\u662f unsigned int. \u5c06 -1 \u8d4b\u503c\u7ed9\u4e00\u4e2a unsigned int, \u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u6267\u884c\u6307\u4ee4\u7684\u6761\u6570\u7f6e\u4e3a\u6700\u5927\u6b63\u6570, \u8ba9 nemu \u4e00\u76f4\u6267\u884c\u4e0b\u53bb\u3002</p> <p>\u7406\u89e3\u6307\u9488\u7684\u81ea\u589e </p> <p>int* i; i++ &lt;=&gt; ((int)i + sizeof (int)), \u8bfb\u4f5c\u8ba9\u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u5b58\u50a8\u5355\u5143\u3002</p> <p>\u8c01\u6765\u6307\u793a\u7a0b\u5e8f\u7684\u7ed3\u675f</p> <p>\u901a\u8fc7\u4f7f\u7528 strace ./test \u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u6267\u884c test \u53ef\u6267\u884c\u6587\u4ef6\u65f6\uff0c\u4f1a\u6709\u4e00\u6761 execv(./test, argc, argv) \u7684\u7cfb\u7edf\u8c03\u7528\u3002execv \u7cfb\u7edf\u8c03\u7528\u4f1a\u8c03\u7528 __libc_main \u8fd9\u4e2a\u51fd\u6570\uff0cint result = __libc_main(argc, argv), \u4e4b\u540e exit(result)</p> <p>\u4f18\u96c5\u7684\u9000\u51fa</p> <p>\u539f\u56e0\u662f\u9700\u8981\u5728 cmd_q \u4e2d\u8bbe\u7f6e nemu \u7684 state \u4e3a quit</p> <p>getopt_long \u5904\u7406 --\uff0c getopt \u5904\u7406 -</p>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#pa14","title":"PA1.4","text":"<p>\u8981\u600e\u4e48\u6d4b\u8bd5\u5462 </p> <ul> <li>\u5355\u6b65\u6267\u884c</li> </ul> <p>\u4f7f\u7528 strtok + strtol \u89e3\u6790\u53c2\u6570\uff0c\u7136\u540e\u4f20\u7ed9 cpu_exec \u5c31\u597d</p> <ul> <li>\u6253\u5370\u5bc4\u5b58\u5668</li> </ul> <p>\u5728 reg.c \u904d\u5386\u4e00\u904d\u5bc4\u5b58\u5668\u5c31\u597d\uff0cgpr(i) \u83b7\u53d6\u5bc4\u5b58\u5668\u503c</p> <ul> <li>\u626b\u63cf\u5185\u5b58</li> </ul> <p>\u8bfb\u53d6\u4e24\u4e2a\u53c2\u6570\u5c31\u597d\uff0c\u6ce8\u610f\u4f7f\u7528 vaddr_read \u8bfb\u53d6</p>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#pa15-pa16","title":"PA1.5 &amp;&amp; PA1.6","text":"<p>\u4e3a\u4ec0\u4e48 printf \u8f93\u51fa\u8981\u6362\u884c</p> <p>\u56e0\u4e3a\u6362\u884c\u53ef\u4ee5\u8d77\u5230\u5237\u65b0\u7f13\u51b2\u5668\u7684\u4f5c\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u7a0b\u5e8f\u5728\u6b7b\u5faa\u73af\u4e4b\u524d\uff0c\u628a\u5185\u5bb9\u8f93\u51fa</p> <p>check_parent.. \u601d\u8def</p> <ul> <li>\u9996\u5148\u68c0\u67e5\u9996\u5c3e\u5b57\u7b26</li> <li>\u901a\u8fc7\u6808\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u68c0\u67e5\u62ec\u53f7\u65f6\u5019\u5408\u6cd5</li> <li>\u5728\u5faa\u73af\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u9700\u8981\u4fdd\u8bc1\u6808\u4e0d\u4e3a\u7a7a(\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u5b57\u7b26)</li> </ul> <p>\u6700\u540e\u6808\u4e3a\u7a7a\u5c31\u662f\u5408\u6cd5\u7684</p> <p>\u5982\u4f55\u627e\u4e3b\u8fd0\u7b97\u7b26</p> <p>\u8fd8\u662f\u7528\u6808\u68c0\u6d4b\u62ec\u53f7\uff0c\u6808\u4e3a\u7a7a\u8bf4\u660e\u5728\u62ec\u53f7\u5916\uff0c\u6b64\u65f6\u5e94\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u5426\u4e3a\u7b97\u672f\u8fd0\u7b97\u7b26\uff0c\u5e76\u4e14\u4fdd\u7559\u4f18\u5148\u7ea7\u6700\u4f4e\u7684\u3002</p> <p>\u5982\u4f55\u5b9e\u73b0\u8d1f\u6570</p> <p>\u5411\u524d\u770b\u4e00\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u524d\u9762\u4e00\u4e2a\u5143\u7d20\u662f \u8fd0\u7b97\u7b26\u7c7b\u578b\u6216\u8005\u51cf\u53f7\u662f\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u90a3\u4e48\u6b64\u65f6 - \u5e94\u8be5\u89e3\u6790\u4e3a \u8d1f\u53f7</p> <p>\u9012\u5f52\u6c42\u503c</p> <p>\u5982\u4f55\u8fdb\u884c\u6d4b\u8bd5</p> <p>popen \u4f1a\u8fd4\u56de\u4e00\u4e2a fp pointer\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7fp\u6765\u83b7\u53d6 c \u8bed\u8a00\u7684\u6253\u5370\u7ed3\u679c</p> <p>mannual: Conversely, reading from the stream reads the command's standard  output,  and  the  com\u2010        mand's standard input is the same as that of the process that called popen().</p> <p>\u5982\u4f55\u4fdd\u8bc1\u8868\u8fbe\u5f0f\u8fdb\u884c\u65e0\u7b26\u53f7\u8fd0\u7b97? \u7ed9\u6570\u5b57\u540e\u6dfb\u52a0 u\u3002 \u5982\u4f55\u968f\u673a\u63d2\u5165\u7a7a\u683c? \u5728\u6570\u5b57\u524d/\u540e\u9762\u968f\u673a\u751f\u6210\u7a7a\u683c\u5c31\u597d\u4e86\u3002 \u5982\u4f55\u751f\u6210\u957f\u8868\u8fbe\u5f0f, \u540c\u65f6\u4e0d\u4f1a\u4f7fbuf\u6ea2\u51fa? \u751f\u6210\u8868\u8fbe\u5f0f\u7684\u65f6\u5019\uff0c\u4f20\u5165 depth \u53c2\u6570\uff0c\u63a7\u5236 gen_expr \u7684\u9012\u5f52\u6df1\u5ea6 \u5982\u4f55\u8fc7\u6ee4\u6c42\u503c\u8fc7\u7a0b\u4e2d\u6709\u96640\u884c\u4e3a\u7684\u8868\u8fbe\u5f0f? \u5728\u7f16\u8bd1\u65f6\u542f\u7528 -Wall -Werror \u8ba9\u7f16\u8bd1\u5668\u81ea\u52a8\u8fc7\u6ee4</p> <p>static \u542b\u4e49</p> <p>\u8868\u793a\u8fd9\u4e2a\u53d8\u91cf\u4f5c\u7528\u57df\u662f\u5f53\u524d\u6587\u4ef6\uff0c\u800c\u975e\u5168\u5c40\u3002 \u7528\u5728\u6b64\u5904\u8868\u793a\uff0c\u4e0d\u5e0c\u671b\u5728\u5916\u90e8\u5f15\u7528\u8fd9\u4e24\u4e2a\u53d8\u91cf</p> <p>\u5728\u540c\u4e00\u65f6\u523b\u89e6\u53d1\u4e24\u4e2a\u4ee5\u4e0a\u7684\u76d1\u89c6\u70b9\u4e5f\u662f\u6709\u53ef\u80fd\u7684, \u4f60\u53ef\u4ee5\u81ea\u7531\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u7279\u6b8a\u60c5\u51b5, \u6211\u4eec\u5bf9\u6b64\u4e0d\u4f5c\u786c\u6027\u89c4\u5b9a.</p> <p>\u8fd9\u91cc\u6211\u76f4\u63a5 break \u4e86\uff0c\u53ea\u5904\u7406\u7b2c\u4e00\u4e2a</p> <p>\u5982\u4f55\u5b9e\u73b0\u76d1\u89c6\u70b9</p> <p>\u5982\u4f55\u6d4b\u8bd5\u76d1\u89c6\u70b9</p> <ul> <li>\u9996\u5148\u5199\u4e00\u4e2a test_bench \u6765\u9759\u6001\u6d4b\u8bd5\u89c2\u6d4b\u70b9  (\u6d4b\u8bd5\u94fe\u8868\u7ed3\u6784\u65f6\u5019\u6709\u6548)</li> <li>\u4e4b\u540e\u662f\u6d4b\u8bd5 cpu \u662f\u4e0d\u662f\u771f\u7684\u53ef\u4ee5\u68c0\u6d4b\u5230 \u89c2\u6d4b\u70b9\u3002</li> <li>\u56e0\u4e3a t0 \u5bc4\u5b58\u5668\u7684\u503c\u662f\u4f1a\u53d8\u7684\uff0c\u89c2\u6d4b\u5b83\u5c31\u597d\u4e86\u3002</li> </ul>"},{"location":"notes/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/PA1/#bug-recording","title":"bug recording","text":"<ul> <li>clangd: pp file not found.</li> </ul> <p>\u5982\u679c\u9700\u8981\u5728\u591a\u5904\u8def\u5f84\u67e5\u627e header file, \u90a3\u4e48 compile_flags.txt \u9700\u8981\u5199\u6210</p> <p><pre><code>-I\nxxx/\n-I\nxxx/\n</code></pre> <code>-I</code> \u540e\u53ea\u80fd\u6307\u5b9a\u4e00\u4e2a\u8def\u5f84</p> <p>\u540e\u9762\u53d1\u73b0\u53ef\u4ee5\u901a\u8fc7 bear \u8fd9\u4e2a\u5de5\u5177\u81ea\u52a8\u751f\u6210 <code>compile_commands.json</code>, \u5b8c\u5168\u4e0d\u9700\u8981\u624b\u52a8\u5199 <code>compile_flags.txt</code></p> <ul> <li>nvim clangd \u63d2\u4ef6\u4e0d\u80fd\u591f\u8bc6\u522b\u5b8f\u5b9a\u4e49\u662f\u5426\u6709\u6548\uff0c\u5e76\u4e14\u4ee5\u7279\u6b8a\u683c\u5f0f\u663e\u793a</li> <li><code>semanticTokens.enable: True</code></li> </ul> <p>\u626b\u63cf\u5730\u5740\u7684\u65f6\u5019\u89e6\u53d1 segment fault - \u9700\u8981\u4f7f\u7528 vaddr_read \u6765\u6a21\u62df\u5185\u5b58\u7684\u8bfb\u5199\u3002\u4f7f\u7528 *p \u7684\u65b9\u5f0f\u8bfb\u53d6\u7684\u5bbf\u4e3b\u673a\u7684\u5185\u5b58\u5355\u5143\u5185\u5bb9\uff0c\u5e76\u6ca1\u6709\u6743\u9650\u8bfb\u53d6\u3002</p> <p>\u7d22\u5f15\u81ea\u589e\u8fd0\u7b97\u5e94\u8be5\u653e\u5728\u4e00\u4e2a\u903b\u8f91\u5757\u7684\u6700\u540e\uff0c\u4e0d\u7136\u5728\u4e00\u4e2a\u903b\u8f91\u5757\u91cc\u4f1a \u4f1a\u51fa\u73b0\u4e24\u4e2a\u4e0d\u540c\u7684\u4e0b\u6807\uff0c\u8fd9\u901a\u5e38\u4e0d\u662f\u9884\u671f\u884c\u4e3a\u3002</p> <p>swicth case \u91cc\u7684\u8bed\u53e5\u8bb0\u5f97 break;</p>"}]}